// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`build import-umd > dist > app.js 1`] = `"App({globalData:{},onLaunch(){}});"`;

exports[`build import-umd > dist > app.json 1`] = `
"{
  "pages": [
    "pages/index/index",
    "pages/index/vue"
  ],
  "window": {},
  "style": "v2",
  "componentFramework": "glass-easel",
  "sitemapLocation": "sitemap.json"
}"
`;

exports[`build import-umd > dist > app.wxss 1`] = `
".app{color:red}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > components/Navbar/Navbar.js 1`] = `"Component({});"`;

exports[`build import-umd > dist > components/Navbar/Navbar.json 1`] = `
"{
  "component": true,
  "styleIsolation": "apply-shared",
  "usingComponents": {}
}"
`;

exports[`build import-umd > dist > components/Navbar/Navbar.wxml 1`] = `
"<view>Navbar</view>
"
`;

exports[`build import-umd > dist > components/Navbar/Navbar.wxss 1`] = `
".navbar{color:red}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > components/chart/index.js 1`] = `
"var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==\`object\`||typeof i==\`function\`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,\`default\`,{value:n,enumerable:!0}):a,n)),l=o(((e,t)=>{(function(n,r){typeof e==\`object\`&&t!==void 0?r(e):typeof define==\`function\`&&define.amd?define([\`exports\`],r):r((n=typeof globalThis<\`u\`?globalThis:n||self).VChart={})})(e,(function(e){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function t(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function n(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}let r=e=>e;var i,a;function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,\`default\`)?e.default:e}e.RenderModeEnum=void 0,(i=e.RenderModeEnum||={})[\`desktop-browser\`]=\`desktop-browser\`,i[\`mobile-browser\`]=\`mobile-browser\`,i.node=\`node\`,i.worker=\`worker\`,i.miniApp=\`miniApp\`,i.wx=\`wx\`,i.tt=\`tt\`,i.harmony=\`harmony\`,i[\`desktop-miniApp\`]=\`desktop-miniApp\`,i.lynx=\`lynx\`,function(e){e.cartesianAxis=\`cartesianAxis\`,e.cartesianBandAxis=\`cartesianAxis-band\`,e.cartesianLinearAxis=\`cartesianAxis-linear\`,e.cartesianTimeAxis=\`cartesianAxis-time\`,e.cartesianLogAxis=\`cartesianAxis-log\`,e.cartesianSymlogAxis=\`cartesianAxis-symlog\`,e.polarAxis=\`polarAxis\`,e.polarBandAxis=\`polarAxis-band\`,e.polarLinearAxis=\`polarAxis-linear\`,e.crosshair=\`crosshair\`,e.cartesianCrosshair=\`cartesianCrosshair\`,e.polarCrosshair=\`polarCrosshair\`,e.dataZoom=\`dataZoom\`,e.geoCoordinate=\`geoCoordinate\`,e.indicator=\`indicator\`,e.discreteLegend=\`discreteLegend\`,e.continuousLegend=\`continuousLegend\`,e.colorLegend=\`colorLegend\`,e.sizeLegend=\`sizeLegend\`,e.mapLabel=\`mapLabel\`,e.markLine=\`markLine\`,e.markArea=\`markArea\`,e.markPoint=\`markPoint\`,e.polarMarkLine=\`polarMarkLine\`,e.polarMarkArea=\`polarMarkArea\`,e.polarMarkPoint=\`polarMarkPoint\`,e.geoMarkPoint=\`geoMarkPoint\`,e.tooltip=\`tooltip\`,e.title=\`title\`,e.player=\`player\`,e.scrollBar=\`scrollBar\`,e.label=\`label\`,e.totalLabel=\`totalLabel\`,e.brush=\`brush\`,e.poptip=\`poptip\`,e.customMark=\`customMark\`}(a||={});var s={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n=\`~\`;function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if(typeof r!=\`function\`)throw TypeError(\`The listener must be a function\`);var s=new i(r,a||e,o),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function o(e,t){--e._eventsCount==0?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(this._eventsCount===0)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var c,l,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,a),!0;case 6:return u.fn.call(u.context,t,r,i,a,o),!0}for(l=1,c=Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var f,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,i);break;default:if(!c)for(f=1,c=Array(d-1);f<d;f++)c[f-1]=arguments[f];u[l].fn.apply(u[l].context,c)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var c=0,l=[],u=s.length;c<u;c++)(s[c].fn!==t||i&&!s[c].once||r&&s[c].context!==r)&&l.push(s[c]);l.length?this._events[a]=l.length===1?l[0]:l:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})(s);var c=o(s.exports),l=(e,t)=>Object.prototype.toString.call(e)===\`[object \${t}]\`,u=function(e){return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?typeof e==\`boolean\`:!0===e||!1===e||l(e,\`Boolean\`)},d=e=>typeof e==\`function\`,f=e=>e==null,p=e=>e!=null,m=e=>{let t=typeof e;return e!==null&&t===\`object\`||t===\`function\`},h=e=>typeof e==\`object\`&&!!e,g=function(e){if(!h(e)||!l(e,\`Object\`))return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},_=e=>e===void 0,v=function(e){let t=typeof e;return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?t===\`string\`:t===\`string\`||l(e,\`String\`)},y=e=>Array.isArray?Array.isArray(e):l(e,\`Array\`),b=function(e){return e!==null&&typeof e!=\`function\`&&Number.isFinite(e.length)},x=e=>l(e,\`Date\`),S=function(e){let t=typeof e;return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?t===\`number\`:t===\`number\`||l(e,\`Number\`)},C=e=>S(e)&&Number.isFinite(e),w=e=>new RegExp(/^(http(s)?:\\/\\/)\\w+[^\\s]+(\\.[^\\s]+){1,}$/).test(e),T=e=>new RegExp(/^data:image\\/(?:gif|png|jpeg|bmp|webp|svg\\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(e),E=e=>({}).toString.call(e).replace(/^\\[object /,\`\`).replace(/]$/,\`\`);let D=Object.prototype;var O=function(e){let t=e&&e.constructor;return e===(typeof t==\`function\`&&t.prototype||D)};let k=Object.prototype.hasOwnProperty;function A(e){if(f(e))return!0;if(b(e))return!e.length;let t=E(e);if(t===\`Map\`||t===\`Set\`)return!e.size;if(O(e))return!Object.keys(e).length;for(let t in e)if(k.call(e,t))return!1;return!0}var j=(e,t,n)=>{let r=v(t)?t.split(\`.\`):t;for(let t=0;t<r.length;t++)e=e?e[r[t]]:void 0;return e===void 0?n:e};let ee=Object.prototype.hasOwnProperty;var te=(e,t)=>e!=null&&ee.call(e,t);function M(e,t,n){let r;if(!p(e)||typeof e!=\`object\`||t&&t(e))return e;let i=y(e),a=e.length;r=i?Array(a):typeof e==\`object\`?{}:u(e)||S(e)||v(e)?e:x(e)?new Date(+e):void 0;let o=i?void 0:Object.keys(Object(e)),s=-1;if(r)for(;++s<(o||e).length;){let i=o?o[s]:s,a=e[i];n&&n.includes(i.toString())?r[i]=a:r[i]=M(a,t,n)}return r}function ne(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(t){if(e===t)return;if(p(t)&&typeof t==\`object\`){let i=Object(t),a=[];for(let e in i)a.push(e);let{length:o}=a,s=-1;for(;o--;){let o=a[++s];!p(i[o])||typeof i[o]!=\`object\`||r&&y(e[o])?ie(e,o,i[o]):re(e,t,o,n,r)}}}}function re(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],i=arguments.length>4&&arguments[4]!==void 0&&arguments[4],a=e[n],o=t[n],s=t[n],c=!0;if(y(o)){if(r)s=[];else if(y(a))s=a;else if(b(a)){s=Array(a.length);let e=-1,t=a.length;for(;++e<t;)s[e]=a[e]}}else g(o)?(s=a??{},typeof a!=\`function\`&&typeof a==\`object\`||(s={})):c=!1;c&&ne(s,o,r,i),ie(e,n,s)}function ie(e,t,n){(n!==void 0&&!function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}(e[t],n)||n===void 0&&!(t in e))&&(e[t]=n)}function N(e){let t=-1,n=arguments.length<=1?0:arguments.length-1;for(;++t<n;)ne(e,t+1<1||arguments.length<=t+1?void 0:arguments[t+1],!0);return e}function ae(e,t){if(!e||!g(e))return e;let n={};return Object.keys(e).forEach((r=>{let i=e[r],a=!1;t.forEach((e=>{(v(e)&&e===r||e instanceof RegExp&&r.match(e))&&(a=!0)})),a||(n[r]=i)})),n}function oe(e){return Object.prototype.toString.call(e)}function se(e){return Object.keys(e)}function ce(e,t,n){if(e===t)return!0;if(typeof e!=typeof t||e==null||t==null)return!1;if(Number.isNaN(e)&&Number.isNaN(t))return!0;if(oe(e)!==oe(t))return!1;if(d(e))return!!n?.skipFunction;if(typeof e!=\`object\`)return!1;if(y(e)){if(e.length!==t.length)return!1;for(let r=e.length-1;r>=0;r--)if(!ce(e[r],t[r],n))return!1;return!0}if(!g(e))return!1;let r=se(e),i=se(t);if(r.length!==i.length)return!1;r.sort(),i.sort();for(let e=r.length-1;e>=0;e--)if(r[e]!=i[e])return!1;for(let i=r.length-1;i>=0;i--){let a=r[i];if(!ce(e[a],t[a],n))return!1}return!0}function le(e,t,n){let r=function(e){if(!e)return[];if(Object.keys)return Object.keys(e);let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(n);return t}(t);for(let i=0;i<r.length;i++){let a=r[i];(n?t[a]!=null:e[a]==null)&&(e[a]=t[a])}return e}function ue(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(e=\`prototype\`in e?e.prototype:e,t=\`prototype\`in t?t.prototype:t,Object.getOwnPropertyNames){let r=Object.getOwnPropertyNames(t);for(let i=0;i<r.length;i++){let a=r[i];a!==\`constructor\`&&(n?t[a]!=null:e[a]==null)&&(e[a]=t[a])}}else le(e,t,n)}function P(e){return p(e)?y(e)?e:[e]:[]}function de(e){if(b(e))return e[e.length-1]}let fe=(e,t)=>{if(e.length===0)return;let n=e[0];for(let r=1;r<e.length;r++){let i=e[r];(t?.(i,n)??i-n)>0&&(n=i)}return n},pe=(e,t)=>{if(e.length===0)return;let n=e[0];for(let r=1;r<e.length;r++){let i=e[r];(t?.(i,n)??i-n)<0&&(n=i)}return n};function me(e,t){if(!y(e)||!y(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function he(e){if(!y(e))return[e];let t=[];for(let n of e)t.push(...he(n));return t}function ge(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function _e(e){return Number(e)}let ve=typeof console<\`u\`;function ye(e,t,n){let r=[t].concat([].slice.call(n));ve&&console[e].apply(console,r)}var be;(function(e){e[e.None=0]=\`None\`,e[e.Error=1]=\`Error\`,e[e.Warn=2]=\`Warn\`,e[e.Info=3]=\`Info\`,e[e.Debug=4]=\`Debug\`})(be||={});class xe{static getInstance(e,t){return xe._instance&&S(e)?xe._instance.level(e):xe._instance||=new xe(e,t),xe._instance}static setInstance(e){return xe._instance=e}static setInstanceLevel(e){xe._instance?xe._instance.level(e):xe._instance=new xe(e)}static clearInstance(){xe._instance=null}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:be.None,t=arguments.length>1?arguments[1]:void 0;this._onErrorHandler=[],this._level=e,this._method=t}addErrorHandler(e){this._onErrorHandler.find((t=>t===e))||this._onErrorHandler.push(e)}removeErrorHandler(e){let t=this._onErrorHandler.findIndex((t=>t===e));t<0||this._onErrorHandler.splice(t,1)}callErrorHandler(){var e=[...arguments];this._onErrorHandler.forEach((t=>t(...e)))}canLogInfo(){return this._level>=be.Info}canLogDebug(){return this._level>=be.Debug}canLogError(){return this._level>=be.Error}canLogWarn(){return this._level>=be.Warn}level(e){return arguments.length?(this._level=+e,this):this._level}error(){var e=[...arguments];return this._level>=be.Error&&(this._onErrorHandler.length?this.callErrorHandler(...e):ye(this._method??\`error\`,\`ERROR\`,e)),this}warn(){var e=[...arguments];return this._level>=be.Warn&&ye(this._method||\`warn\`,\`WARN\`,e),this}info(){var e=[...arguments];return this._level>=be.Info&&ye(this._method||\`log\`,\`INFO\`,e),this}debug(){var e=[...arguments];return this._level>=be.Debug&&ye(this._method||\`log\`,\`DEBUG\`,e),this}}function Se(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;for(f(r)&&(r=e.length);n<r;){let i=n+r>>>1;ge(e[i],t)>0?r=i:n=i+1}return n}xe._instance=null;function Ce(e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e-10,r=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e-10)*Math.max(e,t);return Math.abs(e-t)<=Math.max(n,r)}function we(e,t,n,r){return e>t&&!Ce(e,t,n,r)}function Te(e,t,n,r){return e<t&&!Ce(e,t,n,r)}let Ee=e=>{let t=null,n=null;return function(){for(var r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];return t&&i.every(((e,n)=>e===t[n]))||(t=i,n=e(...i)),n}};var De=function(e,t,n){return e<t?t:e>n?n:e},Oe=(e,t,n)=>{let[r,i]=e;i<r&&(r=e[1],i=e[0]);let a=i-r;return a>=n-t?[t,n]:(r=Math.min(Math.max(r,t),n-a),[r,r+a])};function ke(e,t){let n;return e>t&&(n=e,e=t,t=n),n=>Math.max(e,Math.min(t,n))}let Ae=!1;try{Ae=typeof requestAnimationFrame==\`function\`&&typeof cancelAnimationFrame==\`function\`}catch{Ae=!1}function je(e,t,n){let r,i,a,o,s,c,l=0,u=!1,d=!1,f=!0,p=!t&&t!==0&&Ae;if(typeof e!=\`function\`)throw TypeError(\`Expected a function\`);function h(t){let n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n),o}function g(e,t){return p?(cancelAnimationFrame(s),requestAnimationFrame(e)):setTimeout(e,t)}function _(e){let n=e-c;return c===void 0||n>=t||n<0||d&&e-l>=a}function v(){let e=Date.now();if(_(e))return y(e);s=g(v,function(e){let n=e-l,r=t-(e-c);return d?Math.min(r,a-n):r}(e))}function y(e){return s=void 0,f&&r?h(e):(r=i=void 0,o)}function b(){let e=Date.now(),n=_(e);for(var a=arguments.length,f=Array(a),p=0;p<a;p++)f[p]=arguments[p];if(r=f,i=this,c=e,n){if(s===void 0)return function(e){return l=e,s=g(v,t),u?h(e):o}(c);if(d)return s=g(v,t),h(c)}return s===void 0&&(s=g(v,t)),o}return t=+t||0,m(n)&&(u=!!n.leading,d=\`maxWait\`in n,d&&(a=Math.max(C(n.maxWait)?n.maxWait:0,t)),f=\`trailing\`in n?!!n.trailing:f),b.cancel=function(){s!==void 0&&function(e){if(p)return cancelAnimationFrame(e);clearTimeout(e)}(s),l=0,r=c=i=s=void 0},b.flush=function(){return s===void 0?o:y(Date.now())},b.pending=function(){return s!==void 0},b}function Me(e,t,n){let r=!0,i=!0;if(typeof e!=\`function\`)throw TypeError(\`Expected a function\`);return m(n)&&(r=\`leading\`in n?!!n.leading:r,i=\`trailing\`in n?!!n.trailing:i),je(e,t,{leading:r,trailing:i,maxWait:t})}function Ne(e,t){return n=>e*(1-n)+t*n}function Pe(e,t){return function(n){return Math.round(e*(1-n)+t*n)}}Ae=!1;let Fe=/[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,Ie=new RegExp(Fe.source,\`g\`),Le=1e-12,Re=Math.PI,ze=Re/2,Be=2*Re,F=2*Math.PI,Ve=Math.abs,He=Math.atan2,Ue=Math.cos,We=Math.max,Ge=Math.min,Ke=Math.sin,qe=Math.sqrt,Je=Math.pow;function Ye(e){return e>=1?ze:e<=-1?-ze:Math.asin(e)}function Xe(e,t,n,r,i){let a=n,o=r;return typeof e==\`number\`&&typeof n==\`number\`&&(a=(1-i)*e+i*n),typeof t==\`number\`&&typeof r==\`number\`&&(o=(1-i)*t+i*r),{x:a,y:o}}function Ze(e){let t=e.toString().split(/[eE]/),n=(t[0].split(\`.\`)[1]||\`\`).length-(+t[1]||0);return n>0?n:0}function Qe(e,t){return function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10;return Math.round(e*t)/t}(e-t,10**Math.max(Ze(e),Ze(t)))}class $e{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.x=0,this.y=0,this.x=e,this.y=t,this.x1=n,this.y1=r}clone(){return new $e(this.x,this.y)}copyFrom(e){return this.x=e.x,this.y=e.y,this.x1=e.x1,this.y1=e.y1,this.defined=e.defined,this.context=e.context,this}set(e,t){return this.x=e,this.y=t,this}add(e){return S(e)?(this.x+=e,void(this.y+=e)):(this.x+=e.x,this.y+=e.y,this)}sub(e){return S(e)?(this.x-=e,void(this.y-=e)):(this.x-=e.x,this.y-=e.y,this)}multi(e){throw Error(\`暂不支持\`)}div(e){throw Error(\`暂不支持\`)}}class et{static distancePP(e,t){return qe(Je(e.x-t.x,2)+Je(e.y-t.y,2))}static distanceNN(e,t,n,r){return qe(Je(e-n,2)+Je(t-r,2))}static distancePN(e,t,n){return qe(Je(t-e.x,2)+Je(n-e.y,2))}static pointAtPP(e,t,n){return new $e((t.x-e.x)*n+e.x,(t.y-e.y)*n+e.y)}}function tt(e){return e*(Math.PI/180)}let nt=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e<0)for(;e<-Be;)e+=Be;else if(e>0)for(;e>Be;)e-=Be;return e};function rt(e,t,n){return t?{x:e.x+t*Math.cos(n),y:e.y+t*Math.sin(n)}:{x:e.x,y:e.y}}function it(e){for(;e<0;)e+=2*Math.PI;for(;e>=2*Math.PI;)e-=2*Math.PI;return e}function at(e,t,n,r){let{x:i,y:a}=t,o=function(e,t){let n=Math.abs(t-e);if(n>=2*Math.PI||2*Math.PI-n<1e-6)return[0,Math.PI/2,Math.PI,1.5*Math.PI];let r=it(Math.min(e,t)),i=r+n,a=[r,i],o=Math.floor(r/Math.PI)*Math.PI/2;for(;o<i;)o>r&&a.push(o),o+=Math.PI/2;return a}(n,r),{width:s,height:c}=e,l=[];return o.forEach((e=>{let t=Math.sin(e),n=Math.cos(e);t===1?l.push(c-a):t===-1?l.push(a):n===1?l.push(s-i):n===-1?l.push(i):(t>0?l.push(Math.abs((c-a)/t)):l.push(Math.abs(a/t)),n>0?l.push(Math.abs((s-i)/n)):l.push(Math.abs(i/n)))})),Math.min.apply(null,l)}function ot(e){return(e=it(e))>0&&e<=Math.PI/2?2:e>Math.PI/2&&e<=Math.PI?3:e>Math.PI&&e<=3*Math.PI/2?4:1}var st;(function(e){e[e.NONE=0]=\`NONE\`,e[e.BBOX1=1]=\`BBOX1\`,e[e.BBOX2=2]=\`BBOX2\`})(st||={});let ct=(e,t,n)=>{let r=e.x1,i=e.x2,a=e.y1,o=e.y2,s=t.x1,c=t.x2,l=t.y1,u=t.y2;return n&&(r>i&&([r,i]=[i,r]),a>o&&([a,o]=[o,a]),s>c&&([s,c]=[c,s]),l>u&&([l,u]=[u,l])),{x11:r,x12:i,y11:a,y12:o,x21:s,x22:c,y21:l,y22:u}};function lt(e,t,n){if(e&&t){if(!n)return!(e.x1>t.x2||e.x2<t.x1||e.y1>t.y2||e.y2<t.y1);let{x11:r,x12:i,y11:a,y12:o,x21:s,x22:c,y21:l,y22:u}=ct(e,t,!0);return!(r>c||i<s||a>u||o<l)}return!0}function ut(e,t,n){if(!t)return!0;if(!n)return e.x>=t.x1&&e.x<=t.x2&&e.y>=t.y1&&e.y<=t.y2;let r=t.x1,i=t.x2,a=t.y1,o=t.y2;return r>i&&([r,i]=[i,r]),a>o&&([a,o]=[o,a]),e.x>=r&&e.x<=i&&e.y>=a&&e.y<=o}function dt(e,t){return Math.abs(t[0]*e[0]+t[1]*e[1])}function ft(e,t){let{x:n,y:r}=e,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{x:0,y:0};return{x:(n-i.x)*Math.cos(t)-(r-i.y)*Math.sin(t)+i.x,y:(n-i.x)*Math.sin(t)+(r-i.y)*Math.cos(t)+i.y}}function pt(e){return{x:(e.x1+e.x2)/2,y:(e.y1+e.y2)/2}}function mt(e,t){let n=t?tt(e.angle):e.angle,r=pt(e);return[ft({x:e.x1,y:e.y1},n,r),ft({x:e.x2,y:e.y1},n,r),ft({x:e.x2,y:e.y2},n,r),ft({x:e.x1,y:e.y2},n,r)]}function ht(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=mt(e,n),i=mt(t,n),a=(e,t)=>[t.x-e.x,t.y-e.y],o=a(pt(e),pt(t)),s=a(r[0],r[1]),c=a(r[1],r[2]),l=a(i[0],i[1]),u=a(i[1],i[2]),d=n?tt(e.angle):e.angle,f=n?tt(90-e.angle):e.angle+ze,p=n?tt(t.angle):t.angle,m=n?tt(90-t.angle):t.angle+ze;f>F&&(f-=F),m>F&&(m-=F);let h=(e,t,n,r)=>{let i=[Math.cos(t),Math.sin(t)];return e+(dt(i,n)+dt(i,r))/2>dt(i,o)};return h((e.x2-e.x1)/2,d,l,u)&&h((e.y2-e.y1)/2,f,l,u)&&h((t.x2-t.x1)/2,p,s,c)&&h((t.y2-t.y1)/2,m,s,c)}function gt(e,t,n,r,i,a){if(a>t&&a>r||a<t&&a<r||r===t)return 0;let o=(a-t)/(r-t),s=r<t?1:-1;o!==1&&o!==0||(s=r<t?.5:-.5);let c=o*(n-e)+e;return c===i?1/0:c>i?s:0}let _t=e=>{let t=e.charCodeAt(0),n=e.length===2?e.charCodeAt(1):0,r=t;return 55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t&=1023,n&=1023,r=t<<10|n,r+=65536),r===12288||65281<=r&&r<=65376||65504<=r&&r<=65510?\`F\`:r===8361||65377<=r&&r<=65470||65474<=r&&r<=65479||65482<=r&&r<=65487||65490<=r&&r<=65495||65498<=r&&r<=65500||65512<=r&&r<=65518?\`H\`:4352<=r&&r<=4447||4515<=r&&r<=4519||4602<=r&&r<=4607||9001<=r&&r<=9002||11904<=r&&r<=11929||11931<=r&&r<=12019||12032<=r&&r<=12245||12272<=r&&r<=12283||12289<=r&&r<=12350||12353<=r&&r<=12438||12441<=r&&r<=12543||12549<=r&&r<=12589||12593<=r&&r<=12686||12688<=r&&r<=12730||12736<=r&&r<=12771||12784<=r&&r<=12830||12832<=r&&r<=12871||12880<=r&&r<=13054||13056<=r&&r<=19903||19968<=r&&r<=42124||42128<=r&&r<=42182||43360<=r&&r<=43388||44032<=r&&r<=55203||55216<=r&&r<=55238||55243<=r&&r<=55291||63744<=r&&r<=64255||65040<=r&&r<=65049||65072<=r&&r<=65106||65108<=r&&r<=65126||65128<=r&&r<=65131||110592<=r&&r<=110593||127488<=r&&r<=127490||127504<=r&&r<=127546||127552<=r&&r<=127560||127568<=r&&r<=127569||131072<=r&&r<=194367||177984<=r&&r<=196605||196608<=r&&r<=262141?\`W\`:32<=r&&r<=126||162<=r&&r<=163||165<=r&&r<=166||r===172||r===175||10214<=r&&r<=10221||10629<=r&&r<=10630?\`Na\`:r===161||r===164||167<=r&&r<=168||r===170||173<=r&&r<=174||176<=r&&r<=180||182<=r&&r<=186||188<=r&&r<=191||r===198||r===208||215<=r&&r<=216||222<=r&&r<=225||r===230||232<=r&&r<=234||236<=r&&r<=237||r===240||242<=r&&r<=243||247<=r&&r<=250||r===252||r===254||r===257||r===273||r===275||r===283||294<=r&&r<=295||r===299||305<=r&&r<=307||r===312||319<=r&&r<=322||r===324||328<=r&&r<=331||r===333||338<=r&&r<=339||358<=r&&r<=359||r===363||r===462||r===464||r===466||r===468||r===470||r===472||r===474||r===476||r===593||r===609||r===708||r===711||713<=r&&r<=715||r===717||r===720||728<=r&&r<=731||r===733||r===735||768<=r&&r<=879||913<=r&&r<=929||931<=r&&r<=937||945<=r&&r<=961||963<=r&&r<=969||r===1025||1040<=r&&r<=1103||r===1105||r===8208||8211<=r&&r<=8214||8216<=r&&r<=8217||8220<=r&&r<=8221||8224<=r&&r<=8226||8228<=r&&r<=8231||r===8240||8242<=r&&r<=8243||r===8245||r===8251||r===8254||r===8308||r===8319||8321<=r&&r<=8324||r===8364||r===8451||r===8453||r===8457||r===8467||r===8470||8481<=r&&r<=8482||r===8486||r===8491||8531<=r&&r<=8532||8539<=r&&r<=8542||8544<=r&&r<=8555||8560<=r&&r<=8569||r===8585||8592<=r&&r<=8601||8632<=r&&r<=8633||r===8658||r===8660||r===8679||r===8704||8706<=r&&r<=8707||8711<=r&&r<=8712||r===8715||r===8719||r===8721||r===8725||r===8730||8733<=r&&r<=8736||r===8739||r===8741||8743<=r&&r<=8748||r===8750||8756<=r&&r<=8759||8764<=r&&r<=8765||r===8776||r===8780||r===8786||8800<=r&&r<=8801||8804<=r&&r<=8807||8810<=r&&r<=8811||8814<=r&&r<=8815||8834<=r&&r<=8835||8838<=r&&r<=8839||r===8853||r===8857||r===8869||r===8895||r===8978||9312<=r&&r<=9449||9451<=r&&r<=9547||9552<=r&&r<=9587||9600<=r&&r<=9615||9618<=r&&r<=9621||9632<=r&&r<=9633||9635<=r&&r<=9641||9650<=r&&r<=9651||9654<=r&&r<=9655||9660<=r&&r<=9661||9664<=r&&r<=9665||9670<=r&&r<=9672||r===9675||9678<=r&&r<=9681||9698<=r&&r<=9701||r===9711||9733<=r&&r<=9734||r===9737||9742<=r&&r<=9743||9748<=r&&r<=9749||r===9756||r===9758||r===9792||r===9794||9824<=r&&r<=9825||9827<=r&&r<=9829||9831<=r&&r<=9834||9836<=r&&r<=9837||r===9839||9886<=r&&r<=9887||9918<=r&&r<=9919||9924<=r&&r<=9933||9935<=r&&r<=9953||r===9955||9960<=r&&r<=9983||r===10045||r===10071||10102<=r&&r<=10111||11093<=r&&r<=11097||12872<=r&&r<=12879||57344<=r&&r<=63743||65024<=r&&r<=65039||r===65533||127232<=r&&r<=127242||127248<=r&&r<=127277||127280<=r&&r<=127337||127344<=r&&r<=127386||917760<=r&&r<=917999||983040<=r&&r<=1048573||1048576<=r&&r<=1114109?\`A\`:\`N\`};function vt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;n||=1;let{fontStyle:r=t.fontStyle,fontVariant:i=t.fontVariant,fontWeight:a=t.fontWeight,fontSize:o=t.fontSize,fontFamily:s=t.fontFamily}=e;return(r?r+\` \`:\`\`)+(i?i+\` \`:\`\`)+(a?a+\` \`:\`\`)+o*n+\`px \`+(s||\`sans-serif\`)}class yt{constructor(e,t){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=\`-/: .,@%'"~\`,this._option=e,this._userSpec=t??{},this.textSpec=this._initSpec(),p(e.specialCharSet)&&(this.specialCharSet=e.specialCharSet),this._standardMethod=p(e.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(f(this._canvas)&&(p(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),f(this._canvas)&&typeof window<\`u\`&&window.document!==void 0&&globalThis&&p(globalThis.document)&&(this._canvas=globalThis.document.createElement(\`canvas\`))),f(this._context)&&p(this._canvas)){let e=this._canvas.getContext(\`2d\`);p(e)&&(e.save(),e.font=vt(this.textSpec),this._contextSaved=!0,this._context=e)}return!f(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){let{defaultFontParams:e={}}=this._option,{fontStyle:t=e.fontStyle,fontVariant:n=e.fontVariant,fontWeight:r=e.fontWeight??\`normal\`,fontSize:i=e.fontSize??12,fontFamily:a=e.fontFamily??\`sans-serif\`,align:o,textAlign:s=o??\`center\`,baseline:c,textBaseline:l=c??\`middle\`,ellipsis:u,limit:d}=this._userSpec,{lineHeight:f=i}=this._userSpec;if(v(f)&&f[f.length-1]===\`%\`){let e=Number.parseFloat(f.substring(0,f.length-1))/100;f=i*e}return{fontStyle:t,fontVariant:n,fontFamily:a,fontSize:i,fontWeight:r,textAlign:s,textBaseline:l,ellipsis:u,limit:d,lineHeight:f}}measure(e,t){switch(t){case\`vrender\`:case\`canopus\`:return this.fullMeasure(e);case\`canvas\`:return this.measureWithNaiveCanvas(e);case\`simple\`:return this.quickMeasureWithoutCanvas(e);default:return this.quickMeasure(e)}}fullMeasure(e){if(f(e))return{width:0,height:0};if(f(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(e);let{fontFamily:t,fontSize:n,fontWeight:r,textAlign:i,textBaseline:a,ellipsis:o,limit:s,lineHeight:c}=this.textSpec,l;try{let u=this._option.getTextBounds({text:e,fontFamily:t,fontSize:n,fontWeight:r,textAlign:i,textBaseline:a,ellipsis:!!o,maxLineWidth:s||1/0,lineHeight:c});l={width:u.width(),height:u.height()}}catch{this._notSupportVRender=!0,l=this.measureWithNaiveCanvas(e)}return l}measureWithNaiveCanvas(e){return this._measureReduce(e,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(e){if(!this.initContext())return this._quickMeasureWithoutCanvas(e);let t=this._context.measureText(e),{fontSize:n,lineHeight:r}=this.textSpec;return{width:t.width,height:r??n,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}quickMeasure(e){return this._measureReduce(e,this._quickMeasure.bind(this))}_quickMeasure(e){let t={width:0,height:0};for(let n=0;n<e.length;n++){let r=e[n],i=this._measureSpecialChar(r);f(i)&&yt.NUMBERS_CHAR_SET.includes(r)&&(i=this._measureNumberChar()),f(i)&&[\`F\`,\`W\`].includes(_t(r))&&(i=this._measureFullSizeChar()),f(i)&&(i=this._measureLetterChar()),t.width+=i.width,t.height=Math.max(t.height,i.height),!f(i.fontBoundingBoxAscent)&&(t.fontBoundingBoxAscent=i.fontBoundingBoxAscent),!f(i.fontBoundingBoxDescent)&&(t.fontBoundingBoxDescent=i.fontBoundingBoxDescent)}return t}quickMeasureWithoutCanvas(e){return this._measureReduce(e,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(e){let t={width:0,height:0},{fontSize:n,lineHeight:r}=this.textSpec;for(let r=0;r<e.length;r++){let i=e[r],a=[\`F\`,\`W\`].includes(_t(i))?1:.53;t.width+=a*n}return t.height=r??n,t}_measureReduce(e,t){let{fontSize:n,lineHeight:r}=this.textSpec,i={width:0,height:0};if(f(e))return i;if(y(e)){let a=e.filter(p).map((e=>e.toString()));return a.length===0?i:a.length===1?t(a[0]):{width:a.reduce(((e,n)=>Math.max(e,t(n).width)),0),height:a.length*((r??n)+1)+1}}return t(e.toString())}_measureNumberChar(){if(f(this._numberCharSize)){let e=this._standardMethod(yt.NUMBERS_CHAR_SET);this._numberCharSize={width:e.width/yt.NUMBERS_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return f(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(yt.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(f(this._letterCharSize)){let e=this._standardMethod(yt.ALPHABET_CHAR_SET);this._letterCharSize={width:e.width/yt.ALPHABET_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(e){return p(this._specialCharSizeMap[e])?this._specialCharSizeMap[e]:this.specialCharSet.includes(e)?(this._specialCharSizeMap[e]=this._standardMethod(e),this._specialCharSizeMap[e]):null}release(){p(this._canvas)&&(this._canvas=null),p(this._context)&&(this._contextSaved&&=(this._context.restore(),!1),this._context=null)}}yt.ALPHABET_CHAR_SET=\`abcdefghijklmnopqrstuvwxyz\`,yt.NUMBERS_CHAR_SET=\`0123456789\`,yt.FULL_SIZE_CHAR=\`字\`;function bt(e,t,n){let{x1:r,y1:i,x2:a,y2:o}=t;return n.onlyTranslate()?(e!==t&&e.setValue(t.x1,t.y1,t.x2,t.y2),e.translate(n.e,n.f),t):(e.clear(),e.add(n.a*r+n.c*i+n.e,n.b*r+n.d*i+n.f),e.add(n.a*a+n.c*i+n.e,n.b*a+n.d*i+n.f),e.add(n.a*a+n.c*o+n.e,n.b*a+n.d*o+n.f),e.add(n.a*r+n.c*o+n.e,n.b*r+n.d*o+n.f),t)}class xt{constructor(e){e?this.setValue(e.x1,e.y1,e.x2,e.y2):this.clear()}clone(){return new xt(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2}setValue(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this}set(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this}add(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this}expand(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return y(e)?(this.y1-=e[0],this.x2+=e[1],this.y2+=e[2],this.x1-=e[3]):(this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this}rotate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=this.scalePoints(e,t,n,r);return this.clear().add(i[0],i[1]).add(i[2],i[3])}union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this}intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this}encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2}alignsWith(e){return e&&(this.x1===e.x1||this.x2===e.x2||this.y1===e.y1||this.y2===e.y2)}intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)}contains(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)}containsPoint(e){return!(e.x<this.x1||e.x>this.x2||e.y<this.y1||e.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.x1*=e,this.x2*=e,this}scaleY(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.y1*=e,this.y2*=e,this}transformWithMatrix(e){return bt(this,this,e),this}copy(e){return this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this}rotatedPoints(e,t,n){let{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),c=Math.sin(e),l=t-t*s+n*c,u=n-t*c-n*s;return[s*r-c*i+l,c*r+s*i+u,s*r-c*o+l,c*r+s*o+u,s*a-c*i+l,c*a+s*i+u,s*a-c*o+l,c*a+s*o+u]}scalePoints(e,t,n,r){let{x1:i,y1:a,x2:o,y2:s}=this;return[e*i+(1-e)*n,t*a+(1-t)*r,e*o+(1-e)*n,t*s+(1-t)*r]}}class St extends xt{}class Ct extends xt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(e),e&&(this.angle=e.angle??t)}intersects(e){return ht(this,e)}setValue(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return super.setValue(e,t,n,r),this.angle=i,this}clone(){return new Ct(this)}}class wt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=a}equalToMatrix(e){return!(this.e!==e.e||this.f!==e.f||this.a!==e.a||this.d!==e.d||this.b!==e.b||this.c!==e.c)}equalTo(e,t,n,r,i,a){return!(this.e!==i||this.f!==a||this.a!==e||this.d!==r||this.b!==t||this.c!==n)}setValue(e,t,n,r,i,a){return this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=a,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){let e=this.a,t=this.b,n=this.c,r=this.d,i=this.e,a=this.f,o=new wt,s=e*r-t*n;return o.a=r/s,o.b=-t/s,o.c=-n/s,o.d=e/s,o.e=(n*a-r*i)/s,o.f=-(e*a-t*i)/s,o}rotate(e){let t=Math.cos(e),n=Math.sin(e),r=this.a*t+this.c*n,i=this.b*t+this.d*n,a=this.a*-n+this.c*t,o=this.b*-n+this.d*t;return this.a=r,this.b=i,this.c=a,this.d=o,this}rotateByCenter(e,t,n){let r=Math.cos(e),i=Math.sin(e),a=(1-r)*t+i*n,o=(1-r)*n-i*t,s=r*this.a-i*this.b,c=i*this.a+r*this.b,l=r*this.c-i*this.d,u=i*this.c+r*this.d,d=r*this.e-i*this.f+a,f=i*this.e+r*this.f+o;return this.a=s,this.b=c,this.c=l,this.d=u,this.e=d,this.f=f,this}scale(e,t){return this.a*=e,this.b*=e,this.c*=t,this.d*=t,this}setScale(e,t){return this.b=this.b/this.a*e,this.c=this.c/this.d*t,this.a=e,this.d=t,this}transform(e,t,n,r,i,a){return this.multiply(e,t,n,r,i,a),this}translate(e,t){return this.e+=this.a*e+this.c*t,this.f+=this.b*e+this.d*t,this}transpose(){let{a:e,b:t,c:n,d:r,e:i,f:a}=this;return this.a=t,this.b=e,this.c=r,this.d=n,this.e=a,this.f=i,this}multiply(e,t,n,r,i,a){let o=this.a,s=this.b,c=this.c,l=this.d,u=o*e+c*t,d=s*e+l*t,f=o*n+c*r,p=s*n+l*r,m=o*i+c*a+this.e,h=s*i+l*a+this.f;return this.a=u,this.b=d,this.c=f,this.d=p,this.e=m,this.f=h,this}interpolate(e,t){let n=new wt;return n.a=this.a+(e.a-this.a)*t,n.b=this.b+(e.b-this.b)*t,n.c=this.c+(e.c-this.c)*t,n.d=this.d+(e.d-this.d)*t,n.e=this.e+(e.e-this.e)*t,n.f=this.f+(e.f-this.f)*t,n}transformPoint(e,t){let{a:n,b:r,c:i,d:a,e:o,f:s}=this,c=n*a-r*i,l=a/c,u=-r/c,d=-i/c,f=n/c,p=(i*s-a*o)/c,m=-(n*s-r*o)/c,{x:h,y:g}=e;t.x=h*l+g*d+p,t.y=h*u+g*f+m}onlyTranslate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this.a===e&&this.b===0&&this.c===0&&this.d===e}clone(){return new wt(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){let e=this.a,t=this.b,n=this.c,r=this.d,i=e*r-t*n,a={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!==0||t!==0){let o=Math.sqrt(e*e+t*t);a.rotateDeg=t>0?Math.acos(e/o):-Math.acos(e/o),a.scaleX=o,a.scaleY=i/o,a.skewX=(e*n+t*r)/i,a.skewY=0}else if(n!==0||r!==0){let o=Math.sqrt(n*n+r*r);a.rotateDeg=Math.PI/2-(r>0?Math.acos(-n/o):-Math.acos(n/o)),a.scaleX=i/o,a.scaleY=o,a.skewX=0,a.skewY=(e*n+t*r)/i}return a.rotateDeg=180*a.rotateDeg/Math.PI,a}}class Tt{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(e,t){let{CLEAN_THRESHOLD:n=this.CLEAN_THRESHOLD,L_TIME:r=this.L_TIME,R_COUNT:i=this.R_COUNT}=t;if(e.size<n)return 0;let a=0,o=t=>{a++,e.delete(t)},s=Date.now();return e.forEach(((e,t)=>{if(e.timestamp.length<i)return o(t);let n=0;for(;s-e.timestamp[e.timestamp.length-1-n]<r&&(n++,!(n>=i)););if(n<i)return o(t);for(;s-e.timestamp[0]>r;)e.timestamp.shift()})),a}addLimitedTimestamp(e,t,n){let{R_TIMESTAMP_MAX_SIZE:r=this.R_TIMESTAMP_MAX_SIZE}=n;e.timestamp.length>r&&e.timestamp.shift(),e.timestamp.push(t)}clearTimeStamp(e,t){let{L_TIME:n=this.L_TIME}=t,r=Date.now();e.forEach((e=>{for(;r-e.timestamp[0]>n;)e.timestamp.shift()}))}clearItemTimestamp(e,t){let{L_TIME:n=this.L_TIME}=t,r=Date.now();for(;r-e.timestamp[0]>n;)e.timestamp.shift()}}function Et(e,t,n){t/=100,n/=100;let r=(1-Math.abs(2*n-1))*t,i=r*(1-Math.abs(e/60%2-1)),a=n-r/2,o=0,s=0,c=0;return 0<=e&&e<60?(o=r,s=i,c=0):60<=e&&e<120?(o=i,s=r,c=0):120<=e&&e<180?(o=0,s=r,c=i):180<=e&&e<240?(o=0,s=i,c=r):240<=e&&e<300?(o=i,s=0,c=r):300<=e&&e<360&&(o=r,s=0,c=i),o=Math.round(255*(o+a)),s=Math.round(255*(s+a)),c=Math.round(255*(c+a)),{r:o,g:s,b:c}}function Dt(e,t,n){e/=255,t/=255,n/=255;let r=Math.min(e,t,n),i=Math.max(e,t,n),a=i-r,o=0,s=0,c=0;return o=a===0?0:i===e?(t-n)/a%6:i===t?(n-e)/a+2:(e-t)/a+4,o=Math.round(60*o),o<0&&(o+=360),c=(i+r)/2,s=a===0?0:a/(1-Math.abs(2*c-1)),s=+(100*s).toFixed(1),c=+(100*c).toFixed(1),{h:o,s,l:c}}let Ot=/^#([0-9a-f]{3,8})$/,kt={transparent:4294967040},At={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function jt(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?\`0\`:\`\`)+e.toString(16)}function Mt(e){return S(e)?new Lt(e>>16,e>>8&255,255&e,1):y(e)?new Lt(e[0],e[1],e[2]):new Lt(255,255,255)}function Nt(e){return e<.04045?.0773993808*e:(.9478672986*e+.0521327014)**2.4}function Pt(e){return e<.0031308?12.92*e:1.055*e**.41666-.055}let Ft=(e,t)=>{let n=Ot.exec(e);if(t||n){let e=parseInt(n[1],16),t=n[1].length;return t===3?new Lt((e>>8&15)+((e>>8&15)<<4),(e>>4&15)+((e>>4&15)<<4),(15&e)+((15&e)<<4),1):t===6?Mt(e):t===8?new Lt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):null}};class It{static Brighter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return t===1?e:new It(e).brighter(t).toRGBA()}static SetOpacity(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return t===1?e:new It(e).setOpacity(t).toRGBA()}static getColorBrightness(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:\`hsl\`,n=e instanceof It?e:new It(e);switch(t){case\`hsv\`:default:return n.getHSVBrightness();case\`hsl\`:return n.getHSLBrightness();case\`lum\`:return n.getLuminance();case\`lum2\`:return n.getLuminance2();case\`lum3\`:return n.getLuminance3();case\`wcag\`:return n.getLuminanceWCAG()}}static parseColorString(e){if(p(kt[e]))return function(e){return S(e)?new Lt(e>>>24,e>>>16&255,e>>>8&255,255&e):y(e)?new Lt(e[0],e[1],e[2],e[3]):new Lt(255,255,255,1)}(kt[e]);if(p(At[e]))return Mt(At[e]);let t=\`\${e}\`.trim().toLowerCase(),n=Ft(t);if(n!==void 0)return n;if(/^(rgb|RGB|rgba|RGBA)/.test(t)){let e=t.replace(/(?:\\(|\\)|rgba|RGBA|rgb|RGB)*/g,\`\`).split(\`,\`);return new Lt(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),parseFloat(e[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(t)){let e=t.replace(/(?:\\(|\\)|hsla|HSLA|hsl|HSL)*/g,\`\`).split(\`,\`),n=Et(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10));return new Lt(n.r,n.g,n.b,parseFloat(e[3]))}}constructor(e){let t=It.parseColorString(e);t?this.color=t:(console.warn(\`Warn: 传入\${e}无法解析为Color\`),this.color=new Lt(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(e){let{r:t,g:n,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(t*e))),this.color.g=Math.max(0,Math.min(255,Math.floor(n*e))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*e))),this}add(e){let{r:t,g:n,b:r}=this.color;return this.color.r+=Math.min(255,t+e.color.r),this.color.g+=Math.min(255,n+e.color.g),this.color.b+=Math.min(255,r+e.color.b),this}sub(e){return this.color.r=Math.max(0,this.color.r-e.color.r),this.color.g=Math.max(0,this.color.g-e.color.g),this.color.b=Math.max(0,this.color.b-e.color.b),this}multiply(e){let{r:t,g:n,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(t*e.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(n*e.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*e.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(e,t,n){let r=this.color.opacity,i=Dt(this.color.r,this.color.g,this.color.b),a=Et(f(e)?i.h:De(e,0,360),f(t)?i.s:t>=0&&t<=1?100*t:t,f(n)?i.l:n<=1&&n>=0?100*n:n);return this.color=new Lt(a.r,a.g,a.b,r),this}setRGB(e,t,n){return!f(e)&&(this.color.r=e),!f(t)&&(this.color.g=t),!f(n)&&(this.color.b=n),this}setHex(e){let t=\`\${e}\`.trim().toLowerCase();return Ft(t,!0)??this}setColorName(e){let t=At[e.toLowerCase()];return t===void 0?console.warn(\`THREE.Color: Unknown color \`+e):this.setHex(t),this}setScalar(e){return this.color.r=e,this.color.g=e,this.color.b=e,this}setOpacity(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this.color.opacity=e,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){let e=this.color.r/255,t=this.color.g/255,n=this.color.b/255,r,i,a;return r=e<=.03928?e/12.92:((e+.055)/1.055)**2.4,i=t<=.03928?t/12.92:((t+.055)/1.055)**2.4,a=n<=.03928?n/12.92:((n+.055)/1.055)**2.4,.2126*r+.7152*i+.0722*a}clone(){return new It(this.color.toString())}copyGammaToLinear(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return this.color.r=e.color.r**+t,this.color.g=e.color.g**+t,this.color.b=e.color.b**+t,this}copyLinearToGamma(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=t>0?1/t:1;return this.color.r=e.color.r**+n,this.color.g=e.color.g**+n,this.color.b=e.color.b**+n,this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.color.r=Nt(e.color.r),this.color.g=Nt(e.color.g),this.color.b=Nt(e.color.b),this}copyLinearToSRGB(e){return this.color.r=Pt(e.color.r),this.color.g=Pt(e.color.g),this.color.b=Pt(e.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class Lt{constructor(e,t,n,r){this.r=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.g=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.b=isNaN(+n)?255:Math.max(0,Math.min(255,+n)),p(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return\`#\${jt(this.r)+jt(this.g)+jt(this.b)+(this.opacity===1?\`\`:jt(255*this.opacity))}\`}formatRgb(){let e=this.opacity;return\`\${e===1?\`rgb(\`:\`rgba(\`}\${this.r},\${this.g},\${this.b}\${e===1?\`)\`:\`,\${e})\`}\`}formatHsl(){let e=this.opacity,{h:t,s:n,l:r}=Dt(this.r,this.g,this.b);return\`\${e===1?\`hsl(\`:\`hsla(\`}\${t},\${n}%,\${r}%\${e===1?\`)\`:\`,\${e})\`}\`}toString(){return this.formatHex()}}function Rt(e){let t=\`\`,n=\`\`,r=\`\`,i=e[0]===\`#\`?1:0;for(let a=i;a<e.length;a++)e[a]!==\`#\`&&(a<i+2?t+=e[a]:a<i+4?n+=e[a]:a<i+6&&(r+=e[a]));return[parseInt(t,16),parseInt(n,16),parseInt(r,16)]}var zt=Object.freeze({__proto__:null,Color:It,DEFAULT_COLORS:At,RGB:Lt,hexToRgb:Rt,hslToRgb:Et,interpolateRgb:function(e,t){let n=e.r,r=t.r,i=e.g,a=t.g,o=e.b,s=t.b,c=e.opacity,l=t.opacity;return e=>{let t=Math.round(n*(1-e)+r*e),u=Math.round(i*(1-e)+a*e),d=Math.round(o*(1-e)+s*e);return new Lt(t,u,d,c*(1-e)+l*e)}},rgbToHex:function(e,t,n){return Number((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},rgbToHsl:Dt});function Bt(e){if(C(e))return[e,e,e,e];if(y(e)){let t=e.length;if(t===1){let t=e[0];return[t,t,t,t]}if(t===2){let[t,n]=e;return[t,n,t,n]}if(t===3){let[t,n,r]=e;return[t,n,r,n]}if(t===4)return e}if(m(e)){let{top:t=0,right:n=0,bottom:r=0,left:i=0}=e;return[t,n,r,i]}return[0,0,0,0]}function Vt(e){let t,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!e)return{width:n,height:r};try{t=window==null?void 0:window.getComputedStyle}catch{t=()=>({})}let i=t(e);if(/^(\\d*\\.?\\d+)(px)$/.exec(i.width)){let t=parseFloat(i.width)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)||e.clientWidth-1,a=parseFloat(i.height)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)||e.clientHeight-1;return{width:t<=0?n:t,height:a<=0?r:a}}return{width:n,height:r}}class Ht{static getInstance(){return Ht.instance||=new Ht,Ht.instance}constructor(){this.locale_shortWeekdays=[\`Sun\`,\`Mon\`,\`Tue\`,\`Wed\`,\`Thu\`,\`Fri\`,\`Sat\`],this.locale_periods=[\`AM\`,\`PM\`],this.locale_weekdays=[\`Sunday\`,\`Monday\`,\`Tuesday\`,\`Wednesday\`,\`Thursday\`,\`Friday\`,\`Saturday\`],this.locale_shortMonths=[\`Jan\`,\`Feb\`,\`Mar\`,\`Apr\`,\`May\`,\`Jun\`,\`Jul\`,\`Aug\`,\`Sep\`,\`Oct\`,\`Nov\`,\`Dec\`],this.numberRe=/^\\s*\\d+/,this.pads={"-":\`\`,_:\` \`,0:\`0\`},this.requoteRe=/[\\\\^$*+?|[\\]().{}]/g,this.locale_months=[\`January\`,\`February\`,\`March\`,\`April\`,\`May\`,\`June\`,\`July\`,\`August\`,\`September\`,\`October\`,\`November\`,\`December\`],this.formatShortWeekday=e=>this.locale_shortWeekdays[e.getDay()],this.formatWeekday=e=>this.locale_weekdays[e.getDay()],this.formatShortMonth=e=>this.locale_shortMonths[e.getMonth()],this.formatMonth=e=>this.locale_months[e.getMonth()],this.formatDayOfMonth=(e,t)=>this.pad(e.getDate(),t,2),this.formatHour24=(e,t)=>this.pad(e.getHours(),t,2),this.formatHour12=(e,t)=>this.pad(e.getHours()%12||12,t,2),this.formatMilliseconds=(e,t)=>this.pad(e.getMilliseconds(),t,3),this.formatMonthNumber=(e,t)=>this.pad(e.getMonth()+1,t,2),this.formatMinutes=(e,t)=>this.pad(e.getMinutes(),t,2),this.formatPeriod=e=>this.locale_periods[+(e.getHours()>=12)],this.formatSeconds=(e,t)=>this.pad(e.getSeconds(),t,2),this.formatFullYear=(e,t)=>this.pad(e.getFullYear()%1e4,t,4),this.formatUTCShortWeekday=e=>this.locale_shortWeekdays[e.getUTCDay()],this.formatUTCWeekday=e=>this.locale_weekdays[e.getUTCDay()],this.formatUTCShortMonth=e=>this.locale_shortMonths[e.getUTCMonth()],this.formatUTCMonth=e=>this.locale_months[e.getUTCMonth()],this.formatUTCDayOfMonth=(e,t)=>this.pad(e.getUTCDate(),t,2),this.formatUTCHour24=(e,t)=>this.pad(e.getUTCHours(),t,2),this.formatUTCHour12=(e,t)=>this.pad(e.getUTCHours()%12||12,t,2),this.formatUTCMilliseconds=(e,t)=>this.pad(e.getUTCMilliseconds(),t,3),this.formatUTCMonthNumber=(e,t)=>this.pad(e.getUTCMonth()+1,t,2),this.formatUTCMinutes=(e,t)=>this.pad(e.getUTCMinutes(),t,2),this.formatUTCPeriod=e=>this.locale_periods[+(e.getUTCHours()>=12)],this.formatUTCSeconds=(e,t)=>this.pad(e.getUTCSeconds(),t,2),this.formatUTCFullYear=(e,t)=>this.pad(e.getUTCFullYear()%1e4,t,4),this.formats={a:this.formatShortWeekday,A:this.formatWeekday,b:this.formatShortMonth,B:this.formatMonth,d:this.formatDayOfMonth,e:this.formatDayOfMonth,H:this.formatHour24,I:this.formatHour12,L:this.formatMilliseconds,m:this.formatMonthNumber,M:this.formatMinutes,p:this.formatPeriod,S:this.formatSeconds,Y:this.formatFullYear},this.utcFormats={a:this.formatUTCShortWeekday,A:this.formatUTCWeekday,b:this.formatUTCShortMonth,B:this.formatUTCMonth,d:this.formatUTCDayOfMonth,e:this.formatUTCDayOfMonth,H:this.formatUTCHour24,I:this.formatUTCHour12,L:this.formatUTCMilliseconds,m:this.formatUTCMonthNumber,M:this.formatUTCMinutes,p:this.formatUTCPeriod,S:this.formatUTCSeconds,Y:this.formatUTCFullYear},this.parseShortWeekday=(e,t,n)=>{let r=this.shortWeekdayRe.exec(t.slice(n));return r?(e.w=this.shortWeekdayLookup.get(r[0].toLowerCase()),n+r[0].length):-1},this.parseWeekday=(e,t,n)=>{let r=this.weekdayRe.exec(t.slice(n));return r?(e.w=this.weekdayLookup.get(r[0].toLowerCase()),n+r[0].length):-1},this.parseShortMonth=(e,t,n)=>{let r=this.shortMonthRe.exec(t.slice(n));return r?(e.m=this.shortMonthLookup.get(r[0].toLowerCase()),n+r[0].length):-1},this.parseMonth=(e,t,n)=>{let r=this.monthRe.exec(t.slice(n));return r?(e.m=this.monthLookup.get(r[0].toLowerCase()),n+r[0].length):-1},this.parseDayOfMonth=(e,t,n)=>{let r=this.numberRe.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1},this.parseHour24=(e,t,n)=>{let r=this.numberRe.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1},this.parseMilliseconds=(e,t,n)=>{let r=this.numberRe.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1},this.parseMonthNumber=(e,t,n)=>{let r=this.numberRe.exec(t.slice(n,n+2));return r?(e.m=r-1,n+r[0].length):-1},this.parseMinutes=(e,t,n)=>{let r=this.numberRe.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1},this.parsePeriod=(e,t,n)=>{let r=this.periodRe.exec(t.slice(n));return r?(e.p=this.periodLookup.get(r[0].toLowerCase()),n+r[0].length):-1},this.parseSeconds=(e,t,n)=>{let r=this.numberRe.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1},this.parseFullYear=(e,t,n)=>{let r=this.numberRe.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1},this.parses={a:this.parseShortWeekday,A:this.parseWeekday,b:this.parseShortMonth,B:this.parseMonth,d:this.parseDayOfMonth,e:this.parseDayOfMonth,H:this.parseHour24,I:this.parseHour24,L:this.parseMilliseconds,m:this.parseMonthNumber,M:this.parseMinutes,p:this.parsePeriod,S:this.parseSeconds,Y:this.parseFullYear},this.timeFormat=(e,t)=>this.newFormat(e,this.formats)(new Date(this.getFullTimeStamp(t))),this.timeUTCFormat=(e,t)=>this.newFormat(e,this.utcFormats)(new Date(this.getFullTimeStamp(t))),this.timeParse=(e,t)=>this.newParse(e,!1)(t+\`\`),this.requoteF=this.requote.bind(this),this.periodRe=this.formatRe(this.locale_periods),this.periodLookup=this.formatLookup(this.locale_periods),this.weekdayRe=this.formatRe(this.locale_weekdays),this.weekdayLookup=this.formatLookup(this.locale_weekdays),this.shortWeekdayRe=this.formatRe(this.locale_shortWeekdays),this.shortWeekdayLookup=this.formatLookup(this.locale_shortWeekdays),this.monthRe=this.formatRe(this.locale_months),this.monthLookup=this.formatLookup(this.locale_months),this.shortMonthRe=this.formatRe(this.locale_shortMonths),this.shortMonthLookup=this.formatLookup(this.locale_shortMonths)}requote(e){return e.replace(this.requoteRe,\`\\\\$&\`)}localDate(e){if(0<=e.y&&e.y<100){let t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}utcDate(e){if(0<=e.y&&e.y<100){let t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}newDate(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}formatRe(e){return RegExp(\`^(?:\`+e.map(this.requoteF).join(\`|\`)+\`)\`,\`i\`)}formatLookup(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}pad(e,t,n){let r=e<0?\`-\`:\`\`,i=(r?-e:e)+\`\`,a=i.length;return r+(a<n?Array(n-a+1).join(t)+i:i)}parseSpecifier(e,t,n,r){let i=0,a=t.length,o=n.length,s,c;for(;i<a;){if(r>=o)return-1;if(s=t.charCodeAt(i++),s===37){if(s=t.charAt(i++),c=this.parses[s in this.pads?t.charAt(i++):s],!c||(r=c(e,n,r))<0)return-1}else if(s!==n.charCodeAt(r++))return-1}return r}newParse(e,t){let n=this;return function(r){let i=n.newDate(1900,void 0,1);return n.parseSpecifier(i,e,r+=\`\`,0)===r.length?\`Q\`in i?new Date(i.Q):\`s\`in i?new Date(1e3*i.s+(\`L\`in i?i.L:0)):(t&&!(\`Z\`in i)&&(i.Z=0),\`p\`in i&&(i.H=i.H%12+12*i.p),i.m===void 0&&(i.m=\`q\`in i?i.q:0),\`Z\`in i?(i.H+=i.Z/100|0,i.M+=i.Z%100,n.utcDate(i)):n.localDate(i)):null}}newFormat(e,t){let n=this;return function(r){let i=[],a=-1,o=0,s=e.length,c,l,u;for(r instanceof Date||(r=new Date(+r));++a<s;)e.charCodeAt(a)===37&&(i.push(e.slice(o,a)),(l=n.pads[c=e.charAt(++a)])?c=e.charAt(++a):l=c===\`e\`?\` \`:\`0\`,u=t[c],c=u(r,l),i.push(c),o=a+1);return i.push(e.slice(o,a)),i.join(\`\`)}}getFullTimeStamp(e){let t=parseInt(e+\`\`,10);return String(t).length===10?1e3*t:t}}function Ut(e,t){let n=t?e.toExponential(t-1):e.toExponential(),r=n.indexOf(\`e\`);if(r<0)return null;let i=n.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+n.slice(r+1)]}let Wt;function Gt(e,t){let n=Ut(e,t);if(!n)return e+\`\`;let r=n[0],i=n[1];return i<0?\`0.\`+Array(-i).join(\`0\`)+r:r.length>i+1?r.slice(0,i+1)+\`.\`+r.slice(i+1):r+Array(i-r.length+2).join(\`0\`)}class Kt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fill=e.fill===void 0?\` \`:e.fill+\`\`,this.align=e.align===void 0?\`>\`:e.align+\`\`,this.sign=e.sign===void 0?\`-\`:e.sign+\`\`,this.symbol=e.symbol===void 0?\`\`:e.symbol+\`\`,this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?\`\`:e.type+\`\`}toString(){return this.fill+this.align+this.sign+this.symbol+(this.zero?\`0\`:\`\`)+(this.width===void 0?\`\`:Math.max(1,0|this.width))+(this.comma?\`,\`:\`\`)+(this.precision===void 0?\`\`:\`.\`+Math.max(0,0|this.precision))+(this.trim?\`~\`:\`\`)+this.type}}let qt=/^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;function Jt(e){let t;if(t=qt.exec(e))return new Kt({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]});xe.getInstance().error(\`invalid format: \`+e)}let Yt=[\`y\`,\`z\`,\`a\`,\`f\`,\`p\`,\`n\`,\`µ\`,\`m\`,\`\`,\`k\`,\`M\`,\`G\`,\`T\`,\`P\`,\`E\`,\`Z\`,\`Y\`];class Xt{constructor(){var e,t,n;this.locale={thousands:\`,\`,grouping:[3],currency:[\`$\`,\`\`]},this.group=this.locale.grouping===void 0||this.locale.thousands===void 0?e=>e:(t=[...this.locale.grouping].map(Number),n=\`\${this.locale.thousands}\`,function(e,r){let i=e.length,a=[],o=0,s=t[0],c=0;for(;i>0&&s>0&&(c+s+1>r&&(s=Math.max(1,r-c)),a.push(e.substring(i-=s,i+s)),!((c+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),this.currencyPrefix=this.locale.currency===void 0?\`\`:this.locale.currency[0]+\`\`,this.currencySuffix=this.locale.currency===void 0?\`\`:this.locale.currency[1]+\`\`,this.decimal=this.locale.decimal===void 0?\`.\`:this.locale.decimal+\`\`,this.numerals=this.locale.numerals===void 0?e=>e:(e=[...this.locale.numerals].map(String),function(t){return t.replace(/[0-9]/g,(t=>e[+t]))}),this.percent=this.locale.percent===void 0?\`%\`:this.locale.percent+\`\`,this.minus=this.locale.minus===void 0?\`−\`:this.locale.minus+\`\`,this.nan=this.locale.nan===void 0?\`NaN\`:this.locale.nan+\`\`,this.formatter=e=>this.newFormat(e),this.format=(e,t)=>this.formatter(e)(t),this.formatPrefix=(e,t)=>this._formatPrefix(e,t)}static getInstance(){return Xt.instance||=new Xt,Xt.instance}newFormat(e){let t=Jt(e),n=t.fill,r=t.align,i=t.sign,a=t.symbol,o=t.zero,s=t.width,c=t.comma,l=t.precision,u=t.trim,d=t.type;d===\`n\`?(c=!0,d=\`g\`):Zt[d]||(l===void 0&&(l=12),u=!0,d=\`g\`),(o||n===\`0\`&&r===\`=\`)&&(o=!0,n=\`0\`,r=\`=\`);let f=a===\`$\`?this.currencyPrefix:a===\`#\`&&/[boxX]/.test(d)?\`0\`+d.toLowerCase():\`\`,p=a===\`$\`?this.currencySuffix:/[%p]/.test(d)?this.percent:\`\`,m=Zt[d],h=/[defgprstz%]/.test(d);l=l===void 0?6:/[gprs]/.test(d)?Math.max(1,Math.min(21,l)):Math.max(0,Math.min(20,l));let{nan:g,minus:_,decimal:v,group:y,numerals:b}=this;function x(e){let t,a,x,S=f,C=p,w=e;if(d===\`c\`)C=m(w)+C,w=\`\`;else{w=+w;let e=w<0||1/w<0;if(w=isNaN(w)?g:m(Math.abs(w),l),u&&(w=function(e){let t=e.length,n,r=-1;t:for(let i=1;i<t;++i)switch(e[i]){case\`.\`:r=n=i;break;case\`0\`:r===0&&(r=i),n=i;break;default:if(!+e[i])break t;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(n+1):e}(w)),e&&+w==0&&i!==\`+\`&&(e=!1),S=(e?i===\`(\`?i:_:i===\`-\`||i===\`(\`?\`\`:i)+S,C=(d===\`s\`?Yt[8+Wt/3]:\`\`)+C+(e&&i===\`(\`?\`)\`:\`\`),h){for(t=-1,a=w.length;++t<a;)if(x=w.charCodeAt(t),48>x||x>57){C=(x===46?v+w.slice(t+1):w.slice(t))+C,w=w.slice(0,t);break}}}c&&!o&&(w=y(w,1/0));let T=S.length+w.length+C.length,E=T<s?Array(s-T+1).join(n):\`\`;switch(c&&o&&(w=y(E+w,E.length?s-C.length:1/0),E=\`\`),r){case\`<\`:w=S+w+C+E;break;case\`=\`:w=S+E+w+C;break;case\`^\`:w=E.slice(0,T=E.length>>1)+S+w+C+E.slice(T);break;default:w=E+S+w+C}return b(w)}return x.toString=function(){return e+\`\`},x}_formatPrefix(e,t){let n=Jt(e);n.type=\`f\`;let r=this.newFormat(n.toString()),i=3*Math.max(-8,Math.min(8,Math.floor(function(e){let t=Ut(Math.abs(e));return t?t[1]:NaN}(t)/3))),a=10**-i,o=Yt[8+i/3];return function(e){return r(a*e)+o}}}let Zt={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+\`\`,d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString(\`en\`).replace(/,/g,\`\`):e.toString(10)},f:(e,t)=>e.toFixed(t),e:(e,t)=>e.toExponential(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Gt(100*e,t),r:Gt,s:function(e,t){let n=Ut(e,t);if(!n)return e+\`\`;let r=n[0],i=n[1],a=i-(Wt=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+Array(a-o+1).join(\`0\`):a>0?r.slice(0,a)+\`.\`+r.slice(a):\`0.\`+Array(1-a).join(\`0\`)+Ut(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16),t:(e,t)=>Number.isInteger(e)?e.toFixed(2):Math.floor(e*10**t)/10**t+\`\`,z:(e,t)=>e%1==0?e+\`\`:e.toFixed(t)},Qt=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(e){e||={};let t=-1,n=arguments.length<=1?0:arguments.length-1;for(;++t<n;)en(e,t+1<1||arguments.length<=t+1?void 0:arguments[t+1]);return e}(M(e),...n)};function $t(e,t,n){let r=t[n];if(r===void 0)e[n]=null;else if(m(r))for(let t in m(e[n])||(e[n]={}),r)$t(e[n],r,t);else e[n]=r}function en(e,t){if(m(t)&&e!==t)for(let n in t)$t(e,t,n)}var tn;(function(e){e.DSV=\`dsv\`,e.TREE=\`tree\`,e.GEO=\`geo\`,e.BYTE=\`bytejson\`,e.HEX=\`hex\`,e.GRAPH=\`graph\`,e.TABLE=\`table\`,e.GEO_GRATICULE=\`geo-graticule\`})(tn||={});let nn=(e,t)=>{if(!t?.fields||e.length===0)return e;let n=t.fields,r=e[0],i={},a=[];for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let o=n[t];if(!o.type){let n=r;t in r||(n=e.find((e=>t in e))??r),o.type=typeof n[t]==\`number\`?\`linear\`:\`ordinal\`}let s;if(typeof o.sortIndex==\`number\`&&(s={key:t,type:o.type,index:o.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:!0===o.sortReverse},a.push(s)),o.domain?.length>0)if(o.type===\`ordinal\`){o._domainCache={},i[t]=o;let e={};o.domain.forEach(((t,n)=>{e[t]=n,o._domainCache[t]=n})),s&&(s.sortIndex=e,s.sortIndexCount=o.domain.length)}else o.domain.length>=2&&(i[t]=o)}return Object.keys(i).length>0&&(e=e.filter((e=>{for(let t in i){let n=i[t];if(n.type===\`ordinal\`){if(!(e[t]in n._domainCache))return!1}else if(n.domain[0]>e[t]||n.domain[1]<e[t])return!1}return!0}))),a.sort(((e,t)=>e.index-t.index)),e.sort(((e,t)=>function(e,t,n){for(let r=0;r<n.length;r++){let i=n[r],a=0;if(i.type===\`ordinal\`?(i.sortIndex[t[i.key]]===void 0&&(i.sortIndex[t[i.key]]=i.sortIndexCount++),i.sortIndex[e[i.key]]===void 0&&(i.sortIndex[e[i.key]]=i.sortIndexCount++),a=i.sortIndex[e[i.key]]-i.sortIndex[t[i.key]]):i.type===\`linear\`&&(a=e[i.key]-t[i.key]),i.sortReverse&&(a=-a),a!==0)return a}return 0}(e,t,a))),e};var rn={},an={};function on(e){return Function(\`d\`,\`return {\`+e.map((function(e,t){return JSON.stringify(e)+\`: d[\`+t+\`] || ""\`})).join(\`,\`)+\`}\`)}function sn(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function cn(e,t){var n=e+\`\`,r=n.length;return r<t?Array(t-r+1).join(0)+n:n}function ln(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?\`Invalid Date\`:((t=e.getUTCFullYear())<0?\`-\`+cn(-t,6):t>9999?\`+\`+cn(t,6):cn(t,4))+\`-\`+cn(e.getUTCMonth()+1,2)+\`-\`+cn(e.getUTCDate(),2)+(a?\`T\`+cn(n,2)+\`:\`+cn(r,2)+\`:\`+cn(i,2)+\`.\`+cn(a,3)+\`Z\`:i?\`T\`+cn(n,2)+\`:\`+cn(r,2)+\`:\`+cn(i,2)+\`Z\`:r||n?\`T\`+cn(n,2)+\`:\`+cn(r,2)+\`Z\`:\`\`)}function un(e){var t=RegExp(\`["\`+e+\`
\\r]\`),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,c=a<=0,l=!1;function u(){if(c)return an;if(l)return l=!1,rn;var t,r,i=o;if(e.charCodeAt(i)===34){for(;o++<a&&e.charCodeAt(o)!==34||e.charCodeAt(++o)===34;);return(t=o)>=a?c=!0:(r=e.charCodeAt(o++))===10?l=!0:r===13&&(l=!0,e.charCodeAt(o)===10&&++o),e.slice(i+1,t-1).replace(/""/g,\`"\`)}for(;o<a;){if((r=e.charCodeAt(t=o++))===10)l=!0;else if(r===13)l=!0,e.charCodeAt(o)===10&&++o;else if(r!==n)continue;return e.slice(i,t)}return c=!0,e.slice(i,a)}for(e.charCodeAt(a-1)===10&&--a,e.charCodeAt(a-1)===13&&--a;(r=u())!==an;){for(var d=[];r!==rn&&r!==an;)d.push(r),r=u();t&&(d=t(d,s++))==null||i.push(d)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return e==null?\`\`:e instanceof Date?ln(e):t.test(e+=\`\`)?\`"\`+e.replace(/"/g,\`""\`)+\`"\`:e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=on(e);return function(r,i){return t(n(r),i,e)}}(e,t):on(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return n??=sn(t),[n.map(o).join(e)].concat(i(t,n)).join(\`
\`)},formatBody:function(e,t){return t??=sn(e),i(e,t).join(\`
\`)},formatRows:function(e){return e.map(a).join(\`
\`)},formatRow:a,formatValue:o}}var dn=un(\`,\`).parse,fn=un(\`	\`).parse;let pn={delimiter:\`,\`},mn=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(arguments.length>2?arguments[2]:void 0).type=tn.DSV;let{delimiter:n}=Qt(pn,t);if(!v(n))throw TypeError(\`Invalid delimiter: must be a string!\`);return un(n).parse(e)},hn=function(e){return(arguments.length>2?arguments[2]:void 0).type=tn.DSV,dn(e)},gn=function(e){return(arguments.length>2?arguments[2]:void 0).type=tn.DSV,fn(e)},_n=(e,t,n)=>{let r=!u(t?.dependencyUpdate)||t?.dependencyUpdate;if(!e||!y(e))throw TypeError(\`Invalid data: must be DataView array!\`);return y(n.rawData)&&n.rawData.forEach((e=>{e.target&&(e.target.removeListener(\`change\`,n.reRunAllTransform),e.target.removeListener(\`markRunning\`,n.markRunning))})),r&&e.forEach((e=>{e.target.addListener(\`change\`,n.reRunAllTransform),e.target.addListener(\`markRunning\`,n.markRunning)})),e},vn=0;function yn(){return vn>1e8&&(vn=0),(arguments.length>0&&arguments[0]!==void 0?arguments[0]:\`dataset\`)+\`_\`+ vn++}class bn{constructor(e){let t;this.options=e,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new c,t=e?.name?e.name:yn(\`dataset\`),this.name=t,this._logger=e?.logger??xe.getInstance()}setLogger(e){this._logger=e}getDataView(e){return this.dataViewMap[e]}setDataView(e,t){var n;this.dataViewMap[e]&&((n=this._logger)==null||n.error(\`Error: dataView \${e} 之前已存在，请重新命名\`)),this.dataViewMap[e]=t}removeDataView(e){this.dataViewMap[e]=null,delete this.dataViewMap[e]}registerParser(e,t){var n;this.parserMap[e]&&((n=this._logger)==null||n.warn(\`Warn: transform \${e} 之前已注册，执行覆盖逻辑\`)),this.parserMap[e]=t}removeParser(e){this.parserMap[e]=null,delete this.parserMap[e]}getParser(e){return this.parserMap[e]||this.parserMap.default}registerTransform(e,t){var n;this.transformMap[e]&&((n=this._logger)==null||n.warn(\`Warn: transform \${e} 之前已注册，执行覆盖逻辑\`)),this.transformMap[e]=t}removeTransform(e){this.transformMap[e]=null,delete this.transformMap[e]}getTransform(e){return this.transformMap[e]}multipleDataViewAddListener(e,t,n){this._callMap||=new Map;let r=this._callMap.get(n);r||=()=>{e.some((e=>e.isRunning))||n()},e.forEach((e=>{e.target.addListener(t,r)})),this._callMap.set(n,r)}allDataViewAddListener(e,t){this.multipleDataViewAddListener(Object.values(this.dataViewMap),e,t)}multipleDataViewRemoveListener(e,t,n){if(this._callMap){let r=this._callMap.get(n);r&&e.forEach((e=>{e.target.removeListener(t,r)})),this._callMap.delete(n)}}multipleDataViewUpdateInParse(e){e.forEach((e=>this.getDataView(e.name)?.markRunning())),e.forEach((e=>this.getDataView(e.name)?.parseNewData(e.data,e.options)))}multipleDataViewUpdateInRawData(e){e.forEach((e=>this.getDataView(e.name)?.markRunning())),e.forEach((e=>this.getDataView(e.name)?.updateRawData(e.data,e.options)))}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}let xn=\`_data-view-diff-rank\`;class Sn{constructor(e,t){var n=this;let r;this.dataSet=e,this.options=t,this.isDataView=!0,this.target=new c,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{pushHistory:!0,emitMessage:!0};return n.isRunning=!0,n.resetTransformData(),n.transformsArr.forEach((t=>{n.executeTransform(t,{pushHistory:e.pushHistory,emitMessage:!1}),n.isLastTransform(t)&&n.diffLastData()})),n.isRunning=!1,!1!==e.emitMessage&&n.target.emit(\`change\`,[]),n},this.markRunning=()=>{this.isRunning=!0,this.target.emit(\`markRunning\`,[])},r=t?.name?t.name:yn(\`dataview\`),this.name=r,t!=null&&t.history&&(this.history=t.history,this.historyData=[]),this.dataSet.setDataView(r,this),this.setFields(t?.fields)}parse(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this.isRunning=!0,n&&this.target.emit(\`beforeParse\`,[]),t&&(this.parseOption=t);let r=this.cloneParseData(e,t);if(t?.type){let e=(this.dataSet.getParser(t.type)??this.dataSet.getParser(\`bytejson\`))(r,t.options,this);this.rawData=r,this.parserData=e,this.history&&this.historyData.push(r,e),this.latestData=e}else this.parserData=r,this.rawData=r,this.history&&this.historyData.push(r),this.latestData=r;return this.isRunning=!1,n&&this.target.emit(\`afterParse\`,[]),this}transform(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.isRunning=!0,e&&e.type){let n=!0;if(e.type===\`fields\`){this._fields=e.options.fields;let t=this.transformsArr.findIndex((t=>t.type===e.type));t>=0&&(n=!1,this.transformsArr[t].options.fields=this._fields)}if(n&&this.transformsArr.push(e),t){let t=this.isLastTransform(e);this.executeTransform(e),t&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(e){return this.transformsArr[this.transformsArr.length-1]===e}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort(((e,t)=>(e.level??0)-(t.level??0)))}executeTransform(e){let{pushHistory:t,emitMessage:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{pushHistory:!0,emitMessage:!0},r=this.dataSet.getTransform(e.type)(this.latestData,e.options);this.history&&!1!==t&&this.historyData.push(r),this.latestData=r,!1!==n&&this.target.emit(\`change\`,[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(e){this._diffData=!0,this._diffKeys=e,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){if(!this._diffData||!this.latestData.forEach||!this._diffKeys?.length)return;let e=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach((t=>{t[xn]=e,this._diffMap.set(this._diffKeys.reduce(((e,n)=>e+t[n]),\`\`),t)})),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let t;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach((n=>{n[xn]=e,t=this._diffKeys.reduce(((e,t)=>e+n[t]),\`\`),this._diffMap.get(t)?this.latestDataAUD.update.push(n):this.latestDataAUD.add.push(n),this._diffMap.set(t,n)})),this._diffMap.forEach(((t,n)=>{t[xn]<e&&(this.latestDataAUD.del.push(t),this._diffMap.delete(n))}))}this._diffRank=e}cloneParseData(e,t){let n=!1;return e instanceof Sn||!0!==t?.clone||(n=!0),n?M(e):e}parseNewData(e,t){this.parse(e,t||this.parseOption),this.reRunAllTransform()}updateRawData(e,t){let n=this.cloneParseData(e,t);this.rawData=n,this.parserData=n,this.latestData=n,this.reRunAllTransform()}getFields(){return this._fields?this._fields:this.parseOption?.type===\`dataview\`&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._fields=e&&t?N({},this._fields,e):e;let n=this.transformsArr.find((e=>e.type===\`fields\`));!f(this._fields)&&f(n)?(this.dataSet.registerTransform(\`fields\`,nn),this.transform({type:\`fields\`,options:{fields:this._fields}},!1)):n&&(n.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}class Cn{static GenAutoIncrementId(){return Cn.auto_increment_id++}}Cn.auto_increment_id=0;class I{constructor(e){this.id=Cn.GenAutoIncrementId(),this.registry=e}}let wn=\`named\`,Tn=\`inject\`,En=\`multi_inject\`,Dn=\`inversify:tagged\`,On=\`inversify:paramtypes\`;class kn{constructor(e,t){this.key=e,this.value=t}toString(){return this.key===wn?\`named: \${String(this.value).toString()} \`:\`tagged: { key:\${this.key.toString()}, value: \${String(this.value)} }\`}}var An=function(e){var t;return function(e){let t=typeof Symbol==\`function\`&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:\`@@toPrimitive\`,n=Object.getPrototypeOf(Function),r=(typeof process==\`object\`&&{}.REFLECT_METADATA_USE_MAP_POLYFILL,Map),i=new WeakMap;function a(e,t,n){let a=i.get(e);if(l(a)){if(!n)return;a=new r,i.set(e,a)}let o=a.get(t);if(l(o)){if(!n)return;o=new r,a.set(t,o)}return o}function o(e,t,n){if(s(e,t,n))return!0;let r=h(t);return!u(r)&&o(e,r,n)}function s(e,t,n){let r=a(t,n,!1);return!l(r)&&!!r.has(e)}function c(e,t,n){if(s(e,t,n))return function(e,t,n){let r=a(t,n,!1);if(!l(r))return r.get(e)}(e,t,n);let r=h(t);return u(r)?void 0:c(e,r,n)}function l(e){return e===void 0}function u(e){return e===null}function d(e){return typeof e==\`object\`?e!==null:typeof e==\`function\`}function f(e,n){switch(function(e){if(e===null)return 1;switch(typeof e){case\`undefined\`:return 0;case\`boolean\`:return 2;case\`string\`:return 3;case\`symbol\`:return 4;case\`number\`:return 5;case\`object\`:return e===null?1:6;default:return 6}}(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}let r=n===3?\`string\`:n===5?\`number\`:\`default\`,i=function(e,t){let n=e[t];if(n!=null){if(!m(n))throw TypeError();return n}}(e,t);if(i!==void 0){let t=i.call(e,r);if(d(t))throw TypeError();return t}return function(e,t){if(t===\`string\`){let t=e.toString;if(m(t)){let n=t.call(e);if(!d(n))return n}let n=e.valueOf;if(m(n)){let t=n.call(e);if(!d(t))return t}}else{let t=e.valueOf;if(m(t)){let n=t.call(e);if(!d(n))return n}let n=e.toString;if(m(n)){let t=n.call(e);if(!d(t))return t}}throw TypeError()}(e,r===\`default\`?\`number\`:r)}function p(e){let t=f(e,3);return typeof t==\`symbol\`?t:function(e){return\`\`+e}(t)}function m(e){return typeof e==\`function\`}function h(e){let t=Object.getPrototypeOf(e);if(typeof e!=\`function\`||e===n||t!==n)return t;let r=e.prototype,i=r&&Object.getPrototypeOf(r);if(i==null||i===Object.prototype)return t;let a=i.constructor;return typeof a!=\`function\`||a===e?t:a}e(\`defineMetadata\`,(function(e,t,n,r){if(!d(n))throw TypeError();i=e,o=t,a(n,r,!0).set(i,o);return;var i,o})),e(\`hasMetadata\`,(function(e,t,n){if(!d(t))throw TypeError();return l(n)||(n=p(n)),o(e,t,n)})),e(\`hasOwnMetadata\`,(function(e,t,n){if(!d(t))throw TypeError();return l(n)||(n=p(n)),s(e,t,n)})),e(\`getMetadata\`,(function(e,t,n){if(!d(t))throw TypeError();return l(n)||(n=p(n)),c(e,t,n)}))}((t=e,function(e,n){typeof t[e]!=\`function\`&&Object.defineProperty(t,e,{configurable:!0,writable:!0,value:n})})),e}({});function jn(e,t,n,r){(function(e,t,n,r){let i=[r],a={};An.hasOwnMetadata(e,t)&&(a=An.getMetadata(e,t));let o=a[n];o===void 0&&(o=[]),o.push(...i),a[n]=o,An.defineMetadata(e,a,t)})(Dn,e,n.toString(),r)}function Mn(e){return(t,n,r)=>{jn(t,0,r,e)}}function Nn(e){return t=>(n,r,i)=>Mn(new kn(e,t))(n,r,i)}let L=Nn(Tn),Pn=Nn(En);function R(){return function(e){return An.defineMetadata(On,null,e),e}}function Fn(e){return Mn(new kn(wn,e))}let In=\`Singleton\`,Ln=\`Transient\`,Rn=\`ConstantValue\`,zn=\`Instance\`;class Bn{constructor(e,t){this.id=Cn.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=\`Invalid\`,this.constraint=e=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){let e=new Bn(this.serviceIdentifier,this.scope);return e.activated=e.scope===In&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.provider=this.provider,e.constraint=this.constraint,e.cache=this.cache,e}}class Vn{getConstructorMetadata(e){return{compilerGeneratedMetadata:An.getMetadata(On,e),userGeneratedMetadata:An.getMetadata(Dn,e)||{}}}getPropertiesMetadata(e){throw Error(\`暂未实现\`)}}let Hn=(Un=wn,e=>{let t=t=>{if(t==null)return!1;if(t.key===Un&&t.value===e)return!0;if(t.constructorArgsMetadata==null)return!1;let n=t.constructorArgsMetadata;for(let t=0;t<n.length;t++)if(n[t].key===Un&&n[t].value===e)return!0;return!1};return t.metaData=new kn(Un,e),t});var Un;class Wn{constructor(e){this._binding=e}inRequestScope(){throw Error(\`暂未实现\`)}inSingletonScope(){return this._binding.scope=In,this}inTransientScope(){return this._binding.scope=Ln,this}whenTargetNamed(e){return this._binding.constraint=Hn(e),this}}class Gn{constructor(e){this._binding=e}to(e){return this._binding.type=zn,this._binding.implementationType=e,new Wn(this._binding)}toSelf(){let e=this._binding.serviceIdentifier;return this.to(e)}toDynamicValue(e){return this._binding.type=\`DynamicValue\`,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Wn(this._binding)}toConstantValue(e){return this._binding.type=Rn,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=In,new Wn(this._binding)}toFactory(e){return this._binding.type=\`Factory\`,this._binding.factory=e,this._binding.scope=In,new Wn(this._binding)}toService(e){this.toDynamicValue((t=>t.container.get(e)))}}let Kn=Symbol(\`ContributionProvider\`);class qn{constructor(e,t){this.serviceIdentifier=e,this.container=t}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function Jn(e,t){e(Kn).toDynamicValue((e=>{let{container:n}=e;return new qn(t,n)})).inSingletonScope().whenTargetNamed(t)}class Yn{constructor(e,t){this._args=e,this.name=t,this.taps=[]}tap(e,t){this._tap(\`sync\`,e,t)}unTap(e,t){let n=typeof e==\`string\`?e.trim():e.name;n&&(this.taps=this.taps.filter((e=>!(e.name===n&&(!t||e.fn===t)))))}_parseOptions(e,t,n){let r;if(typeof t==\`string\`)r={name:t.trim()};else if(typeof t!=\`object\`||!t)throw Error(\`Invalid tap options\`);if(typeof r.name!=\`string\`||r.name===\`\`)throw Error(\`Missing name for tap\`);return r=Object.assign({type:e,fn:n},r),r}_tap(e,t,n){this._insert(this._parseOptions(e,t,n))}_insert(e){let t;typeof e.before==\`string\`?t=new Set([e.before]):Array.isArray(e.before)&&(t=new Set(e.before));let n=0;typeof e.stage==\`number\`&&(n=e.stage);let r=this.taps.length;for(;r>0;){r--;let e=this.taps[r];this.taps[r+1]=e;let i=e.stage||0;if(t){if(t.has(e.name)){t.delete(e.name);continue}if(t.size>0)continue}if(!(i>n)){r++;break}}this.taps[r]=e}}class Xn extends Yn{call(){var e=[...arguments];this.taps.map((e=>e.fn)).forEach((t=>t(...e)))}}let Zn=Symbol.for(\`EnvContribution\`),Qn=Symbol.for(\`VGlobal\`);var $n=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},er=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},tr=function(e,t){return function(n,r){t(n,r,e)}},nr=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};let rr=class{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(e){this._isImageAnonymous=e}get devicePixelRatio(){return this._env||this.setEnv(\`browser\`),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv(\`browser\`),this.envContribution.supportEvent}set supportEvent(e){this._env||this.setEnv(\`browser\`),this.envContribution.supportEvent=e}get supportsTouchEvents(){return this._env||this.setEnv(\`browser\`),this.envContribution.supportsTouchEvents}set supportsTouchEvents(e){this._env||this.setEnv(\`browser\`),this.envContribution.supportsTouchEvents=e}get supportsPointerEvents(){return this._env||this.setEnv(\`browser\`),this.envContribution.supportsPointerEvents}set supportsPointerEvents(e){this._env||this.setEnv(\`browser\`),this.envContribution.supportsPointerEvents=e}get supportsMouseEvents(){return this._env||this.setEnv(\`browser\`),this.envContribution.supportsMouseEvents}set supportsMouseEvents(e){this._env||this.setEnv(\`browser\`),this.envContribution.supportsMouseEvents=e}get applyStyles(){return this._env||this.setEnv(\`browser\`),this.envContribution.applyStyles}set applyStyles(e){this._env||this.setEnv(\`browser\`),this.envContribution.applyStyles=e}constructor(e){this.contributions=e,this._isImageAnonymous=!0,this.id=Cn.GenAutoIncrementId(),this.hooks={onSetEnv:new Xn([\`lastEnv\`,\`env\`,\`global\`])},this.measureTextMethod=\`native\`,this.optimizeVisible=!1}bindContribution(e){let t=[];if(this.contributions.getContributions().forEach((n=>{let r=n.configure(this,e);r&&r.then&&t.push(r)})),t.length)return Promise.all(t)}getDynamicCanvasCount(){return this._env||this.setEnv(\`browser\`),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv(\`browser\`),this.envContribution.getStaticCanvasCount()}setEnv(e,t){if(t&&!0===t.force||this._env!==e)return this.deactiveCurrentEnv(),this.activeEnv(e,t)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(e,t){let n=this._env;this._env=e;let r=this.bindContribution(t);if(r&&r.then)return r.then((()=>{this.envParams=t,this.hooks.onSetEnv.call(n,e,this)}));this.envParams=t,this.hooks.onSetEnv.call(n,e,this)}setActiveEnvContribution(e){this.envContribution=e}createCanvas(e){return this._env||this.setEnv(\`browser\`),this.envContribution.createCanvas(e)}createOffscreenCanvas(e){return this._env||this.setEnv(\`browser\`),this.envContribution.createOffscreenCanvas(e)}releaseCanvas(e){return this._env||this.setEnv(\`browser\`),this.envContribution.releaseCanvas(e)}addEventListener(e,t,n){return this._env||this.setEnv(\`browser\`),this.envContribution.addEventListener(e,t,n)}removeEventListener(e,t,n){return this._env||this.setEnv(\`browser\`),this.envContribution.removeEventListener(e,t,n)}dispatchEvent(e){return this._env||this.setEnv(\`browser\`),this.envContribution.dispatchEvent(e)}getRequestAnimationFrame(){return this._env||this.setEnv(\`browser\`),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv(\`browser\`),this.envContribution.getCancelAnimationFrame()}getElementById(e){return this._env||this.setEnv(\`browser\`),this.envContribution.getElementById?this.envContribution.getElementById(e):null}getRootElement(){return this._env||this.setEnv(\`browser\`),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv(\`browser\`),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(e,t){return this._env||this.setEnv(\`browser\`),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(e,t):null}loadImage(e){return this._env||this.setEnv(\`browser\`),this.envContribution.loadImage(e)}loadSvg(e){return this._env||this.setEnv(\`browser\`),this.envContribution.loadSvg(e)}loadJson(e){return this._env||this.setEnv(\`browser\`),this.envContribution.loadJson(e)}loadArrayBuffer(e){return this._env||this.setEnv(\`browser\`),this.envContribution.loadArrayBuffer(e)}loadBlob(e){return this._env||this.setEnv(\`browser\`),this.envContribution.loadBlob(e)}loadFont(e,t,n){return nr(this,void 0,void 0,(function*(){return this._env||this.setEnv(\`browser\`),this.envContribution.loadFont(e,t,n)}))}isChrome(){return this._isChrome??=(this._env||this.setEnv(\`browser\`),this._env===\`browser\`&&navigator.userAgent.indexOf(\`Chrome\`)>-1),this._isChrome}isSafari(){return this._isSafari??=(this._env||this.setEnv(\`browser\`),this._env===\`browser\`&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(e){return this._env||this.setEnv(\`browser\`),this.envContribution.getNativeAABBBounds(e)}removeDom(e){return this._env||this.setEnv(\`browser\`),this.envContribution.removeDom(e)}createDom(e){return this._env||this.setEnv(\`browser\`),this.envContribution.createDom(e)}updateDom(e,t){return this._env||this.setEnv(\`browser\`),this.envContribution.updateDom(e,t)}getElementTop(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this._env||this.setEnv(\`browser\`),this.envContribution.getElementTop(e,t)}getElementLeft(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this._env||this.setEnv(\`browser\`),this.envContribution.getElementLeft(e,t)}getElementTopLeft(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this._env||this.setEnv(\`browser\`),this.envContribution.getElementTopLeft(e,t)}isMacOS(){return this._env||this.setEnv(\`browser\`),this.envContribution.isMacOS()}copyToClipBoard(e){return this._env||this.setEnv(\`browser\`),this.envContribution.copyToClipBoard(e)}};var ir;rr=$n([R(),tr(0,L(Kn)),tr(0,Fn(Zn)),er(\`design:paramtypes\`,[Object])],rr),function(e){e[e.estimate=0]=\`estimate\`,e[e.actualBounding=1]=\`actualBounding\`,e[e.fontBounding=2]=\`fontBounding\`}(ir||={});let ar=Be-1e-8;class or{constructor(e){this.init(e)}init(e){this.bounds=e}arc(e,t,n,r,i,a){if(Math.abs(i-r)>ar)return this.bounds.add(e-n,t-n),void this.bounds.add(e+n,t+n);let o,s,c,l,u=1/0,d=-1/0,f=1/0,p=-1/0;function m(e){c=n*Math.cos(e),l=n*Math.sin(e),c<u&&(u=c),c>d&&(d=c),l<f&&(f=l),l>p&&(p=l)}if(m(r),m(i),i!==r)if((r%=Be)<0&&(r+=Be),(i%=Be)<0&&(i+=Be),i<r&&(a=!a,o=r,r=i,i=o),a)for(i-=Be,o=r-r%ze,s=0;s<4&&o>i;++s,o-=ze)m(o);else for(o=r-r%ze+ze,s=0;s<4&&o<i;++s,o+=ze)m(o);this.bounds.add(e+u,t+f),this.bounds.add(e+d,t+p)}arcTo(e,t,n,r,i){this.bounds.add(e,t)}bezierCurveTo(e,t,n,r,i,a){this.bounds.add(e,t),this.bounds.add(n,r),this.bounds.add(i,a)}closePath(){}ellipse(){throw Error(\`不支持ellipse\`)}lineTo(e,t){this.bounds.add(e,t)}moveTo(e,t){this.bounds.add(e,t)}quadraticCurveTo(e,t,n,r){this.bounds.add(e,t),this.bounds.add(n,r)}rect(e,t,n,r){this.bounds.add(e,t),this.bounds.add(e+n,t+r)}clear(){this.bounds.clear()}release(){}}class sr{constructor(){this._curves=[],this.bounds=new St}get curves(){return this._curves}getCurveLengths(){return this._curves.map((e=>e.getLength()))}getPointAt(e){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}let cr=/([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/gi,lr={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},z={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8},ur,dr,fr,pr,mr,hr;var gr,_r,vr,yr,br,xr,Sr,Cr,wr;function Tr(e){let t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=c*a,u=-s*o,d=s*a,f=c*o,p=Math.cos(r),m=Math.sin(r),h=Math.cos(i),g=Math.sin(i),_=.5*(i-r),v=Math.sin(.5*_),y=8/3*v*v/Math.sin(_),b=t+p-y*m,x=n+m+y*p,S=t+h,C=n+g,w=S+y*g,T=C-y*h;return[l*b+u*x,d*b+f*x,l*w+u*T,d*w+f*T,l*S+u*C,d*S+f*C]}function Er(e,t,n,r){let i=function(e,t,n,r,i,a,o,s,c){let l=tt(o),u=Math.sin(l),d=Math.cos(l),f=d*(s-e)*.5+u*(c-t)*.5,p=d*(c-t)*.5-u*(s-e)*.5,m=f*f/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);let h=d/n,g=u/n,_=-u/r,v=d/r,y=h*s+g*c,b=_*s+v*c,x=h*e+g*t,S=_*e+v*t,C=1/((x-y)*(x-y)+(S-b)*(S-b))-.25;C<0&&(C=0);let w=Math.sqrt(C);a===i&&(w=-w);let T=.5*(y+x)-w*(S-b),E=.5*(b+S)+w*(x-y),D=Math.atan2(b-E,y-T),O=Math.atan2(S-E,x-T)-D;O<0&&a===1?O+=Be:O>0&&a===0&&(O-=Be);let k=Math.ceil(Math.abs(O/(ze+.001))),A=[];for(let e=0;e<k;++e){let t=D+e*O/k,i=D+(e+1)*O/k;A[e]=[T,E,t,i,n,r,u,d]}return A}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let t=0;t<i.length;++t){let n=Tr(i[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}(function(e){e[e.NONE=0]=\`NONE\`,e[e.UPDATE_BOUNDS=1]=\`UPDATE_BOUNDS\`,e[e.UPDATE_SHAPE=2]=\`UPDATE_SHAPE\`,e[e.CLEAR_SHAPE=253]=\`CLEAR_SHAPE\`,e[e.UPDATE_SHAPE_AND_BOUNDS=3]=\`UPDATE_SHAPE_AND_BOUNDS\`,e[e.INIT=179]=\`INIT\`,e[e.CLEAR_BOUNDS=254]=\`CLEAR_BOUNDS\`,e[e.UPDATE_GLOBAL_MATRIX=32]=\`UPDATE_GLOBAL_MATRIX\`,e[e.CLEAR_GLOBAL_MATRIX=223]=\`CLEAR_GLOBAL_MATRIX\`,e[e.UPDATE_LOCAL_MATRIX=16]=\`UPDATE_LOCAL_MATRIX\`,e[e.CLEAR_LOCAL_MATRIX=239]=\`CLEAR_LOCAL_MATRIX\`,e[e.UPDATE_GLOBAL_LOCAL_MATRIX=48]=\`UPDATE_GLOBAL_LOCAL_MATRIX\`,e[e.UPDATE_LAYOUT=128]=\`UPDATE_LAYOUT\`,e[e.CLEAR_LAYOUT=127]=\`CLEAR_LAYOUT\`})(gr||={}),function(e){e[e.GLOBAL=1]=\`GLOBAL\`,e[e.LOCAL=16]=\`LOCAL\`,e[e.GLOBAL_ACCURATE=3]=\`GLOBAL_ACCURATE\`,e[e.LOCAL_ACCURATE=48]=\`LOCAL_ACCURATE\`}(_r||={}),function(e){e[e.INIT=0]=\`INIT\`,e[e.DEFAULT=1]=\`DEFAULT\`,e[e.STATE=2]=\`STATE\`,e[e.ANIMATE_BIND=10]=\`ANIMATE_BIND\`,e[e.ANIMATE_PLAY=11]=\`ANIMATE_PLAY\`,e[e.ANIMATE_START=12]=\`ANIMATE_START\`,e[e.ANIMATE_UPDATE=13]=\`ANIMATE_UPDATE\`,e[e.ANIMATE_END=14]=\`ANIMATE_END\`,e[e.TRANSLATE=20]=\`TRANSLATE\`,e[e.TRANSLATE_TO=21]=\`TRANSLATE_TO\`,e[e.SCALE=22]=\`SCALE\`,e[e.SCALE_TO=23]=\`SCALE_TO\`,e[e.ROTATE=24]=\`ROTATE\`,e[e.ROTATE_TO=25]=\`ROTATE_TO\`}(vr||={}),function(e){e[e.INITIAL=0]=\`INITIAL\`,e[e.RUNNING=1]=\`RUNNING\`,e[e.PAUSED=2]=\`PAUSED\`,e[e.END=3]=\`END\`}(yr||={}),function(e){e[e.NORMAL=0]=\`NORMAL\`,e[e.SET_ATTR_IMMEDIATELY=1]=\`SET_ATTR_IMMEDIATELY\`}(br||={}),function(e){e.wait=\`wait\`,e.from=\`from\`,e.to=\`to\`,e.customAnimate=\`customAnimate\`}(xr||={}),function(e){e[e.ROW=1]=\`ROW\`,e[e.COLUMN=2]=\`COLUMN\`}(Sr||={}),function(e){e[e.CubicBezierCurve=0]=\`CubicBezierCurve\`,e[e.QuadraticBezierCurve=1]=\`QuadraticBezierCurve\`,e[e.ArcCurve=2]=\`ArcCurve\`,e[e.LineCurve=3]=\`LineCurve\`,e[e.EllipseCurve=4]=\`EllipseCurve\`,e[e.MoveCurve=5]=\`MoveCurve\`}(Cr||={}),function(e){e[e.beforeFillStroke=0]=\`beforeFillStroke\`,e[e.afterFillStroke=1]=\`afterFillStroke\`}(wr||={});let Dr=[(e,t,n,r,i,a,o)=>t.arc(e[1]*i+n,e[2]*a+r,e[3]*(i+a)/2,e[4],e[5],e[6],o),(e,t,n,r,i,a,o)=>t.arcTo(e[1]*i+n,e[2]*a+r,e[3]*i+n,e[4]*a+r,e[5]*(i+a)/2,o),(e,t,n,r,i,a,o)=>t.bezierCurveTo(e[1]*i+n,e[2]*a+r,e[3]*i+n,e[4]*a+r,e[5]*i+n,e[6]*a+r,o),(e,t,n,r)=>t.closePath(),(e,t,n,r,i,a)=>t.ellipse(e[1]*i+n,e[2]*a+r,e[3]*i,e[4]*a,e[5],e[6],e[7],e[8]),(e,t,n,r,i,a,o)=>t.lineTo(e[1]*i+n,e[2]*a+r,o),(e,t,n,r,i,a,o)=>t.moveTo(e[1]*i+n,e[2]*a+r,o),(e,t,n,r,i,a,o)=>t.quadraticCurveTo(e[1]*i+n,e[2]*a+r,e[3]*i+n,e[4]*a+r,o),(e,t,n,r,i,a,o)=>t.rect(e[1]*i+n,e[2]*a+r,e[3]*i,e[4]*a,o)];function Or(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0;for(let s=0;s<e.length;s++){let c=e[s];Dr[c[0]](c,t,n,r,i,a,o)}}class kr{getLength(e){return e==null?(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length):this.calcProjLength(e)}}function Ar(e,t){let n=0,r=e.length;for(let i=0;i<r;i++){let a=e[i],o=t[i],s=e[(i+1)%r],c=t[(i+1)%r];n+=et.distanceNN(a,o,s,c)}return n/2}function jr(e,t,n,r,i){let a=1-i;return a*a*a*e+3*t*i*a*a+3*n*i*i*a+r*i*i*i}function Mr(e,t,n,r,i){let a=jr(e.x,t.x,n.x,r.x,i),o=jr(e.y,t.y,n.y,r.y,i);return new $e(a,o)}function Nr(e,t,n,r){let i=1-r;return i*i*e+2*i*r*t+r*r*n}function Pr(e,t,n,r){let i=Nr(e.x,t.x,n.x,r),a=Nr(e.y,t.y,n.y,r);return new $e(i,a)}class Fr extends kr{constructor(e,t,n){super(),this.type=Cr.QuadraticBezierCurve,this.p0=e,this.p1=t,this.p2=n}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(e){if(!1!==this.defined)return Pr(this.p0,this.p1,this.p2,e);throw Error(\`defined为false的点不能getPointAt\`)}calcLength(){return this._validPoint()?(e=this.p0,t=this.p1,n=this.p2,Ar([e.x,t.x,n.x],[e.y,t.y,n.y])):60;var e,t,n}calcProjLength(e){return e===Sr.ROW?Ve(this.p0.x-this.p2.x):e===Sr.COLUMN?Ve(this.p0.y-this.p2.y):0}getAngleAt(e){let t=We(e-.01,0),n=Ge(e+.01,1),r=this.getPointAt(t),i=this.getPointAt(n);return He(i.y-r.y,i.x-r.x)}draw(e,t,n,r,i,a){if(e.moveTo(this.p0.x*r+t,this.p0.y*i+n),a>=1)e.quadraticCurveTo(this.p1.x*r+t,this.p1.y*i+n,this.p2.x*r+t,this.p2.y*i+n);else if(a>0){let[o]=function(e,t){let{p0:n,p1:r,p2:i}=e,a=Pr(n,r,i,t),o=et.pointAtPP(n,r,t),s=et.pointAtPP(r,i,t);return[new Fr(n,o,a),new Fr(a,s,i)]}(this,a);e.quadraticCurveTo(o.p1.x*r+t,o.p1.y*i+n,o.p2.x*r+t,o.p2.y*i+n)}}getYAt(e){throw Error(\`QuadraticBezierCurve暂不支持getYAt\`)}includeX(e){throw Error(\`QuadraticBezierCurve暂不支持includeX\`)}}function Ir(e,t){let{p0:n,p1:r,p2:i,p3:a}=e,o=Mr(n,r,i,a,t),s=et.pointAtPP(n,r,t),c=et.pointAtPP(r,i,t),l=et.pointAtPP(i,a,t),u=et.pointAtPP(s,c,t),d=et.pointAtPP(c,l,t);return[new Lr(n,s,u,o),new Lr(o,d,l,a)]}class Lr extends kr{constructor(e,t,n,r){super(),this.type=Cr.CubicBezierCurve,this.p0=e,this.p1=t,this.p2=n,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(e){if(!1!==this.defined)return Mr(this.p0,this.p1,this.p2,this.p3,e);throw Error(\`defined为false的点不能getPointAt\`)}calcLength(){return this._validPoint()?(e=this.p0,t=this.p1,n=this.p2,r=this.p3,Ar([e.x,t.x,n.x,r.x],[e.y,t.y,n.y,r.y])):60;var e,t,n,r}calcProjLength(e){return e===Sr.ROW?Ve(this.p0.x-this.p3.x):e===Sr.COLUMN?Ve(this.p0.y-this.p3.y):0}getAngleAt(e){let t=We(e-.01,0),n=Ge(e+.01,1),r=this.getPointAt(t),i=this.getPointAt(n);return He(i.y-r.y,i.x-r.x)}draw(e,t,n,r,i,a){if(e.moveTo(this.p0.x*r+t,this.p0.y*i+n),a>=1)e.bezierCurveTo(this.p1.x*r+t,this.p1.y*i+n,this.p2.x*r+t,this.p2.y*i+n,this.p3.x*r+t,this.p3.y*i+n);else if(a>0){let[o]=Ir(this,a);e.bezierCurveTo(o.p1.x*r+t,o.p1.y*i+n,o.p2.x*r+t,o.p2.y*i+n,o.p3.x*r+t,o.p3.y*i+n)}}includeX(e){let t=Ge(this.p0.x,this.p1.x,this.p2.x,this.p3.x),n=We(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return e>=t&&e<=n}getYAt(e){let t=Ge(this.p0.x,this.p1.x,this.p2.x,this.p3.x),n=(e-t)/(We(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-t);return this.getPointAt(n).y}}function Rr(e,t){let{p0:n,p1:r}=e,i=et.pointAtPP(n,r,t);return[new zr(n,i),new zr(i,r)]}class zr extends kr{constructor(e,t){super(),this.type=Cr.LineCurve,this.p0=e,this.p1=t}getPointAt(e){if(!1!==this.defined)return et.pointAtPP(this.p0,this.p1,e);throw Error(\`defined为false的点不能getPointAt\`)}getAngleAt(e){return this.angle??=He(this.p1.y-this.p0.y,this.p1.x-this.p0.x),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?et.distancePP(this.p0,this.p1):60}calcProjLength(e){return e===Sr.ROW?Ve(this.p0.x-this.p1.x):e===Sr.COLUMN?Ve(this.p0.y-this.p1.y):0}draw(e,t,n,r,i,a){if(e.moveTo(this.p0.x*r+t,this.p0.y*i+n),a>=1)e.lineTo(this.p1.x*r+t,this.p1.y*i+n);else if(a>0){let o=this.getPointAt(a);e.lineTo(o.x*r+t,o.y*i+n)}}includeX(e){return e>=this.p0.x&&e<=this.p1.x||e>=this.p1.x&&e<=this.p0.x}getYAt(e){if(this.includeX(e)){let t=this.p0,n=this.p1;this.p0.x>this.p1.x&&(t=this.p1,n=this.p0);let r=(e-t.x)/(n.x-t.x);return t.y+r*(n.y-t.y)}return 1/0}}class Br{get endX(){return this._lastX}get endY(){return this._lastY}constructor(e,t){this.init(e,t)}init(e,t){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=e,this.direction=t,this.curves=[]}bezierCurveTo(e,t,n,r,i,a,o,s){let c=new Lr(new $e(this._lastX,this._lastY),new $e(e,t),new $e(n,r),new $e(i,a));c.originP1=this._lastOriginP,c.originP2=s,c.defined=o,this.curves.push(c),this._lastX=i,this._lastY=a,this._lastOriginP=s}closePath(){if(this.curves.length<2)return;let e=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,e.defined,this._startOriginP)}ellipse(){throw Error(\`SegContext不支持调用ellipse\`)}lineTo(e,t,n,r){let i=this.addLinearCurve(e,t,n,this._lastOriginP,r);this.curves.push(i),this._lastX=e,this._lastY=t,this._lastOriginP=r}moveTo(e,t,n){return this._lastX=this._startX=e,this._lastY=this._startY=t,this._lastOriginP=n,this._startOriginP=n,this}quadraticCurveTo(e,t,n,r){throw Error(\`SegContext不支持调用quadraticCurveTo\`)}clear(){this.curves=[],this.length=NaN}tryUpdateLength(e){return this.getLength(e)}addLinearCurve(e,t,n,r,i){let a=new zr(new $e(this._lastX,this._lastY),new $e(e,t));return a.originP1=r,a.originP2=i,a.defined=n,a}getPointAt(e){throw Error(\`暂未实现\`)}getCurveLengths(){return[]}getLength(e){if(e===Sr.COLUMN){if(!this.curves.length)return 0;let e=this.curves[0],t=this.curves[this.curves.length-1],n=t.p3??t.p1;return Ve(e.p0.y-n.y)}if(e===Sr.ROW){if(!this.curves.length)return 0;let e=this.curves[0],t=this.curves[this.curves.length-1],n=t.p3??t.p1;return Ve(e.p0.x-n.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce(((e,t)=>e+t.getLength()),0)),this.length}}class Vr extends Br{bezierCurveTo(e,t,n,r,i,a,o,s){return super.bezierCurveTo(t,e,r,n,a,i,o,s)}lineTo(e,t,n,r){return super.lineTo(t,e,n,r)}moveTo(e,t,n){return super.moveTo(t,e,n)}clear(){return super.clear()}}function Hr(e,t){let n=!1;for(let r=0,i=t.length;r<=i;r++)r>=i===n&&((n=!n)?e.lineStart():e.lineEnd()),n&&e.point(t[r])}function Ur(e,t,n){let r=t??(Ve(n[n.length-1].x-n[0].x)>Ve(n[n.length-1].y-n[0].y)?Sr.ROW:Sr.COLUMN);return e===\`monotoneY\`?new Vr(e,r):new Br(e,r)}class Wr{constructor(e,t){this.context=e,t&&(this.startPoint=t)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){let t=e.x,n=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,n,!1!==this._lastDefined&&!1!==e.defined,e):this.context.moveTo(t,n,e);break;case 1:this._point=2;default:this.context.lineTo(t,n,!1!==this._lastDefined&&!1!==e.defined,e)}this._lastDefined=e.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function Gr(e){let{direction:t,startPoint:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.length<2-Number(!!n))return null;let r=Ur(\`linear\`,t,e);return function(e,t){Hr(e,t)}(new Wr(r,n),e),r}function Kr(e,t,n,r,i){e.context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6,r,e.lastPoint1)}class qr{constructor(e,t){this.context=e,this.startPoint=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&Kr(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){let t=e.x,n=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,n,!1!==this._lastDefined1&&!1!==this._lastDefined2,e):this.context.moveTo(t,n,e);break;case 1:this._point=2;break;default:Kr(this,t,n,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}function Jr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:n,startPoint:r}=t;if(e.length<2-Number(!!r))return null;if(e.length<3-Number(!!r))return Gr(e,t);let i=Ur(\`basis\`,n,e);return function(e,t){Hr(e,t)}(new qr(i,r),e),i}function Yr(e){return e<0?-1:1}function Xr(e,t,n){let r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||Number(i<0&&-0)),o=(n-e._y1)/(i||Number(r<0&&-0)),s=(a*i+o*r)/(r+i);return(Yr(a)+Yr(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function Zr(e,t){let n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Qr(e,t,n,r,i){let a=e._x0,o=e._y0,s=e._x1,c=e._y1,l=(s-a)/3;e.context.bezierCurveTo(a+l,o+l*t,s-l,c-l*n,s,c,r,e.lastPoint1)}class $r{constructor(e,t){this.context=e,this.startPoint=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:Qr(this,this._t0,Zr(this,this._t0),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){let t=NaN,n=e.x,r=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(n,r,!1!==this._lastDefined1&&!1!==this._lastDefined2,e):this.context.moveTo(n,r,e);break;case 1:this._point=2;break;case 2:this._point=3,Qr(this,Zr(this,t=Xr(this,n,r)),t,!1!==this._lastDefined1&&!1!==this._lastDefined2);break;default:Qr(this,this._t0,t=Xr(this,n,r),!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=r,this._t0=t,this._lastDefined1=this._lastDefined2,this._lastDefined2=!1!==e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}class ei extends $r{constructor(e,t){super(e,t)}point(e){return super.point({y:e.x,x:e.y,defined:e.defined})}}function ti(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:n,startPoint:r}=t;if(e.length<2-Number(!!r))return null;if(e.length<3-Number(!!r))return Gr(e,t);let i=Ur(\`monotoneX\`,n,e);return function(e,t){Hr(e,t)}(new $r(i,r),e),i}function ni(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{direction:n,startPoint:r}=t;if(e.length<2-Number(!!r))return null;if(e.length<3-Number(!!r))return Gr(e,t);let i=Ur(\`monotoneY\`,n,e);return function(e,t){Hr(e,t)}(new ei(i,r),e),i}let ri=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,n=arguments.length>2?arguments[2]:void 0;this.context=e,this._t=t,this.startPoint=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,!1!==this._lastDefined,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(e){let t=e.x,n=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,n,!1!==this._lastDefined&&!1!==e.defined,e):this.context.moveTo(t,n,e);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,n,!1!==this._lastDefined&&!1!==e.defined,this.lastPoint),this.context.lineTo(t,n,!1!==this._lastDefined&&!1!==e.defined,e);else{let r=this._x*(1-this._t)+t*this._t;this._t===.5?this.context.lineTo(r,this._y,!1!==this._lastDefined,this.lastPoint):this.context.lineTo(r,this._y,!1!==this._lastDefined&&!1!==e.defined,this.lastPoint),this.context.lineTo(r,n,!1!==this._lastDefined&&!1!==e.defined,e)}}this._lastDefined=e.defined,this._x=t,this._y=n,this.lastPoint=e}tryUpdateLength(){return this.context.tryUpdateLength()}};function ii(e,t){let{direction:n,startPoint:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.length<2-Number(!!r))return null;let i=new Br(\`step\`,n??(Ve(e[e.length-1].x-e[0].x)>Ve(e[e.length-1].y-e[0].y)?Sr.ROW:Sr.COLUMN));return function(e,t){Hr(e,t)}(new ri(i,t,r),e),i}class ai extends Wr{lineEnd(){this.context.closePath()}}function oi(e){let{direction:t,startPoint:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.length<2-Number(!!n))return null;let r=Ur(\`linear\`,t,e);return function(e,t){Hr(e,t)}(new ai(r,n),e),r}function si(e,t,n,r,i){let a=e._x1,o=e._y1,s=e._x2,c=e._y2;if(e._l01_a>Le){let t=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,n=3*e._l01_a*(e._l01_a+e._l12_a);a=(a*t-e._x0*e._l12_2a+e._x2*e._l01_2a)/n,o=(o*t-e._y0*e._l12_2a+e._y2*e._l01_2a)/n}if(e._l23_a>Le){let r=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,i=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*r+e._x1*e._l23_2a-t*e._l12_2a)/i,c=(c*r+e._y1*e._l23_2a-n*e._l12_2a)/i}e.context.bezierCurveTo(a,o,s,c,e._x2,e._y2,r,e.lastPoint1)}function ci(e,t){return function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},{direction:a,startPoint:o}=i;if(n.length<2-Number(!!o))return null;if(n.length<3-Number(!!o))return Gr(n,i);let s=Ur(e,a,n);return Hr(new t(s,r,o),n),s}}let li=ci(\`catmullRom\`,class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,n=arguments.length>2?arguments[2]:void 0;this.context=e,this.startPoint=n,this._alpha=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){let{x:t,y:n}=e;if(this._point){let e=this._x2-t,r=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=(e*e+r*r)**+this._alpha)}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,n,!1!==this._lastDefined1&&!1!==this._lastDefined2):this.context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3;default:si(this,t,n,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}),ui=ci(\`catmullRomClosed\`,class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,n=arguments.length>2?arguments[2]:void 0;this.context=e,this.startPoint=n,this._alpha=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(e){let{x:t,y:n}=e;if(this._point){let e=this._x2-t,r=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=(e*e+r*r)**+this._alpha)}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this.context.moveTo(this._x4=t,this._y4=n,e);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:si(this,t,n,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}});class di{constructor(e){this.path=e,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(e,t){return this._lastX=this._startX=e,this._lastY=this._startY=t,this}lineTo(e,t){let n=this.addLinearCurve(e,t);this.path.addCurve(n),this._lastX=e,this._lastY=t}addLinearCurve(e,t){return new zr(new $e(this._lastX,this._lastY),new $e(e,t))}quadraticCurveTo(e,t,n,r){let i=new Fr(new $e(this._lastX,this._lastY),new $e(e,t),new $e(n,r));this.path.addCurve(i),this._lastX=n,this._lastY=r}bezierCurveTo(e,t,n,r,i,a){let o=new Lr(new $e(this._lastX,this._lastY),new $e(e,t),new $e(n,r),new $e(i,a));this.path.addCurve(o),this._lastX=i,this._lastY=a}arcTo(e,t,n,r,i){throw Error(\`CurveContext不支持调用arcTo\`)}ellipse(e,t,n,r,i,a,o,s){throw Error(\`CurveContext不支持调用ellipse\`)}rect(e,t,n,r){throw Error(\`CurveContext不支持调用rect\`)}arc(e,t,n,r,i,a){throw Error(\`CurveContext不支持调用arc\`)}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}}function fi(e,t,n){switch(t){case\`linear\`:default:return Gr(e,n);case\`basis\`:return Jr(e,n);case\`monotoneX\`:return ti(e,n);case\`monotoneY\`:return ni(e,n);case\`step\`:return ii(e,.5,n);case\`stepBefore\`:return ii(e,0,n);case\`stepAfter\`:return ii(e,1,n);case\`catmullRom\`:return li(e,n?.curveTension??.5,n);case\`catmullRomClosed\`:return ui(e,n?.curveTension??.5,n);case\`linearClosed\`:return oi(e,n)}}class pi extends sr{constructor(e){super(),this.commandList=[],e&&(this._ctx=e),this._boundsContext=new or(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(e){this._ctx=e}moveTo(e,t){return this.commandList.push([z.M,e,t]),this._ctx&&this._ctx.moveTo(e,t),this}lineTo(e,t){return this.commandList.push([z.L,e,t]),this._ctx&&this._ctx.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.commandList.push([z.Q,e,t,n,r]),this._ctx&&this._ctx.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.commandList.push([z.C,e,t,n,r,i,a]),this._ctx&&this._ctx.bezierCurveTo(e,t,n,r,i,a),this}arcTo(e,t,n,r,i){return this.commandList.push([z.AT,e,t,n,r,i]),this._ctx&&this._ctx.arcTo(e,t,n,r,i),this}ellipse(e,t,n,r,i,a,o,s){return this.commandList.push([z.E,e,t,n,r,i,a,o,s]),this._ctx&&this._ctx.ellipse(e,t,n,r,i,a,o,s),this}rect(e,t,n,r){return this.commandList.push([z.R,e,t,n,r]),this._ctx&&this._ctx.rect(e,t,n,r),this}arc(e,t,n,r,i,a){return this.commandList.push([z.A,e,t,n,r,i,a]),this._ctx&&this._ctx.arc(e,t,n,r,i,a),this}closePath(){return this.commandList.push([z.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(e){this._curves.push(e)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){let e=new di(this);Or(this.commandList,e,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){let e=[];e[z.M]=e=>\`M\${e[1]} \${e[2]}\`,e[z.L]=e=>\`L\${e[1]} \${e[2]}\`,e[z.Q]=e=>\`Q\${e[1]} \${e[2]} \${e[3]} \${e[4]}\`,e[z.C]=e=>\`C\${e[1]} \${e[2]} \${e[3]} \${e[4]} \${e[5]} \${e[6]}\`,e[z.A]=e=>{let t=[];((e,t,n,r,i,a,o)=>{let s=Math.abs(n-t),c=s>.5*Math.PI?Math.ceil(2*s/Math.PI):1,l=(n-t)/c;for(let n=0;n<c;n++){let s=t+l*n,c=t+l*(n+1),u=4*Math.tan(Math.abs(l)/4)/3,d=c<s?-1:1,f=Math.cos(s),p=Math.sin(s),m=Math.cos(c),h=Math.sin(c),g=f*a+r,_=p*o+i,v=m*a+r,y=h*o+i,b=a*u*d,x=o*u*d;e.push(g-b*p,_+x*f,v+b*h,y-x*m,v,y)}})(t,e[4],e[5],e[1],e[2],e[3],e[3]);let n=\`\`;for(let e=0;e<t.length;e+=6)n+=\`C\${t[e]} \${t[e+1]} \${t[e+2]} \${t[e+3]} \${t[e+4]} \${t[e+5]}\`;return n},e[z.R]=e=>\`M\${e[1]} \${e[2]} h\${e[3]} v\${e[4]} H\${e[1]}Z\`,e[z.Z]=e=>\`Z\`,this.toStringCbList=e}let e=this.toStringCbList,t=\`\`;return this.commandList.forEach((n=>{t+=e[n[0]](n)})),t}fromString(e,t,n,r,i){this.clear();let a=function(e){if(!e)return[];let t=e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(t===null)return[];let n,r,i=[];for(let e=0,a=t.length;e<a;e++)if(ur=t[e],dr=ur.slice(1),fr=ur[0],n=[fr],r=dr.match(cr),r!==null){for(let e=0,t=r.length;e<t;e++)pr=r[e],mr=parseFloat(pr),Number.isNaN(mr)||n.push(mr);if(hr=lr[fr],n.length-1>hr){let e,t=fr;for(let r=1,a=n.length;r<a;r+=hr){e=[t];for(let t=r,i=r+hr;t<i;t++)e.push(n[t]);i.push(e),t===\`m\`?t=\`l\`:t===\`M\`&&(t=\`L\`)}}else i.push(n)}else i.push(n);return i}(e);return this._runCommandStrList(a,t,n,r,i),this._updateBounds(),this}fromLine(e){let{points:t,curveType:n,clipRangeByDimension:r}=e.attribute;if(!t)return;let i=fi(t,n);r===\`x\`?this.direction=Sr.ROW:r===\`y\`?this.direction=Sr.COLUMN:r===\`auto\`&&(this.direction=i.direction),this._curves=i.curves}fromCustomPath2D(e,t,n,r,i){return this.clear(),this._runCommandList(e.commandList,t,n,r,i),this._updateBounds(),this}transform(e,t,n,r){let i=this.commandList;if(!this.transformCbList){let e=[];e[z.M]=this.moveToTransform,e[z.L]=this.lineToTransform,e[z.Q]=this.quadraticCurveToTransform,e[z.C]=this.bezierCurveToTransform,e[z.AT]=this.arcToTransform,e[z.E]=this.ellipseTransform,e[z.R]=this.rectTransform,e[z.A]=this.arcTransform,e[z.Z]=this.closePathTransform,this.transformCbList=e}i.forEach((i=>{this.transformCbList[i[0]](i,e,t,n,r)})),this._updateBounds()}moveToTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n}lineToTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n}quadraticCurveToTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n,e[3]=e[3]*r+t,e[4]=e[4]*i+n}bezierCurveToTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n,e[3]=e[3]*r+t,e[4]=e[4]*i+n,e[5]=e[5]*r+t,e[6]=e[6]*i+n}arcToTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n,e[3]=e[3]*r+t,e[4]=e[4]*i+n,e[5]=e[5]*(r+i)/2}ellipseTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n,e[3]*=r,e[4]*=i}rectTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n,e[3]*=r,e[4]*=i}arcTransform(e,t,n,r,i){e[1]=e[1]*r+t,e[2]=e[2]*i+n,e[3]=e[3]*(r+i)/2}closePathTransform(){}_runCommandStrList(e){let t,n,r,i,a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,u=null,d=0,f=0,p=0,m=0;for(let h=0,g=e.length;h<g;++h){switch(t=e[h],c===1&&l===1||(t=hi(t,c,l)),t[0]){case\`l\`:d+=t[1],f+=t[2],this.lineTo(d+o,f+s);break;case\`L\`:d=t[1],f=t[2],this.lineTo(d+o,f+s);break;case\`h\`:d+=t[1],this.lineTo(d+o,f+s);break;case\`H\`:d=t[1],this.lineTo(d+o,f+s);break;case\`v\`:f+=t[1],this.lineTo(d+o,f+s);break;case\`V\`:f=t[1],this.lineTo(d+o,f+s);break;case\`m\`:d+=t[1],f+=t[2],this.moveTo(d+o,f+s);break;case\`M\`:d=t[1],f=t[2],this.moveTo(d+o,f+s);break;case\`c\`:n=d+t[5],r=f+t[6],p=d+t[3],m=f+t[4],this.bezierCurveTo(d+t[1]+o,f+t[2]+s,p+o,m+s,n+o,r+s),d=n,f=r;break;case\`C\`:d=t[5],f=t[6],p=t[3],m=t[4],this.bezierCurveTo(t[1]+o,t[2]+s,p+o,m+s,d+o,f+s);break;case\`s\`:n=d+t[3],r=f+t[4],u[0].match(/[CcSs]/)===null?(p=d,m=f):(p=2*d-p,m=2*f-m),i=d+t[1],a=f+t[2],this.bezierCurveTo(p+o,m+s,i+o,a+s,n+o,r+s),p=i,m=a,d=n,f=r;break;case\`S\`:n=t[3],r=t[4],u[0].match(/[CcSs]/)===null?(p=d,m=f):(p=2*d-p,m=2*f-m),i=t[1],a=t[2],this.bezierCurveTo(p+o,m+s,i+o,a+s,n+o,r+s),p=i,m=a,d=n,f=r;break;case\`q\`:n=d+t[3],r=f+t[4],p=d+t[1],m=f+t[2],this.quadraticCurveTo(p+o,m+s,n+o,r+s),d=n,f=r;break;case\`Q\`:n=t[3],r=t[4],this.quadraticCurveTo(t[1]+o,t[2]+s,n+o,r+s),d=n,f=r,p=t[1],m=t[2];break;case\`t\`:n=d+t[1],r=f+t[2],u[0].match(/[QqTt]/)===null?(p=d,m=f):u[0]===\`t\`?(p=2*d-i,m=2*f-a):u[0]===\`q\`&&(p=2*d-p,m=2*f-m),i=p,a=m,this.quadraticCurveTo(p+o,m+s,n+o,r+s),d=n,f=r,p=d+t[1],m=f+t[2];break;case\`T\`:n=t[1],r=t[2],p=2*d-p,m=2*f-m,this.quadraticCurveTo(p+o,m+s,n+o,r+s),d=n,f=r;break;case\`a\`:Er(this,d+o,f+s,[t[1],t[2],t[3],t[4],t[5],t[6]+d+o,t[7]+f+s]),d+=t[6],f+=t[7];break;case\`A\`:Er(this,d+o,f+s,[t[1],t[2],t[3],t[4],t[5],t[6]+o,t[7]+s]),d=t[6],f=t[7];break;case\`z\`:case\`Z\`:this.closePath()}u=t}}_runCommandList(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1;if(t!==0||n!==0||r!==1||i!==1)for(let a=0,o=e.length;a<o;++a){let o=e[a].slice();switch(o[0]){case z.L:this.lineToTransform(o,t,n,r,i);break;case z.M:this.moveToTransform(o,t,n,r,i);break;case z.C:this.bezierCurveToTransform(o,t,n,r,i);break;case z.Q:this.quadraticCurveToTransform(o,t,n,r,i);break;case z.A:this.arcToTransform(o,t,n,r,i);break;case z.E:this.ellipseTransform(o,t,n,r,i);break;case z.R:this.rectTransform(o,t,n,r,i);break;case z.AT:this.arcToTransform(o,t,n,r,i);break;case z.Z:this.closePath()}}else this.commandList=e.map((e=>e.slice()))}_updateBounds(){this.bounds.clear(),Or(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===Sr.COLUMN){if(!this._curves.length)return 0;let e=this._curves[0],t=this._curves[this._curves.length-1];return Ve(e.p0.y-t.p1.y)}if(this.direction===Sr.ROW){if(!this._curves.length)return 0;let e=this._curves[0],t=this._curves[this._curves.length-1];return Ve(e.p0.x-t.p1.x)}return this._curves.reduce(((e,t)=>e+t.getLength()),0)}getYAt(e){if(!this.curves)return 1/0;for(let t=0;t<this.curves.length;t++){let n=this.curves[t];if(n.includeX(e))return n.getYAt(e)}return 1/0}getAttrAt(e){if(!this._curves)return{pos:{x:0,y:0},angle:0};let t,n=0;for(let r=0;r<this._curves.length;r++){t=this._curves[r];let i=t.getLength(this.direction);if(n+i>=e)break;n+=i}let r=(e-n)/t.getLength(this.direction);return{pos:t.getPointAt(r),angle:t.getAngleAt(r)}}drawWithClipRange(e,t,n,r,i){this.tryBuildCurves();let a=this.getLength()*i,o=0;for(let i=0;i<this._curves.length;i++){let s=this._curves[i],c=s.getLength(this.direction);if(!(o+c<=a)){let i=1-(o+c-a)/c;s.draw(e,n,r,t,t,i);break}s.draw(e,n,r,t,t,1),o+=c}}}let mi=[\`l\`,0,0,0,0,0,0,0];function hi(e,t,n){let r=mi[0]=e[0];if(r===\`a\`||r===\`A\`)mi[1]=t*e[1],mi[2]=n*e[2],mi[3]=e[3],mi[4]=e[4],mi[5]=e[5],mi[6]=t*e[6],mi[7]=n*e[7];else if(r===\`h\`||r===\`H\`)mi[1]=t*e[1];else if(r===\`v\`||r===\`V\`)mi[1]=n*e[1];else for(let r=1,i=e.length;r<i;++r)mi[r]=(r%2==1?t:n)*e[r];return mi}let gi={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new wt},_i={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:\`black\`,shadowOffsetX:0,shadowOffsetY:0},vi={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:\`butt\`,lineJoin:\`miter\`,miterLimit:10,strokeBoundsBuffer:2,stroke:!1},yi=Object.assign({outerBorder:Object.assign(Object.assign({},vi),{distance:0}),innerBorder:Object.assign(Object.assign({},vi),{distance:0})},vi),bi={text:\`\`,maxLineWidth:1/0,maxWidth:1/0,textAlign:\`left\`,textBaseline:\`alphabetic\`,fontSize:16,fontFamily:\`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol\`,fontWeight:\`\`,ellipsis:\`…\`,fontVariant:\`\`,fontStyle:\`\`,lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:\`horizontal\`,wordBreak:\`break-all\`,ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:\`no-wrap\`,heightLimit:1/0,lineClamp:1/0,suffixPosition:\`end\`,underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:ir.fontBounding,keepCenterInLine:!1},xi=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:\`black\`,textureSize:10,texturePadding:2,backgroundMode:\`no-repeat\`,backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:\`\`,cursor:null,html:null,react:null},_i),yi),{alignSelf:\`auto\`}),{pickStrokeBuffer:0}),Si={connectedType:\`none\`,connectedStyle:{},connectedX:NaN,connectedY:NaN},Ci=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:\`default\`,pickMode:\`accurate\`,customPickShape:null,boundsMode:\`accurate\`,keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:\`\`,overflow:\`hidden\`,shadowPickMode:\`graphic\`,keepStrokeScale:!1,clipConfig:null},{_debug_bounds:!1}),xi),gi),wi=Object.assign(Object.assign({},Ci),{startAngle:0,endAngle:F,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),Ti=Object.assign(Object.assign(Object.assign({},Ci),Si),{points:[],segments:[],curveType:\`linear\`,clipRange:1,closePath:!1,curveTension:1}),Ei=Object.assign(Object.assign({},Ci),{radius:1,startAngle:0,endAngle:F}),Di=Object.assign(Object.assign({},Ci),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:\`relative\`,flexDirection:\`row\`,flexWrap:\`wrap\`,justifyContent:\`flex-start\`,alignItems:\`flex-start\`,alignContent:\`flex-start\`,baseOpacity:1,cornerType:\`round\`}),Oi=Object.assign(Object.assign({},Ci),{path:\`\`,width:0,height:0,cornerRadius:0,clip:!1}),ki=Object.assign(Object.assign(Object.assign({},Ci),Si),{points:[],segments:[],curveType:\`linear\`,clipRange:1,clipRangeByDimension:\`default\`,closePath:!1,curveTension:1}),Ai=Object.assign(Object.assign({},Ci),{path:new pi,fillStrokeOrder:1,clipRange:1,customPath:()=>{xe.getInstance().warn(\`空函数\`)}}),ji=Object.assign(Object.assign({},Ci),{points:[],cornerRadius:0,closePath:!0}),Mi=Object.assign(Object.assign({},Ci),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:\`round\`});Object.assign(Object.assign({},Ci),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:\`round\`});let Ni=Object.assign(Object.assign({},Ci),{symbolType:\`circle\`,size:10,keepDirIn3d:!0,clipRange:1}),Pi=Object.assign(Object.assign(Object.assign({},Ci),bi),{strokeBoundsBuffer:0,keepDirIn3d:!0}),Fi=Object.assign(Object.assign(Object.assign({},Ci),bi),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:\`actual\`,width:300,height:300,ellipsis:!0,wordBreak:\`break-word\`,verticalDirection:\`top\`,textAlign:\`left\`,textBaseline:\`top\`,layoutDirection:\`horizontal\`,textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Ii=Object.assign(Object.assign({repeatX:\`no-repeat\`,repeatY:\`no-repeat\`,image:\`\`,width:0,height:0,maxWidth:500,maxHeight:500},Ci),{fill:!0,cornerRadius:0,cornerType:\`round\`}),Li=Object.assign(Object.assign({},Ii),{backgroundShowMode:\`never\`,backgroundWidth:0,backgroundHeight:0,textAlign:\`left\`,textBaseline:\`middle\`,direction:\`horizontal\`,margin:0,id:\`\`,width:20,height:20,backgroundFill:\`rgba(101, 117, 168, 0.1)\`,backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1}),B=new class{},Ri=function(){let e={linearGradient:/^(linear\\-gradient)/i,radialGradient:/^(radial\\-gradient)/i,conicGradient:/^(conic\\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\\-side|closest\\-corner|farthest\\-side|farthest\\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))px/,percentageValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))\\%/,emValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))em/,angleValue:/^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))deg/,fromAngleValue:/^from\\s*(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))deg/,startCall:/^\\(/,endCall:/^\\)/,comma:/^,/,hexColor:/(^\\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\\(\\d{1,3},\\s*\\d{1,3},\\s*\\d{1,3}\\))/i,rgbaColor:/^(rgba\\(\\d{1,3},\\s*\\d{1,3},\\s*\\d{1,3},\\s*((\\d\\.\\d+)|\\d{1,3})\\))/i,number:/^(([0-9]*\\.[0-9]+)|([0-9]+\\.?))/},t=\`\`;function n(e){let n=Error(t+\`: \`+e);throw n.source=t,n}function r(){return i(\`linear\`,e.linearGradient,a)||i(\`radial\`,e.radialGradient,s)||i(\`conic\`,e.conicGradient,o)}function i(t,r,i){return function(r,a){if(_(r)){_(e.startCall)||n(\`Missing (\`);let r=function(r){let a=i();return a&&(_(e.comma)||n(\`Missing comma before color stops\`)),{type:t,orientation:a,colorStops:f(p)}}();return _(e.endCall)||n(\`Missing )\`),r}}(r)}function a(){return g(\`directional\`,e.sideOrCorner,1)||g(\`angular\`,e.angleValue,1)}function o(){return g(\`angular\`,e.fromAngleValue,1)}function s(){let n,r,i=c();return i&&(n=[],n.push(i),r=t,_(e.comma)&&(i=c(),i?n.push(i):t=r)),n}function c(){let e=function(){let e=g(\`shape\`,/^(circle)/i,0);return e&&(e.style=h()||l()),e}()||function(){let e=g(\`shape\`,/^(ellipse)/i,0);return e&&(e.style=m()||l()),e}();if(e)e.at=u();else{let t=l();if(t){e=t;let n=u();n&&(e.at=n)}else{let t=d();t&&(e={type:\`default-radial\`,at:t})}}return e}function l(){return g(\`extent-keyword\`,e.extentKeywords,1)}function u(){if(g(\`position\`,/^at/,0)){let e=d();return e||n(\`Missing positioning value\`),e}}function d(){let e={x:m(),y:m()};if(e.x||e.y)return{type:\`position\`,value:e}}function f(t){let r=t(),i=[];if(r)for(i.push(r);_(e.comma);)r=t(),r?i.push(r):n(\`One extra comma\`);return i}function p(){let t=g(\`hex\`,e.hexColor,1)||g(\`rgba\`,e.rgbaColor,1)||g(\`rgb\`,e.rgbColor,1)||g(\`literal\`,e.literalColor,0);return t||n(\`Expected color definition\`),t.length=m(),t}function m(){return g(\`%\`,e.percentageValue,1)||g(\`position-keyword\`,e.positionKeywords,1)||h()}function h(){return g(\`px\`,e.pixelValue,1)||g(\`em\`,e.emValue,1)}function g(e,t,n){let r=_(t);if(r)return{type:e,value:r[n]}}function _(e){let n=/^[\\n\\r\\t\\s]+/.exec(t);n&&v(n[0].length);let r=e.exec(t);return r&&v(r[0].length),r}function v(e){t=t.substr(e)}return function(e){return t=e.toString(),function(){let e=f(r);return t.length>0&&n(\`Invalid input not EOF\`),e}()}}();class zi{static IsGradient(e){return!(typeof e==\`string\`&&!e.includes(\`gradient\`))}static IsGradientStr(e){return typeof e==\`string\`&&e.includes(\`gradient\`)}static Parse(e){if(zi.IsGradientStr(e))try{let t=Ri(e)[0];if(t){if(t.type===\`linear\`)return zi.ParseLinear(t);if(t.type===\`radial\`)return zi.ParseRadial(t);if(t.type===\`conic\`)return zi.ParseConic(t)}}catch{return e}return e}static ParseConic(e){let{orientation:t,colorStops:n=[]}=e,r=Re/2,i=parseFloat(t.value)/180*Re-r;return{gradient:\`conical\`,x:.5,y:.5,startAngle:i,endAngle:i+F,stops:n.map((e=>({color:e.value,offset:parseFloat(e.length.value)/100})))}}static ParseRadial(e){let{colorStops:t=[]}=e;return{gradient:\`radial\`,x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:t.map((e=>({color:e.value,offset:parseFloat(e.length.value)/100})))}}static ParseLinear(e){let{orientation:t,colorStops:n=[]}=e,r=Re/2,i=t.type===\`angular\`?parseFloat(t.value)/180*Re:0;for(;i<0;)i+=F;for(;i>=F;)i-=F;let a=0,o=0,s=0,c=0;return i<r?(a=0,o=1,s=Math.sin(i),c=o-Math.cos(i)):i<Re?(a=0,o=0,s=Math.cos(i-r),c=Math.sin(i-r)):i<Re+r?(a=1,o=0,s=a-Math.sin(i-Re),c=Math.cos(i-Re)):(a=1,s=a-Math.cos(i-r-Re),c-=Math.sin(i-r-Re)),{gradient:\`linear\`,x0:a,y0:o,x1:s,y1:c,stops:n.map((e=>({color:e.value,offset:parseFloat(e.length.value)/100})))}}}function Bi(e,t,n){let r=t,{a:i,b:a,c:o,d:s}=e.currentMatrix,c=Math.sign(i)*Math.sqrt(i*i+a*a),l=Math.sign(s)*Math.sqrt(o*o+s*s);return c+l===0?0:(r=r/Math.abs(c+l)*2*n,r)}function Vi(e,t,n){let r,i,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!t||!0===t)return\`black\`;if(y(t))for(let e=0;e<t.length&&(i=t[e],!i);e++);else i=t;if(i=zi.Parse(i),typeof i==\`string\`)return i;if(n.AABBBounds&&(!n.attribute||n.attribute.scaleX!==0||n.attribute.scaleY!==0)){let t=n.AABBBounds,s=t.x2-t.x1,c=t.y2-t.y1,l=t.x1-a,u=t.y1-o;if(n.attribute){let{scaleX:e=1,scaleY:t=1}=n.attribute;s/=e,c/=t,l/=e,u/=t}i.gradient===\`linear\`?r=function(e,t,n,r,i,a){let o=e.createLinearGradient(n+(t.x0??0)*i,r+(t.y0??0)*a,n+(t.x1??1)*i,r+(t.y1??0)*a);return t.stops.forEach((e=>{o.addColorStop(e.offset,e.color)})),o}(e,i,l,u,s,c):i.gradient===\`conical\`?r=function(e,t,n,r,i,a){let o=e.createConicGradient(n+(t.x??0)*i,r+(t.y??0)*a,t.startAngle,t.endAngle);return t.stops.forEach((e=>{o.addColorStop(e.offset,e.color)})),o.GetPattern(i+n,a+r,void 0)}(e,i,l,u,s,c):i.gradient===\`radial\`&&(r=function(e,t,n,r,i,a){let o=e.createRadialGradient(n+(t.x0??.5)*i,r+(t.y0??.5)*a,Math.max(i,a)*(t.r0??0),n+(t.x1??.5)*i,r+(t.y1??.5)*a,Math.max(i,a)*(t.r1??.5));return t.stops.forEach((e=>{o.addColorStop(e.offset,e.color)})),o}(e,i,l,u,s,c))}return r||\`orange\`}let Hi={horizontal:{width:\`width\`,height:\`height\`,left:\`left\`,top:\`top\`,x:\`x\`,y:\`y\`,bottom:\`bottom\`},vertical:{width:\`height\`,height:\`width\`,left:\`top\`,top:\`left\`,x:\`y\`,y:\`x\`,bottom:\`right\`}},Ui=/\\w|\\(|\\)|-/,Wi=/[.?!,;:/，。？！、；：]/,Gi=/\\S/,Ki=(e,t)=>{let n=t.fontSize||16;switch(t.script){case\`super\`:case\`sub\`:n*=.8}e.setTextStyle({textAlign:\`left\`,textBaseline:t.textBaseline||\`alphabetic\`,fontStyle:t.fontStyle||\`\`,fontWeight:t.fontWeight||\`\`,fontSize:n,fontFamily:t.fontFamily})};function qi(e,t,n,r,i){if(!t||t<=0)return 0;let a=B.graphicUtil.textMeasure,o=r,s=e.slice(0,o),c=Math.floor(a.measureText(s,n).width),l=e.slice(0,o+1),u=Math.floor(a.measureText(l,n).width);for(;c>t||u<=t;){if(c>t?o--:o++,o>e.length){o=e.length;break}if(o<0){o=0;break}s=e.slice(0,o),c=Math.floor(a.measureText(s,n).width),l=e.slice(0,o+1),u=Math.floor(a.measureText(l,n).width)}return i&&(o=Ji(e,o)),o}function Ji(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=t;for(;Ui.test(e[r-1])&&Ui.test(e[r])||Wi.test(e[r]);)if(r--,r<=0)return n?Yi(e,t):t;return r}function Yi(e,t){let n=t;for(;Ui.test(e[n+1])&&Ui.test(e[n])||Wi.test(e[n]);)if(n++,n>=e.length)return n;return n+1}function Xi(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`actual\`,r=B.graphicUtil.textMeasure.measureText(e,t),i={ascent:0,height:0,descent:0,width:0},a=n===\`actual\`?r.actualBoundingBoxAscent:r.fontBoundingBoxAscent,o=n===\`actual\`?r.actualBoundingBoxDescent:r.fontBoundingBoxDescent;return typeof a!=\`number\`||typeof o!=\`number\`?(i.width=Math.floor(r.width),i.height=t.fontSize||0,i.ascent=i.height,i.descent=0):(i.width=Math.floor(r.width),i.height=Math.floor(a+o),i.ascent=Math.floor(a),i.descent=i.height-i.ascent),i}var Zi=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let Qi=class{configure(e,t){this.canvas=e.canvas,this.context=e.context,e.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(e,t,n){this.context.setTextStyleWithoutAlignBaseline(t);let r=this.context.measureText(e);return n?this.compatibleMetrics(r,t):r}_measureTextWithAlignBaseline(e,t,n){this.context.setTextStyle(t);let r=this.context.measureText(e);return n?this.compatibleMetrics(r,t):r}compatibleMetrics(e,t){if(e.actualBoundingBoxAscent==null||e.actualBoundingBoxDescent==null||e.fontBoundingBoxAscent==null||e.fontBoundingBoxDescent==null){e={width:e.width};let{ascent:n,descent:r}=this.measureTextBoundADscentEstimate(t);e.actualBoundingBoxAscent=n,e.actualBoundingBoxDescent=r,e.fontBoundingBoxAscent=n,e.fontBoundingBoxDescent=r}if(e.actualBoundingBoxLeft==null||e.actualBoundingBoxRight==null){e={width:e.width,actualBoundingBoxAscent:e.actualBoundingBoxAscent,actualBoundingBoxDescent:e.actualBoundingBoxDescent,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent};let{left:n,right:r}=this.measureTextBoundLeftRightEstimate(t);e.actualBoundingBoxLeft=n,e.actualBoundingBoxRight=r}return e}estimate(e,t){let{fontSize:n=Pi.fontSize}=t,r=0,i=0;for(let t=0;t<e.length;t++)e.charCodeAt(t)<128?r++:i++;return{width:~~(.8*r*n+i*n),height:n}}measureTextWidth(e,t,n){return this.context?(n??=this._measureTextWithoutAlignBaseline(e,t)).width:this.estimate(e,t).width}measureTextBoundsWidth(e,t,n){return this.context?(n??=this._measureTextWithoutAlignBaseline(e,t)).width:this.estimate(e,t).width}measureTextBoundsLeftRight(e,t,n){return this.context?{left:(n??=this._measureTextWithAlignBaseline(e,t,!0)).actualBoundingBoxLeft,right:n.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(t)}measureTextPixelHeight(e,t,n){return this.context?(n??=this._measureTextWithoutAlignBaseline(e,t,!0),Math.abs(n.actualBoundingBoxAscent-n.actualBoundingBoxDescent)):t.fontSize??bi.fontSize}measureTextPixelADscent(e,t,n){return this.context?{ascent:(n??=this._measureTextWithAlignBaseline(e,t,!0)).actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundHieght(e,t,n){return this.context?(n??=this._measureTextWithoutAlignBaseline(e,t,!0),Math.abs(n.fontBoundingBoxAscent-n.fontBoundingBoxDescent)):t.fontSize??bi.fontSize}measureTextBoundADscent(e,t,n){return this.context?{ascent:(n??=this._measureTextWithAlignBaseline(e,t,!0)).fontBoundingBoxAscent,descent:n.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundADscentEstimate(e){let t=e.fontSize??bi.fontSize;return{ascent:.79*t,descent:.21*t}}measureTextBoundLeftRightEstimate(e){let t=e.fontSize??bi.fontSize,{textAlign:n}=e;return n===\`center\`?{left:t/2,right:t/2}:n===\`right\`||n===\`end\`?{left:t,right:0}:{left:0,right:t}}measureTextPixelADscentAndWidth(e,t,n){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:this.estimate(e,t).width});let r=this._measureTextWithoutAlignBaseline(e,t,!0);if(n===ir.actualBounding)return{ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,width:r.width};if(n===ir.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:r.width});if(n===ir.fontBounding){let e=r.fontBoundingBoxAscent,t=r.fontBoundingBoxDescent;if(r.actualBoundingBoxDescent&&t<r.actualBoundingBoxDescent){let n=r.actualBoundingBoxDescent-t;t+=n,e-=n}else if(r.actualBoundingBoxAscent&&e<r.actualBoundingBoxAscent){let n=r.actualBoundingBoxAscent-e;e+=n,t-=n}return{ascent:e,descent:t,width:r.width}}return{ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,width:r.width}}measureText(e,t){return this.context?(this.context.setTextStyleWithoutAlignBaseline(t),this.context.measureText(e)):this.estimate(e,t)}clipTextVertical(e,t,n,r){if(e.length===0)return{verticalList:e,width:0};let{fontSize:i=12}=t;e.forEach((e=>{e.width=e.direction===0?i:this.measureTextWidth(e.text,t)}));let a=[],o=0,s=0;for(;s<e.length&&o+e[s].width<n;s++)o+=e[s].width,a.push(e[s]);if(e[s]&&e[s].text.length>1){let i=this._clipText(e[s].text,t,n-o,0,e[s].text.length-1,\`end\`,!1);if(r&&i.str!==e[s].text){let n=\`\`,r=0;for(let t=0;t<s;t++){let i=e[t];n+=i.text,r+=i.text.length}n+=e[s].text;let a=Ji(n,r+i.str.length);a-=r,a!==i.str.length-1&&(i.str=i.str.substring(0,a),i.width=this.measureTextWidth(i.str,t))}a.push(Object.assign(Object.assign({},e[s]),{text:i.str,width:i.width})),o+=i.width}return{verticalList:a,width:o}}clipText(e,t,n,r,i){if(e.length===0)return{str:\`\`,width:0};let a=this.measureTextWidth(e,t);if(a<=n)return{str:e,width:a};if(a=this.measureTextWidth(e[0],t),a>n)return{str:\`\`,width:0};let o=this._clipText(e,t,n,0,e.length-1,\`end\`,!1);if(r&&o.str!==e){let n=Ji(e,o.str.length,i);n!==o.str.length&&(n>o.str.length&&(o.wordBreaked=n,n=o.str.length),o.str=e.substring(0,n),o.width=this.measureTextWidth(o.str,t))}return o}_clipText(e,t,n,r,i,a,o){let s;if(a===\`start\`)s=this._clipTextStart(e,t,n,r,i),o&&(s.result=o+s.str);else if(a===\`middle\`){let r=this._clipTextMiddle(e,t,n,\`\`,\`\`,0,0,1);s={str:\`none\`,width:r.width,result:r.left+o+r.right}}else s=this._clipTextEnd(e,t,n,r,i),o&&(s.result=s.str+o);return s}_clipTextEnd(e,t,n,r,i){if(r===i){xe.getInstance().warn(\`【_clipTextEnd】不应该走到这里\${e}, \${r}, \${i}\`);let n=e.substring(0,i+1);return{str:n,width:this.measureTextWidth(n,t)}}let a=Math.floor((r+i)/2),o=e.substring(0,a+1),s=this.measureTextWidth(o,t),c;if(s>n){if(o.length<=1)return{str:\`\`,width:0};let i=e.substring(0,a);return c=this.measureTextWidth(i,t),c<=n?{str:i,width:c}:this._clipTextEnd(e,t,n,r,a)}if(s<n){if(a>=e.length-1)return{str:e,width:this.measureTextWidth(e,t)};let r=e.substring(0,a+2);return c=this.measureTextWidth(r,t),c>=n?{str:o,width:s}:this._clipTextEnd(e,t,n,a,i)}return{str:o,width:s}}_clipTextStart(e,t,n,r,i){let a=Math.ceil((r+i)/2),o=e.substring(a-1,e.length),s=this.measureTextWidth(o,t),c;if(s>n){if(o.length<=1)return{str:\`\`,width:0};let r=e.substring(a,e.length);return c=this.measureTextWidth(r,t),c<=n?{str:r,width:c}:this._clipTextStart(e,t,n,a,e.length)}if(s<n){if(a<=0)return{str:e,width:this.measureTextWidth(e,t)};let i=e.substring(a-2,e.length);return c=this.measureTextWidth(i,t),c>=n?{str:o,width:s}:this._clipTextStart(e,t,n,r,a)}return{str:o,width:s}}_clipTextMiddle(e,t,n,r,i,a,o,s){let c=e.substring(0,s),l=this.measureTextWidth(c,t);if(l+o>n)return{left:r,right:i,width:a+o};let u=e.substring(e.length-s,e.length),d=this.measureTextWidth(u,t);return l+d>n?{left:c,right:i,width:l+o}:this._clipTextMiddle(e,t,n,c,u,l,d,s+1)}clipTextWithSuffixVertical(e,t,n,r,i,a){if(r===\`\`)return this.clipTextVertical(e,t,n,i);if(e.length===0)return{verticalList:e,width:0};let o=this.clipTextVertical(e,t,n,i);if(o.verticalList.length===e.length&&o.verticalList[o.verticalList.length-1].width===e[e.length-1].width)return o;let s=this.measureTextWidth(r,t);if(s>n)return o;let c;if(n-=s,a===\`start\`){let a=this.revertVerticalList(e);c=this.clipTextVertical(a,t,n,i);let o=this.revertVerticalList(c.verticalList);o.unshift({text:r,direction:1,width:s}),c.verticalList=o}else if(a===\`middle\`){let a=this.clipTextVertical(e,t,n/2,i),o=this.revertVerticalList(e),l=this.clipTextVertical(o,t,n/2,i);a.verticalList.push({text:r,direction:1,width:s}),this.revertVerticalList(l.verticalList).forEach((e=>a.verticalList.push(e))),c={verticalList:a.verticalList,width:a.width+l.width}}else c=this.clipTextVertical(e,t,n,i),c.verticalList.push({text:r,direction:1,width:s});return c.width+=s,c}revertVerticalList(e){return e.reverse().map((e=>{let t=e.text.split(\`\`).reverse().join(\`\`);return Object.assign(Object.assign({},e),{text:t})}))}clipTextWithSuffix(e,t,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];if(r===\`\`)return this.clipText(e,t,n,i);if(e.length===0)return{str:\`\`,width:0};let s=this.measureTextWidth(e,t);if(!o&&s<=n)return{str:e,width:s};let c=this.measureTextWidth(r,t);if(c>n)return{str:\`\`,width:0};if(o&&s+c<=n)return{str:e+r,width:s+c};n-=c;let l=this._clipText(e,t,n,0,e.length-1,a,r);if(i&&l.str!==e){let n=Ji(e,l.str.length);n!==l.str.length&&(l.result=e.substring(0,n),l.width=this.measureTextWidth(l.str,t))}else o&&l.str===e&&(l.result=e+r);return l.str=l.result,l.width+=c,l}};Qi=Zi([R()],Qi);var $i=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let ea=Symbol.for(\`TextMeasureContribution\`),ta=class extends Qi{};ta=$i([R()],ta);let V=new class{constructor(e){let t=e||{};t.defaultScope=t.defaultScope||Ln,this.options=t,this.id=Cn.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new Vn}load(e){let t=this._getContainerModuleHelpersFactory()(e.id);e.registry(t.bindFunction,t.unbindFunction,t.isboundFunction,t.rebindFunction)}get(e){let t=this._getNotAllArgs(e,!1);return this._get(t)}getAll(e){let t=this._getAllArgs(e);return this._get(t)}getTagged(e,t,n){let r=this._getNotAllArgs(e,!1,t,n);return this._get(r)}getNamed(e,t){return this.getTagged(e,wn,t)}isBound(e){return this._bindingDictionary.has(e)}bind(e){let t=this.options.defaultScope,n=new Bn(e,t),r=this._bindingDictionary.get(e)||[];return r.push(n),this._bindingDictionary.set(e,r),new Gn(n)}unbind(e){this._bindingDictionary.delete(e)}rebind(e){return this.unbind(e),this.bind(e)}_getContainerModuleHelpersFactory(){let e=(e,t)=>{e._binding.moduleId=t},t=t=>n=>{let r=this.bind(n);return e(r,t),r},n=()=>e=>this.unbind(e),r=()=>e=>this.isBound(e),i=t=>n=>{let r=this.rebind(n);return e(r,t),r};return e=>({bindFunction:t(e),isboundFunction:r(),rebindFunction:i(e),unbindFunction:n(),unbindAsyncFunction:e=>null})}_getNotAllArgs(e,t,n,r){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:r}}_getAllArgs(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}}_get(e){let t=[];return this._bindingDictionary.get(e.serviceIdentifier).filter((t=>t.constraint(e))).forEach((e=>{t.push(this._resolveFromBinding(e))})),e.isMultiInject||t.length!==1?t:t[0]}_getChildRequest(e){let t=e.implementationType,{userGeneratedMetadata:n}=this._metadataReader.getConstructorMetadata(t),r=Object.keys(n),i=[];for(let e=0;e<r.length;e++){let t=n[e],r={};t.forEach((e=>{r[e.key]=e.value}));let a={inject:r[Tn],multiInject:r[En]},o=a.inject||a.multiInject,s={serviceIdentifier:o,constructorArgsMetadata:t},c=(this._bindingDictionary.get(o)||[]).filter((e=>e.constraint(s)));if(c.length){let e={injectIdentifier:o,metadata:t,bindings:c};i.push(e)}}return i}_resolveFromBinding(e){let t=this._getResolvedFromBinding(e);return this._saveToScope(e,t),t}_getResolvedFromBinding(e){let t;switch(e.type){case Rn:case\`Function\`:t=e.cache;break;case zn:t=this._resolveInstance(e,e.implementationType);break;default:t=e.dynamicValue({container:this})}return t}_resolveInstance(e,t){if(e.activated)return e.cache;let n=this._getChildRequest(e);return this._createInstance(t,n)}_createInstance(e,t){return t.length?new e(...this._resolveRequests(t)):new e}_resolveRequests(e){return e.map((e=>e.bindings.length>1?e.bindings.map((e=>this._resolveFromBinding(e))):this._resolveFromBinding(e.bindings[0])))}_saveToScope(e,t){e.scope===In&&(e.cache=t,e.activated=!0)}},na=Symbol.for(\`CanvasFactory\`),ra=Symbol.for(\`Context2dFactory\`);function ia(e){return V.getNamed(na,B.global.env)(e)}let aa=1e-4,oa=Math.sqrt(3),sa=1/3;function ca(e){return e>-xa&&e<xa}function la(e){return e>xa||e<-xa}let ua=[0,0],da=[0,0],fa=[0,0];function pa(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function ma(e,t,n,r){let i=1-r;return i*(i*e+2*r*t)+r*r*n}function ha(e,t,n,r,i){let a=1-i;return a*a*(a*e+3*i*t)+i*i*(i*r+3*a*n)}function ga(e){return(e%=F)<0&&(e+=F),e}function _a(e,t,n,r,i,a,o,s,c){if(o===0)return!1;let l=o;return!(c>t+l&&c>r+l&&c>a+l||c<t-l&&c<r-l&&c<a-l||s>e+l&&s>n+l&&s>i+l||s<e-l&&s<n-l&&s<i-l)&&function(e,t,n,r,i,a,o,s,c){let l=0,u=.005,d=1/0;ua[0]=o,ua[1]=s;for(let o=0;o<1;o+=.05){da[0]=ma(e,n,i,o),da[1]=ma(t,r,a,o);let s=pa(ua,da);s<d&&(l=o,d=s)}d=1/0;for(let o=0;o<32&&!(u<aa);o++){let o=l-u,s=l+u;da[0]=ma(e,n,i,o),da[1]=ma(t,r,a,o);let c=pa(da,ua);if(o>=0&&c<d)l=o,d=c;else{fa[0]=ma(e,n,i,s),fa[1]=ma(t,r,a,s);let o=pa(fa,ua);s<=1&&o<d?(l=s,d=o):u*=.5}}return c&&(c[0]=ma(e,n,i,l),c[1]=ma(t,r,a,l)),Math.sqrt(d)}(e,t,n,r,i,a,s,c,null)<=l/2}function va(e,t,n,r,i,a,o,s,c,l,u){if(c===0)return!1;let d=c;return!(u>t+d&&u>r+d&&u>a+d&&u>s+d||u<t-d&&u<r-d&&u<a-d&&u<s-d||l>e+d&&l>n+d&&l>i+d&&l>o+d||l<e-d&&l<n-d&&l<i-d&&l<o-d)&&function(e,t,n,r,i,a,o,s,c,l,u){let d,f,p,m,h=0,g=.005,_=1/0;ua[0]=c,ua[1]=l;for(let c=0;c<1;c+=.05)da[0]=ha(e,n,i,o,c),da[1]=ha(t,r,a,s,c),p=pa(ua,da),p<_&&(h=c,_=p);_=1/0;for(let c=0;c<32&&!(g<aa);c++)d=h-g,f=h+g,da[0]=ha(e,n,i,o,d),da[1]=ha(t,r,a,s,d),p=pa(da,ua),d>=0&&p<_?(h=d,_=p):(fa[0]=ha(e,n,i,o,f),fa[1]=ha(t,r,a,s,f),m=pa(fa,ua),f<=1&&m<_?(h=f,_=m):g*=.5);return u&&(u[0]=ha(e,n,i,o,h),u[1]=ha(t,r,a,s,h)),Math.sqrt(_)}(e,t,n,r,i,a,o,s,l,u,null)<=d/2}function ya(e,t,n,r,i,a,o,s,c){if(o===0)return!1;let l=o;s-=e,c-=t;let u=Math.sqrt(s*s+c*c);if(u-l>n||u+l<n)return!1;if(Math.abs(r-i)%F<1e-4)return!0;if(a){let e=r;r=ga(i),i=ga(e)}else r=ga(r),i=ga(i);r>i&&(i+=F);let d=Math.atan2(c,s);return d<0&&(d+=F),d>=r&&d<=i||d+F>=r&&d+F<=i}function ba(e,t,n,r,i,a,o){if(i===0)return!1;let s=i,c=i/2,l=0,u=e;if(o>t+c&&o>r+c||o<t-c&&o<r-c||a>e+c&&a>n+c||a<e-c&&a<n-c)return!1;if(e===n)return Math.abs(a-e)<=s/2;l=(t-r)/(e-n),u=(e*r-n*t)/(e-n);let d=l*a-o+u;return d*d/(l*l+1)<=s/2*s/2}let xa=1e-4;function Sa(e,t,n,r,i){let a=6*n-12*t+6*e,o=9*t+3*r-3*e-9*n,s=3*t-3*e,c=0;if(ca(o)){if(la(a)){let e=-s/a;e>=0&&e<=1&&(i[c++]=e)}}else{let e=a*a-4*o*s;if(ca(e))i[0]=-a/(2*o);else if(e>0){let t=Math.sqrt(e),n=(-a+t)/(2*o),r=(-a-t)/(2*o);n>=0&&n<=1&&(i[c++]=n),r>=0&&r<=1&&(i[c++]=r)}}return c}let Ca=[-1,-1,-1],wa=[-1,-1];function Ta(){let e=wa[0];wa[0]=wa[1],wa[1]=e}function Ea(e,t,n,r,i,a,o,s,c,l){if(l>t&&l>r&&l>a&&l>s||l<t&&l<r&&l<a&&l<s)return 0;let u=function(e,t,n,r,i,a){let o=r+3*(t-n)-e,s=3*(n-2*t+e),c=3*(t-e),l=e-i,u=s*s-3*o*c,d=s*c-9*o*l,f=c*c-3*s*l,p=0;if(ca(u)&&ca(d))if(ca(s))a[0]=0;else{let e=-c/s;e>=0&&e<=1&&(a[p++]=e)}else{let e=d*d-4*u*f;if(ca(e)){let e=d/u,t=-s/o+e,n=-e/2;t>=0&&t<=1&&(a[p++]=t),n>=0&&n<=1&&(a[p++]=n)}else if(e>0){let t=Math.sqrt(e),n=u*s+1.5*o*(-d+t),r=u*s+1.5*o*(-d-t);n=n<0?-((-n)**+sa):n**+sa,r=r<0?-((-r)**+sa):r**+sa;let i=(-s-(n+r))/(3*o);i>=0&&i<=1&&(a[p++]=i)}else{let e=(2*u*s-3*o*d)/(2*Math.sqrt(u*u*u)),t=Math.acos(e)/3,n=Math.sqrt(u),r=Math.cos(t),i=(-s-2*n*r)/(3*o),c=(-s+n*(r+oa*Math.sin(t)))/(3*o),l=(-s+n*(r-oa*Math.sin(t)))/(3*o);i>=0&&i<=1&&(a[p++]=i),c>=0&&c<=1&&(a[p++]=c),l>=0&&l<=1&&(a[p++]=l)}}return p}(t,r,a,s,l,Ca);if(u===0)return 0;let d=0,f=-1,p=0,m=0;for(let l=0;l<u;l++){let u=Ca[l],h=u===0||u===1?.5:1;ha(e,n,i,o,u)<c||(f<0&&(f=Sa(t,r,a,s,wa),wa[1]<wa[0]&&f>1&&Ta(),p=ha(t,r,a,s,wa[0]),f>1&&(m=ha(t,r,a,s,wa[1]))),f===2?u<wa[0]?d+=p<t?h:-h:u<wa[1]?d+=m<p?h:-h:d+=s<m?h:-h:u<wa[0]?d+=p<t?h:-h:d+=s<p?h:-h)}return d}function Da(e,t,n,r,i,a,o,s){if(s>t&&s>r&&s>a||s<t&&s<r&&s<a)return 0;let c=function(e,t,n,r,i){let a=e-2*t+n,o=2*(t-e),s=e-r,c=0;if(ca(a)){if(la(o)){let e=-s/o;e>=0&&e<=1&&(i[c++]=e)}}else{let e=o*o-4*a*s;if(ca(e)){let e=-o/(2*a);e>=0&&e<=1&&(i[c++]=e)}else if(e>0){let t=Math.sqrt(e),n=(-o+t)/(2*a),r=(-o-t)/(2*a);n>=0&&n<=1&&(i[c++]=n),r>=0&&r<=1&&(i[c++]=r)}}return c}(t,r,a,s,Ca);if(c===0)return 0;let l=function(e,t,n){let r=e+n-2*t;return r===0?.5:(e-t)/r}(t,r,a);if(l>=0&&l<=1){let s=0,u=ma(t,r,a,l);for(let r=0;r<c;r++){let c=Ca[r]===0||Ca[r]===1?.5:1;ma(e,n,i,Ca[r])<o||(Ca[r]<l?s+=u<t?c:-c:s+=a<u?c:-c)}return s}let u=Ca[0]===0||Ca[0]===1?.5:1;return ma(e,n,i,Ca[0])<o?0:a<t?u:-u}function Oa(e,t,n,r,i,a,o,s){if((s-=t)>n||s<-n)return 0;let c=Math.sqrt(n*n-s*s);Ca[0]=-c,Ca[1]=c;let l=Math.abs(r-i);if(l<1e-4)return 0;if(l>=F-1e-4){r=0,i=F;let t=a?1:-1;return o>=Ca[0]+e&&o<=Ca[1]+e?t:0}if(r>i){let e=r;r=i,i=e}r<0&&(r+=F,i+=F);let u=0;for(let t=0;t<2;t++){let n=Ca[t];if(n+e>o){let e=Math.atan2(s,n),t=a?1:-1;e<0&&(e=F+e),(e>=r&&e<=i||e+F>=r&&e+F<=i)&&(e>Re/2&&e<1.5*Re&&(t=-t),u+=t)}}return u}function ka(e){return Math.round(e/Re*1e8)/1e8%2*Re}function Aa(e,t){let n=ka(e[0]);n<0&&(n+=F);let r=n-e[0],i=e[1];i+=r,!t&&i-n>=F?i=n+F:t&&n-i>=F?i=n-F:!t&&n>i?i=n+(F-ka(n-i)):t&&n<i&&(i=n-(F-ka(i-n))),e[0]=n,e[1]=i}let ja=[0,0];function Ma(e,t,n,r,i){let a=e,o=e.length,s,c,l=0,u=0,d=0,f=0,p=0;for(let e=0;e<o;e++){let o=a[e],m=e===0;o[0]===z.M&&e>1&&(n||(l+=gt(u,d,f,p,r,i))),m&&(u=o[1],d=o[2],f=u,p=d);let h=o[0],g=o[1],_=o[2],v=o[3],y=o[4],b=o[5],x=o[6],S=y,C=b;ja[0]=S,ja[1]=C,Aa(ja,!!o[6]),S=ja[0],C=ja[1];let w=S,T=C-S,E=!!(1-(o[6]?0:1)),D=(r-g)*v/v+g;switch(h){case z.M:f=g,p=_,u=f,d=p;break;case z.L:if(n){if(ba(u,d,g,_,t,r,i))return!0}else l+=gt(u,d,g,_,r,i)||0;u=g,d=_;break;case z.C:if(n){if(va(u,d,g,_,v,y,b,x,t,r,i))return!0}else l+=Ea(u,d,g,_,v,y,b,x,r,i)||0;u=b,d=x;break;case z.Q:if(n){if(_a(u,d,g,_,v,y,t,r,i))return!0}else l+=Da(u,d,g,_,v,y,r,i)||0;u=v,d=y;break;case z.A:if(s=Math.cos(w)*v+g,c=Math.sin(w)*v+_,m?(f=s,p=c):l+=gt(u,d,s,c,r,i),n){if(ya(g,_,v,w,w+T,E,t,D,i))return!0}else l+=Oa(g,_,v,w,w+T,E,D,i);u=Math.cos(w+T)*v+g,d=Math.sin(w+T)*v+_;break;case z.R:if(f=u=g,p=d=_,s=f+v,c=p+y,n){if(ba(f,p,s,p,t,r,i)||ba(s,p,s,c,t,r,i)||ba(s,c,f,c,t,r,i)||ba(f,c,f,p,t,r,i))return!0}else l+=gt(s,p,s,c,r,i),l+=gt(f,c,f,p,r,i);break;case z.Z:if(n){if(ba(u,d,f,p,t,r,i))return!0}else l+=gt(u,d,f,p,r,i);u=f,d=p}}return n||(m=d,h=p,Math.abs(m-h)<xa)||(l+=gt(u,d,f,p,r,i)||0),l!==0;var m,h}let Na=new class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||=this.allocate({width:100,height:100,dpr:2}),this._commonCanvas}allocate(e){if(!this.pools.length){let t=ia(Object.assign({nativeCanvas:B.global.createCanvas(e)},e));return this.allocatedCanvas.push(t),t}let t=this.pools.pop();return t.resize(e.width,e.height),t.dpr=e.dpr,t}allocateByObj(e){if(!this.pools.length){let t={width:e.width/e.dpr,height:e.height/e.dpr,dpr:e.dpr},n=ia(Object.assign({nativeCanvas:B.global.createCanvas(t)},t));return this.allocatedCanvas.push(n),n}let t=this.pools.pop();return t.width=e.width,t.height=e.height,t}free(e){this.pools.push(e)}get length(){return this.pools.length}release(){this.pools=[]}};var Pa=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Fa=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let Ia=Symbol.for(\`VWindow\`),La=Symbol.for(\`WindowHandlerContribution\`),Ra=class{get width(){return this._handler?this._width=this._handler.getWH().width:this._width}get height(){return this._handler?this._height=this._handler.getWH().height:this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new Xn([\`x\`,\`y\`,\`width\`,\`height\`])},this.active=()=>{let e=this.global;e.env&&!this.actived&&(V.getNamed(La,e.env).configure(this,e),this.actived=!0)},this._uid=Cn.GenAutoIncrementId(),this.global=B.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap(\`window\`,this.active),this.active()}get style(){return this._handler.getStyle()??{}}set style(e){this._handler.setStyle(e)}create(e){this._handler.createWindow(e);let t=this._handler.getWH();this._width=t.width,this._height=t.height,e.viewBox?this.setViewBox(e.viewBox):!1===e.canvasControled?this.setViewBox({x1:0,y1:0,x2:e.width??this._width,y2:e.height??this._height}):this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(e){this._handler=e}setDpr(e){return this._handler.setDpr(e)}resize(e,t){return this._handler.resizeWindow(e,t)}configure(){throw Error(\`暂不支持\`)}release(){return this.global.hooks.onSetEnv.unTap(\`window\`,this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(e){return this._handler.getImageBuffer?this._handler.getImageBuffer(e):null}addEventListener(e,t,n){return this._handler.addEventListener(e,t,n)}removeEventListener(e,t,n){return this._handler.removeEventListener(e,t,n)}dispatchEvent(e){return this._handler.dispatchEvent(e)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(e){this._handler.clearViewBox(e)}setViewBox(e){this._handler.setViewBox(e)}setViewBoxTransform(e,t,n,r,i,a){this._handler.setViewBoxTransform(e,t,n,r,i,a)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(e,t){let n=this._handler.getViewBox(),r={x:e,y:t};return this._handler.getViewBoxTransform().transformPoint({x:e,y:t},r),r.x-=n.x1,r.y-=n.y1,r}hasSubView(){let e=this._handler.getViewBox();return!(e.x1===0&&e.y1===0&&Ce(this.width,e.width())&&Ce(this.height,e.height()))}isVisible(e){return this._handler.isVisible(e)}onVisibleChange(e){return this._handler.onVisibleChange(e)}getTopLeft(e){return this._handler.getTopLeft(e)}};Ra=Pa([R(),Fa(\`design:paramtypes\`,[])],Ra);var za=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ba=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Va=function(e,t){return function(n,r){t(n,r,e)}};let Ha=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(e){this.contributions=e,this.configured=!1,this.global=B.global,this.global.hooks.onSetEnv.tap(\`graphic-util\`,((e,t,n)=>{this.configured=!1,this.configure(n,t)}))}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(e,t){this.configured||=(this.contributions.getContributions().forEach((e=>{e.configure(this,t)})),!0)}tryInitCanvas(){if(!this._canvas){let e=Na.shareCanvas();this._canvas=e,this._context=e.getContext(\`2d\`)}}bindTextMeasure(e){this._textMeasure=e}measureText(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`native\`;this.configure(this.global,this.global.env);let r=this.global.measureTextMethod;this.global.measureTextMethod=n;let i={width:this._textMeasure.measureTextWidth(e,t),height:t.fontSize??bi.fontSize};return this.global.measureTextMethod=r,i}createTextMeasureInstance(e,t,n){return this.configure(this.global,this.global.env),new yt(Object.assign({defaultFontParams:{fontFamily:bi.fontFamily,fontSize:bi.fontSize},getCanvasForMeasure:n||(()=>this.canvas),getTextBounds:void 0,specialCharSet:\`-/: .,@%'"~\`+yt.ALPHABET_CHAR_SET+yt.ALPHABET_CHAR_SET.toUpperCase()},t??{}),e)}drawGraphicToCanvas(e,t,n){if(!t.defaultLayer)return null;let r=V.get(Ia),i=e.AABBBounds,a=i.width(),o=i.height(),s=-i.x1,c=-i.y1;r.create({viewBox:{x1:s,y1:c,x2:i.x2,y2:i.y2},width:a,height:o,canvas:n,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:\`\`});let l=t.params.optimize.disableCheckGraphicWidthOutRange;t.params.optimize.disableCheckGraphicWidthOutRange=!0,t.defaultLayer.getNativeHandler().drawTo(r,[e],{transMatrix:r.getViewBoxTransform(),viewBox:r.getViewBox(),stage:t,layer:t.defaultLayer,renderService:t.renderService,background:\`transparent\`,clear:!0,updateBounds:!1}),t.params.optimize.disableCheckGraphicWidthOutRange=l;let u=r.getNativeHandler();return u.nativeCanvas?u.nativeCanvas:null}};var Ua;Ha=za([R(),Va(0,L(Kn)),Va(0,Fn(ea)),Ba(\`design:paramtypes\`,[Object])],Ha),function(e){e[e.transform=0]=\`transform\`,e[e.matrix=1]=\`matrix\`}(Ua||={});let Wa=new wt,Ga=class{constructor(){this.matrix=new wt}init(e){return this.mode=Ua.transform,this.originTransform=e,this.matrix.reset(),this}fromMatrix(e,t){return this.mode=Ua.matrix,this.outSourceMatrix=e,this.outTargetMatrix=t,this}scaleMatrix(e,t,n){let r=this.outSourceMatrix;if(Wa.setValue(r.a,r.b,r.c,r.d,r.e,r.f),this.outTargetMatrix.reset(),n){let{x:r,y:i}=n;this.outTargetMatrix.translate(r,i),this.outTargetMatrix.scale(e,t),this.outTargetMatrix.translate(-r,-i)}else this.outTargetMatrix.scale(e,t);return this.outTargetMatrix.multiply(Wa.a,Wa.b,Wa.c,Wa.d,Wa.e,Wa.f),this}rotateMatrix(e,t){let n=this.outSourceMatrix;if(Wa.setValue(n.a,n.b,n.c,n.d,n.e,n.f),this.outTargetMatrix.reset(),t){let{x:n,y:r}=t;this.outTargetMatrix.translate(n,r),this.outTargetMatrix.rotate(e),this.outTargetMatrix.translate(-n,-r)}else this.outTargetMatrix.rotate(e);return this.outTargetMatrix.multiply(Wa.a,Wa.b,Wa.c,Wa.d,Wa.e,Wa.f),this}scale(e,t,n){return this.mode===Ua.matrix?this.scaleMatrix(e,t,n):this}rotate(e,t){return this.mode===Ua.matrix?this.rotateMatrix(e,t):this}translateMatrix(e,t){let n=this.outSourceMatrix;return Wa.setValue(n.a,n.b,n.c,n.d,n.e,n.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(e,t),this.outTargetMatrix.multiply(Wa.a,Wa.b,Wa.c,Wa.d,Wa.e,Wa.f),this}translate(e,t){return this.mode===Ua.matrix?this.translateMatrix(e,t):this}simplify(e){return this.mode===Ua.matrix?this.simplifyMatrix(e):this}simplifyMatrix(e){return this}};Ga=za([R(),Ba(\`design:paramtypes\`,[])],Ga);let Ka={arc:wi,area:Ti,circle:Ei,line:ki,path:Ai,symbol:Ni,text:Pi,rect:Mi,polygon:ji,richtext:Fi,richtextIcon:Li,image:Ii,group:Di,glyph:Oi},qa=Object.keys(Ka);function Ja(e,t){Object.keys(t).forEach((n=>{e[n]=t[n]}))}let Ya={arc:Object.assign({},Ka.arc),area:Object.assign({},Ka.area),circle:Object.assign({},Ka.circle),line:Object.assign({},Ka.line),path:Object.assign({},Ka.path),symbol:Object.assign({},Ka.symbol),text:Object.assign({},Ka.text),rect:Object.assign({},Ka.rect),polygon:Object.assign({},Ka.polygon),richtext:Object.assign({},Ka.richtext),richtextIcon:Object.assign({},Ka.richtextIcon),image:Object.assign({},Ka.image),group:Object.assign({},Ka.group),glyph:Object.assign({},Ka.glyph)};class Xa{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},qa.forEach((e=>{this._defaultTheme[e]=Object.create(Ya[e])})),this.combinedTheme=this._defaultTheme}getTheme(e){if(!e||!this.dirty)return this.combinedTheme;let t={},n=this.getParentWithTheme(e);return n&&(t=n.theme),this.applyTheme(e,t),this.combinedTheme}getParentWithTheme(e){for(;e.parent;)if((e=e.parent).theme)return e;return null}applyTheme(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this.dirty){let r=this.getParentWithTheme(e);if(r){let e=r.theme;(e.dirty||n)&&e.applyTheme(r,t,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,xe.getInstance().warn(\`未知错误，走到不应该走的区域里\`)),this.dirty=!1)}return this.combinedTheme}doCombine(e){let t=this.userTheme,n=this.combinedTheme;qa.forEach((r=>{let i=Object.create(Ya[r]);e&&e[r]&&Ja(i,e[r]),n[r]&&Ja(i,n[r]),t[r]&&Ja(i,t[r]),this.combinedTheme[r]=i})),t.common&&qa.forEach((e=>{Ja(this.combinedTheme[e],t.common)})),this.dirty=!1}setTheme(e,t){let n=this.userTheme;n?Object.keys(e).forEach((t=>{n[t]?Object.assign(n[t],e[t]):n[t]=Object.assign({},e[t])})):n=e,this.userTheme=n,this.dirty=!0,this.dirtyChildren(t)}resetTheme(e,t){this.userTheme=e,this.dirty=!0,this.dirtyChildren(t)}dirtyChildren(e){e.forEachChildren((e=>{e.isContainer&&(e.theme&&(e.theme.dirty=!0),this.dirtyChildren(e))}))}}let Za=new Xa;function Qa(e,t){return e.glyphHost?Qa(e.glyphHost):t?(e.isContainer,t):function(e){let t;if(t=e.isContainer?e:e.parent,t){for(;t&&!t.theme;)t=t.parent;return t?(t.theme||t.createTheme(),t.theme.getTheme(t)):Za.getTheme()}return null}(e)||e.attachedThemeGraphic&&Qa(e.attachedThemeGraphic)||Za.getTheme()}var $a=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};class eo extends c{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=Cn.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(e){if(arguments.length>1&&arguments[1]!==void 0&&arguments[1]){let t=this._lastChild,n=0;for(;t;){if(e(t,n++))return;t=t._prev}}else{let t=this._firstChild,n=0;for(;t;){if(e(t,n++))return;t=t._next}}}forEachChildrenAsync(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return $a(this,void 0,void 0,(function*(){if(t){let t=this._lastChild,n=0;for(;t;){let r=e(t,n++);if(r.then&&(r=yield r),r)return;t=t._prev}}else{let t=this._firstChild,n=0;for(;t;){let r=e(t,n++);if(r.then&&(r=yield r),r)return;t=t._next}}}))}forEach(e){return this.forEachChildren(e)}appendChild(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._uid===e._uid)return null;if(!t&&e.isAncestorsOf(this))throw Error(\`【Node::appendChild】不能将父辈元素append为子元素\`);return e.parent&&e.parent.removeChild(e),e.parent=this,this._lastChild?(this._lastChild._next=e,e._prev=this._lastChild,this._lastChild=e):(this._firstChild=this._lastChild=e,e._prev=e._next=null),this._idMap||=new Map,this._idMap.set(e._uid,e),this.setCount(e.count),this._structEdit=!0,e}appendChildArrHighPerformance(e){return console.error(\`暂不支持该函数\`),e}insertBefore(e,t){if(!t)return this.appendChild(e);if(this===e||e===t)return null;if(e.isAncestorsOf(this))throw Error(\`【Node::insertBefore】不能将父辈元素insert为子元素\`);return t.parent===this?(e.parent&&e.parent.removeChild(e),e.parent=this,e._prev=t._prev,t._prev?t._prev._next=e:this._firstChild=e,t._prev=e,e._next=t,this._idMap||=new Map,this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e):null}insertAfter(e,t){if(!t)return this.appendChild(e);if(this===e||e===t)return null;if(e.isAncestorsOf(this))throw Error(\`【Node::insertAfter】不能将父辈元素insert为子元素\`);return t.parent===this?(e.parent&&e.parent.removeChild(e),e.parent=this,t._next?(t._next._prev=e,e._next=t._next):this._lastChild=e,t._next=e,e._prev=t,this._idMap||=new Map,this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e):null}insertInto(e,t){if(!this._ignoreWarn&&this._nodeList&&xe.getInstance().warn(\`insertIntoKeepIdx和insertInto混用可能会存在错误\`),t>=this.childrenCount)return this.appendChild(e);if(this===e)return null;if(e.isAncestorsOf(this))throw Error(\`【Node::insertBefore】不能将父辈元素insert为子元素\`);if(e.parent&&e.parent.removeChild(e),e.parent=this,t===0)e._next=this._firstChild,this._firstChild&&(this._firstChild._prev=e),e._prev=null,this._firstChild=e;else{let n=this._firstChild;for(let e=0;e<t;e++){if(!n)return null;e>0&&(n=n._next)}if(!n)return null;e._next=n._next,e._prev=n,n._next=e,e._next&&(e._next._prev=e)}return this._idMap||=new Map,this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e}insertIntoKeepIdx(e,t){if(this._nodeList||=this.children,this._nodeList[t]){let n=this._nodeList[t];return this._nodeList.splice(t,0,e),this.insertBefore(e,n)}let n;this._nodeList[t]=e;for(let e=t-1;e>=0&&(n=this._nodeList[e],!n);e--);if(n)return n._next?this.insertBefore(e,n._next):this.appendChild(e);this._ignoreWarn=!0;let r=this.insertInto(e,0);return this._ignoreWarn=!1,r}removeChild(e){if(!this._idMap||!this._idMap.has(e._uid))return null;if(this._idMap.delete(e._uid),this._nodeList){let t=this._nodeList.findIndex((t=>t===e));t>=0&&this._nodeList.splice(t,1)}return e._prev?e._prev._next=e._next:this._firstChild=e._next,e._next?e._next._prev=e._prev:this._lastChild=e._prev,e.parent=null,e._prev=null,e._next=null,this._structEdit=!0,this.setCount(-e.count),e}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(e){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let t=this._firstChild;for(;t;){let e=t._next;t.parent=null,t._prev=null,t._next=null,t=t._next,t=e}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(e,t){throw Error(\`暂不支持\`)}find(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=null;return this.forEachChildren(((t,r)=>!(t===this||!e(t,r)||(n=t,0)))),t&&this.forEachChildren((t=>{if(t.isContainer){let r=t.find(e,!0);if(r)return n=r,!0}return!1})),n}findAll(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=[];return this.forEachChildren(((t,r)=>{t!==this&&e(t,r)&&n.push(t)})),t&&this.forEachChildren((t=>{if(t.isContainer){let r=t.findAll(e,!0);r.length&&(n=n.concat(r))}})),n}getElementById(e){return this.find((t=>t.id===e),!0)}findChildById(e){return this.getElementById(e)}findChildByUid(e){return this._idMap&&this._idMap.get(e)||null}getElementsByName(e){return this.findAll((t=>t.name===e),!0)}findChildrenByName(e){return this.getElementsByName(e)}getElementsByType(e){return this.findAll((t=>t.type===e),!0)}getChildByName(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.find((t=>t.name===e),t)}getChildAt(e){let t=this._firstChild;if(!t)return null;for(let n=0;n<e;n++){if(!t._next)return null;t=t._next}return t}at(e){return this.getChildAt(e)}containNode(e){if(!this._idMap)return!1;if(this._idMap.has(e._uid))return!0;let t=this._firstChild;for(;t;){if(t.containNode(e))return!0;t=t._next}return!1}getRootNode(){let e=this.parent;for(;e?.parent;)e=e.parent;return e||this}hasChildNodes(){return this._firstChild!==null}addChild(e){return this.appendChild(e)}add(e){return this.appendChild(e)}getChildren(){let e=[],t=this._firstChild;for(;t;)e.push(t),t=t._next;return e}isChildOf(e){return!!this.parent&&this.parent._uid===e._uid}isParentOf(e){return e.isChildOf(this)}isDescendantsOf(e){let t=this.parent;if(!t)return!1;do{if(t._uid===e._uid)return!0;t=t.parent}while(t!==null);return!1}isAncestorsOf(e){return e.isDescendantsOf(this)}getAncestor(e){throw Error(\`暂不支持\`)}setAllDescendantsProps(e,t){let n=this._firstChild;for(;n;)n[e]=t,n.setAllDescendantsProps(e,t),n=n._next}setCount(e){this._count+=e;let t=this.parent;if(t)do t._count+=e,t=t.parent;while(t!==null)}clone(){throw Error(\`暂不支持\`)}cloneTo(e){throw Error(\`暂不支持\`)}getParent(){return this.parent}del(e){return this.removeChild(e)}addEventListener(e,t,n){let r=u(n,!0)&&n||m(n)&&n.capture,i=m(n)&&n.once,a=d(t)?void 0:t;return e=r?\`\${e}capture\`:e,t=d(t)?t:t.handleEvent,i?super.once(e,t,a):super.on(e,t,a),this}on(e,t,n){return this.addEventListener(e,t,n)}removeEventListener(e,t,n){let r=u(n,!0)&&n||m(n)&&n.capture,i=d(t)?void 0:t;e=r?\`\${e}capture\`:e,t=d(t)?t:t.handleEvent;let a=m(n)&&n.once;return super.off(e,t,i,a),this}off(e,t,n){return this.removeEventListener(e,t,n)}once(e,t,n){return m(n)?(n.once=!0,this.addEventListener(e,t,n)):this.addEventListener(e,t,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(e){var t=[...arguments].slice(1);return super.emit(e.type,e,...t),!e.defaultPrevented}emit(e,t){return this.dispatchEvent(e,t)}release(){this.removeAllListeners()}}class to{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=to.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(e){if(e&&e.graphic){let t=this.pickParams.graphic;if(t.stage){let n=t.stage.eventSystem.manager.propagationPath(t);this.detailPath.push(n),this._composedDetailPath(e.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&d(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&d(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw Error(\`Method not implemented.\`)}}class no extends to{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(e){return\`getModifierState\`in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m){throw Error(\`Method not implemented.\`)}}class ro extends no{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type===\`pointermove\`||this.type===\`mousemove\`||this.type===\`touchmove\`?[this]:[]}getPredictedEvents(){throw Error(\`getPredictedEvents is not supported!\`)}clone(){var e,t,n;let r=new ro(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(e=this.manager)==null||e.copyPointerData(this,r),(t=this.manager)==null||t.copyMouseData(this,r),(n=this.manager)==null||n.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();let i=this.composedDetailPath();return r.detailPath=i&&i.slice(),r.type=this.type,r}}class io extends no{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var e,t,n;let r=new io(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(e=this.manager)==null||e.copyWheelData(this,r),(t=this.manager)==null||t.copyMouseData(this,r),(n=this.manager)==null||n.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();let i=this.composedDetailPath();return r.detailPath=i&&i.slice(),r.type=this.type,r}}io.DOM_DELTA_PIXEL=0,io.DOM_DELTA_LINE=1,io.DOM_DELTA_PAGE=2;class ao extends to{constructor(e,t){super(),this.type=e,this.detail=t}}let oo=typeof performance==\`object\`&&performance.now?performance:Date;function so(e){return e===\`mouse\`||e===\`pen\`}class co{constructor(e,t){this.dispatch=new c,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(e,t)=>{if(!(e instanceof ro))return void xe.getInstance().warn(\`EventManager cannot map a non-pointer event as a pointer event\`);let n=this.createPointerEvent(e,e.type,t);if(this.dispatchEvent(n,\`pointerdown\`),n.pointerType===\`touch\`)this.dispatchEvent(n,\`touchstart\`);else if(so(n.pointerType)){let e=n.button===2;this.dispatchEvent(n,e?\`rightdown\`:\`mousedown\`)}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=n.composedPath(),this.freeEvent(n)},this.onPointerMove=(e,t)=>{if(!(e instanceof ro))return void xe.getInstance().warn(\`EventManager cannot map a non-pointer event as a pointer event\`);let n=this.createPointerEvent(e,e.type,t),r=so(n.pointerType),i=this.trackingData(e.pointerId),a=this.findMountedTarget(i.overTargets);if(i.overTargets&&a&&a!==this.rootTarget&&a!==n.target){let t=e.type===\`mousemove\`?\`mouseout\`:\`pointerout\`,i=this.createPointerEvent(e,t,a||void 0);if(this.dispatchEvent(i,\`pointerout\`),r&&this.dispatchEvent(i,\`mouseout\`),!n.composedPath().includes(a)){let t=this.createPointerEvent(e,\`pointerleave\`,a||void 0);for(t.eventPhase=t.AT_TARGET;t.target&&!n.composedPath().includes(t.target);)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,\`mouseleave\`),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(i)}if(a!==n.target){let t=e.type===\`mousemove\`?\`mouseover\`:\`pointerover\`,i=this.clonePointerEvent(n,t);this.dispatchEvent(i,\`pointerover\`),r&&this.dispatchEvent(i,\`mouseover\`);let o=a?.parent;for(;o&&o!==this.rootTarget.parent&&o!==n.target;)o=o.parent;if(!o||o===this.rootTarget.parent){let e=this.clonePointerEvent(n,\`pointerenter\`);e.eventPhase=e.AT_TARGET;let t=e.target,i=new Set,o=a;for(;o&&o!==this.rootTarget;)i.add(o),o=o.parent;for(;t&&t!==a&&t!==this.rootTarget.parent;)i.has(t)||(e.currentTarget=t,this.notifyTarget(e),r&&this.notifyTarget(e,\`mouseenter\`)),t=t.parent;this.freeEvent(e)}this.freeEvent(i)}this.dispatchEvent(n,\`pointermove\`),n.pointerType===\`touch\`&&this.dispatchEvent(n,\`touchmove\`),r&&(this.dispatchEvent(n,\`mousemove\`),this.cursorTarget=n.target,this.cursor=n.target?.attribute?.cursor||this.rootTarget.getCursor()),i.overTargets=n.composedPath(),this.freeEvent(n)},this.onPointerOver=(e,t)=>{if(!(e instanceof ro))return void xe.getInstance().warn(\`EventManager cannot map a non-pointer event as a pointer event\`);let n=this.trackingData(e.pointerId),r=this.createPointerEvent(e,e.type,t),i=so(r.pointerType);this.dispatchEvent(r,\`pointerover\`),i&&this.dispatchEvent(r,\`mouseover\`),r.pointerType===\`mouse\`&&(this.cursorTarget=r.target,this.cursor=r.target?.attribute?.cursor||this.rootTarget.getCursor());let a=this.clonePointerEvent(r,\`pointerenter\`);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,\`mouseenter\`),a.target=a.target.parent;n.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(a)},this.onPointerOut=(e,t)=>{if(!(e instanceof ro))return void xe.getInstance().warn(\`EventManager cannot map a non-pointer event as a pointer event\`);let n=this.trackingData(e.pointerId);if(n.overTargets){let t=so(e.pointerType),r=this.findMountedTarget(n.overTargets),i=this.createPointerEvent(e,\`pointerout\`,r||void 0);this.dispatchEvent(i),t&&this.dispatchEvent(i,\`mouseout\`);let a=this.createPointerEvent(e,\`pointerleave\`,r||void 0);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),t&&this.notifyTarget(a,\`mouseleave\`),a.target=a.target.parent;n.overTargets=[],this.freeEvent(i),this.freeEvent(a)}this.cursorTarget=null,this.cursor=\`\`},this.onPointerUp=(e,t)=>{if(!(e instanceof ro))return void xe.getInstance().warn(\`EventManager cannot map a non-pointer event as a pointer event\`);let n=oo.now(),r=this.createPointerEvent(e,e.type,t);if(this.dispatchEvent(r,\`pointerup\`),r.pointerType===\`touch\`)this.dispatchEvent(r,\`touchend\`);else if(so(r.pointerType)){let e=r.button===2;this.dispatchEvent(r,e?\`rightup\`:\`mouseup\`)}let i=this.trackingData(e.pointerId),a=this.findMountedTarget(i.pressTargetsByButton[e.button]),o=a;if(a&&!r.composedPath().includes(a)){let t=a;for(;t&&!r.composedPath().includes(t);){if(r.currentTarget=t,this.notifyTarget(r,\`pointerupoutside\`),r.pointerType===\`touch\`)this.notifyTarget(r,\`touchendoutside\`);else if(so(r.pointerType)){let e=r.button===2;this.notifyTarget(r,e?\`rightupoutside\`:\`mouseupoutside\`)}t=t.parent}delete i.pressTargetsByButton[e.button],o=t}if(o){let t=this.clonePointerEvent(r,\`click\`);t.target=o,t.path=[],t.detailPath=[],i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:t.target,timeStamp:n});let a=i.clicksByButton[e.button];a.target===t.target&&n-a.timeStamp<(this._config.clickInterval??200)?++a.clickCount:a.clickCount=1,a.target=t.target,a.timeStamp=n,t.detail=a.clickCount,so(t.pointerType)?(this.dispatchEvent(t,\`click\`),a.clickCount===2&&this.dispatchEvent(t,\`dblclick\`)):t.pointerType===\`touch\`&&this._config.supportsTouchEvents&&(this.dispatchEvent(t,\`tap\`),a.clickCount===2&&this.dispatchEvent(t,\`dbltap\`)),this.dispatchEvent(t,\`pointertap\`),this.freeEvent(t)}this.freeEvent(r)},this.onPointerUpOutside=(e,t)=>{if(!(e instanceof ro))return void xe.getInstance().warn(\`EventManager cannot map a non-pointer event as a pointer event\`);let n=this.trackingData(e.pointerId),r=this.findMountedTarget(n.pressTargetsByButton[e.button]),i=this.createPointerEvent(e,e.type,t);if(r){let t=r;for(;t;)i.currentTarget=t,this.notifyTarget(i,\`pointerupoutside\`),i.pointerType===\`touch\`?this.notifyTarget(i,\`touchendoutside\`):so(i.pointerType)&&this.notifyTarget(i,i.button===2?\`rightupoutside\`:\`mouseupoutside\`),t=t.parent;delete n.pressTargetsByButton[e.button]}this.freeEvent(i)},this.onWheel=(e,t)=>{if(!(e instanceof io))return void xe.getInstance().warn(\`EventManager cannot map a non-wheel event as a wheel event\`);let n=this.createWheelEvent(e,t);this.dispatchEvent(n),this.freeEvent(n)},this.rootTarget=e,this.mappingTable={},this._config=Object.assign({clickInterval:200},t),this.addEventMapping(\`pointerdown\`,this.onPointerDown),this.addEventMapping(\`pointermove\`,this.onPointerMove),this.addEventMapping(\`pointerout\`,this.onPointerOut),this.addEventMapping(\`pointerleave\`,this.onPointerOut),this.addEventMapping(\`pointerover\`,this.onPointerOver),this.addEventMapping(\`pointerup\`,this.onPointerUp),this.addEventMapping(\`pointerupoutside\`,this.onPointerUpOutside),this.addEventMapping(\`wheel\`,this.onWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort(((e,t)=>e.priority-t.priority))}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;let t=this.mappingTable[e.type],n,r=\`\${e.canvasX}-\${e.canvasY}\`;if(this._prePointTargetCache?.[r]&&this._prePointTargetCache?.[r]?.stage&&(this._prePointTargetCache?.[r])?.stage.renderCount===this._prePointTargetCache?.stageRenderCount?n=this._prePointTargetCache[r]:(n=this.pickTarget(e.viewX,e.viewY,e),e.pickParams||(this._prePointTargetCache={[r]:n,stageRenderCount:n?.stage.renderCount??-1})),t)for(let r=0,i=t.length;r<i;r++)t[r].fn(e,n);else xe.getInstance().warn(\`[EventManager]: Event mapping not defined for \${e.type}\`)}propagate(e,t){if(!e.target)return;let n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let r=0,i=n.length-1;r<i;r++)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let r=n.length-2;r>=0;r--)if(e.currentTarget=n[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}propagationPath(e){let t=[e];for(let n=0;n<2048&&e!==this.rootTarget&&e.parent;n++){if(!e.parent)throw Error(\`Cannot find propagation path to disconnected target\`);t.push(e.parent),e=e.parent}return t.reverse(),t}notifyTarget(e,t){if(this.pauseNotify)return;t??=e.type;let n=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?\`\${t}capture\`:t;this.notifyListeners(e,n),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let n=1;n<e.length&&e[n].parent===t;n++)t=e[n];return t}createPointerEvent(e,t,n){let r=this.allocateEvent(ro);return this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.nativeEvent=e.nativeEvent,r.originalEvent=e,r.target=n||this.pickTarget(r.viewX??r.global.x,r.viewY??r.global.y,r),typeof t==\`string\`&&(r.type=t),r}createWheelEvent(e,t){let n=this.allocateEvent(io);return this.copyWheelData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.nativeEvent=e.nativeEvent,n.originalEvent=e,n.target=t||this.pickTarget(n.viewX??n.global.x,n.viewY??n.global.y,n),n}clonePointerEvent(e,t){let n=this.allocateEvent(ro);n.nativeEvent=e.nativeEvent,n.originalEvent=e.originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice();let r=e.composedDetailPath();return n.detailPath=r&&r.slice(),n.type=t??n.type,n}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof ro&&t instanceof ro&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof no&&t instanceof no&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,[\`client\`,\`movement\`,\`canvas\`,\`screen\`,\`global\`,\`offset\`,\`viewport\`].forEach((n=>{t[n].x=e[n].x,t[n].y=e[n].y})))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=oo.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.x=e.layer.x,t.layer.y=e.layer.y,t.page.x=e.page.x,t.page.y=e.page.y,t.pickParams=e.pickParams}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);let t=this.eventPool.get(e)?.pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=[],t.detailPath=[],t.target=null,t}freeEvent(e){var t;if(e.manager!==this)throw Error(\`It is illegal to free an event not managed by this EventManager!\`);let n=e.constructor;this.eventPool.has(n)||this.eventPool.set(n,[]),(t=this.eventPool.get(n))==null||t.push(e)}notifyListeners(e,t){let n=e.currentTarget._events[t];if(n)if(\`fn\`in n)n.once&&e.currentTarget.removeEventListener(t,n.fn,{once:!0}),n.fn.call(n.context,e);else for(let r=0,i=n.length;r<i&&!e.propagationImmediatelyStopped;r++)n[r].once&&e.currentTarget.removeEventListener(t,n[r].fn,{once:!0}),n[r].fn.call(n[r].context,e);this.emitDelegation(e,t)}emitDelegation(e,t){let n=e.currentTarget._events[\`*\`];if(n)if(\`fn\`in n)n.fn.call(n.context,e,t);else for(let r=0,i=n.length;r<i&&!e.propagationImmediatelyStopped;r++)n[r].fn.call(n[r].context,e,t)}pickTarget(e,t,n){let r,i=this.rootTarget.pick(e,t);return r=i&&i.graphic?i.graphic:i&&i.group?i.group:this.rootTarget.AABBBounds.contains(e,t)?this.rootTarget:null,n&&(n.pickParams=i.params),r}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}let lo={dispatchEvent(e){var t;if(!(e instanceof to))throw Error(\`DisplayObject cannot propagate events outside of the Federated Events API\`);return e.defaultPrevented=!1,e.path=[],e.detailPath&&=[],e.target=this,(t=e?.manager)==null||t.dispatchEvent(e),!e.defaultPrevented},emit(e,t){return this.dispatchEvent(new ao(e,t))}},uo={touchstart:\`pointerdown\`,touchend:\`pointerup\`,touchendoutside:\`pointerupoutside\`,touchmove:\`pointermove\`,touchcancel:\`pointercancel\`};class fo{constructor(e){this.resolution=1,this.onPointerDown=e=>{if(this.supportsTouchEvents&&e.pointerType===\`touch\`)return;let t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!(\`cancelable\`in e))&&e.preventDefault();for(let e=0,n=t.length;e<n;e++){let n=t[e],r=this.bootstrapEvent(this.rootPointerEvent,n);this.manager.mapEvent(r)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=e=>{if(this.supportsTouchEvents&&e.pointerType===\`touch\`||this.isEventOutsideOfTargetElement(e))return;let t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){let n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.manager.mapEvent(n)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=e=>{if(this.supportsTouchEvents&&e.pointerType===\`touch\`)return;let t=this.isEventOutsideOfTargetViewPort(e)?\`outside\`:\`\`,n=this.normalizeToPointerData(e);for(let e=0,r=n.length;e<r;e++){let r=this.bootstrapEvent(this.rootPointerEvent,n[e]);r.type+=t,this.manager.mapEvent(r)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=e=>{if(this.supportsTouchEvents&&e.pointerType===\`touch\`)return;let t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){let n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.manager.mapEvent(n)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=e=>{let t=this.normalizeWheelEvent(e);this.manager.mapEvent(t)};let{targetElement:t,resolution:n,rootNode:r,global:i,autoPreventDefault:a=!1,clickInterval:o,supportsTouchEvents:s=i.supportsTouchEvents,supportsPointerEvents:c=i.supportsPointerEvents}=e;this.manager=new co(r,{clickInterval:o,supportsTouchEvents:s}),this.globalObj=i,this.supportsPointerEvents=c,this.supportsTouchEvents=s,this.supportsMouseEvents=i.supportsMouseEvents,this.applyStyles=i.applyStyles,this.autoPreventDefault=a,this.eventsAdded=!1,this.rootPointerEvent=new ro,this.rootWheelEvent=new io,this.cursorStyles={default:\`inherit\`,pointer:\`pointer\`},this.resolution=n,this.setTargetElement(t)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(e,t){if(!t&&!this.manager.rootTarget.window._handler.canvas.controled)return;e||=\`default\`;let{applyStyles:n,domElement:r}=this;if(this.currentCursor===e)return;this.currentCursor=e;let i=this.cursorStyles[e];i?typeof i==\`string\`&&n?r.style.cursor=i:typeof i==\`function\`?i(e):typeof i==\`object\`&&n&&Object.assign(r.style,i):n&&v(e)&&!te(this.cursorStyles,e)&&(r.style.cursor=e)}setTargetElement(e){this.removeEvents(),this.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;let{globalObj:e,domElement:t}=this;this.supportsPointerEvents?(e.getDocument()?(e.getDocument().addEventListener(\`pointermove\`,this.onPointerMove,!0),e.getDocument().addEventListener(\`pointerup\`,this.onPointerUp,!0)):(t.addEventListener(\`pointermove\`,this.onPointerMove,!0),t.addEventListener(\`pointerup\`,this.onPointerUp,!0)),t.addEventListener(\`pointerdown\`,this.onPointerDown,!0),t.addEventListener(\`pointerleave\`,this.onPointerOverOut,!0),t.addEventListener(\`pointerover\`,this.onPointerOverOut,!0)):(e.getDocument()?(e.getDocument().addEventListener(\`mousemove\`,this.onPointerMove,!0),e.getDocument().addEventListener(\`mouseup\`,this.onPointerUp,!0)):(t.addEventListener(\`mousemove\`,this.onPointerMove,!0),t.addEventListener(\`mouseup\`,this.onPointerUp,!0)),t.addEventListener(\`mousedown\`,this.onPointerDown,!0),t.addEventListener(\`mouseout\`,this.onPointerOverOut,!0),t.addEventListener(\`mouseover\`,this.onPointerOverOut,!0)),this.supportsTouchEvents&&(t.addEventListener(\`touchstart\`,this.onPointerDown,!0),t.addEventListener(\`touchend\`,this.onPointerUp,!0),t.addEventListener(\`touchmove\`,this.onPointerMove,!0)),t.addEventListener(\`wheel\`,this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;let{globalObj:e,domElement:t}=this,n=e.getDocument()??t;this.supportsPointerEvents?(n.removeEventListener(\`pointermove\`,this.onPointerMove,!0),n.removeEventListener(\`pointerup\`,this.onPointerUp,!0),t.removeEventListener(\`pointerdown\`,this.onPointerDown,!0),t.removeEventListener(\`pointerleave\`,this.onPointerOverOut,!0),t.removeEventListener(\`pointerover\`,this.onPointerOverOut,!0)):(n.removeEventListener(\`mousemove\`,this.onPointerMove,!0),n.removeEventListener(\`mouseup\`,this.onPointerUp,!0),t.removeEventListener(\`mousedown\`,this.onPointerDown,!0),t.removeEventListener(\`mouseout\`,this.onPointerOverOut,!0),t.removeEventListener(\`mouseover\`,this.onPointerOverOut,!0)),this.supportsTouchEvents&&(t.removeEventListener(\`touchstart\`,this.onPointerDown,!0),t.removeEventListener(\`touchend\`,this.onPointerUp,!0),t.removeEventListener(\`touchmove\`,this.onPointerMove,!0)),t.removeEventListener(\`wheel\`,this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(e){return this.domElement.pointTransform?this.domElement.pointTransform(e.x,e.y):e}mapToCanvasPoint(e){let t=this.globalObj?.mapToCanvasPoint(e,this.domElement);if(t)return t;let n=0,r=0;if(e.changedTouches){let t=e.changedTouches[0]??{};n=t.clientX||0,r=t.clientY||0}else n=e.clientX||0,r=e.clientY||0;let i=this.domElement.getBoundingClientRect();return{x:n-i.left,y:r-i.top}}normalizeToPointerData(e){let t=[];if(this.supportsTouchEvents&&e.changedTouches&&e.changedTouches.length)for(let n=0,r=e.changedTouches.length;n<r;n++){let r=e.changedTouches[n];_(r.button)&&(r.button=0),_(r.buttons)&&(r.buttons=1),_(r.isPrimary)&&(r.isPrimary=e.touches.length===1&&e.type===\`touchstart\`),_(r.width)&&(r.width=r.radiusX||1),_(r.height)&&(r.height=r.radiusY||1),_(r.tiltX)&&(r.tiltX=0),_(r.tiltY)&&(r.tiltY=0),_(r.pointerType)&&(r.pointerType=\`touch\`),_(r.pointerId)&&(r.pointerId=r.identifier||0),_(r.pressure)&&(r.pressure=r.force||.5),_(r.twist)&&(r.twist=0),_(r.tangentialPressure)&&(r.tangentialPressure=0),_(r.layerX)&&(r.layerX=r.offsetX=r.clientX),_(r.layerY)&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(!this.globalObj.supportsMouseEvents||e instanceof MouseEvent&&!(this.supportsPointerEvents&&e instanceof PointerEvent)){let n=e;_(n.isPrimary)&&(n.isPrimary=!0),_(n.width)&&(n.width=1),_(n.height)&&(n.height=1),_(n.tiltX)&&(n.tiltX=0),_(n.tiltY)&&(n.tiltY=0),_(n.pointerType)&&(n.pointerType=\`mouse\`),_(n.pointerId)&&(n.pointerId=1),_(n.pressure)&&(n.pressure=.5),_(n.twist)&&(n.twist=0),_(n.tangentialPressure)&&(n.tangentialPressure=0),n.isNormalized=!0,t.push(n)}else t.push(e);return t}normalizeWheelEvent(e){let t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;let{x:n,y:r}=this.mapToCanvasPoint(e);t.canvas.x=n,t.canvas.y=r,t.global.x=n,t.global.y=r,t.offset.x=n,t.offset.y=r;let{x:i,y:a}=this.mapToViewportPoint(t);return t.viewport.x=i,t.viewport.y=a,t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);let{x:n,y:r}=this.mapToCanvasPoint(t);e.canvas.x=n,e.canvas.y=r,e.global.x=n,e.global.y=r,e.offset.x=n,e.offset.y=r;let{x:i,y:a}=this.mapToViewportPoint(e);return e.viewport.x=i,e.viewport.y=a,e.isTrusted=t.isTrusted,e.type===\`pointerleave\`&&(e.type=\`pointerout\`),e.type.startsWith(\`mouse\`)&&(e.type=e.type.replace(\`mouse\`,\`pointer\`)),e.type.startsWith(\`touch\`)&&(e.type=uo[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=oo.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null}isEventOutsideOfTargetViewPort(e){if(this.isEventOutsideOfTargetElement(e))return!0;if(this.domElement.getViewBox){let t=this.mapToViewportPoint(this.mapToCanvasPoint(e)),n=this.domElement.getViewBox(),r=n.width(),i=n.height();return!(t.x<r&&t.y<i&&t.x>0&&t.y>0)}return!1}isEventOutsideOfTargetElement(e){let t=e.target;return e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]),t!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}var po;(function(e){e[e.INITIAL=0]=\`INITIAL\`,e[e.RUNNING=1]=\`RUNNING\`,e[e.PAUSE=2]=\`PAUSE\`})(po||={});class mo{static Avaliable(){return!!B.global.getRequestAnimationFrame()}avaliable(){return mo.Avaliable()}tick(e,t){B.global.getRequestAnimationFrame()((()=>{this.released||t(this)}))}release(){this.released=!0}getTime(){return Date.now()}}class ho{static Avaliable(){return!0}avaliable(){return ho.Avaliable()}tick(e,t){this.timerId=setTimeout((()=>{t(this)}),e)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class H{constructor(){}static linear(e){return e}static none(){return this.linear}static get(e){return e<-1?e=-1:e>1&&(e=1),function(t){return e===0?t:e<0?t*(t*-e+1+e):t*((2-t)*e+(1-e))}}static getPowIn(e){return function(t){return t**+e}}static getPowOut(e){return function(t){return 1-(1-t)**e}}static getPowInOut(e){return function(t){return(t*=2)<1?.5*t**+e:1-.5*Math.abs((2-t)**e)}}static getBackIn(e){return function(t){return t*t*((e+1)*t-e)}}static getBackOut(e){return function(t){return--t*t*((e+1)*t+e)+1}}static getBackInOut(e){return e*=1.525,function(t){return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}}static sineIn(e){return 1-Math.cos(e*Math.PI/2)}static sineOut(e){return Math.sin(e*Math.PI/2)}static sineInOut(e){return-(Math.cos(Math.PI*e)-1)/2}static expoIn(e){return e===0?0:2**(10*e-10)}static expoOut(e){return e===1?1:1-2**(-10*e)}static expoInOut(e){return e===0?0:e===1?1:e<.5?2**(20*e-10)/2:(2-2**(-20*e+10))/2}static circIn(e){return-(Math.sqrt(1-e*e)-1)}static circOut(e){return Math.sqrt(1- --e*e)}static circInOut(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}static bounceOut(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}static bounceIn(e){return 1-H.bounceOut(1-e)}static bounceInOut(e){return e<.5?.5*H.bounceIn(2*e):.5*H.bounceOut(2*e-1)+.5}static getElasticIn(e,t){return function(n){if(n===0||n===1)return n;let r=t/F*Math.asin(1/e);return-e*2**(10*--n)*Math.sin((n-r)*F/t)}}static getElasticOut(e,t){return function(n){if(n===0||n===1)return n;let r=t/F*Math.asin(1/e);return e*2**(-10*n)*Math.sin((n-r)*F/t)+1}}static getElasticInOut(e,t){return function(n){let r=t/F*Math.asin(1/e);return(n*=2)<1?e*2**(10*--n)*Math.sin((n-r)*F/t)*-.5:e*2**(-10*--n)*Math.sin((n-r)*F/t)*.5+1}}static registerFunc(e,t){H[e]=t}}function go(e,t){let n=1/t,r=1;for(;e>n;)e-=n,r*=-1;let i=r*e/n;return i>0?i:1+i}H.quadIn=H.getPowIn(2),H.quadOut=H.getPowOut(2),H.quadInOut=H.getPowInOut(2),H.cubicIn=H.getPowIn(3),H.cubicOut=H.getPowOut(3),H.cubicInOut=H.getPowInOut(3),H.quartIn=H.getPowIn(4),H.quartOut=H.getPowOut(4),H.quartInOut=H.getPowInOut(4),H.quintIn=H.getPowIn(5),H.quintOut=H.getPowOut(5),H.quintInOut=H.getPowInOut(5),H.backIn=H.getBackIn(1.7),H.backOut=H.getBackOut(1.7),H.backInOut=H.getBackInOut(1.7),H.elasticIn=H.getElasticIn(1,.3),H.elasticOut=H.getElasticOut(1,.3),H.elasticInOut=H.getElasticInOut(1,.3*1.5),H.easeInOutQuad=e=>(e/=.5)<1?.5*e**2:-.5*((e-=2)*e-2),H.easeOutElastic=e=>{let t=2*Math.PI/3;return e===0?0:e===1?1:2**(-10*e)*Math.sin((10*e-.75)*t)+1},H.easeInOutElastic=e=>{let t=2*Math.PI/4.5;return e===0?0:e===1?1:e<.5?-(2**(20*e-10))*Math.sin((20*e-11.125)*t)/2:2**(-20*e+10)*Math.sin((20*e-11.125)*t)/2+1};for(let e=0;e<10;e++)H[\`flicker\${e}\`]=t=>go(t,e);for(let e=2;e<10;e++)H[\`aIn\${e}\`]=t=>e*t*t+(1-e)*t;class _o{constructor(){this.id=Cn.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(e){this.animateTail?(this.animateTail.nextAnimate=e,e.prevAnimate=this.animateTail,this.animateTail=e,e.nextAnimate=null):(this.animateHead=e,this.animateTail=e),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(e){if(this.paused)return;let t=this.animateHead;for(this.animateCount=0;t;)t.status===yr.END?this.removeAnimate(t):t.status===yr.RUNNING||t.status===yr.INITIAL?(this.animateCount++,t.advance(e)):t.status===yr.PAUSED&&this.animateCount++,t=t.nextAnimate}clear(){let e=this.animateHead;for(;e;)e.release(),e=e.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];e._onRemove&&e._onRemove.forEach((e=>e())),e===this.animateHead?(this.animateHead=e.nextAnimate,e===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):e===this.animateTail?(this.animateTail=e.prevAnimate,this.animateTail.nextAnimate=null):(e.prevAnimate.nextAnimate=e.nextAnimate,e.nextAnimate.prevAnimate=e.prevAnimate),t&&e.release()}}let vo=new _o;class yo{constructor(e,t,n,r,i){this.from=e,this.to=t,this.duration=n,this.easing=r,this.params=i,this.updateCount=0}bind(e,t){this.target=e,this.subAnimate=t,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){let e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},this.step.prev.getLastProps()??{},e))):this.step.prev?this.step.prev.getLastProps():e}update(e,t,n){if(this.updateCount===0){this.onFirstRun();let e=this.step.getLastProps();Object.keys(e).forEach((t=>{this.subAnimate.animate.validAttr(t)&&(n[t]=e[t])}))}this.updateCount+=1,this.onUpdate(e,t,n),e&&this.onEnd()}}class bo extends yo{constructor(e){super(null,null,0,\`linear\`),this.cb=e}onUpdate(e,t,n){}onStart(){this.cb()}}class xo{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cn.GenAutoIncrementId(),t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vo,n=arguments.length>2?arguments[2]:void 0;this.id=e,this.timeline=t||vo,this.status=yr.INITIAL,this.tailAnimate=new So(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=n}setTimeline(e){e!==this.timeline&&(this.timeline.removeAnimate(this,!1),e.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce(((e,t)=>e+t.totalDuration),0)}after(e){return this._startTime=e.getDuration(),this}afterAll(e){let t=-1/0;return e.forEach((e=>{t=We(e.getDuration(),t)})),this._startTime=t,this}parallel(e){return this._startTime=e.getStartTime(),this}static AddInterpolate(e,t){xo.interpolateMap.set(e,t)}play(e){if(this.tailAnimate.play(e),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.totalDuration===e.duration&&this.trySetAttribute(e.getFromProps(),e.mode),this}trySetAttribute(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xo.mode;e&&t&br.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(e,!1,{type:vr.ANIMATE_PLAY})}runCb(e){let t=new bo((()=>{e(this,t.step.prev)}));return this.tailAnimate.play(t),this}customInterpolate(e,t,n,r,i,a){let o=xo.interpolateMap.get(e)||xo.interpolateMap.get(\`\`);return!!o&&o(e,t,n,r,i,a)}pause(){this.status===yr.RUNNING&&(this.status=yr.PAUSED)}resume(){this.status===yr.PAUSED&&(this.status=yr.RUNNING)}to(e,t,n,r){if(this.tailAnimate.to(e,t,n,r),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}from(e,t,n,r){if(this.tailAnimate.from(e,t,n,r),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}wait(e){if(this.tailAnimate.wait(e),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}startAt(e){if(this.tailAnimate.startAt(e),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}loop(e){if(this.tailAnimate.loop=e,this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}reversed(e){if(this.tailAnimate.reversed=e,this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}bounce(e){if(this.tailAnimate.bounce=e,this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}subAnimate(){let e=new So(this,this.tailAnimate);return this.tailAnimate=e,this.subAnimates.push(e),e.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(e){this._preventAttrs&&this._preventAttrs.delete(e)}preventAttr(e){this._preventAttrs||=new Set,this._preventAttrs.add(e)}preventAttrs(e){e.forEach((e=>this.preventAttr(e)))}validAttr(e){return!this._preventAttrs||!this._preventAttrs.has(e)}bind(e){return this.target=e,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach((t=>{t.bind(e)})),this}advance(e){if(this._duringTime<this._startTime){if(this._duringTime+e*this.timeScale<this._startTime)return void(this._duringTime+=e*this.timeScale);e=this._duringTime+e*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===yr.INITIAL&&(this.status=yr.RUNNING,this._onStart&&this._onStart.forEach((e=>e()))),this.setPosition(Math.max(this.rawPosition,0)+e*this.timeScale)&&this.status===yr.RUNNING&&(this.status=yr.END,this._onEnd&&this._onEnd.forEach((e=>e())))}setPosition(e){let t,n=0,r=this.rawPosition,i=this.subAnimates.reduce(((e,t)=>e+t.totalDuration),0);e<0&&(e=0);let a=e>=i;if(a&&(e=i),e===r)return a;for(let r=0;r<this.subAnimates.length&&(t=this.subAnimates[r],!(n+t.totalDuration>=e));r++)n+=t.totalDuration,t=void 0;return this.rawPosition=e,t.setPosition(e-n),a}onStart(e){this._onStart||=[],this._onStart.push(e)}onEnd(e){this._onEnd||=[],this._onEnd.push(e)}onRemove(e){this._onRemove||=[],this._onRemove.push(e)}onFrame(e){this._onFrame||=[],this._onFrame.push(e)}release(){this.status=yr.END}stop(e){e||this.target.onStop(),e===\`start\`?this.target.onStop(this.getStartProps()):e===\`end\`?this.target.onStop(this.getEndProps()):this.target.onStop(e),this.release()}}xo.mode=br.NORMAL,xo.interpolateMap=new Map;class So{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(e,t){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=e,this.stepHead=new Co(0,0,t?Object.assign({},t.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(e){return this.target=e,this}play(e){let t=e.duration;(t==null||t<0)&&(t=0);let n=e.easing,r=typeof n==\`string\`?H[n]:n,i=this._addStep(t,null,r);return i.type=xr.customAnimate,this._appendProps(e.getEndProps(),i,!1),this._appendCustomAnimate(e,i),this}to(e,t,n,r){(t==null||t<0)&&(t=0);let i=typeof n==\`string\`?H[n]:n,a=this._addStep(t,null,i);return a.type=xr.to,this._appendProps(e,a,!!r&&r.tempProps),a.propKeys||=Object.keys(a.props),r&&r.noPreventAttrs||this.target.animates&&this.target.animates.forEach((e=>{e.id!==this.animate.id&&e.preventAttrs(a.propKeys)})),this}from(e,t,n,r){this.to(e,0,n,r);let i={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach((e=>{i[e]=this.getLastPropByName(e,this.stepTail)})),this.to(i,t,n,r),this.stepTail.type=xr.from}startAt(e){return e<0&&(e=0),this._startAt=e,this}getStartProps(){return this.stepHead?.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(e){if(e>0){let t=this._addStep(+e,null);t.type=xr.wait,t.prev.customAnimate?t.props=t.prev.customAnimate.getEndProps():t.props=t.prev.props,this.target.onAddStep&&this.target.onAddStep(t)}return this}_addStep(e,t,n){let r=new Co(this.duration,e,t,n);return this.duration+=e,this.stepTail.append(r),this.stepTail=r,r}_appendProps(e,t,n){t.props=n?e:Object.assign({},e);let r=t.prev,i=t.props;for(t.propKeys||=Object.keys(t.props),t.propKeys.forEach((e=>{t.props[e]===void 0&&(t.props[e]=this.target.getDefaultAttribute(e))}));r.prev;)r.props&&(r.propKeys||=Object.keys(r.props),r.propKeys.forEach((e=>{i[e]===void 0&&(i[e]=r.props[e])}))),t.propKeys=Object.keys(t.props),r=r.prev;let a=this.stepHead.props;t.propKeys||=Object.keys(i),t.propKeys.forEach((e=>{if(a[e]===void 0){let t=this.animate.getStartProps();a[e]=t[e]=this.target.getComputedAttribute(e)}})),this.target.onAddStep&&this.target.onAddStep(t)}_appendCustomAnimate(e,t){t.customAnimate=e,e.step=t,e.bind(this.target,this)}setPosition(e){let t=this.duration,n=this.loop,r=this.rawPosition,i,a,o=!1,s=this._startAt??0;if(e<0&&(e=0),e<s)return this.rawPosition=e,!1;if(e-=s,t<=0&&(o=!0,t<0)||(i=Math.floor(e/t),a=e-i*t,o=e>=n*t+t,o&&(a=t,i=n,e=a*i+t),e===r))return o;let c=!this.reversed!=!(this.bounce&&i%2);return c&&(a=t-a),this._deltaPosition=a-this.position,this.position=a,this.rawPosition=e+s,this.updatePosition(o,c),o}updatePosition(e,t){if(!this.stepHead)return;let n=this.stepHead.next,r=this.position,i=this.duration;if(this.target&&n){let a=n.next;for(;a&&a.position<=r;)n=a,a=n.next;let o=e?i===0?1:r/i:(r-n.position)/n.duration;n.easing&&(o=n.easing(o)),this.tryCallCustomAnimateLifeCycle(n,this._lastStep||(t?this.stepTail:this.stepHead),t),this.updateTarget(n,o,e),this._lastStep=n,this.animate._onFrame&&this.animate._onFrame.forEach((e=>e(n,o)))}}tryCallCustomAnimateLifeCycle(e,t,n){if(e!==t)if(n){let n=t.prev;for(;n&&n!==e;)n.customAnimate&&(n.customAnimate.onStart&&n.customAnimate.onStart(),n.customAnimate.onEnd&&n.customAnimate.onEnd()),n=e.prev;t&&t.customAnimate&&t.customAnimate.onEnd&&t.customAnimate.onEnd(),e&&e.customAnimate&&e.customAnimate.onStart&&e.customAnimate.onStart()}else{let n=t.next;for(;n&&n!==e;)n.customAnimate&&(n.customAnimate.onStart&&n.customAnimate.onStart(),n.customAnimate.onEnd&&n.customAnimate.onEnd()),n=n.next;t&&t.customAnimate&&t.customAnimate.onEnd&&t.customAnimate.onEnd(),e&&e.customAnimate&&e.customAnimate.onStart&&e.customAnimate.onStart()}}getLastPropByName(e,t){let n=t.prev;for(;n;){if(n.props&&n.props[e]!==void 0)return n.props[e];if(n.customAnimate){let t=n.customAnimate.getEndProps()[e];if(t!==void 0)return t}n=n.prev}return xe.getInstance().warn(\`未知错误，step中找不到属性\`),t.props[e]}updateTarget(e,t,n){e.props==null&&e.customAnimate==null||this.target.onStep(this,this.animate,e,t,n)}}class Co{constructor(e,t,n,r){this.duration=t,this.position=e,this.props=n,this.easing=r}append(e){e.prev=this,e.next=this.next,this.next=e}getLastProps(){let e=this.prev;for(;e;){if(e.props)return e.props;if(e.customAnimate)return e.customAnimate.getMergedEndProps();e=e.prev}return null}}var wo;(function(e){e[e.Top=1]=\`Top\`,e[e.Right=2]=\`Right\`,e[e.Bottom=4]=\`Bottom\`,e[e.Left=8]=\`Left\`,e[e.ALL=15]=\`ALL\`})(wo||={});let To=[!1,!1,!1,!1],Eo=[0,0,0,0],Do=e=>e?y(e)?e.length===0?0:e.length===1?e[0]:e.length===2?(Eo[0]=e[0],Eo[2]=e[0],Eo[1]=e[1],Eo[3]=e[1],Eo):e:e:0,Oo=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],ko=[1,2,3,0,1,2,3,0];function Ao(e,t,n,r){for(;e>=F;)e-=F;for(;e<0;)e+=F;for(;e>t;)t+=F;Oo[0].x=n,Oo[1].y=n,Oo[2].x=-n,Oo[3].y=-n;let i=Math.ceil(e/ze)%4,a=Math.ceil(t/ze)%4;if(r.add(Ue(e)*n,Ke(e)*n),r.add(Ue(t)*n,Ke(t)*n),i!==a||t-e>Re){let e=!1;for(let t=0;t<ko.length;t++)if(e||i!==ko[t]){if(e&&a===ko[t])break;if(e){let e=Oo[ko[t]];r.add(e.x,e.y)}}else{e=!0;let t=Oo[i];r.add(t.x,t.y)}}}function jo(e,t,n){let{x:r,y:i}=Xe(e.x,e.y,t.x,t.y,n),{x:a,y:o}=Xe(e.x1,e.y1,t.x1,t.y1,n),s=new $e(r,i,a,o);return s.defined=t.defined,s}function Mo(e,t,n){if(!e||!t)return[];Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);let r=[];if(e.length>t.length){r=t.map((e=>{let t=new $e(e.x,e.y,e.x1,e.y1);return t.defined=e.defined,t}));for(let i=0;i<t.length;i++)r[i]=jo(e[i],t[i],n)}else{r=t.map((e=>{let t=new $e(e.x,e.y,e.x1,e.y1);return t.defined=e.defined,t}));for(let i=0;i<e.length;i++)r[i]=jo(e[i],t[i],n)}return r}function No(e,t){if(y(e)){let n;for(let r=0;r<e.length&&n===void 0;r++)n=e[r][t];return n}return e[t]}class Po{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Po.TimeOut;this.durations=[],this.timeout=e,this.lastDate=0,this.durationsListThreshold=30}call(e){return this.lastDate=Date.now(),setTimeout((()=>{this.appendDuration(Date.now()-this.lastDate),e(0)}),this.timeout,!0)}clear(e){clearTimeout(e)}appendDuration(e){this.durations.push(e),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce(((e,t)=>e+t),0)/this.durations.length,1e3/60),1e3/30)}}Po.TimeOut=1e3/60;let Fo=new Po,Io=(e,t)=>{let n=((e,t)=>v(e)&&e[e.length-1]===\`%\`?t*(Number.parseFloat(e.substring(0,e.length-1))/100):e)(e,t);return isNaN(n)?n:Math.max(t,n)};class Lo extends yo{constructor(e,t,n,r,i){super(e,t,n,r,i)}getEndProps(){return!1===this.valid?{}:{text:this.to}}onBind(){this.fromNumber=S(this.from?.text)?this.from?.text:Number.parseFloat(this.from?.text),this.toNumber=S(this.to?.text)?this.to?.text:Number.parseFloat(this.to?.text),Number.isFinite(this.toNumber)||(this.fromNumber=0),Number.isFinite(this.toNumber)||(this.valid=!1),!1!==this.valid&&(this.decimalLength=this.params?.fixed??Math.max(Ze(this.fromNumber),Ze(this.toNumber)))}onEnd(){}onUpdate(e,t,n){!1!==this.valid&&(n.text=e?this.to?.text:(this.fromNumber+(this.toNumber-this.fromNumber)*t).toFixed(this.decimalLength))}}var Ro;(function(e){e[e.LEFT_TO_RIGHT=0]=\`LEFT_TO_RIGHT\`,e[e.RIGHT_TO_LEFT=1]=\`RIGHT_TO_LEFT\`,e[e.TOP_TO_BOTTOM=2]=\`TOP_TO_BOTTOM\`,e[e.BOTTOM_TO_TOP=3]=\`BOTTOM_TO_TOP\`,e[e.STROKE=4]=\`STROKE\`})(Ro||={});class zo extends yo{constructor(e,t,n,r,i){super(e,t,n,r,i),this.newPointAnimateType=i?.newPointAnimateType??\`grow\`,this.clipRangeByDimension=i?.clipRangeByDimension??\`x\`}getPoints(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(e.points)return e.points;if(e.segments){let n=[];return this.segmentsCache||=[],e.segments.map((e=>{e.points&&n.push(...e.points),t&&this.segmentsCache.push(e.points?.length??0)})),n}return[]}onBind(){let e=this.getPoints(this.from),t=this.getPoints(this.to,!0);this.fromPoints=e?Array.isArray(e)?e:[e]:[],this.toPoints=t?Array.isArray(t)?t:[t]:[];let n=new Map;this.fromPoints.forEach((e=>{e.context&&n.set(e.context,e)}));let r,i,a=1/0,o=-1/0;for(let e=0;e<this.toPoints.length;e+=1)if(n.has(this.toPoints[e].context)){a=e,r=n.get(this.toPoints[e].context);break}for(let e=this.toPoints.length-1;e>=0;--e)if(n.has(this.toPoints[e].context)){o=e,i=n.get(this.toPoints[e].context);break}this.newPointAnimateType===\`clip\`&&this.toPoints.length!==0&&(Number.isFinite(o)?(this.clipRange=this.toPoints[o][this.clipRangeByDimension]/this.toPoints[this.toPoints.length-1][this.clipRangeByDimension],this.clipRange===1&&(this.shrinkClipRange=this.toPoints[o][this.clipRangeByDimension]/this.fromPoints[this.fromPoints.length-1][this.clipRangeByDimension]),C(this.clipRange)?this.clipRange=De(this.clipRange,0,1):this.clipRange=0):this.clipRange=0);let s=this.toPoints[0];this.interpolatePoints=this.toPoints.map(((e,t)=>{let c=n.get(e.context);return c?(s=c,[c,e]):this.newPointAnimateType===\`appear\`||this.newPointAnimateType===\`clip\`?[e,e]:t<a&&r?[r,e]:t>o&&i?[i,e]:[s,e]})),this.points=this.interpolatePoints.map((e=>{let t=e[0],n=e[1],r=new $e(t.x,t.y,t.x1,t.y1);return r.defined=n.defined,r.context=n.context,r}))}onFirstRun(){let e=this.target.attribute.clipRange;C(e*this.clipRange)&&(this.clipRange*=e)}onUpdate(e,t,n){if(this.points=this.points.map(((e,n)=>{let r=jo(this.interpolatePoints[n][0],this.interpolatePoints[n][1],t);return r.context=e.context,r})),this.clipRange){if(this.shrinkClipRange)return void(e?(n.points=this.toPoints,n.clipRange=1):(n.points=this.fromPoints,n.clipRange=this.clipRange-(this.clipRange-this.shrinkClipRange)*t));n.clipRange=this.clipRange+(1-this.clipRange)*t}if(this.segmentsCache&&this.to.segments){let e=0;n.segments=this.to.segments.map(((t,n)=>{let r=e+this.segmentsCache[n],i=this.points.slice(e,r);return e=r,Object.assign(Object.assign({},t),{points:i})}))}else n.points=this.points}}var Bo;(function(e){e[e.Color255=0]=\`Color255\`,e[e.Color1=1]=\`Color1\`})(Bo||={});class Vo{static Get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bo.Color1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0,1];if(t===Bo.Color1){let t=Vo.store1[e];if(t)return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n;let r=It.parseColorString(e);if(r){let t=[r.r/255,r.g/255,r.b/255,r.opacity];Vo.store1[e]=t,Vo.store255[e]=[r.r,r.g,r.b,r.opacity],n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]}return n}let r=Vo.store255[e];if(r)return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n;let i=It.parseColorString(e);return i&&(Vo.store1[e]=[i.r/255,i.g/255,i.b/255,i.opacity],Vo.store255[e]=[i.r,i.g,i.b,i.opacity],n[0]=i.r,n[1]=i.g,n[2]=i.b,n[3]=i.opacity),n}static Set(e,t,n){if(t===Bo.Color1){if(Vo.store1[e])return;Vo.store1[e]=n,Vo.store255[e]=[Math.floor(255*n[0]),Math.floor(255*n[1]),Math.floor(255*n[2]),Math.floor(255*n[3])]}else{if(Vo.store255[e])return;Vo.store255[e]=n,Vo.store1[e]=[n[0]/255,n[1]/255,n[2]/255,n[3]]}}}function Ho(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return Array.isArray(e)&&S(e[0])?t?\`rgb(\${Math.round(e[0])},\${Math.round(e[1])},\${Math.round(e[2])},\${e[3].toFixed(2)})\`:\`rgb(\${Math.round(e[0])},\${Math.round(e[1])},\${Math.round(e[2])})\`:e}function Uo(e,t,n,r,i){return Array.isArray(e)&&!S(e[0])||Array.isArray(t)&&!S(t[0])?[,,,,].fill(0).map(((i,a)=>Wo(y(e)?e[a]:e,y(t)?t[a]:t,n,r))):Wo(e,t,n,r,i)}function Wo(e,t,n,r,i){if(!e||!t)return e&&Ho(e)||t&&Ho(t)||!1;let a,o,s=!1,c=!1;if(Array.isArray(e)?a=e:typeof e==\`string\`?a=Vo.Get(e,Bo.Color255):s=!0,Array.isArray(t)?o=t:typeof t==\`string\`?o=Vo.Get(t,Bo.Color255):c=!0,s!==c){let a=s?e:t,o=s?t:e,c=Object.assign(Object.assign({},a),{stops:a.stops.map((e=>Object.assign(Object.assign({},e),{color:Ho(o)})))});return s?Uo(a,c,n,r,i):Uo(c,a,n,r,i)}if(s){if(e.gradient===t.gradient){let r=e,i=t,a=r.stops,o=i.stops;if(a.length!==o.length)return!1;if(r.gradient===\`linear\`)return function(e,t,n){let r=e.stops,i=t.stops;return{gradient:\`linear\`,x0:e.x0+(t.x0-e.x0)*n,x1:e.x1+(t.x1-e.x1)*n,y0:e.y0+(t.y0-e.y0)*n,y1:e.y1+(t.y1-e.y1)*n,stops:Array(r.length).fill(0).map(((e,t)=>({color:qo(r[t].color,i[t].color,n),offset:r[t].offset+(i[t].offset-r[t].offset)*n})))}}(r,i,n);if(r.gradient===\`radial\`)return function(e,t,n){let r=e.stops,i=t.stops;return{gradient:\`radial\`,x0:e.x0+(t.x0-e.x0)*n,x1:e.x1+(t.x1-e.x1)*n,y0:e.y0+(t.y0-e.y0)*n,y1:e.y1+(t.y1-e.y1)*n,r0:e.r0+(t.r0-e.r0)*n,r1:e.r1+(t.r1-e.r1)*n,stops:Array(r.length).fill(0).map(((e,t)=>({color:qo(r[t].color,i[t].color,n),offset:r[t].offset+(i[t].offset-r[t].offset)*n})))}}(r,i,n);if(r.gradient===\`conical\`)return function(e,t,n){let r=e.stops,i=t.stops;return{gradient:\`conical\`,startAngle:e.startAngle+(t.startAngle-e.startAngle)*n,endAngle:e.endAngle+(t.endAngle-e.endAngle)*n,x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n,stops:Array(r.length).fill(0).map(((e,t)=>({color:qo(r[t].color,i[t].color,n),offset:r[t].offset+(i[t].offset-r[t].offset)*n})))}}(r,i,n)}return!1}return i&&i(a,o),Ho(function(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n,e[2]+(t[2]-e[2])*n,e[3]+(t[3]-e[3])*n]}(a,o,n),r)}Vo.store255={},Vo.store1={};let Go=[0,0,0,0],Ko=[0,0,0,0];function qo(e,t,n){return Vo.Get(e,Bo.Color255,Go),Vo.Get(t,Bo.Color255,Ko),\`rgba(\${Math.round(Go[0]+(Ko[0]-Go[0])*n)},\${Math.round(Go[1]+(Ko[1]-Go[1])*n)},\${Math.round(Go[2]+(Ko[2]-Go[2])*n)},\${Go[3]+(Ko[3]-Go[3])*n})\`}class Jo extends yo{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:0}})}onEnd(){this.target.setTheme({common:{opacity:1}})}onUpdate(e,t,n){this.target.setTheme({common:{opacity:t}})}}class Yo extends yo{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:1}})}onEnd(){this.target.setTheme({common:{opacity:0}})}onUpdate(e,t,n){this.target.setTheme({common:{opacity:1-t}})}}class Xo{static GetImage(e,t){var n;let r=Xo.cache.get(e);r?r.loadState===\`fail\`?B.global.getRequestAnimationFrame()((()=>{t.imageLoadFail(e)})):r.loadState===\`init\`||r.loadState===\`loading\`?(n=r.waitingMark)==null||n.push(t):t&&t.imageLoadSuccess(e,r.data):Xo.loadImage(e,t)}static GetSvg(e,t){var n;let r=Xo.cache.get(e);r?r.loadState===\`fail\`?B.global.getRequestAnimationFrame()((()=>{t.imageLoadFail(e)})):r.loadState===\`init\`||r.loadState===\`loading\`?(n=r.waitingMark)==null||n.push(t):t&&t.imageLoadSuccess(e,r.data):(r={type:\`image\`,loadState:\`init\`},Xo.cache.set(e,r),r.dataPromise=B.global.loadSvg(e),r.dataPromise?(r.waitingMark=[t],r.dataPromise.then((t=>{var n;r.loadState=t?.data?\`success\`:\`fail\`,r.data=t?.data,(n=r.waitingMark)==null||n.map(((n,i)=>{t?.data?(r.loadState=\`success\`,r.data=t.data,n.imageLoadSuccess(e,t.data)):(r.loadState=\`fail\`,n.imageLoadFail(e))})),r.waitingMark&&=[]}))):(r.loadState=\`fail\`,t.imageLoadFail(e)))}static GetFile(e,t){let n=Xo.cache.get(e);return n?n.loadState===\`fail\`?Promise.reject():n.loadState===\`init\`||n.loadState===\`loading\`?n.dataPromise.then((e=>e.data)):Promise.resolve(n.data):(n={type:t,loadState:\`init\`},Xo.cache.set(e,n),t===\`arrayBuffer\`?n.dataPromise=B.global.loadArrayBuffer(e):t===\`blob\`?n.dataPromise=B.global.loadBlob(e):t===\`json\`&&(n.dataPromise=B.global.loadJson(e)),n.dataPromise.then((e=>e.data)))}static loading(){setTimeout((()=>{if(!Xo.isLoading&&Xo.toLoadAueue.length){Xo.isLoading=!0;let e=Xo.toLoadAueue.splice(0,10),t=[];e.forEach((e=>{let{url:n,marks:r}=e,i={type:\`image\`,loadState:\`init\`};if(Xo.cache.set(n,i),i.dataPromise=B.global.loadImage(n),i.dataPromise){i.waitingMark=r;let e=i.dataPromise.then((e=>{var t;i.loadState=e?.data?\`success\`:\`fail\`,i.data=e?.data,(t=i.waitingMark)==null||t.map(((t,r)=>{e?.data?(i.loadState=\`success\`,i.data=e.data,t.imageLoadSuccess(n,e.data)):(i.loadState=\`fail\`,t.imageLoadFail(n))})),i.waitingMark&&=[]}));t.push(e)}else i.loadState=\`fail\`,r.forEach((e=>e.imageLoadFail(n)))})),Promise.all(t).then((()=>{Xo.isLoading=!1,this.onLoadSuccessCb.forEach((e=>e())),Xo.loading()})).catch((e=>{console.error(e),Xo.isLoading=!1,this.onLoadSuccessCb.forEach((e=>e())),Xo.loading()}))}}),0)}static loadImage(e,t){let n=Zo(e,Xo.toLoadAueue);if(n!==-1)return Xo.toLoadAueue[n].marks.push(t),void Xo.loading();Xo.toLoadAueue.push({url:e,marks:[t]}),Xo.loading()}static improveImageLoading(e){let t=Zo(e,Xo.toLoadAueue);if(t!==-1){let e=Xo.toLoadAueue.splice(t,1);Xo.toLoadAueue.unshift(e[0])}}static onLoadSuccess(e){this.onLoadSuccessCb.push(e)}}function Zo(e,t){for(let n=0;n<t.length;n++)if(t[n].url===e)return n;return-1}Xo.cache=new Map,Xo.isLoading=!1,Xo.toLoadAueue=[],Xo.onLoadSuccessCb=[];class Qo{bounds(e,t){if(S(e)){let n=e/2;t.x1=-n,t.x2=n,t.y1=-n,t.y2=n}else t.x1=-e[0]/2,t.x2=e[0]/2,t.y1=-e[1]/2,t.y2=e[1]/2}parseSize(e){return S(e)?e:Math.min(e[0],e[1])}}function $o(e,t,n,r,i){return i?e.arc(n,r,t,0,Be,!1,i):e.arc(n,r,t,0,Be),!1}var es=new class extends Qo{constructor(){super(...arguments),this.type=\`circle\`,this.pathStr=\`M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0\`}draw(e,t,n,r,i){return $o(e,this.parseSize(t)/2,n,r,i)}drawOffset(e,t,n,r,i,a){return $o(e,this.parseSize(t)/2+i,n,r,a)}drawToSvgPath(e,t,n,r){let i=this.parseSize(e)/2;return\`M \${t-i}, \${n} a \${i},\${i} 0 1,0 \${2*i},0 a \${i},\${i} 0 1,0 -\${2*i},0\`}},ts=new class extends Qo{constructor(){super(...arguments),this.type=\`cross\`,this.pathStr=\`M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z\`}draw(e,t,n,r,i){return function(e,t,n,r,i){return e.moveTo(-3*t+n,-t+r,i),e.lineTo(-t+n,-t+r,i),e.lineTo(-t+n,-3*t+r,i),e.lineTo(t+n,-3*t+r,i),e.lineTo(t+n,-t+r,i),e.lineTo(3*t+n,-t+r,i),e.lineTo(3*t+n,t+r,i),e.lineTo(t+n,t+r,i),e.lineTo(t+n,3*t+r,i),e.lineTo(-t+n,3*t+r,i),e.lineTo(-t+n,t+r,i),e.lineTo(-3*t+n,t+r,i),e.closePath(),!0}(e,this.parseSize(t)/6,n,r,i)}drawOffset(e,t,n,r,i,a){return function(e,t,n,r,i,a){return e.moveTo(-3*t+n-i,-t+r-i,a),e.lineTo(-t+n-i,-t+r-i,a),e.lineTo(-t+n-i,-3*t+r-i,a),e.lineTo(t+n+i,-3*t+r-i,a),e.lineTo(t+n+i,-t+r-i,a),e.lineTo(3*t+n+i,-t+r-i,a),e.lineTo(3*t+n+i,t+r+i,a),e.lineTo(t+n+i,t+r+i,a),e.lineTo(t+n+i,3*t+r+i,a),e.lineTo(-t+n-i,3*t+r+i,a),e.lineTo(-t+n-i,t+r+i,a),e.lineTo(-3*t+n-i,t+r+i,a),e.closePath(),!0}(e,this.parseSize(t)/6,n,r,i,a)}};function ns(e,t,n,r,i){return e.moveTo(n,r-t,i),e.lineTo(t+n,r,i),e.lineTo(n,r+t,i),e.lineTo(n-t,r,i),e.closePath(),!0}var rs=new class extends Qo{constructor(){super(...arguments),this.type=\`diamond\`,this.pathStr=\`M-0.5,0L0,-0.5L0.5,0L0,0.5Z\`}draw(e,t,n,r,i){return ns(e,this.parseSize(t)/2,n,r,i)}drawFitDir(e,t,n,r,i){return ns(e,this.parseSize(t)/2,n,r,i)}drawOffset(e,t,n,r,i,a){return ns(e,this.parseSize(t)/2+i,n,r,a)}};function os(e,t,n,r){let i=2*t;return e.rect(n-t,r-t,i,i),!1}var ss=new class extends Qo{constructor(){super(...arguments),this.type=\`square\`,this.pathStr=\`M-0.5,-0.5h1v1h-1Z\`}draw(e,t,n,r){return os(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return os(e,this.parseSize(t)/2+i,n,r)}};function cs(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return e.moveTo(n+t+2*i,t+r+i),e.lineTo(n-t-2*i,t+r+i),e.lineTo(n,r-t-2*i),e.closePath(),!0}class ls extends Qo{constructor(){super(...arguments),this.type=\`triangleUp\`,this.pathStr=\`M0.5,0.5 L-0.5,0.5 L0,-0.5 Z\`}draw(e,t,n,r){return cs(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return cs(e,this.parseSize(t)/2,n,r,i)}}var us=new ls,ds=new class extends ls{constructor(){super(...arguments),this.type=\`triangle\`}};let fs=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),ps=Math.sin(Be/10)*fs,ms=-Math.cos(Be/10)*fs;function hs(e,t,n,r){let i=ps*t,a=ms*t;e.moveTo(n,-t+r),e.lineTo(i+n,a+r);for(let o=1;o<5;++o){let s=Be*o/5,c=Math.cos(s),l=Math.sin(s);e.lineTo(l*t+n,-c*t+r),e.lineTo(c*i-l*a+n,l*i+c*a+r)}return e.closePath(),!0}var gs=new class extends Qo{constructor(){super(...arguments),this.type=\`star\`,this.pathStr=\`M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z\`}draw(e,t,n,r){return hs(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return hs(e,this.parseSize(t)/2+i,n,r)}};let _s=qe(3);function vs(e,t,n,r){let i=t,a=i/_s,o=a/5,s=t;return e.moveTo(0+n,-i+r),e.lineTo(a/2+n,r),e.lineTo(o/2+n,r),e.lineTo(o/2+n,s+r),e.lineTo(-o/2+n,s+r),e.lineTo(-o/2+n,r),e.lineTo(-a/2+n,r),e.closePath(),!0}var ys=new class extends Qo{constructor(){super(...arguments),this.type=\`arrow\`,this.pathStr=\`M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z\`}draw(e,t,n,r){return vs(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return vs(e,this.parseSize(t)/2+i,n,r)}};function bs(e,t,n,r){let i=2*t;return e.moveTo(n,-t+r),e.lineTo(i/3/2+n,t+r),e.lineTo(-i/3/2+n,t+r),e.closePath(),!0}var xs=new class extends Qo{constructor(){super(...arguments),this.type=\`wedge\`,this.pathStr=\`M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z\`}draw(e,t,n,r){return bs(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return bs(e,this.parseSize(t)/2+i,n,r)}};function Ss(e,t,n,r){return e.moveTo(-t+n,r),e.lineTo(n,t+r),!1}var Cs=new class extends Qo{constructor(){super(...arguments),this.type=\`stroke\`,this.pathStr=\`\`}draw(e,t,n,r){return Ss(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return Ss(e,this.parseSize(t)/2+i,n,r)}};let ws=-.5,Ts=qe(3)/2,Es=1/qe(12);function Ds(e,t,n,r){let i=t/2,a=t*Es,o=i,s=t*Es+t,c=-o,l=s;return e.moveTo(i+n,a+r),e.lineTo(o+n,s+r),e.lineTo(c+n,l+r),e.lineTo(ws*i-Ts*a+n,Ts*i+ws*a+r),e.lineTo(ws*o-Ts*s+n,Ts*o+ws*s+r),e.lineTo(ws*c-Ts*l+n,Ts*c+ws*l+r),e.lineTo(ws*i+Ts*a+n,ws*a-Ts*i+r),e.lineTo(ws*o+Ts*s+n,ws*s-Ts*o+r),e.lineTo(ws*c+Ts*l+n,ws*l-Ts*c+r),e.closePath(),!1}var Os=new class extends Qo{constructor(){super(...arguments),this.type=\`wye\`,this.pathStr=\`M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z\`}draw(e,t,n,r){return Ds(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return Ds(e,this.parseSize(t)/2+i,n,r)}};function ks(e,t,n,r,i){return e.moveTo(-t+n-2*i,r),e.lineTo(t+n+i,t+r+2*i),e.lineTo(t+n+i,r-t-2*i),e.closePath(),!0}var As=new class extends Qo{constructor(){super(...arguments),this.type=\`triangleLeft\`,this.pathStr=\`M-0.5,0 L0.5,0.5 L0.5,-0.5 Z\`}draw(e,t,n,r){return ks(e,this.parseSize(t)/2,n,r,0)}drawOffset(e,t,n,r,i){return ks(e,this.parseSize(t)/2,n,r,i)}};function js(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return e.moveTo(n-t-i,t+r+2*i),e.lineTo(t+n+2*i,r),e.lineTo(n-t-i,r-t-2*i),e.closePath(),!0}var Ms=new class extends Qo{constructor(){super(...arguments),this.type=\`triangleRight\`,this.pathStr=\`M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z\`}draw(e,t,n,r){return js(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return js(e,this.parseSize(t)/2,n,r,i)}};function Ns(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;return e.moveTo(n-t-2*i,r-t-i),e.lineTo(n+t+2*i,r-t-i),e.lineTo(n,r+t+2*i),e.closePath(),!0}var Ps=new class extends Qo{constructor(){super(...arguments),this.type=\`triangleDown\`,this.pathStr=\`M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z\`}draw(e,t,n,r){return Ns(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i){return Ns(e,this.parseSize(t)/2,n,r,i)}};let Fs=qe(3);function Is(e,t,n,r){let i=t*Fs;return e.moveTo(n,r+-i/3*2),e.lineTo(t+n,r+i),e.lineTo(n-t,r+i),e.closePath(),!0}var Ls=new class extends Qo{constructor(){super(...arguments),this.type=\`thinTriangle\`,this.pathStr=\`M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z\`}draw(e,t,n,r){return Is(e,this.parseSize(t)/2/Fs,n,r)}drawOffset(e,t,n,r,i){return Is(e,this.parseSize(t)/2/Fs+i,n,r)}};function Rs(e,t,n,r){let i=2*t;return e.moveTo(t+n,r-i),e.lineTo(n-t,r),e.lineTo(t+n,i+r),!0}var zs=new class extends Qo{constructor(){super(...arguments),this.type=\`arrow2Left\`,this.pathStr=\`M 0.25 -0.5 L -0.25 0 l 0.25 0.5\`}draw(e,t,n,r){return Rs(e,this.parseSize(t)/4,n,r)}drawOffset(e,t,n,r,i){return Rs(e,this.parseSize(t)/4+i,n,r)}};function Bs(e,t,n,r){let i=2*t;return e.moveTo(n-t,r-i),e.lineTo(n+t,r),e.lineTo(n-t,i+r),!0}var Vs=new class extends Qo{constructor(){super(...arguments),this.type=\`arrow2Right\`,this.pathStr=\`M -0.25 -0.5 l 0.25 0 l -0.25 0.5\`}draw(e,t,n,r){return Bs(e,this.parseSize(t)/4,n,r)}drawOffset(e,t,n,r,i){return Bs(e,this.parseSize(t)/4+i,n,r)}};function Hs(e,t,n,r){let i=2*t;return e.moveTo(n-i,r+t),e.lineTo(n,r-t),e.lineTo(n+i,r+t),!0}var Us=new class extends Qo{constructor(){super(...arguments),this.type=\`arrow2Up\`,this.pathStr=\`M -0.5 0.25 L 0 -0.25 l 0.5 0.25\`}draw(e,t,n,r){return Hs(e,this.parseSize(t)/4,n,r)}drawOffset(e,t,n,r,i){return Hs(e,this.parseSize(t)/4+i,n,r)}};function Ws(e,t,n,r){let i=2*t;return e.moveTo(n-i,r-t),e.lineTo(n,r+t),e.lineTo(n+i,r-t),!0}var Gs=new class extends Qo{constructor(){super(...arguments),this.type=\`arrow2Down\`,this.pathStr=\`M -0.5 -0.25 L 0 0.25 l 0.5 -0.25\`}draw(e,t,n,r){return Ws(e,this.parseSize(t)/4,n,r)}drawOffset(e,t,n,r,i){return Ws(e,this.parseSize(t)/4+i,n,r)}};function Ks(e,t,n,r,i){return e.moveTo(n,r-t),e.lineTo(n,r+t),!0}var qs=new class extends Qo{constructor(){super(...arguments),this.type=\`lineV\`,this.pathStr=\`M0,-0.5L0,0.5\`}draw(e,t,n,r,i){return Ks(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i,a){return Ks(e,this.parseSize(t)/2+i,n,r)}drawToSvgPath(e,t,n,r){let i=this.parseSize(e)/2;return\`M \${t}, \${n-i} L \${t},\${n+i}\`}};function Js(e,t,n,r,i){return e.moveTo(n-t,r),e.lineTo(n+t,r),!0}var Ys=new class extends Qo{constructor(){super(...arguments),this.type=\`lineH\`,this.pathStr=\`M-0.5,0L0.5,0\`}draw(e,t,n,r,i){return Js(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i,a){return Js(e,this.parseSize(t)/2+i,n,r)}drawToSvgPath(e,t,n,r){let i=this.parseSize(e)/2;return\`M \${t-i}, \${n} L \${t+i},\${n}\`}};function Xs(e,t,n,r,i){return e.moveTo(n-t,r-t),e.lineTo(n+t,r+t),e.moveTo(n+t,r-t),e.lineTo(n-t,r+t),!0}var Zs=new class extends Qo{constructor(){super(...arguments),this.type=\`close\`,this.pathStr=\`M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5\`}draw(e,t,n,r,i){return Xs(e,this.parseSize(t)/2,n,r)}drawOffset(e,t,n,r,i,a){return Xs(e,this.parseSize(t)/2+i,n,r)}drawToSvgPath(e,t,n,r){let i=this.parseSize(e)/2;return\`M \${t-i}, \${n-i} L \${t+i},\${n+i} M \${t+i}, \${n-i} L \${t-i},\${n+i}\`}};function Qs(e,t,n,r){return e.rect(n-t[0]/2,r-t[1]/2,t[0],t[1]),!1}function $s(e,t,n,r){let i=t,a=t/2;return e.rect(n-i/2,r-a/2,i,a),!1}var ec=new class extends Qo{constructor(){super(...arguments),this.type=\`rect\`,this.pathStr=\`M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z\`}draw(e,t,n,r){return S(t)?$s(e,t,n,r):Qs(e,t,n,r)}drawWithClipRange(e,t,n,r,i,a,o){S(t)&&(t=[t,t/2]);let s=2*(t[0]+t[1])*i,c=[{x:n+t[0]/2,y:r-t[1]/2},{x:n+t[0]/2,y:r+t[1]/2},{x:n-t[0]/2,y:r+t[1]/2},{x:n-t[0]/2,y:r-t[1]/2}],l=0,u=c[3];e.moveTo(u.x,u.y);for(let t=0;t<c.length;t++){let n=c[t],r=Math.sqrt((n.x-u.x)*(n.x-u.x)+(n.y-u.y)*(n.y-u.y));if(l+r>s){let t=(n.x-u.x)*(s-l)/r,i=(n.y-u.y)*(s-l)/r;e.lineTo(u.x+t,u.y+i);break}e.lineTo(n.x,n.y),u=n,l+=r}return!1}drawOffset(e,t,n,r,i){return S(t)?$s(e,t+2*i,n,r):Qs(e,[t[0]+2*i,t[1]+2*i],n,r)}};let tc=new St;class nc{constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this.pathStr=\`\`,this.type=e,y(t)?this.svgCache=t:this.path=t,this.isSvg=n}drawOffset(e,t,n,r,i,a,o){return t=this.parseSize(t),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((i=>{e.beginPath(),Or(i.path.commandList,e,n,r,t,t),o&&o(i.path,i.attribute)})),!1):(Or(this.path.commandList,e,n,r,t+i,t+i),!1)}draw(e,t,n,r,i,a){return t=this.parseSize(t),this.drawOffset(e,t,n,r,0,i,a)}parseSize(e){return S(e)?e:Math.min(e[0],e[1])}drawWithClipRange(e,t,n,r,i,a,o){return t=this.parseSize(t),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((a=>{a.path.drawWithClipRange(e,t,n,r,i),o&&o(a.path,a.attribute)})),!1):(this.path.drawWithClipRange(e,t,n,r,i),!1)}bounds(e,t){if(e=this.parseSize(e),this.isSvg){if(!this.svgCache)return;t.clear(),this.svgCache.forEach((n=>{let{path:r}=n;tc.x1=r.bounds.x1*e,tc.y1=r.bounds.y1*e,tc.x2=r.bounds.x2*e,tc.y2=r.bounds.y2*e,t.union(tc)}));return}this.path.bounds&&(t.x1=this.path.bounds.x1*e,t.y1=this.path.bounds.y1*e,t.x2=this.path.bounds.x2*e,t.y2=this.path.bounds.y2*e)}}let rc={};[es,ts,rs,ss,Ls,ds,gs,ys,xs,Cs,Os,As,Ms,us,Ps,zs,Vs,Us,Gs,ec,qs,Ys,Zs].forEach((e=>{rc[e.type]=e}));let ic={arrowLeft:\`M 0.25 -0.5 L -0.25 0 l 0.5 0.5\`,arrowRight:\`M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5\`,rectRound:\`M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z\`,roundLine:\`M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z\`};class ac{constructor(e){this.tagname=e,this.child=[],this[\`:@\`]={}}add(e,t){e===\`__proto__\`&&(e=\`#__proto__\`),this.child.push({[e]:t})}addChild(e){e.tagname===\`__proto__\`&&(e.tagname=\`#__proto__\`),e[\`:@\`]&&Object.keys(e[\`:@\`]).length>0?this.child.push({[e.tagname]:e.child,":@":e[\`:@\`]}):this.child.push({[e.tagname]:e.child})}}function oc(e,t,n,r){let i=e.indexOf(t,n);if(i===-1)throw Error(r);return i+t.length-1}function sc(e,t,n){let r=function(e,t){let n,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`>\`,i=\`\`;for(let a=t;a<e.length;a++){let t=e[a];if(n)t===n&&(n=\`\`);else if(t===\`"\`||t===\`'\`)n=t;else if(t===r[0]){if(!r[1]||e[a+1]===r[1])return{data:i,index:a}}else t===\`	\`&&(t=\` \`);i+=t}}(e,t+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:\`>\`);if(!r)return;let i=r.data,a=r.index,o=i.search(/\\s/),s=i,c=!0;o!==-1&&(s=i.substr(0,o).replace(/\\s\\s*$/,\`\`),i=i.substr(o+1));let l=s;if(n){let e=s.indexOf(\`:\`);e!==-1&&(s=s.substr(e+1),c=s!==r.data.substr(e+1))}return{tagName:s,tagExp:i,closeIndex:a,attrExpPresent:c,rawTagName:l}}let cc=RegExp(\`([^\\\\s=]+)\\\\s*(=\\\\s*(['"])([\\\\s\\\\S]*?)\\\\3)?\`,\`gm\`);class lc{constructor(e){this.currentNode=null,this.options=e,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(e,t,n){let r=t.tagname;typeof r==\`string\`&&(t.tagname=r),e.addChild(t)}buildAttributesMap(e,t,n){let r={};if(!e)return;let i=function(e,t){let n=[],r=t.exec(e);for(;r;){let i=[];i.startIndex=t.lastIndex-r[0].length;let a=r.length;for(let e=0;e<a;e++)i.push(r[e]);n.push(i),r=t.exec(e)}return n}(e,cc),a=i.length;for(let e=0;e<a;e++){let t=i[e][1],n=i[e][4];t&&(r[t]=n===void 0||(isNaN(n)?n:Number(n)))}return r}parseXml(e){e=e.replace(/\\r\\n?/g,\`
\`);let t=new ac(\`!xml\`),n=t,r=\`\`,i=\`\`;for(let a=0;a<e.length;a++)if(e[a]===\`<\`)if(e[a+1]===\`/\`){let t=oc(e,\`>\`,a,\`Closing Tag is not closed.\`),o=i.lastIndexOf(\`.\`);i=i.substring(0,o),n=this.tagsNodeStack.pop(),n&&n.child&&r&&n.child[n.child.length-1][\`:@\`]&&(n.child[n.child.length-1][\`:@\`].text=r),r=\`\`,a=t}else if(e[a+1]===\`?\`)a=sc(e,a,!1,\`?>\`).closeIndex+1;else if(e.substr(a+1,3)===\`!--\`)a=oc(e,\`-->\`,a+4,\`Comment is not closed.\`);else{let o=sc(e,a,!1),s=o.tagName,c=o.tagExp,l=o.attrExpPresent,u=o.closeIndex;if(s!==t.tagname&&(i+=i?\`.\`+s:s),c.length>0&&c.lastIndexOf(\`/\`)===c.length-1){s[s.length-1]===\`/\`?(s=s.substr(0,s.length-1),i=i.substr(0,i.length-1),c=s):c=c.substr(0,c.length-1);let e=new ac(s);s!==c&&l&&(e[\`:@\`]=this.buildAttributesMap(c,i,s)),this.addChild(n,e,i),i=i.substr(0,i.lastIndexOf(\`.\`))}else{let e=new ac(s);this.tagsNodeStack.push(n),s!==c&&l&&(e[\`:@\`]=this.buildAttributesMap(c,i,s)),this.addChild(n,e,i),n=e}r=\`\`,a=u}else r+=e[a];return t.child}}function uc(e,t){return dc(e)}function dc(e,t){let n={};for(let t=0;t<e.length;t++){let i=e[t],a=fc(i);if(a!==void 0&&i[a]){let e=dc(i[a]);r=e,Object.keys(r).length,i[\`:@\`]&&pc(e,i[\`:@\`]),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(e)):n[a]=e}}var r;return n}function fc(e){let t=Object.keys(e);for(let e=0;e<t.length;e++){let n=t[e];if(n!==\`:@\`)return n}}function pc(e,t,n){if(t){let n=Object.keys(t),r=n.length;for(let i=0;i<r;i++){let r=n[i];e[r]=t[r]}}}class mc{constructor(e){this.options=Object.assign({},mc.defaultOptions,e)}valid(e){return e.startsWith(\`<\`)}parse(e){return this.valid?uc(new lc(this.options).parseXml(e),this.options):!1}}mc.defaultOptions={};var hc=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};function gc(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return e.expand(t+(r/2+(n?function(e,t){return e?t:0}(n,t):0))),e}let _c=0;function vc(){return _c++}var yc;(function(e){e[e.HORIZONTAL=0]=\`HORIZONTAL\`,e[e.VERTICAL=1]=\`VERTICAL\`})(yc||={});let bc=new Map;[\`…\`,\`（\`,\`）\`,\`—\`,\`【\`,\`】\`,\`「\`,\`」\`,\`《\`,\`》\`].forEach((e=>bc.set(e,!0)));let xc=new Map;function Sc(e){if(bc.has(e))return!0;if(xc.has(e))return!1;let t=!1;return e.codePointAt(0)<256&&(t=!0),t}[\`\`].forEach((e=>xc.set(e,!0)));let Cc=vc(),wc=vc(),Tc=vc(),Ec=vc(),Dc=vc(),Oc=vc(),kc=vc(),Ac=vc(),jc=vc(),Mc=vc();vc();let Nc=vc();vc();let Pc=vc(),Fc=vc(),Ic=vc(),Lc=Symbol.for(\`GraphicService\`),Rc=Symbol.for(\`GraphicCreator\`),zc={"stroke-linecap":\`lineCap\`,"stroke-linejoin":\`lineJoin\`,"stroke-dasharray":\`lineDash\`,"stroke-dashoffset":\`lineDashOffset\`,"stroke-width":\`lineWidth\`,"fill-opacity":\`fillOpacity\`,"stroke-opacity":\`strokeOpacity\`,stroke:\`stroke\`,fill:\`fill\`},Bc=Object.keys(zc),Vc=new St,Hc=new wt,Uc=new St,Wc=[\`lineWidth\`,\`scaleX\`,\`scaleY\`,\`angle\`,\`anchor\`,\`visible\`],Gc=[\`x\`,\`y\`],Kc=[\`scaleX\`,\`scaleY\`],qc=[\`angle\`],Jc=new $e,Yc={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class Xc extends eo{static mixin(e){let t=Object.keys(e);for(let n=0;n<t.length;++n){let r=t[n];Object.defineProperty(Xc.prototype,r,Object.getOwnPropertyDescriptor(e,r))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._AABBBounds=new St,this._updateTag=gr.INIT,this.attribute=e,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,e.background?this.loadImage(e.background.background??e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic)}setMode(e){e===\`3d\`?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],{dx:n=e.dx,dy:r=e.dy}=this.attribute;if(t&&this.parent){let e=this.parent.attribute;Jc.x=n+(e.scrollX??0),Jc.y=r+(e.scrollY??0)}else Jc.x=n,Jc.y=r;return Jc}onAnimateBind(e){this._emitCustomEvent(\`animate-bind\`,e)}tryUpdateAABBBounds(){let e=this.attribute.boundsMode===\`imprecise\`;if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;B.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);let t=this.doUpdateAABBBounds(e);return B.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),this.attribute.boundsMode===\`empty\`&&t.clear(),t}tryUpdateOBBBounds(){return this._OBBBounds||=new Ct,this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(e){if(this.shadowRoot){let t=this.shadowRoot.AABBBounds.clone();e.union(t)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){let{clipConfig:e}=this.attribute;if(!e)return null;this.clipPathMap||=new Map;let{shape:t}=e,n=this.clipPathMap.get(t)||null;return n||(this.clipPathMap.size>10&&this.clipPathMap.clear(),n=this.parsePath(t),n&&this.clipPathMap.set(t,n)),n}parsePath(e){if(!e)return null;let t=rc[e];if(t||(t=Xc.userSymbolMap[e],t))return t;if(!0===((n=e=ic[e]||e).startsWith(\`<svg\`)||n.startsWith(\`<?xml\`))){let{svg:t}=new mc().parse(e);if(!t)return null;let n=y(t.path)?t.path:[t.path];Vc.clear();let r=[];n.forEach((e=>{let t=new pi().fromString(e.d),n={};Bc.forEach((t=>{e[t]&&(n[zc[t]]=e[t])})),r.push({path:t,attribute:n}),Vc.union(t.bounds)}));let i=Vc.width(),a=Vc.height(),o=1/We(i,a);r.forEach((e=>e.path.transform(0,0,o,o)));let s=new nc(e,r,!0);return Xc.userSymbolMap[e]=s,s}var n;let r=new pi().fromString(e),i=r.bounds.width(),a=r.bounds.height(),o=1/We(i,a);r.transform(0,0,o,o);let s=new nc(e,r);return Xc.userSymbolMap[e]=s,s}doUpdateAABBBounds(e){this.updateAABBBoundsStamp++;let t=this.getGraphicTheme();this._AABBBounds.clear();let n=this.attribute,r=this.updateAABBBounds(n,t,this._AABBBounds,e),{boundsPadding:i=t.boundsPadding}=n,a=Do(i);return a&&r.expand(a),this.clearUpdateBoundTag(),r}updatePathProxyAABBBounds(e){let t=typeof this.pathProxy==\`function\`?this.pathProxy(this.attribute):this.pathProxy;if(!t)return!1;let n=new or(e);return Or(t.commandList,n,0,0),!0}tryUpdateGlobalAABBBounds(){let e=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(e.x1,e.y1,e.x2,e.y2):this._globalAABBBounds=e.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(){if(this._globalTransMatrix){if(this.parent){let e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._transMatrix||=new wt,this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),e&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&gr.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&B.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&gr.UPDATE_BOUNDS)&&B.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&gr.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&gr.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&gr.UPDATE_LOCAL_MATRIX)}isValid(){let e=this.attribute;return Number.isFinite((e.x??0)+(e.y??0))}_validNumber(e){return e==null||Number.isFinite(e)}shouldUpdateShape(){return!!(this._updateTag&gr.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=gr.CLEAR_SHAPE}containsPoint(e,t,n,r){if(!r)return!1;if(n===_r.GLOBAL){let n=new $e(e,t);this.parent&&this.parent.globalTransMatrix.transformPoint(n,n),e=n.x,t=n.y}return r.containsPoint(this,{x:e,y:t})}setAttributes(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2?arguments[2]:void 0;(e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,n)||e).background?this.loadImage(e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic),this._setAttributes(e,t,n)}_setAttributes(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=Object.keys(e);for(let t=0;t<r.length;t++){let n=r[t];this.attribute[n]=e[n]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!t&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n)}setAttribute(e,t,n,r){let i=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[e]:t},this.attribute,e,r);i?this._setAttributes(i,n,r):f(this.normalAttrs?.[e])?(this.attribute[e]=t,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!n&&!this.needUpdateTag(e)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[e]=t,e===\`background\`?this.loadImage(t,!0):e===\`shadowGraphic\`&&this.setShadowGraphic(t)}needUpdateTags(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Wc;for(let n=0;n<t.length;n++){let r=t[n];if(e.indexOf(r)!==-1)return!0}return!1}needUpdateTag(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Wc;for(let n=0;n<t.length;n++)if(e===t[n])return!0;return!1}initAttributes(e){let t={type:vr.INIT};e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,t)||e,this.attribute=e,e.background?this.loadImage(e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic),this._updateTag=gr.INIT,this.valid=this.isValid(),this.onAttributeUpdate(t)}translate(e,t){if(e===0&&t===0)return this;let n={type:vr.TRANSLATE},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:e,y:t},this.attribute,Gc,n);r&&(e=r.x,t=r.y,delete r.x,delete r.y,this._setAttributes(r));let i=this.attribute,a=i.postMatrix;return a?B.transformUtil.fromMatrix(a,a).translate(e,t):(i.x=(i.x??gi.x)+e,i.y=(i.y??gi.y)+t),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}translateTo(e,t){let n=this.attribute;if(n.x===e&&n.y===t)return this;let r={type:vr.TRANSLATE_TO},i=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:e,y:t},this.attribute,Gc,r);return i?(this._setAttributes(i,!1,r),this):(n.x=e,n.y=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(e,t,n){if(e===1&&t===1)return this;let r={type:vr.SCALE},i=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:e,scaleY:t,scaleCenter:n},this.attribute,Kc,r);i&&(e=i.scaleX,t=i.scaleY,delete i.scaleX,delete i.scaleY,this._setAttributes(i));let a=this.attribute;if(n){let{postMatrix:r}=this.attribute;r||(r=new wt,a.postMatrix=r),B.transformUtil.fromMatrix(r,r).scale(e,t,n)}else a.scaleX=(a.scaleX??gi.scaleX)*e,a.scaleY=(a.scaleY??gi.scaleY)*t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}scaleTo(e,t){let n=this.attribute;if(n.scaleX===e&&n.scaleY===t)return this;let r={type:vr.SCALE_TO},i=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:e,scaleY:t},this.attribute,Kc,r);return i?(this._setAttributes(i,!1,r),this):(n.scaleX=e,n.scaleY=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(e,t){if(e===0)return this;let n={type:vr.ROTATE},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:e,rotateCenter:t},this.attribute,qc,n);r&&(delete r.angle,this._setAttributes(r,!1,n));let i=this.attribute;if(t){let{postMatrix:n}=this.attribute;n||(n=new wt,i.postMatrix=n),B.transformUtil.fromMatrix(n,n).rotate(e,t)}else i.angle=(i.angle??gi.angle)+e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}rotateTo(e){let t=this.attribute;if(t.angle===e)return this;let n={type:vr.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,qc,n);return r?(this._setAttributes(r,!1,n),this):(t.angle=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this)}skewTo(e,t){return this}animate(e){this.animates||=new Map;let t=new xo(e?.id,e?.timeline??(this.stage&&this.stage.getTimeline()),e?.slience);if(t.bind(this),e){let{onStart:n,onFrame:r,onEnd:i,onRemove:a}=e;n!=null&&t.onStart(n),r!=null&&t.onFrame(r),i!=null&&t.onEnd(i),a!=null&&t.onRemove(a),t.interpolateFunc=e.interpolate}return this.animates.set(t.id,t),t.onRemove((()=>{t.stop(),this.animates.delete(t.id)})),t}onAttributeUpdate(e){e&&e.skipUpdateCallback||(B.graphicService.onAttributeUpdate(this),this._emitCustomEvent(\`afterAttributeUpdate\`,e))}update(e){e?(e.bounds&&this.tryUpdateAABBBounds(),e.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(e){return!(!this.currentStates||!this.currentStates.length)&&(!!f(e)||this.currentStates.includes(e))}getState(e){return this.states?.[e]}applyStateAttrs(e,t,n,r){if(n){let n=Object.keys(e),i=this.getNoWorkAnimateAttr(),a={},o;n.forEach((t=>{i[t]?(o||={},o[t]=e[t]):a[t]=r&&e[t]===void 0?this.getDefaultAttribute(t):e[t]}));let s=this.animate({slience:!0});s.stateNames=t,s.to(a,this.stateAnimateConfig?.duration??200,this.stateAnimateConfig?.easing??\`cubicOut\`),o&&this.setAttributes(o,!1,{type:vr.STATE})}else this.stopStateAnimates(),this.setAttributes(e,!1,{type:vr.STATE})}updateNormalAttrs(e){let t={};this.normalAttrs?(Object.keys(e).forEach((e=>{e in this.normalAttrs?(t[e]=this.normalAttrs[e],delete this.normalAttrs[e]):t[e]=this.getNormalAttribute(e)})),Object.keys(this.normalAttrs).forEach((t=>{e[t]=this.normalAttrs[t]}))):Object.keys(e).forEach((e=>{t[e]=this.getNormalAttribute(e)})),this.normalAttrs=t}stopStateAnimates(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:\`end\`;this.animates&&this.animates.forEach((t=>{t.stateNames&&(t.stop(e),this.animates.delete(t.id))}))}getNormalAttribute(e){let t=this.attribute[e];return this.animates&&this.animates.forEach((n=>{if(n.stateNames){let r=n.getEndProps();te(r,e)&&(t=r[e])}})),t}clearStates(e){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,e,!0)):this.currentStates=[],this.normalAttrs=null}removeState(e,t){if(this.currentStates){let n=y(e)?t=>!e.includes(t):t=>t!==e,r=this.currentStates.filter(n);r.length!==this.currentStates.length&&this.useStates(r,t)}}toggleState(e,t){if(this.hasState(e))this.removeState(e,t);else if((this.currentStates?this.currentStates.indexOf(e):-1)<0){let n=this.currentStates?this.currentStates.slice():[];n.push(e),this.useStates(n,t)}}addState(e,t,n){if(this.currentStates&&this.currentStates.includes(e)&&(t||this.currentStates.length===1))return;let r=t&&this.currentStates?.length?this.currentStates.concat([e]):[e];this.useStates(r,n)}useStates(e,t){if(!e.length)return void this.clearStates(t);if(this.currentStates?.length===e.length&&!e.some(((e,t)=>this.currentStates[t]!==e)))return;let n={};e.forEach((t=>{let r=this.stateProxy?this.stateProxy(t,e):this.states?.[t];r&&Object.assign(n,r)})),this.updateNormalAttrs(n),this.currentStates=e,this.applyStateAttrs(n,e,t)}addUpdateBoundTag(){this._updateTag|=gr.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=gr.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=gr.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&gr.UPDATE_SHAPE_AND_BOUNDS)===gr.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=gr.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=gr.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=gr.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=gr.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=gr.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=gr.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=gr.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&gr.UPDATE_LAYOUT)}getAnchor(e,t){let n=[0,0],r=()=>{if(t.b)return t.b;let{scaleX:e,scaleY:n,angle:r}=this.attribute;return Uc.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),t.b=this.AABBBounds.clone(),this._AABBBounds.copy(Uc),this.setAttributes({scaleX:e,scaleY:n,angle:r}),t.b};if(typeof e[0]==\`string\`){let t=parseFloat(e[0])/100,i=r();n[0]=i.x1+(i.x2-i.x1)*t}else n[0]=e[0];if(typeof e[1]==\`string\`){let t=parseFloat(e[1])/100,i=r();n[1]=i.y1+(i.y2-i.y1)*t}else n[1]=e[1];return n}doUpdateLocalMatrix(){let{x:e=gi.x,y:t=gi.y,scaleX:n=gi.scaleX,scaleY:r=gi.scaleY,angle:i=gi.angle,scaleCenter:a,anchor:o,postMatrix:s}=this.attribute,c=[0,0],l={};if(o&&(c=this.getAnchor(o,l)),!a||n===1&&r===1)(function(e,t,n,r,i,a,o,s){let c=t.a,l=t.b,u=t.c,d=t.d,f=t.e,p=t.f,m=Ue(o),h=Ke(o),g,_;s?(g=s[0],_=s[1]):(g=n,_=r);let v=g-n,y=_-r,b=c*m+u*h,x=l*m+d*h,S=u*m-c*h,C=d*m-l*h;e.a=i*b,e.b=i*x,e.c=a*S,e.d=a*C,e.e=f+c*g+u*_-b*v-S*y,e.f=p+l*g+d*_-x*v-C*y})(this._transMatrix,this._transMatrix.reset(),e,t,n,r,i,o&&c);else{let o=this._transMatrix;o.reset(),o.translate(c[0],c[1]),o.rotate(i),o.translate(-c[0],-c[1]),o.translate(e,t),c=this.getAnchor(a,l),B.transformUtil.fromMatrix(o,o).scale(n,r,{x:c[0],y:c[1]})}let u=this.getOffsetXY(gi);if(this._transMatrix.e+=u.x,this._transMatrix.f+=u.y,s){let e=Hc.setValue(s.a,s.b,s.c,s.d,s.e,s.f),t=this._transMatrix;e.multiply(t.a,t.b,t.c,t.d,t.e,t.f),t.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);let{scrollX:e=0,scrollY:t=0}=this.parent.attribute;this._globalTransMatrix.translate(e,t)}}setStage(e,t){if(this.stage!==e){if(this.stage=e,this.layer=t,this.setStageToShadowRoot(e,t),this.animates&&this.animates.size){let t=e.getTimeline();this.animates.forEach((e=>{e.timeline===vo&&e.setTimeline(t)}))}this._onSetStage&&this._onSetStage(this,e,t),B.graphicService.onSetStage(this,e)}}setStageToShadowRoot(e,t){this.shadowRoot&&this.shadowRoot.setStage(e,t)}onAddStep(e){}onStop(e){e&&this.setAttributes(e,!1,{type:vr.ANIMATE_END})}onStep(e,t,n,r,i){let a={};if(n.customAnimate)n.customAnimate.update(i,r,a);else{let o=n.props,s=n.parsedProps,c=n.propKeys;this.stepInterpolate(e,t,a,n,r,i,o,void 0,s,c)}this.setAttributes(a,!1,{type:vr.ANIMATE_UPDATE,animationState:{ratio:r,end:i,step:n,isFirstFrameOfStep:e.getLastStep()!==n}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(e,t,n,r,i,a,o,s,c,l){l||(l=Object.keys(o),r.propKeys=l),a?r.propKeys.forEach((e=>{t.validAttr(e)&&(n[e]=o[e])})):l.forEach((a=>{if(!t.validAttr(a))return;let l=o[a],u=(s&&s[a])??e.getLastPropByName(a,r);if(l==null||u==null||l===u)return void(n[a]=l);let d;d=t.interpolateFunc&&t.interpolateFunc(a,i,u,l,n),d||(d=t.customInterpolate(a,i,u,l,this,n),d||this.defaultInterpolate(l,u,a,n,c,i)||this._interpolate(a,i,u,l,n))})),r.parsedProps=c}defaultInterpolate(e,t,n,r,i,a){if(Number.isFinite(e)&&Number.isFinite(t))return r[n]=t+(e-t)*a,!0;if(n===\`fill\`){i||={};let o=i.fillColorArray,s=Uo(t,o??e,a,!1,((e,t)=>{i.fillColorArray=t}));return s&&(r[n]=s),!0}if(n===\`stroke\`){i||={};let o=i.strokeColorArray,s=Uo(t,o??e,a,!1,((e,t)=>{i.strokeColorArray=t}));return s&&(r[n]=s),!0}if(n===\`shadowColor\`){i||={};let o=i.shadowColorArray,s=Uo(t,o??e,a,!0,((e,t)=>{i.shadowColorArray=t}));return s&&(r[n]=s),!0}if(Array.isArray(e)&&e.length===t.length){let i=[],o=!0;for(let n=0;n<e.length;n++){let r=t[n],s=r+(e[n]-r)*a;if(!Number.isFinite(s)){o=!1;break}i.push(s)}o&&(r[n]=i)}return!1}_interpolate(e,t,n,r,i){}getDefaultAttribute(e){return this.getGraphicTheme()[e]}getComputedAttribute(e){return this.attribute[e]??this.getDefaultAttribute(e)}onSetStage(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._onSetStage=e,t&&this.stage&&e(this,this.stage)}attachShadow(e){return e&&(e.shadowHost=this),this.shadowRoot=e??B.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&=(this.addUpdateBoundTag(),this.shadowRoot.release(!0),null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map((e=>e.toJson()))}}createPathProxy(e){return v(e,!0)?this.pathProxy=new pi().fromString(e):this.pathProxy=new pi,this.pathProxy}loadImage(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||t&&function(e){return!(!e.fill&&!e.stroke)}(e))return;let n=e;this.resources||=new Map;let r={data:\`init\`,state:null};this.resources.set(n,r),typeof e==\`string\`?(r.state=\`loading\`,e.startsWith(\`<svg\`)?(Xo.GetSvg(e,this),this.backgroundImg=this.backgroundImg||t):(w(e)||e.includes(\`/\`)||T(e))&&(Xo.GetImage(e,this),this.backgroundImg=this.backgroundImg||t)):m(e)?(r.state=\`success\`,r.data=e,this.backgroundImg=this.backgroundImg||t):r.state=\`fail\`}setShadowGraphic(e){e?this.attachShadow().add(e):this.detachShadow()}imageLoadSuccess(e,t,n){if(!this.resources)return;let r=this.resources.get(e);r&&(r.state=\`success\`,r.data=t,n&&n(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(e,t){if(!this.resources)return;let n=this.resources.get(e);n&&(n.state=\`fail\`,t&&t())}_stopAnimates(e){e&&e.forEach((e=>{e.stop()}))}stopAnimates(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&e&&this.forEachChildren((t=>{t.stopAnimates(e)}))}release(){this.releaseStatus=\`released\`,this.stopAnimates(),B.graphicService.onRelease(this)}_emitCustomEvent(e,t){if(this._events&&e in this._events){let n=new ao(e,t);n.bubbles=!1,n.manager=this.stage?.eventSystem?.manager,this.dispatchEvent(n)}}}var Zc;Xc.userSymbolMap={},Xc.mixin(lo),function(e){e[e.LESS_GROUP=0]=\`LESS_GROUP\`,e[e.MORE_GROUP=1]=\`MORE_GROUP\`}(Zc||={});class Qc extends Xc{constructor(e){super(e),this.type=\`group\`,this.parent=null,this.isContainer=!0,this.numberType=Oc,this._childUpdateTag=gr.UPDATE_BOUNDS}setMode(e){e===\`3d\`?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(e){return this.theme||=new Xa,this.theme.setTheme(e,this)}createTheme(){this.theme||=new Xa}visibleAll(e){this.setAttribute(\`visible\`,e),this.forEachChildren((t=>{t.isContainer&&t.visibleAll?t.visibleAll(e):t.setAttribute(\`visible\`,e)}))}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(e,t,n){if(n===_r.GLOBAL){let n=new $e(e,t);return this.parent&&this.parent.globalTransMatrix.transformPoint(n,n),this.AABBBounds.contains(n.x,n.y)}return this.AABBBounds.contains(e,t)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&gr.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;B.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);let e=this.shouldSelfChangeUpdateAABBBounds(),t=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),B.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,e),this.attribute.boundsMode===\`empty\`&&t.clear(),t}doUpdateLocalMatrix(){let{x:e=gi.x,y:t=gi.y,dx:n=gi.dx,dy:r=gi.dy,scaleX:i=gi.scaleX,scaleY:a=gi.scaleY,angle:o=gi.angle,postMatrix:s}=this.attribute;if(e!==0||t!==0||n!==0||r!==0||i!==1||a!==1||o!==0||s)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return Qa(this).group}updateAABBBounds(e,t,n){let r=n;n=n.clone();let{width:i,height:a,path:o,clip:s=t.clip}=e;if(o&&o.length?o.forEach((e=>{n.union(e.AABBBounds)})):i!=null&&a!=null&&n.set(0,0,Math.max(0,i),Math.max(0,a)),!s){this.forEachChildren((e=>{n.union(e.AABBBounds)}));let{scrollX:t=0,scrollY:r=0}=e;n.translate(t,r)}return B.graphicService.updateTempAABBBounds(n),B.graphicService.transformAABBBounds(e,n,t,!1,this),r.copy(n),r}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;let e=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent(\`AAABBBoundsChange\`),e}clearUpdateBoundTag(){this._updateTag&=gr.CLEAR_BOUNDS,this._childUpdateTag&=gr.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=gr.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&gr.UPDATE_BOUNDS||(this._childUpdateTag|=gr.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(e){let t=super.appendChild(e);return this.stage&&t&&(t.stage=this.stage,t.layer=this.layer),this.addUpdateBoundTag(),B.graphicService.onAddIncremental(e,this,this.stage),t}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),B.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(e){return this.stage&&e&&e.setStage(this.stage,this.layer),this.addUpdateBoundTag(),e}appendChild(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=super.appendChild(e);return t&&this.stage&&n&&n.setStage(this.stage,this.layer),this.addUpdateBoundTag(),n}insertBefore(e,t){return this._updateChildToStage(super.insertBefore(e,t))}insertAfter(e,t){return this._updateChildToStage(super.insertAfter(e,t))}insertInto(e,t){return this._updateChildToStage(super.insertInto(e,t))}removeChild(e){let t=super.removeChild(e);return e.stage=null,B.graphicService.onRemove(e),this.addUpdateBoundTag(),t}removeAllChild(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.forEachChildren((t=>{B.graphicService.onRemove(t),e&&t.isContainer&&t.removeAllChild(e)})),super.removeAllChild(),this.addUpdateBoundTag()}setStage(e,t){this.stage!==e&&(this.stage=e,this.layer=t,this.setStageToShadowRoot(e,t),this._onSetStage&&this._onSetStage(this,e,t),B.graphicService.onSetStage(this,e),this.forEachChildren((t=>{t.setStage(e,this.layer)})))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren((e=>{e.isContainer&&e.addUpdateGlobalPositionTag()}))}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren((e=>{e.isContainer&&e.addUpdateGlobalPositionTag()}))}tryUpdateGlobalTransMatrix(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){let e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),e&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&gr.UPDATE_GLOBAL_MATRIX)}_getChildByName(e,t){return this.find((t=>t.name===e),t)}createOrUpdateChild(e,t,n){let r=this._getChildByName(e);return r?r.setAttributes(t):(r=B.graphicService.creator[n](t),r.name=e,this.add(r)),r}clone(){return new Qc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Qc.NOWORK_ANIMATE_ATTR}release(e){e&&this.forEachChildren((t=>{t.release(e)})),super.release()}}function $c(e){return new Qc(e)}Qc.NOWORK_ANIMATE_ATTR=Yc;class el extends Qc{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw Error(\`暂不支持\`)}get dpr(){return this._dpr}constructor(e,t,n,r){super({}),this.stage=e,this.global=t,this.window=n,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,n,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:r.zIndex??0}),this.layer=this,this.subLayers=new Map,this.theme=new Xa,this.background=\`rgba(0, 0, 0, 0)\`,this.afterDrawCbs=[]}combineSubLayer(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=Array.from(this.subLayers.values()).sort(((e,t)=>e.zIndex-t.zIndex));this.layerHandler.merge(t.map((t=>(t.layer.subLayers.size&&t.layer.combineSubLayer(e),t.layer.getNativeHandler())))),e&&t.forEach((e=>{e.group&&(e.group.incremental=0)})),t.forEach((e=>{B.layerService.releaseLayer(this.stage,e.layer)})),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(e,t){super.setStage(e,this)}pick(e,t){throw Error(\`暂不支持\`)}tryRenderSecondaryLayer(e,t){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach((n=>{n.layer.renderCount=this.renderCount,n.layer.render(e,t)}))}render(e,t){this.layerHandler.render([this],{renderService:e.renderService,stage:this.stage,layer:this,viewBox:e.viewBox,transMatrix:e.transMatrix,background:e.background??this.background,updateBounds:e.updateBounds},t),this.afterDrawCbs.forEach((e=>e(this))),this.tryRenderSecondaryLayer(e,t)}resize(e,t){this.layerHandler.resize(e,t)}resizeView(e,t){this.layerHandler.resizeView(e,t)}setDpr(e){this.layerHandler.setDpr(e)}afterDraw(e){this.afterDrawCbs.push(e)}startAnimate(e){throw Error(\`暂不支持\`)}setToFrame(e){throw Error(\`暂不支持\`)}prepare(e,t){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach((e=>{B.layerService.releaseLayer(this.stage,e.layer)}))}drawTo(e,t){this.layerHandler.drawTo(e,[this],Object.assign({background:t.background??this.background,renderService:t.renderService,viewBox:t.viewBox,transMatrix:t.transMatrix,stage:this.stage,layer:this},t)),this.afterDrawCbs.forEach((e=>e(this)))}}let tl=Symbol.for(\`TransformUtil\`),nl=Symbol.for(\`GraphicUtil\`),rl=Symbol.for(\`LayerService\`),il=Symbol.for(\`StaticLayerHandlerContribution\`),al=Symbol.for(\`DynamicLayerHandlerContribution\`),ol=Symbol.for(\`VirtualLayerHandlerContribution\`);var sl,cl=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ll=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let ul=sl=class{static GenerateLayerId(){return\`\${sl.idprefix}_\${sl.prefix_count++}\`}constructor(){this.layerMap=new Map,this.global=B.global}tryInit(){this.inited||=(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),!0)}getStageLayer(e){return this.layerMap.get(e)}getRecommendedLayerType(e){return e||(this.staticLayerCountInEnv===0?this.dynamicLayerCountInEnv===0?\`virtual\`:\`dynamic\`:\`static\`)}getLayerHandler(e){let t;return t=e===\`static\`?V.get(il):e===\`dynamic\`?V.get(al):V.get(ol),t}createLayer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{main:!1};this.tryInit();let n=this.getRecommendedLayerType(t.layerMode);n=t.main||t.canvasId?\`static\`:n;let r=this.getLayerHandler(n),i=new el(e,this.global,e.window,Object.assign(Object.assign({main:!1},t),{layerMode:n,canvasId:t.canvasId??sl.GenerateLayerId(),layerHandler:r})),a=this.layerMap.get(e)||[];return a.push(i),this.layerMap.set(e,a),this.staticLayerCountInEnv--,i}prepareStageLayer(e){let t;e.forEachChildren((e=>{let n=e.getNativeHandler();n.type===\`virtual\`?(n.mainHandler=t,t.secondaryHandlers.push(n)):(t=n,t.secondaryHandlers=[])}))}releaseLayer(e,t){t.release();let n=this.layerMap.get(e)||[];this.layerMap.set(e,n.filter((e=>e!==t)))}layerCount(e){return(this.layerMap.get(e)||[]).length}restLayerCount(e){return this.global.env===\`browser\`?10:0}releaseStage(e){this.layerMap.delete(e)}};ul.idprefix=\`visactor_layer\`,ul.prefix_count=0,ul=sl=cl([R(),ll(\`design:paramtypes\`,[])],ul);var dl=new I((e=>{e(Qn).to(rr).inSingletonScope(),e(Ia).to(Ra),e(nl).to(Ha).inSingletonScope(),e(tl).to(Ga).inSingletonScope(),e(rl).to(ul).inSingletonScope()}));function fl(e,t){return!(!e&&!t)}function pl(e,t){let n;return n=y(e)?e.some((e=>e||e===void 0)):!!e,n&&t>0}function ml(e,t,n){return n&&e*t>0}function hl(e,t,n,r,i){return i&&e*t>0&&n!==0&&r!==0}function gl(e,t){return e*t>0}function _l(e,t,n,r){return e*t>0&&n!==0&&r!==0}function vl(e,t,n,r,i,a,o){let s=e-n,c=t-r,l=(o?a:-a)/Math.sqrt(s*s+c*c),u=l*c,d=-l*s,f=e+u,p=t+d,m=n+u,h=r+d,g=(f+m)/2,_=(p+h)/2,v=m-f,y=h-p,b=v*v+y*y,x=i-a,S=f*h-m*p,C=(y<0?-1:1)*Math.sqrt(Math.max(0,x*x*b-S*S)),w=(S*y-v*C)/b,T=(-S*v-y*C)/b,E=(S*y+v*C)/b,D=(-S*v+y*C)/b,O=w-g,k=T-_,A=E-g,j=D-_;return O*O+k*k>A*A+j*j&&(w=E,T=D),{cx:w,cy:T,x01:-u,y01:-d,x11:w*(i/x-1),y11:T*(i/x-1)}}function yl(e,t,n,r,i){let a=Ve(n-t),o=e.getParsedCornerRadius(),s=y(o),{outerDeltaAngle:c,innerDeltaAngle:l,outerStartAngle:u,outerEndAngle:d,innerEndAngle:f,innerStartAngle:p}=e.getParsePadAngle(t,n),m=s?o[0]:o,h=s?o[1]:o,g=s?o[2]:o,_=s?o[3]:o,v=Math.max(h,m),b=Math.max(g,_),x=v,S=b,C=i*Ue(u),w=i*Ke(u),T=r*Ue(f),E=r*Ke(f),D,O,k,A;if((b>Le||v>Le)&&(D=i*Ue(d),O=i*Ke(d),k=r*Ue(p),A=r*Ke(p),a<Re)){let e=function(e,t,n,r,i,a,o,s){let c=n-e,l=r-t,u=o-i,d=s-a,f=d*c-u*l;return f*f<Le?[]:(f=(u*(t-a)-d*(e-i))/f,[e+f*c,t+f*l])}(C,w,k,A,D,O,T,E);if(e){let t=C-e[0],n=w-e[1],a=D-e[0],o=O-e[1],s=1/Ke(((j=(t*a+n*o)/(qe(t*t+n*n)*qe(a*a+o*o)))>1?0:j<-1?Re:Math.acos(j))/2),c=qe(e[0]*e[0]+e[1]*e[1]);S=Ge(b,(r-c)/(s-1)),x=Ge(v,(i-c)/(s+1))}}var j;return{outerDeltaAngle:c,xors:C,yors:w,xirs:k,yirs:A,xore:D,yore:O,xire:T,yire:E,limitedOcr:x,limitedIcr:S,outerCornerRadiusStart:m,outerCornerRadiusEnd:h,maxOuterCornerRadius:v,maxInnerCornerRadius:b,outerStartAngle:u,outerEndAngle:d,innerDeltaAngle:l,innerEndAngle:f,innerStartAngle:p,innerCornerRadiusStart:_,innerCornerRadiusEnd:g}}function bl(e,t,n,r,i,a,o){let{startAngle:s,endAngle:c}=e.getParsedAngle(),l=Ve(c-s),u=c>s,d=!1;if(i<a){let e=i;i=a,a=e}if(i<=Le)t.moveTo(n,r);else if(l>=F-Le)t.moveTo(n+i*Ue(s),r+i*Ke(s)),t.arc(n,r,i,s,c,!u),a>Le&&(t.moveTo(n+a*Ue(c),r+a*Ke(c)),t.arc(n,r,a,c,s,u));else{let{outerDeltaAngle:l,xors:f,yors:p,xirs:m,yirs:h,limitedOcr:g,outerCornerRadiusStart:_,outerCornerRadiusEnd:v,maxOuterCornerRadius:y,xore:b,yore:x,xire:S,yire:C,outerStartAngle:w,outerEndAngle:T,limitedIcr:E,innerDeltaAngle:D,innerEndAngle:O,innerStartAngle:k,innerCornerRadiusStart:A,innerCornerRadiusEnd:j,maxInnerCornerRadius:ee}=yl(e,s,c,a,i);if(l<.001)o&&(o[3]||o[1])&&t.moveTo(n+f,r+p),d=!0;else if(g>Le){let e=Ge(_,g),a=Ge(v,g),s=vl(m,h,f,p,i,e,Number(u)),c=vl(b,x,S,C,i,a,Number(u));g<y&&e===a?!o||o[0]?(t.moveTo(n+s.cx+s.x01,r+s.cy+s.y01),t.arc(n+s.cx,r+s.cy,g,He(s.y01,s.x01),He(c.y01,c.x01),!u)):t.moveTo(n+s.cx+g*Ue(He(c.y01,c.x01)),r+s.cy+g*Ke(He(c.y01,c.x01))):!o||o[0]?(t.moveTo(n+s.cx+s.x01,r+s.cy+s.y01),e>0&&t.arc(n+s.cx,r+s.cy,e,He(s.y01,s.x01),He(s.y11,s.x11),!u),t.arc(n,r,i,He(s.cy+s.y11,s.cx+s.x11),He(c.cy+c.y11,c.cx+c.x11),!u),a>0&&t.arc(n+c.cx,r+c.cy,a,He(c.y11,c.x11),He(c.y01,c.x01),!u)):a>0?t.moveTo(n+c.cx+a*Ue(He(c.y01,c.x01)),r+c.cy+a*Ke(He(c.y01,c.x01))):t.moveTo(n+b,r+i*Ke(T))}else !o||o[0]?(t.moveTo(n+f,r+p),t.arc(n,r,i,w,T,!u)):t.moveTo(n+i*Ue(T),r+i*Ke(T));if(!(a>Le)||D<.001)!o||o[1]?t.lineTo(n+S,r+C):t.moveTo(n+S,r+C),d=!0;else if(E>Le){let e=Ge(A,E),i=Ge(j,E),s=vl(S,C,b,x,a,-i,Number(u)),c=vl(f,p,m,h,a,-e,Number(u));if(!o||o[1]?t.lineTo(n+s.cx+s.x01,r+s.cy+s.y01):t.moveTo(n+s.cx+s.x01,r+s.cy+s.y01),E<ee&&e===i){let e=He(c.y01,c.x01);!o||o[2]?t.arc(n+s.cx,r+s.cy,E,He(s.y01,s.x01),e,!u):t.moveTo(n+s.cx+Ue(e),r+s.cy+Ke(e))}else !o||o[2]?(i>0&&t.arc(n+s.cx,r+s.cy,i,He(s.y01,s.x01),He(s.y11,s.x11),!u),t.arc(n,r,a,He(s.cy+s.y11,s.cx+s.x11),He(c.cy+c.y11,c.cx+c.x11),u),e>0&&t.arc(n+c.cx,r+c.cy,e,He(c.y11,c.x11),He(c.y01,c.x01),!u)):e>0?t.moveTo(n+c.cx+e*Ue(He(c.y01,c.x01)),r+c.cy+e*Ke(He(c.y01,c.x01))):t.moveTo(n+m,r+h)}else !o||o[1]?t.lineTo(n+S,r+C):t.moveTo(n+S,r+C),!o||o[2]?t.arc(n,r,a,O,k,u):t.moveTo(n+a*Ue(k),r+a*Ke(k))}return o?o[3]&&t.lineTo(n+i*Ue(s),r+i*Ke(s)):t.closePath(),d}class xl{static GetCanvas(){try{return xl.canvas||=B.global.createCanvas({}),xl.canvas}catch{return null}}static GetCtx(){return xl.ctx||=xl.GetCanvas().getContext(\`2d\`),xl.ctx}}class Sl extends Tt{static getInstance(){return Sl._instance||=new Sl,Sl._instance}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;let n=xl.GetCanvas(),r=xl.GetCtx();if(n.width=t,n.height=1,!r)return;if(r.translate(0,0),!r)throw Error(\`获取ctx发生错误\`);let i=r.createLinearGradient(0,0,t,0);e.forEach((e=>{i.addColorStop(e[0],e[1])})),r.fillStyle=i,r.fillRect(0,0,t,1),this.rgbaSet=r.getImageData(0,0,t,1).data}getColor(e){let t=this.rgbaSet.slice(4*e,4*e+4);return\`rgba(\${t[0]}, \${t[1]}, \${t[2]}, \${t[3]/255})\`}GetOrCreate(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:100,o=\`\${e}\${t}\${n}\${r}\`;i.forEach((e=>o+=e.join())),o+=a;let s=this.dataMap.get(o);return s||(s={data:new Sl(i,a),timestamp:[]},this.addLimitedTimestamp(s,Date.now(),{}),this.dataMap.set(o,s)),this.clearCache(this.dataMap,this.cacheParams),s.data}}class Cl{static GetSize(e){for(let t=0;t<Cl.ImageSize.length;t++)if(Cl.ImageSize[t]>=e)return Cl.ImageSize[t];return e}static Get(e,t,n,r,i,a,o){let s=Cl.GenKey(e,t,n,r,i),c=Cl.cache[s];if(!c||c.length===0)return null;for(let e=0;e<c.length;e++)if(c[e].width>=a&&c[e].height>=o)return c[e].pattern;return null}static Set(e,t,n,r,i,a,o,s){let c=Cl.GenKey(e,t,n,r,i);Cl.cache[c]?Cl.cache[c].push({width:o,height:s,pattern:a}):Cl.cache[c]=[{width:o,height:s,pattern:a}]}static GenKey(e,t,n,r,i){return\`\${t},\${n},\${r},\${i},\${e.join()}\`}}Cl.cache={},Cl.ImageSize=[20,40,80,160,320,640,1280,2560];let wl=Symbol.for(\`ArcRenderContribution\`),Tl=Symbol.for(\`AreaRenderContribution\`),El=Symbol.for(\`GroupRenderContribution\`),Dl=Symbol.for(\`PathRenderContribution\`),Ol=Symbol.for(\`PolygonRenderContribution\`),kl=Symbol.for(\`RectRenderContribution\`),Al=Symbol.for(\`SymbolRenderContribution\`),jl=Symbol.for(\`TextRenderContribution\`),Ml=Symbol.for(\`InteractiveSubRenderContribution\`);function Nl(e,t){return e===\`end\`||e===\`right\`?-t:e===\`center\`?-t/2:0}function Pl(e,t,n){return e===\`middle\`?-t/2:e===\`top\`?0:e===\`bottom\`?(arguments.length>3&&arguments[3]!==void 0?arguments[3]:0)-t:e&&e!==\`alphabetic\`?0:(n||=t,-(t-n)/2-.79*n)}function Fl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Il(e,t,n){let r=n[0],i=n[1],a=n[2],o,s,c,l,u,d,f,p,m,h,g,_;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],c=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],m=t[8],h=t[9],g=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=f,e[7]=p,e[8]=m,e[9]=h,e[10]=g,e[11]=_,e[12]=o*r+u*i+m*a+t[12],e[13]=s*r+d*i+h*a+t[13],e[14]=c*r+f*i+g*a+t[14],e[15]=l*r+p*i+_*a+t[15]),e}function Ll(e,t){e[0]=t.a,e[1]=t.b,e[2]=0,e[3]=0,e[4]=t.c,e[5]=t.d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t.e,e[13]=t.f,e[14]=0,e[15]=1}function Rl(e,t,n){let r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],h=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],x=n[2],S=n[3];return e[0]=y*r+b*s+x*d+S*h,e[1]=y*i+b*c+x*f+S*g,e[2]=y*a+b*l+x*p+S*_,e[3]=y*o+b*u+x*m+S*v,y=n[4],b=n[5],x=n[6],S=n[7],e[4]=y*r+b*s+x*d+S*h,e[5]=y*i+b*c+x*f+S*g,e[6]=y*a+b*l+x*p+S*_,e[7]=y*o+b*u+x*m+S*v,y=n[8],b=n[9],x=n[10],S=n[11],e[8]=y*r+b*s+x*d+S*h,e[9]=y*i+b*c+x*f+S*g,e[10]=y*a+b*l+x*p+S*_,e[11]=y*o+b*u+x*m+S*v,y=n[12],b=n[13],x=n[14],S=n[15],e[12]=y*r+b*s+x*d+S*h,e[13]=y*i+b*c+x*f+S*g,e[14]=y*a+b*l+x*p+S*_,e[15]=y*o+b*u+x*m+S*v,e}function zl(e,t,n){let r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o||=1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e}class Bl{constructor(){this.pools=[]}static identity(e){return Fl(e)}allocate(){if(!this.pools.length)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];let e=this.pools.pop();return Bl.identity(e),e}allocateByObj(e){let t;t=this.pools.length?this.pools.pop():[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let n=0;n<t.length;n++)t[n]=e[n];return t}free(e){e&&this.pools.push(e)}get length(){return this.pools.length}release(){this.pools=[]}}let Vl=new class{constructor(){this.pools=[]}allocate(e,t,n,r,i,a){if(!this.pools.length)return new wt(e,t,n,r,i,a);let o=this.pools.pop();return o.a=e,o.b=t,o.c=n,o.d=r,o.e=i,o.f=a,o}allocateByObj(e){if(!this.pools.length)return new wt(e.a,e.b,e.c,e.d,e.e,e.f);let t=this.pools.pop();return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t}free(e){this.pools.push(e)}get length(){return this.pools.length}release(){this.pools=[]}},Hl=new Bl;var Ul=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Wl=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Gl=function(e,t){return function(n,r){t(n,r,e)}};function Kl(e,t,n){let{x:r=n.x,y:i=n.y,z:a=n.z,dx:o=n.dx,dy:s=n.dy,dz:c=n.dz,scaleX:l=n.scaleX,scaleY:u=n.scaleY,scaleZ:d=n.scaleZ,alpha:f=n.alpha,beta:p=n.beta,angle:m=n.angle,anchor3d:h=t.attribute.anchor,anchor:g}=t.attribute,_=[0,0,0];if(h){if(typeof h[0]==\`string\`){let e=parseFloat(h[0])/100,n=t.AABBBounds;_[0]=n.x1+(n.x2-n.x1)*e}else _[0]=h[0];if(typeof h[1]==\`string\`){let e=parseFloat(h[1])/100,n=t.AABBBounds;_[1]=n.x1+(n.x2-n.x1)*e}else _[1]=h[1];_[2]=h[2]??0}if(Fl(e),Il(e,e,[r+o,i+s,a+c]),Il(e,e,[_[0],_[1],_[2]]),function(e,t,n){let r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],u=t[9],d=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+u*r,e[6]=s*i+d*r,e[7]=c*i+f*r,e[8]=l*i-a*r,e[9]=u*i-o*r,e[10]=d*i-s*r,e[11]=f*i-c*r}(e,e,p),function(e,t,n){let r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[8],u=t[9],d=t[10],f=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*r,e[1]=o*i-u*r,e[2]=s*i-d*r,e[3]=c*i-f*r,e[8]=a*r+l*i,e[9]=o*r+u*i,e[10]=s*r+d*i,e[11]=c*r+f*i}(e,e,f),Il(e,e,[-_[0],-_[1],_[2]]),function(e,t,n){let r=n[0],i=n[1],a=n[2];e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(e,e,[l,u,d]),m){let n=Hl.allocate(),r=[0,0];if(g){if(typeof h[0]==\`string\`){let e=parseFloat(h[0])/100,n=t.AABBBounds;r[0]=n.x1+(n.x2-n.x1)*e}else r[0]=h[0];if(typeof h[1]==\`string\`){let e=parseFloat(h[1])/100,n=t.AABBBounds;r[1]=n.x1+(n.x2-n.x1)*e}else r[1]=h[1]}Il(n,n,[r[0],r[1],0]),function(e,t,n){let r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],f=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+u*r,e[2]=s*i+d*r,e[3]=c*i+f*r,e[4]=l*i-a*r,e[5]=u*i-o*r,e[6]=d*i-s*r,e[7]=f*i-c*r}(n,n,m),Il(n,n,[-r[0],-r[1],0]),Rl(e,e,n)}}let ql=class{constructor(e){this.creator=e,this.hooks={onAttributeUpdate:new Xn([\`graphic\`]),onSetStage:new Xn([\`graphic\`,\`stage\`]),onRemove:new Xn([\`graphic\`]),onRelease:new Xn([\`graphic\`]),onAddIncremental:new Xn([\`graphic\`,\`group\`,\`stage\`]),onClearIncremental:new Xn([\`graphic\`,\`group\`,\`stage\`]),beforeUpdateAABBBounds:new Xn([\`graphic\`,\`stage\`,\`willUpdate\`,\`aabbBounds\`]),afterUpdateAABBBounds:new Xn([\`graphic\`,\`stage\`,\`aabbBounds\`,\`globalAABBBounds\`,\`selfChange\`]),clearAABBBounds:new Xn([\`graphic\`,\`stage\`,\`aabbBounds\`])},this.tempAABBBounds1=new St,this.tempAABBBounds2=new St}onAttributeUpdate(e){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(e)}onSetStage(e,t){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(e,t)}onRemove(e){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(e)}onRelease(e){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(e)}onAddIncremental(e,t,n){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(e,t,n)}onClearIncremental(e,t){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(e,t)}beforeUpdateAABBBounds(e,t,n,r){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(e,t,n,r)}afterUpdateAABBBounds(e,t,n,r,i){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(e,t,n,r,i)}clearAABBBounds(e,t,n){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(e,t,n)}updatePathProxyAABBBounds(e,t){let n=typeof t.pathProxy==\`function\`?t.pathProxy(t.attribute):t.pathProxy;if(!n)return!1;let r=new or(e);return Or(n.commandList,r,0,0),!0}updateHTMLTextAABBBounds(e,t,n,r){let{textAlign:i,textBaseline:a}=e;if(e.forceBoundsHeight!=null){let t=S(e.forceBoundsHeight)?e.forceBoundsHeight:e.forceBoundsHeight(),r=Pl(a,t,t);n.set(n.x1,r,n.x2,r+t)}if(e.forceBoundsWidth!=null){let t=S(e.forceBoundsWidth)?e.forceBoundsWidth:e.forceBoundsWidth(),r=Nl(i,t);n.set(r,n.y1,r+t,n.y2)}}combindShadowAABBBounds(e,t){if(t&&t.shadowRoot){let n=t.shadowRoot.AABBBounds;e.union(n)}}transformAABBBounds(e,t,n,r,i){if(!t.empty()){let{scaleX:i=n.scaleX,scaleY:a=n.scaleY,stroke:o=n.stroke,shadowBlur:s=n.shadowBlur,lineWidth:c=n.lineWidth,pickStrokeBuffer:l=n.pickStrokeBuffer,strokeBoundsBuffer:u=n.strokeBoundsBuffer}=e,d=this.tempAABBBounds1,f=this.tempAABBBounds2;if(o&&c&&(gc(d,(c+l)/Math.abs(i+a),r,u),t.union(d),d.setValue(f.x1,f.y1,f.x2,f.y2)),s){let{shadowOffsetX:r=n.shadowOffsetX,shadowOffsetY:o=n.shadowOffsetY}=e;gc(d,s/Math.abs(i+a)*2,!1,u+1),d.translate(r,o),t.union(d)}}if(this.combindShadowAABBBounds(t,i),t.empty())return;let a=!0,o=i.transMatrix;i&&i.isContainer&&(a=!(o.a===1&&o.b===0&&o.c===0&&o.d===1&&o.e===0&&o.f===0)),a&&bt(t,t,o)}validCheck(e,t,n,r){if(!r||e.forceBoundsHeight!=null||e.forceBoundsWidth!=null||r.shadowRoot||r.isContainer)return!0;let{visible:i=t.visible}=e;return!(!r.valid||!i)||(n.empty()||(r.parent&&n.transformWithMatrix(r.parent.globalTransMatrix),B.graphicService.clearAABBBounds(r,r.stage,n),n.clear()),!1)}updateTempAABBBounds(e){let t=this.tempAABBBounds1,n=this.tempAABBBounds2;return t.setValue(e.x1,e.y1,e.x2,e.y2),n.setValue(e.x1,e.y1,e.x2,e.y2),{tb1:t,tb2:n}}};ql=Ul([R(),Gl(0,L(Rc)),Wl(\`design:paramtypes\`,[Object])],ql);let Jl=(e,t,n)=>{let{outerBorder:r,shadowBlur:i=t.shadowBlur}=e;if(r){let e=t.outerBorder,{distance:a=e.distance,lineWidth:o=e.lineWidth}=r;n.expand(a+(i+o)/2)}return n};class Yl{constructor(e,t,n){this.fontFamily=e,this.textOptions=t,this.textMeasure=n}LayoutBBox(e,t,n,r){if(e.xOffset=t===\`left\`||t===\`start\`?0:t===\`center\`?e.width/-2:t===\`right\`||t===\`end\`?-e.width:0,n===\`top\`)e.yOffset=0;else if(n===\`middle\`)e.yOffset=e.height/-2;else if(n===\`alphabetic\`){let t=.79;if(r.length===1){let e=r[0];t=e.ascent/(e.ascent+e.descent)}e.yOffset=e.height*-t}else e.yOffset=-e.height;return e}GetLayoutByLines(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:\`\`,a=arguments.length>5?arguments[5]:void 0,{lineWidth:o,suffixPosition:s=\`end\`,measureMode:c=ir.actualBounding,keepCenterInLine:l=!1}=(arguments.length>6?arguments[6]:void 0)??{};e=e.map((e=>e.toString()));let u=[],d=[0,0];if(typeof o==\`number\`&&o!==1/0){let t;for(let n=0,r=e.length;n<r;n++){let r=this.textMeasure.measureTextPixelADscentAndWidth(e[n],this.textOptions,c),d=e[n].toString();if(r.width>o){let r=this.textMeasure.clipTextWithSuffix(e[n],this.textOptions,o,i,a,s);d=r.str,t=r.width}else t=r.width;u.push({str:d,width:t,ascent:r.ascent,descent:r.descent,keepCenterInLine:l})}d[0]=o}else{let t,n,r=0;for(let i=0,a=e.length;i<a;i++){n=e[i];let a=this.textMeasure.measureTextPixelADscentAndWidth(e[i],this.textOptions,c);t=a.width,r=Math.max(r,t),u.push({str:n,width:t,ascent:a.ascent,descent:a.descent,keepCenterInLine:l})}d[0]=r}d[1]=u.length*r,d[0]=u.reduce(((e,t)=>Math.max(e,t.width)),0);let f={xOffset:0,yOffset:0,width:d[0],height:d[1]};return this.LayoutBBox(f,t,n,u),this.layoutWithBBox(f,u,t,n,r)}layoutWithBBox(e,t,n,r,i){let a=[0,0],o=t.length*i;r===\`top\`||(r===\`middle\`?a[1]=(e.height-o)/2:r===\`bottom\`&&(a[1]=e.height-o));for(let o=0;o<t.length;o++)this.lineOffset(e,t[o],n,r,i,a);return{bbox:e,lines:t,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:i,textAlign:n,textBaseline:r}}lineOffset(e,t,n,r,i,a){if(n===\`left\`||n===\`start\`?t.leftOffset=0:n===\`center\`?t.leftOffset=(e.width-t.width)/2:n!==\`right\`&&n!==\`end\`||(t.leftOffset=e.width-t.width),t.topOffset=i/2+(t.ascent-t.descent)/2+a[1],!t.keepCenterInLine){let e=t.ascent+t.descent+0;if(e<i-0&&(r===\`bottom\`?t.topOffset+=(i-e)/2:r===\`top\`&&(t.topOffset-=(i-e)/2)),r===\`alphabetic\`){let e=i/(t.ascent+t.descent);t.topOffset=i/2+(t.ascent-t.descent)/2*e+a[1]}}return a[1]+=i,t}}let Xl=[\`text\`,\`maxLineWidth\`,\`maxWidth\`,\`textAlign\`,\`textBaseline\`,\`heightLimit\`,\`lineClamp\`,\`fontSize\`,\`fontFamily\`,\`fontWeight\`,\`ellipsis\`,\`lineHeight\`,\`direction\`,\`wordBreak\`,\`heightLimit\`,\`lineClamp\`,...Wc],Zl=class e extends Xc{get font(){let e=this.getGraphicTheme();return this._font||=vt(this.attribute,e),this._font}get clipedText(){let e=this.attribute,t=this.getGraphicTheme(),n=this.getMaxWidth(t);return Number.isFinite(n)?(this.tryUpdateAABBBounds(),this.cache.clipedText):(e.text??t.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){let e=this.getGraphicTheme(),t=this.attribute,n=this.getMaxWidth(e);if(!Number.isFinite(n))return!1;let{text:r}=this.attribute;if(this.tryUpdateAABBBounds(),this.cache?.layoutData?.lines){let e=\`\`;return this.cache.layoutData.lines.forEach((t=>{e+=t.str})),(Array.isArray(r)?r.join(\`\`):r)!==e}return t.direction===\`vertical\`&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map((e=>e.text)).join(\`\`)!==t.text.toString():this.clipedText!=null&&this.clipedText!==t.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace===\`normal\`}constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{text:\`\`,fontSize:16}),this.type=\`text\`,this.numberType=Ic,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{text:e}=this.attribute;return y(e)?!e.every((e=>e==null||e===\`\`)):e!=null&&e!==\`\`}getGraphicTheme(){return Qa(this).text}doUpdateOBBBounds(){let t=this.getGraphicTheme();this._OBBBounds.clear();let n=this.attribute,{angle:r=t.angle}=n;if(!r){let e=this.AABBBounds;return this._OBBBounds.setValue(e.x1,e.y1,e.x2,e.y2),this._OBBBounds}this.obbText||=new e({}),this.obbText.setAttributes(Object.assign(Object.assign({},n),{angle:0}));let i=this.obbText.AABBBounds,{x:a,y:o}=n,s={x:(i.x1+i.x2)/2,y:(i.y1+i.y2)/2},c=ft(s,r,{x:a,y:o});return this._OBBBounds.copy(i),this._OBBBounds.translate(c.x-s.x,c.y-s.y),this._OBBBounds.angle=r,this._OBBBounds}updateAABBBounds(e,t,n){let{text:r=t.text}=this.attribute;Array.isArray(r)?this.updateMultilineAABBBounds(r):this.updateSingallineAABBBounds(r);let{tb1:i}=B.graphicService.updateTempAABBBounds(n),{scaleX:a=t.scaleX,scaleY:o=t.scaleY,shadowBlur:s=t.shadowBlur,strokeBoundsBuffer:c=t.strokeBoundsBuffer}=e;return s&&(gc(i,s/Math.abs(a+o),!0,c),n.union(i)),B.graphicService.combindShadowAABBBounds(n,this),e.forceBoundsHeight==null&&e.forceBoundsWidth==null||B.graphicService.updateHTMLTextAABBBounds(e,t,n),bt(n,n,this.transMatrix),n}updateSingallineAABBBounds(e){this.updateMultilineAABBBounds([e]);let t=this.cache.layoutData;if(t&&t.lines&&t.lines.length){let e=t.lines[0];this.cache.clipedText=e.str,this.cache.clipedWidth=e.width}return this._AABBBounds}updateMultilineAABBBounds(e){let t=this.getGraphicTheme(),{direction:n=t.direction,underlineOffset:r=t.underlineOffset}=this.attribute,i=n===\`horizontal\`?this.updateHorizontalMultilineAABBBounds(e):this.updateVerticalMultilineAABBBounds(e);return n===\`horizontal\`&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),i}guessLineHeightBuf(e){return e?.1*e:0}updateHorizontalMultilineAABBBounds(e){let t=this.getGraphicTheme(),n=this.attribute,{fontFamily:r=t.fontFamily,textAlign:i=t.textAlign,textBaseline:a=t.textBaseline,fontSize:o=t.fontSize,fontWeight:s=t.fontWeight,ellipsis:c=t.ellipsis,maxLineWidth:l,stroke:u=t.stroke,wrap:d=t.wrap,measureMode:f=t.measureMode,lineWidth:p=t.lineWidth,whiteSpace:m=t.whiteSpace,suffixPosition:h=t.suffixPosition,ignoreBuf:g=t.ignoreBuf,keepCenterInLine:_=t.keepCenterInLine}=n,v=g?0:this.guessLineHeightBuf(o),y=this.getLineHeight(n,t,v);if(m===\`normal\`||d)return this.updateWrapAABBBounds(e);if(!this.shouldUpdateShape()&&this.cache?.layoutData){let e=this.cache.layoutData.bbox;return this._AABBBounds.set(e.xOffset,e.yOffset,e.xOffset+e.width,e.yOffset+e.height),u&&this._AABBBounds.expand(p/2),this._AABBBounds}let b=B.graphicUtil.textMeasure,x=new Yl(r,{fontSize:o,fontWeight:s,fontFamily:r,lineHeight:y},b).GetLayoutByLines(e,i,a,y,!0===c?t.ellipsis:c||void 0,!1,{lineWidth:l,suffixPosition:h,measureMode:f,keepCenterInLine:_}),{bbox:S}=x;return this.cache.layoutData=x,this.clearUpdateShapeTag(),this._AABBBounds.set(S.xOffset,S.yOffset,S.xOffset+S.width,S.yOffset+S.height),u&&this._AABBBounds.expand(p/2),this._AABBBounds}updateWrapAABBBounds(e){let t=this.getGraphicTheme(),{fontFamily:n=t.fontFamily,textAlign:r=t.textAlign,textBaseline:i=t.textBaseline,fontSize:a=t.fontSize,ellipsis:o=t.ellipsis,maxLineWidth:s,stroke:c=t.stroke,lineWidth:l=t.lineWidth,wordBreak:u=t.wordBreak,fontWeight:d=t.fontWeight,ignoreBuf:f=t.ignoreBuf,measureMode:p=t.measureMode,suffixPosition:m=t.suffixPosition,heightLimit:h=0,lineClamp:g,keepCenterInLine:_=t.keepCenterInLine}=this.attribute,v=f?0:this.guessLineHeightBuf(a),b=this.getLineHeight(this.attribute,t,v);if(!this.shouldUpdateShape()&&this.cache?.layoutData){let e=this.cache.layoutData.bbox;return this._AABBBounds.set(e.xOffset,e.yOffset,e.xOffset+e.width,e.yOffset+e.height),c&&this._AABBBounds.expand(l/2),this._AABBBounds}let x=B.graphicUtil.textMeasure,S={fontSize:a,fontWeight:d,fontFamily:n,lineHeight:b},C=new Yl(n,S,x),w=y(e)?e.map((e=>e.toString())):[e.toString()],T=[],E=[0,0],D=1/0;if(h>0&&(D=Math.max(Math.floor(h/b),1)),g&&(D=Math.min(D,g)),typeof s==\`number\`&&s!==1/0){if(s>0)for(let e=0;e<w.length;e++){let t=w[e],n=!0;if(e===D-1){let n=x.clipTextWithSuffix(t,S,s,o,!1,m,e!==w.length-1),r=x.measureTextPixelADscentAndWidth(n.str,S,p);T.push({str:n.str,width:n.width,ascent:r.ascent,descent:r.descent,keepCenterInLine:_});break}let r=x.clipText(t,S,s,u!==\`break-all\`,u===\`keep-all\`);if(t!==\`\`&&r.str===\`\`||r.wordBreaked){if(o){let e=x.clipTextWithSuffix(t,S,s,o,!1,m);r.str=e.str??\`\`,r.width=e.width??0}else r.str=\`\`,r.width=0;n=!1}let i=x.measureTextPixelADscentAndWidth(r.str,S,p);T.push({str:r.str,width:r.width,ascent:i.ascent,descent:i.descent,keepCenterInLine:_});let a=r.str.length;if(!r.wordBreaked||t!==\`\`&&r.str===\`\`||(n=!0,a=r.wordBreaked),r.str.length!==t.length&&n){let n=t.substring(a);u===\`keep-all\`&&(n=n.replace(/^\\s+/g,\`\`)),w.splice(e+1,0,n)}}let e=0;T.forEach((t=>{e=Math.max(e,t.width)})),E[0]=e}else{let e,t,n=0;for(let r=0,i=w.length;r<i;r++){if(r===D-1){let e=x.clipTextWithSuffix(w[r],S,s,o,!1,m),t=x.measureTextPixelADscentAndWidth(e.str,S,p);T.push({str:e.str,width:e.width,ascent:t.ascent,descent:t.descent,keepCenterInLine:_}),n=Math.max(n,e.width);break}t=w[r],e=x.measureTextWidth(t,S),n=Math.max(n,e);let i=x.measureTextPixelADscentAndWidth(t,S,p);T.push({str:t,width:e,ascent:i.ascent,descent:i.descent,keepCenterInLine:_})}E[0]=n}E[1]=T.length*b;let O={xOffset:0,yOffset:0,width:E[0],height:E[1]};C.LayoutBBox(O,r,i,T);let k=C.layoutWithBBox(O,T,r,i,b);return this.cache.layoutData=k,this.clearUpdateShapeTag(),this._AABBBounds.set(O.xOffset,O.yOffset,O.xOffset+O.width,O.yOffset+O.height),c&&this._AABBBounds.expand(l/2),this._AABBBounds}updateVerticalMultilineAABBBounds(t){let n=this.getGraphicTheme(),r=B.graphicUtil.textMeasure,i,a=this.attribute,{maxLineWidth:o=n.maxLineWidth,ellipsis:s=n.ellipsis,fontFamily:c=n.fontFamily,fontSize:l=n.fontSize,fontWeight:u=n.fontWeight,stroke:d=n.stroke,lineWidth:f=n.lineWidth,verticalMode:p=n.verticalMode,suffixPosition:m=n.suffixPosition}=a,h=this.getLineHeight(a,n,0),{textAlign:g=n.textAlign,textBaseline:_=n.textBaseline}=a;if(!p){let t=g;g=e.baselineMapAlign[_]??\`left\`,_=e.alignMapBaseline[t]??\`top\`}if(i=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach((e=>{let t=e.reduce(((e,t)=>e+t.width),0);i=We(t,i)}));let e=Nl(g,i),t=this.cache.verticalList.length*h,n=Pl(_,t,l);return this._AABBBounds.set(n,e,n+t,e+i),d&&this._AABBBounds.expand(f/2),this._AABBBounds}let v=t.map((e=>function(e){let t=[],n=0,r=\`\`;for(let i=0;i<e.length;i++)Sc(e[i])?n?r+=e[i]:(n=1,r=e[i]):(n&&=(t.push({text:r,direction:yc.VERTICAL}),r=\`\`,0),t.push({text:e[i],direction:yc.HORIZONTAL}));return r&&t.push({text:r,direction:yc.VERTICAL}),t}(e.toString())));v.forEach(((e,t)=>{if(Number.isFinite(o))if(s){let a=!0===s?n.ellipsis:s,d=r.clipTextWithSuffixVertical(e,{fontSize:l,fontWeight:u,fontFamily:c},o,a,!1,m);v[t]=d.verticalList,i=d.width}else{let n=r.clipTextVertical(e,{fontSize:l,fontWeight:u,fontFamily:c},o,!1);v[t]=n.verticalList,i=n.width}else i=0,e.forEach((e=>{let t=e.direction===yc.HORIZONTAL?l:r.measureTextWidth(e.text,{fontSize:l,fontWeight:u,fontFamily:c});i+=t,e.width=t}))})),this.cache.verticalList=v,this.clearUpdateShapeTag(),this.cache.verticalList.forEach((e=>{let t=e.reduce(((e,t)=>e+t.width),0);i=We(t,i)}));let y=Nl(g,i),b=this.cache.verticalList.length*h,x=Pl(_,b,l);return this._AABBBounds.set(x,y,x+b,y+i),d&&this._AABBBounds.expand(f/2),this._AABBBounds}getMaxWidth(e){let t=this.attribute;return t.maxLineWidth??t.maxWidth??e.maxWidth}getLineHeight(e,t,n){return Io(e.lineHeight,e.fontSize||t.fontSize)??(e.fontSize||t.fontSize)+n}needUpdateTags(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xl;return super.needUpdateTags(e,t)}needUpdateTag(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xl;return super.needUpdateTag(e,t)}_interpolate(e,t,n,r,i){e===\`text\`&&(i.text=r)}clone(){return new e(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return e.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return e.baselineMapAlign}getAlignMapBaseline(){return e.alignMapBaseline}};function Ql(e){return new Zl(e)}Zl.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},Yc),Zl.baselineMapAlign={top:\`left\`,bottom:\`right\`,middle:\`center\`},Zl.alignMapBaseline={left:\`top\`,right:\`bottom\`,center:\`middle\`};let $l=[\`symbolType\`,\`size\`,...Wc],eu=class e extends Xc{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{symbolType:\`circle\`}),this.type=\`symbol\`,this.numberType=Fc}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=null;try{r=new Path2D}catch{return null}let i=this.getParsedPath();if(!i)return null;i.draw(r,n,e,t)}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{size:e}=this.attribute;return y(e)?e.length===2&&e.every(this._validNumber):this._validNumber(e)}doUpdateParsedPath(){let{symbolType:e=\`circle\`}=this.attribute;return super.parsePath(e)}getGraphicTheme(){return Qa(this).symbol}updateAABBBounds(e,t,n,r){this.updatePathProxyAABBBounds(n)||(r?this.updateSymbolAABBBoundsImprecise(e,t,n):this.updateSymbolAABBBoundsAccurate(e,t,n));let{tb1:i,tb2:a}=B.graphicService.updateTempAABBBounds(n);((e,t,n)=>{let{outerBorder:r,shadowBlur:i=t.shadowBlur,strokeBoundsBuffer:a=t.strokeBoundsBuffer}=e;if(r){let e=t.outerBorder,{distance:o=e.distance,lineWidth:s=e.lineWidth}=r;gc(n,o+(i+s)/2,!0,a)}})(e,t,i),n.union(i),i.setValue(a.x1,a.y1,a.x2,a.y2);let{lineJoin:o=t.lineJoin}=e;return B.graphicService.transformAABBBounds(e,n,t,o===\`miter\`,this),n}updateSymbolAABBBoundsImprecise(e,t,n){let{size:r=t.size}=e;if(y(r))n.set(-r[0]/2,-r[1]/2,r[0]/2,r[1]/2);else{let e=r/2;n.set(-e,-e,e,e)}return n}updateSymbolAABBBoundsAccurate(e,t,n){let{size:r=t.size}=e;return this.getParsedPath().bounds(r,n),n}needUpdateTags(e){return super.needUpdateTags(e,$l)}needUpdateTag(e){return super.needUpdateTag(e,$l)}toCustomPath(){let e=this.getParsedPath(),t=this.attribute.size,n=y(t)?t:[t,t];return e.path?new pi().fromCustomPath2D(e.path,0,0,n[0],n[1]):new pi().fromString(e.pathStr,0,0,n[0],n[1])}clone(){return new e(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return e.NOWORK_ANIMATE_ATTR}};function tu(e){return new eu(e)}eu.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},Yc);let nu=[\`segments\`,\`points\`,\`curveType\`,\`curveTension\`,...Wc],ru=class e extends Xc{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}),this.type=\`line\`,this.numberType=Ac}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;let{points:e,segments:t}=this.attribute;return t?t.length!==0:!(!e||e.length<=1)}_interpolate(e,t,n,r,i){e===\`points\`&&(i.points=Mo(n,r,t))}getGraphicTheme(){return Qa(this).line}updateAABBBounds(e,t,n){this.updatePathProxyAABBBounds(n)||(e.segments?this.updateLineAABBBoundsBySegments(e,t,n):this.updateLineAABBBoundsByPoints(e,t,n)),B.graphicService.updateTempAABBBounds(n);let{lineJoin:r=t.lineJoin}=e;return B.graphicService.transformAABBBounds(e,n,t,r===\`miter\`,this),n}updateLineAABBBoundsByPoints(e,t,n,r){let{points:i=t.points,connectedType:a}=e,o=n;return i.forEach((e=>{!1===e.defined&&a!==\`connect\`||o.add(e.x,e.y)})),o}updateLineAABBBoundsBySegments(e,t,n,r){let{segments:i=t.segments,connectedType:a}=e,o=n;return i.forEach((e=>{e.points.forEach((e=>{!1===e.defined&&a!==\`connect\`||o.add(e.x,e.y)}))})),o}needUpdateTags(e){return super.needUpdateTags(e,nu)}needUpdateTag(e){return super.needUpdateTag(e,nu)}toCustomPath(){let e=this.attribute,t=new pi,n=e.segments,r=e=>{if(e&&e.length){let n=!0;e.forEach((e=>{!1!==e.defined&&(n?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y),n=!1)}))}};return n&&n.length?n.forEach((e=>{r(e.points)})):e.points&&r(e.points),t}clone(){return new e(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return e.NOWORK_ANIMATE_ATTR}};function iu(e){return new ru(e)}ru.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Yc);let au=[\`width\`,\`x1\`,\`y1\`,\`height\`,\`cornerRadius\`,...Wc];class ou extends Xc{constructor(e){super(e),this.type=\`rect\`,this.numberType=Nc}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return Qa(this).rect}updateAABBBounds(e,t,n){if(!this.updatePathProxyAABBBounds(n)){let{width:t,height:r}=e,{x1:i,y1:a,x:o,y:s}=e;t??=i-o,r??=a-s,(isFinite(t)||isFinite(r)||isFinite(o)||isFinite(s))&&n.set(0,0,t||0,r||0)}let{tb1:r,tb2:i}=B.graphicService.updateTempAABBBounds(n);return Jl(e,t,r),n.union(r),r.setValue(i.x1,i.y1,i.x2,i.y2),B.graphicService.transformAABBBounds(e,n,t,!1,this),n}needUpdateTags(e){return super.needUpdateTags(e,au)}needUpdateTag(e){return super.needUpdateTag(e,au)}toCustomPath(){let{x:e,y:t,width:n,height:r}=(e=>{if(!e)return{x:0,y:0,width:0,height:0};let t=f(e.width)?e.x1-e.x:e.width,n=f(e.height)?e.y1-e.y:e.height,r=0,i=0;return t<0?(r=t,t=-t):Number.isNaN(t)&&(t=0),n<0?(i=n,n=-n):Number.isNaN(n)&&(n=0),{x:r,y:i,width:t,height:n}})(this.attribute),i=new pi;return i.moveTo(e,t),i.rect(e,t,n,r),i}clone(){return new ou(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ou.NOWORK_ANIMATE_ATTR}}function su(e){return new ou(e)}ou.NOWORK_ANIMATE_ATTR=Yc;class cu{constructor(e,t,n,r,i,a,o,s,c,l,u,d,f,p){this.left=e,this.top=t,this.width=n,this.height=r,this.actualHeight=0,this.bottom=t+r,this.right=e+n,this.ellipsis=i,this.wordBreak=a,this.verticalDirection=o,this.lines=[],this.globalAlign=s,this.globalBaseline=c,this.layoutDirection=l,this.directionKey=Hi[this.layoutDirection],this.isWidthMax=u,this.isHeightMax=d,this.singleLine=f,p?(p.clear(),this.icons=p):this.icons=new Map}draw(e,t){let{width:n,height:r}=this.getActualSize(),i=this.isWidthMax?Math.min(this.width,n):this.width||n||0,a=this.isHeightMax?Math.min(this.height,r):this.height||r||0;a=Math.min(a,r);let o=0;switch(this.globalBaseline){case\`top\`:o=0;break;case\`middle\`:o=-a/2;break;case\`bottom\`:o=-a}let s=0;this.globalAlign===\`right\`||this.globalAlign===\`end\`?s=-i:this.globalAlign===\`center\`&&(s=-i/2);let c=this[this.directionKey.height];this.singleLine&&(c=this.lines[0].height+1);let l=!1;if(this.verticalDirection===\`middle\`)if(this.actualHeight>=c&&c!==0)for(let n=0;n<this.lines.length;n++){let{top:r,height:i}=this.lines[n];if(r+i<this[this.directionKey.top]||r+i>this[this.directionKey.top]+c)return l;let a=!1;this.ellipsis&&this.lines[n+1]&&this.lines[n+1].top+this.lines[n+1].height>this[this.directionKey.top]+c&&(a=!0,l=!0),this.lines[n].draw(e,a,this.lines[n][this.directionKey.left]+s,this.lines[n][this.directionKey.top]+o,this.ellipsis,t)}else{let n=Math.floor((c-this.actualHeight)/2);this.layoutDirection===\`vertical\`?s+=n:o+=n;for(let n=0;n<this.lines.length;n++)this.lines[n].draw(e,!1,this.lines[n][this.directionKey.left]+s,this.lines[n][this.directionKey.top]+o,this.ellipsis,t)}else if(this.verticalDirection===\`bottom\`&&this.layoutDirection!==\`vertical\`)for(let n=0;n<this.lines.length;n++){let{top:r,height:i}=this.lines[n],a=c-this.lines[n].top-this.lines[n].height;if(c===0)this.lines[n].draw(e,!1,s,a+o,this.ellipsis,t);else{if(a+i>this[this.directionKey.top]+c||a<this[this.directionKey.top])return l;{let r=!1;this.ellipsis&&this.lines[n+1]&&a-this.lines[n+1].height<this[this.directionKey.top]&&(r=!0,l=!0),this.lines[n].draw(e,r,s,a+o,this.ellipsis,t)}}}else{this.verticalDirection===\`bottom\`&&this.layoutDirection===\`vertical\`&&this.singleLine&&this.isWidthMax&&(s+=this.lines[0].height+1);for(let n=0;n<this.lines.length;n++){this.verticalDirection===\`bottom\`&&this.layoutDirection===\`vertical\`&&(s-=this.lines[n].height+this.lines[n].top);let{top:r,height:i}=this.lines[n];if(c===0)this.lines[n].draw(e,!1,this.lines[n][this.directionKey.left]+s,this.lines[n][this.directionKey.top]+o,this.ellipsis,t);else{if(r+i<this[this.directionKey.top]||r+i>this[this.directionKey.top]+c)return l;{let r=!1;this.ellipsis&&this.lines[n+1]&&this.lines[n+1].top+this.lines[n+1].height>this[this.directionKey.top]+c&&(r=!0,l=!0),this.lines[n].draw(e,r,this.lines[n][this.directionKey.left]+s,this.lines[n][this.directionKey.top]+o,this.ellipsis,t)}}}}return l}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let e=0,t=0;for(let n=0;n<this.lines.length;n++){let r=this.lines[n];r.actualWidth>e&&(e=r.actualWidth),t+=r.height}return{width:this.layoutDirection===\`vertical\`?t:e,height:this.layoutDirection===\`vertical\`?e:t}}getActualSizeWidthEllipsis(){let e=0,t=0,{width:n,height:r}=this.getRawActualSize();this.width,this.height;let i=this[this.directionKey.height];if(this.singleLine&&(i=this.lines[0].height+1),this.verticalDirection===\`middle\`)if(this.actualHeight>=i&&i!==0)for(let n=0;n<this.lines.length;n++){let{top:r,height:a}=this.lines[n];if(!(r+a<this[this.directionKey.top]||r+a>this[this.directionKey.top]+i))if(this.ellipsis&&this.lines[n+1]&&this.lines[n+1].top+this.lines[n+1].height>this[this.directionKey.top]+i){let r=!0===this.ellipsis?\`...\`:this.ellipsis||\`\`,i=this.lines[n].getWidthWithEllips(r);i>e&&(e=i),t+=this.lines[n].height}else this.lines[n].actualWidth>e&&(e=this.lines[n].actualWidth),t+=this.lines[n].height}else{Math.floor((i-this.actualHeight)/2);for(let n=0;n<this.lines.length;n++)this.lines[n].actualWidth>e&&(e=this.lines[n].actualWidth),t+=this.lines[n].height}else if(this.verticalDirection===\`bottom\`)for(let n=0;n<this.lines.length;n++){let{top:r,height:a}=this.lines[n],o=i-this.lines[n].top-this.lines[n].height;if(i===0)this.lines[n].actualWidth>e&&(e=this.lines[n].actualWidth),t+=this.lines[n].height;else if(!(o+a>this[this.directionKey.top]+i||o<this[this.directionKey.top]))if(this.ellipsis&&this.lines[n+1]&&o-this.lines[n+1].height<this[this.directionKey.top]){let r=!0===this.ellipsis?\`...\`:this.ellipsis||\`\`,i=this.lines[n].getWidthWithEllips(r);i>e&&(e=i),t+=this.lines[n].height}else this.lines[n].actualWidth>e&&(e=this.lines[n].actualWidth),t+=this.lines[n].height}else for(let n=0;n<this.lines.length;n++){let{top:r,height:a}=this.lines[n];if(i===0)this.lines[n].actualWidth>e&&(e=this.lines[n].actualWidth),t+=this.lines[n].height;else if(!(r+a<this[this.directionKey.top]||r+a>this[this.directionKey.top]+i))if(this.ellipsis&&this.lines[n+1]&&this.lines[n+1].top+this.lines[n+1].height>this[this.directionKey.top]+i){let r=!0===this.ellipsis?\`...\`:this.ellipsis||\`\`,i=this.lines[n].getWidthWithEllips(r);i>e&&(e=i),t+=this.lines[n].height}else this.lines[n].actualWidth>e&&(e=this.lines[n].actualWidth),t+=this.lines[n].height}return{width:this.layoutDirection===\`vertical\`?t:e,height:this.layoutDirection===\`vertical\`?e:t}}}function lu(e,t,n,r){let i=Math.round(e),a=Math.round(n),o=Math.round(t),s=Math.round(r);return{left:e>i?i:i-.5,top:n>a?a:a-.5,right:o>t?o:o+.5,bottom:s>r?s:s+.5}}class uu{constructor(e,t,n,r){this.fontSize=n.fontSize||16,this.textBaseline=n.textBaseline||\`alphabetic\`,this.ascentDescentMode=r;let i=Io(n.lineHeight,this.fontSize);this.lineHeight=typeof i==\`number\`?i>this.fontSize?i:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;let{ascent:a,height:o,descent:s,width:c}=Xi(e,n,this.ascentDescentMode),l=0,u=0,d=0;this.height>o&&(l=(this.height-o)/2,u=Math.ceil(l),d=Math.floor(l)),this.textBaseline===\`top\`?(this.ascent=l,this.descent=o-l):this.textBaseline===\`bottom\`?(this.ascent=o-l,this.descent=l):this.textBaseline===\`middle\`?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=a+u,this.descent=s+d),this.length=e.length,this.width=c||0,this.text=e||\`\`,this.newLine=t||!1,this.character=n,this.left=0,this.top=0,this.ellipsis=\`normal\`,this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,n.direction===\`vertical\`&&(this.direction=n.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr=\`...\`}updateWidth(){let{width:e}=Xi(this.text,this.character,this.ascentDescentMode);this.width=e,this.direction===\`vertical\`&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(e,t,n,r,i,a,o){if(this.text===\`\`||this.text===\`
\`||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let s=t+n,c=this.text,l=this.left+r;s+=this.top;let u=this.direction;if(this.verticalEllipsis)c=this.ellipsisStr,u=\`vertical\`,s-=this.ellipsisWidth/2;else{if(this.ellipsis===\`hide\`)return;if(this.ellipsis===\`add\`)c+=this.ellipsisStr,a!==\`right\`&&a!==\`end\`||(l-=this.ellipsisWidth);else if(this.ellipsis===\`replace\`){let e=qi(c,(u===\`vertical\`?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,c.length-1);if(c=c.slice(0,e),c+=this.ellipsisStr,a===\`right\`||a===\`end\`){let{width:t}=Xi(this.text.slice(e),this.character,this.ascentDescentMode);u===\`vertical\`||(l-=this.ellipsisWidth-t)}}}let d=lu(l,l+(this.widthOrigin||this.width),t,t+o);return Object.assign(Object.assign({},d),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(e,t,n,r,i,a,o){let s=t+n,c=this.text,l=this.left+r;s+=this.top;let u=this.direction;if(this.verticalEllipsis)c=this.ellipsisStr,u=\`vertical\`,s-=this.ellipsisWidth/2;else{if(this.ellipsis===\`hide\`)return;if(this.ellipsis===\`add\`)c+=this.ellipsisStr,a!==\`right\`&&a!==\`end\`||(l-=this.ellipsisWidth);else if(this.ellipsis===\`replace\`){let e=qi(c,(u===\`vertical\`?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,c.length-1);if(c=c.slice(0,e),c+=this.ellipsisStr,a===\`right\`||a===\`end\`){let{width:t}=Xi(this.text.slice(e),this.character,this.ascentDescentMode);u===\`vertical\`||(l-=this.ellipsisWidth-t)}}}switch(this.character.script){case\`super\`:s-=this.ascent*(1/3);break;case\`sub\`:s+=this.descent/2}u===\`vertical\`&&(e.save(),e.rotateAbout(Math.PI/2,l,s),e.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),e.translate(l,s),l=0,s=0);let{lineWidth:d=1}=this.character;if(this.character.stroke&&d&&e.strokeText(c,l,s),this.character.fill&&e.fillText(c,l,s),this.character.fill){if(this.character.lineThrough||this.character.underline){if(this.character.underline){let t=1+s,n=lu(l,l+(this.widthOrigin||this.width),t,t+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));e.fillRect(n.left,1+s,n.right-n.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){let t=1+s-this.ascent/2,n=lu(l,l+(this.widthOrigin||this.width),t,t+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));e.fillRect(n.left,1+s-this.ascent/2,n.right-n.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if(this.character.textDecoration===\`underline\`){let t=1+s,n=lu(l,l+(this.widthOrigin||this.width),t,t+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));e.fillRect(n.left,1+s,n.right-n.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if(this.character.textDecoration===\`line-through\`){let t=1+s-this.ascent/2,n=lu(l,l+(this.widthOrigin||this.width),t,t+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));e.fillRect(n.left,1+s-this.ascent/2,n.right-n.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}u===\`vertical\`&&e.restore()}getWidthWithEllips(e){let t=this.text,n=e===\`vertical\`?this.height:this.width;if(this.ellipsis===\`hide\`)return n;if(this.ellipsis===\`add\`)return n+this.ellipsisWidth;if(this.ellipsis===\`replace\`){let e=qi(t,n-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,t.length-1);t=t.slice(0,e),t+=this.ellipsisStr;let{width:r}=Xi(this.text.slice(e),this.character,this.ascentDescentMode);return n+this.ellipsisWidth-r}return n}}let du=[\`width\`,\`height\`,\`image\`,...Wc];class fu extends Xc{constructor(e){super(e),this.type=\`image\`,this.numberType=kc,this.loadImage(this.attribute.image)}getImageElement(){let{image:e}=this.attribute;if(!e||!this.resources)return null;let t=this.resources.get(e);return t.state===\`success\`?t.data:null}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){return this.attribute.repeatX??\`no-repeat\`}set repeatX(e){this.attribute.repeatX===e&&(this.attribute.repeatX=e)}get repeatY(){return this.attribute.repeatY??\`no-repeat\`}set repeatY(e){this.attribute.repeatY===e&&(this.attribute.repeatY=e)}get image(){return this.attribute.image}set image(e){e!==this.attribute.image&&(this.attribute.image=e,this.loadImage(this.attribute.image))}imageLoadSuccess(e,t,n){super.imageLoadSuccess(e,t,(()=>{this.successCallback&&this.successCallback()})),this.addUpdateBoundTag()}imageLoadFail(e,t){super.imageLoadFail(e,(()=>{this.failCallback&&this.failCallback()}))}setAttributes(e,t,n){return e.image&&this.loadImage(e.image),super.setAttributes(e,t,n)}setAttribute(e,t,n,r){return e===\`image\`&&this.loadImage(t),super.setAttribute(e,t,n,r)}getGraphicTheme(){return Qa(this).image}updateAABBBounds(e,t,n){if(!this.updatePathProxyAABBBounds(n)){let{maxWidth:r=t.maxWidth,maxHeight:i=t.maxHeight}=e,{width:a,height:o}=e;if(a==null||o==null){let e=this.getImageElement();if(e){let t=e.width,n=e.height;if(a!=null)o=a*(n/t);else if(o!=null)a=o*(t/n);else{let e=t/n;e>r/i?(a=r,o=r/e):(o=i,a=i*e)}}else a=r,o=i}this._actualWidth=a,this._actualHeight=o,n.set(0,0,a,o)}let{tb1:r,tb2:i}=B.graphicService.updateTempAABBBounds(n);return Jl(e,t,r),n.union(r),r.setValue(i.x1,i.y1,i.x2,i.y2),B.graphicService.transformAABBBounds(e,n,t,!1,this),n}getDefaultAttribute(e){return Ii[e]}needUpdateTags(e){return super.needUpdateTags(e,du)}needUpdateTag(e){return super.needUpdateTag(e,du)}clone(){return new fu(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return fu.NOWORK_ANIMATE_ATTR}}fu.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},Yc);class pu extends fu{constructor(e){if(super(e),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],e.backgroundShowMode===\`always\`&&(this._hovered=!0),e.margin){let t=Do(e.margin);this._marginArray=typeof t==\`number\`?[t,t,t,t]:t}this.onBeforeAttributeUpdate=(e,t,n)=>{if(y(n)&&n.indexOf(\`margin\`)!==-1||n===\`margin\`)if(t.margin){let e=Do(t.margin);this._marginArray=typeof e==\`number\`?[e,e,e,e]:e}else this._marginArray=[0,0,0,0]}}get width(){return(this.attribute.width??0)+this._marginArray[1]+this._marginArray[3]}get height(){return(this.attribute.height??0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();let{width:e=Ii.width,height:t=Ii.height}=this.attribute,{backgroundWidth:n=e,backgroundHeight:r=t}=this.attribute,i=(n-e)/2,a=(r-t)/2;return this._AABBBounds.expand([0,2*i,2*a,0]),this._AABBBounds}setHoverState(e){this.attribute.backgroundShowMode===\`hover\`&&this._hovered!==e&&(this._hovered=e)}}class mu{constructor(e,t,n,r,i,a,o,s){this.left=e,this.width=t,this.baseline=n,this.ascent=r,this.descent=i,this.top=n-r,this.paragraphs=a.map((e=>e)),this.textAlign=(this.paragraphs[0]instanceof pu?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||\`left\`,this.direction=o,this.directionKey=Hi[this.direction],this.actualWidth=0;let c=0;this.paragraphs.forEach(((e,t)=>{if(t===0&&e instanceof uu){let t=Gi.exec(e.text);t?.index!==0&&(e.text=e.text.slice(t?.index),e.updateWidth())}this.actualWidth+=e[this.directionKey.width],c=Math.max(e[this.directionKey.height],c)})),this.height=c,this.blankWidth=s?0:this.width-this.actualWidth,this.calcOffset(t,s)}calcOffset(e,t){let n=this.directionKey,r=this.height,i=this.left,a=0;this.actualWidth<e&&!t&&(this.textAlign===\`right\`||this.textAlign===\`end\`?i=e-this.actualWidth:this.textAlign===\`center\`?i=(e-this.actualWidth)/2:this.textAlign===\`justify\`&&(this.paragraphs.length<2?i=(e-this.actualWidth)/2:a=(e-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map((function(e){e instanceof pu?(e[\`_\`+n.x]=i,i+=e[n.width]+a,e[\`_\`+n.y]=e.attribute.textBaseline===\`top\`?0:e.attribute.textBaseline===\`bottom\`?r-e.height:(r-e.height)/2):(e[n.left]=i,i+=e[n.width]+a)}))}draw(e,t,n,r,i,a){if(i&&(t||this.paragraphs.some((e=>e.overflow)))){let e=!0,n=!1;for(let t=this.paragraphs.length-1;t>=0;t--){let r=this.paragraphs[t];if(r.overflow)e&&=r.text===\`\`;else if(e){n=!0;break}}let r=0;if(!n)for(let e=this.paragraphs.length-1;e>=0;e--){let n=this.paragraphs[e];if(n.overflow){if(n.text===\`\`)break;continue}if(n instanceof pu)break;if(this.direction===\`vertical\`&&n.direction!==\`vertical\`){n.verticalEllipsis=!0;break}let a=!0===i?\`...\`:i||\`\`;n.ellipsisStr=a;let{width:o}=Xi(a,n.character,n.ascentDescentMode),s=o||0;if(s<=this.blankWidth+r){t&&(n.ellipsis=\`add\`);break}if(s<=this.blankWidth+r+n.width){n.ellipsis=\`replace\`,n.ellipsisWidth=s,n.ellipsisOtherParagraphWidth=this.blankWidth+r;break}n.ellipsis=\`hide\`,r+=n.width}}let o=\`\`,s=-1,c=[],l=[c];this.paragraphs.forEach(((t,i)=>{if(t instanceof pu)return;let a=t.drawBackground(e,r,this.ascent,n,i===0,this.textAlign,this.height);a&&(o===a.fillStyle&&s===a.globalAlpha||(c=[],l.push(c),o=a.fillStyle,s=a.globalAlpha),c.push(a))})),l.forEach((t=>{if(t.length===0)return;let n=t[0],r=t[t.length-1];e.fillStyle=n.fillStyle,e.globalAlpha=n.globalAlpha,e.fillRect(n.left,n.top,r.right-n.left,r.bottom-n.top)})),this.paragraphs.forEach(((t,i)=>{if(t instanceof pu)return t.setAttributes({x:n+t._x,y:r+t._y}),void a(t,e,n+t._x,r+t._y,this.ascent);let o={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};(function(e,t){let n=t&&t.stroke||!1;if(!n)return void(e.globalAlpha=0);let{strokeOpacity:r=1,opacity:i=1}=t;e.globalAlpha=r*i,e.lineWidth=t&&typeof t.lineWidth==\`number\`?t.lineWidth:1,e.strokeStyle=n,Ki(e,t)})(e,t.character),function(e,t,n){let r=t&&t.fill||!0;if(!r)return void(e.globalAlpha=0);let{fillOpacity:i=1,opacity:a=1}=t;e.globalAlpha=i*a,e.fillStyle=n?Vi(e,r,{AABBBounds:n}):r,Ki(e,t)}(e,t.character,o),t.draw(e,r,this.ascent,n,i===0,this.textAlign,this.height)}))}getWidthWithEllips(e){let t=0;for(let n=this.paragraphs.length-1;n>=0;n--){let r=this.paragraphs[n];if(r instanceof pu)break;let{width:i}=Xi(e,r.character,r.ascentDescentMode),a=i||0;if(a<=this.blankWidth+t){r.ellipsis=\`add\`,r.ellipsisWidth=a;break}if(a<=this.blankWidth+t+r.width){r.ellipsis=\`replace\`,r.ellipsisWidth=a,r.ellipsisOtherParagraphWidth=this.blankWidth+t;break}r.ellipsis=\`hide\`,t+=r.width}let n=0;return this.paragraphs.forEach(((e,t)=>{n+=e instanceof pu?e.width:e.getWidthWithEllips(this.direction)})),n}}class hu{constructor(e){this.frame=e,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=e.layoutDirection,this.directionKey=Hi[this.direction]}store(e){if(e instanceof pu){this.frame.icons.set(e.richtextId,e),this.lineBuffer.push(e),this.lineWidth+=e[this.directionKey.width];let t=0,n=0;e.attribute.textBaseline===\`top\`?(t=0,n=e.height):e.attribute.textBaseline===\`bottom\`?(t=e.height,n=0):(t=e.height/2,n=e.height/2),this.maxAscent=Math.max(this.maxAscent,t),this.maxDescent=Math.max(this.maxDescent,n)}else this.lineBuffer.push(e),e.text.length===0?(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,e.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,e.descent)):(this.lineWidth+=e[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,e.ascent),this.maxDescent=Math.max(this.maxDescent,e.descent))}send(){if(this.lineBuffer.length===0)return;let e=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,t=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,n=new mu(this.frame.left,this[this.directionKey.width],this.y+e,e,t,this.lineBuffer,this.direction,this.direction===\`horizontal\`?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(n),this.frame.actualHeight+=n.height,this.y+=n.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];e instanceof pu?this.direction===\`horizontal\`&&this.width===0||this.direction===\`vertical\`&&this.height===0||this.lineWidth+e[this.directionKey.width]<=this[this.directionKey.width]?this.store(e):this.lineBuffer.length===0?(this.store(e),this.send()):(this.send(),this.deal(e)):typeof this.width!=\`number\`||this.width<0||(e.newLine&&this.send(),(e.text.length!==0||this.newLine)&&(this.direction===\`horizontal\`&&this.width===0||this.direction===\`vertical\`&&this.height===0||this.lineWidth+e[this.directionKey.width]<=this[this.directionKey.width]?this.store(e):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(e)):this.cut(e,t)))}cut(e,t){let n=this[this.directionKey.width]-this.lineWidth||0,r=Math.ceil(n/e[this.directionKey.width]*e.length)||0,i=qi(e.text,n,e.character,r,this.frame.wordBreak===\`break-word\`);if(i!==0){let[n,r]=function(e,t){let n=e.text.slice(0,t),r=e.text.slice(t);return[new uu(n,e.newLine,e.character,e.ascentDescentMode),new uu(r,!0,e.character,e.ascentDescentMode)]}(e,i);this.store(n),t?this.send():this.deal(r)}else this.lineBuffer.length!==0&&(this.send(),this.deal(e))}}let gu=!1;try{gu=Intl&&typeof Intl.Segmenter==\`function\`}catch{gu=!1}let _u=[\`width\`,\`height\`,\`ellipsis\`,\`wordBreak\`,\`verticalDirection\`,\`maxHeight\`,\`maxWidth\`,\`textAlign\`,\`textBaseline\`,\`textConfig\`,\`layoutDirection\`,\`fill\`,\`stroke\`,\`fontSize\`,\`fontFamily\`,\`fontStyle\`,\`fontWeight\`,\`lineWidth\`,\`opacity\`,\`fillOpacity\`,\`strokeOpacity\`,...Wc];class vu extends Xc{constructor(e){super(e),this.type=\`richtext\`,this._currentHoverIcon=null,this.numberType=Pc,this.onBeforeAttributeUpdate=(e,t,n)=>{for(let n in e)if(n===\`hoverIconId\`){if(e[n]===t[n])continue;let r=this._frameCache.icons.get(e[n]);this.updateHoverIconState(r)}}}get width(){return this.attribute.width??Fi.width}set width(e){this.attribute.width!==e&&(this.attribute.width=e,this.addUpdateShapeAndBoundsTag())}get height(){return this.attribute.height??Fi.height}set height(e){this.attribute.height!==e&&(this.attribute.height=e,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(e){this.attribute.maxWidth!==e&&(this.attribute.maxWidth=e,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(e){this.attribute.maxHeight!==e&&(this.attribute.maxHeight=e,this.addUpdateShapeAndBoundsTag())}get ellipsis(){return this.attribute.ellipsis??Fi.ellipsis}set ellipsis(e){this.attribute.ellipsis!==e&&(this.attribute.ellipsis=e,this.addUpdateShapeAndBoundsTag())}get wordBreak(){return this.attribute.wordBreak??Fi.wordBreak}set wordBreak(e){this.attribute.wordBreak!==e&&(this.attribute.wordBreak=e,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){return this.attribute.verticalDirection??Fi.verticalDirection}set verticalDirection(e){this.attribute.verticalDirection!==e&&(this.attribute.verticalDirection=e,this.addUpdateShapeAndBoundsTag())}get textAlign(){return this.attribute.textAlign??Fi.textAlign}set textAlign(e){this.attribute.textAlign!==e&&(this.attribute.textAlign=e,this.addUpdateShapeAndBoundsTag())}get textBaseline(){return this.attribute.textBaseline??Fi.textBaseline}set textBaseline(e){this.attribute.textBaseline!==e&&(this.attribute.textBaseline=e,this.addUpdateShapeAndBoundsTag())}get textConfig(){return this.attribute.textConfig??Fi.textConfig}set textConfig(e){this.attribute.textConfig=e,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return Qa(this).richtext}static AllSingleCharacter(e){return e.lines?e.lines.every((e=>e.paragraphs.every((e=>!(e.text&&v(e.text)&&vu.splitText(e.text).length>1))))):e.every((e=>e.isComposing||!(e.text&&v(e.text)&&vu.splitText(e.text).length>1)))}static splitText(e){if(gu){let t=new Intl.Segmenter(void 0,{granularity:\`grapheme\`}),n=[];for(let{segment:r}of t.segment(e))n.push(r);return n}return Array.from(e)}static TransformTextConfig2SingleCharacter(e){let t=[];return e.forEach((e=>{let n=vu.splitText(e.text.toString());if(v(e.text)&&n.length>1)for(let r=0;r<n.length;r++){let i=n[r];t.push(Object.assign(Object.assign({},e),{text:i}))}else t.push(e)})),t}updateAABBBounds(e,t,n){let{width:r=t.width,height:i=t.height,maxWidth:a=t.maxWidth,maxHeight:o=t.maxHeight,textAlign:s=t.textAlign,verticalDirection:c=e.textBaseline??t.textBaseline??t.verticalDirection,editOptions:l}=e;if(r>0&&i>0)n.set(0,0,r,i);else{let{width:e,height:t}=this.getFrameCache().getActualSize(),s=r||e||0,c=i||t||0;c=typeof o==\`number\`&&c>o?o:c||0,s=typeof a==\`number\`&&s>a?a:s||0,n.set(0,0,s,c)}l&&l.keepHeightWhileEmpty&&!n.height()&&!e.textConfig?.length&&(n.y2=n.y1+(e.fontSize??12),n.x2=n.x1+2);let u=0;switch(c){case\`top\`:u=0;break;case\`middle\`:u=-n.height()/2;break;case\`bottom\`:u=-n.height()}let d=0;switch(s){case\`left\`:d=0;break;case\`center\`:d=-n.width()/2;break;case\`right\`:d=-n.width()}return n.translate(d,u),B.graphicService.updateTempAABBBounds(n),e.forceBoundsHeight==null&&e.forceBoundsWidth==null||B.graphicService.updateHTMLTextAABBBounds(e,t,n),B.graphicService.transformAABBBounds(e,n,t,!1,this),n.width()===0&&n.height()===0&&n.clear(),n}needUpdateTags(e){return super.needUpdateTags(e,_u)}needUpdateTag(e){return super.needUpdateTag(e,_u)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){let e=this.getFrameCache();if(e.actualHeight>e.height)return!0;let{disableAutoWrapLine:t}=this.attribute;if(t)for(let t=0;t<e.lines.length;t++){let n=e.lines[t];for(let e=0;e<n.paragraphs.length;e++){let t=n.paragraphs[e];if(t.overflow&&t.text!==\`\`)return!0}}return!1}combinedStyleToCharacter(e){let{fill:t,stroke:n,fontSize:r,fontFamily:i,fontStyle:a,fontWeight:o,lineWidth:s,opacity:c,fillOpacity:l,lineHeight:u,strokeOpacity:d,upgradeAttrs:f}=this.attribute,p=Object.assign({fill:t,stroke:n,fontSize:r,fontFamily:i,fontStyle:a,fontWeight:o,lineWidth:s,opacity:c,fillOpacity:l,strokeOpacity:d},e);return f!=null&&f.lineHeight&&(p.lineHeight=u),p}doUpdateFrameCache(e){let{maxWidth:t,maxHeight:n,width:r,height:i,ellipsis:a,wordBreak:o,verticalDirection:s,textAlign:c,textBaseline:l,layoutDirection:u,singleLine:d,disableAutoWrapLine:f,editable:p,ascentDescentMode:m,upgradeAttrs:h}=this.attribute,g=h&&h.multiBreakLine,{textConfig:_=[]}=this.attribute;p&&_.length>0&&!vu.AllSingleCharacter(_)&&(_=vu.TransformTextConfig2SingleCharacter(_),this.attribute.textConfig=_);let v=[],y=e??_;for(let e=0;e<y.length;e++)if(\`image\`in y[e]){let t=this.combinedStyleToCharacter(y[e]);t.lineWidth=void 0;let n=t.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(t.id);if(n)v.push(n);else{let e=new pu(t);e.successCallback=()=>{var e;this.addUpdateBoundTag(),(e=this.stage)==null||e.renderNextFrame()},e.richtextId=t.id,v.push(e)}}else{let t=this.combinedStyleToCharacter(y[e]);if(S(t.text)&&(t.text=\`\${t.text}\`),t.text&&t.text.includes(\`
\`)){let n=t.text.split(\`
\`);for(let r=0;r<n.length;r++)if(r===0)v.push(new uu(n[r],!1,t,m));else if(n[r]||e===y.length-1)v.push(new uu(n[r],!0,t,m));else{let t=this.combinedStyleToCharacter(y[e+1]);v.push(new uu(n[r],!0,t,m))}}else t.text&&v.push(new uu(t.text,!1,t,m))}let b=typeof t==\`number\`&&Number.isFinite(t)&&t>0,x=typeof n==\`number\`&&Number.isFinite(n)&&n>0,C=typeof r==\`number\`&&Number.isFinite(r)&&r>0&&(!b||r<=t),w=typeof i==\`number\`&&Number.isFinite(i)&&i>0&&(!x||i<=n),T=new cu(0,0,(C?r:b?t:0)||0,(w?i:x?n:0)||0,a,o,s,c,l,u||\`horizontal\`,!C&&b,!w&&x,d||!1,this._frameCache?.icons),E=new hu(T);if(E.newLine=g,f){let e=0,t=!1;for(let n=0;n<v.length;n++){let r=v[n];t?(r.overflow=!0,r.left=1/0,r.top=1/0,!r.newLine&&T.lines[T.lines.length-1].paragraphs.push(r)):E.deal(r,!0),T.lines.length!==e&&(e=T.lines.length,E.lineBuffer.length=0,r.overflow=!0,r.left=1e3,r.top=1e3,T.lines[T.lines.length-1].paragraphs.push(r),t=!0),r.newLine&&(t=!1,E.lineWidth=0),E.send()}}else for(let e=0;e<v.length;e++)E.deal(v[e]);if(E.send(),!(T.layoutDirection===\`horizontal\`?C:w)){let e=T.getActualSizeWidthEllipsis(),r=T.layoutDirection===\`horizontal\`?e.width:e.height;(T.layoutDirection===\`horizontal\`?b:x)&&(r=Math.min(r,T.layoutDirection===\`horizontal\`?t:n)),T.lines.forEach((function(e){e.calcOffset(r,!1)}))}g&&T.lines.forEach((e=>{let t=e.paragraphs;e.paragraphs=e.paragraphs.filter((e=>e.text!==\`\`)),e.paragraphs.length===0&&t.length&&(t[0].text=\`
\`,e.paragraphs.push(t[0]))})),this._frameCache=T}clone(){return new vu(Object.assign({},this.attribute))}setStage(e,t){super.setStage(e,t),this.getFrameCache().icons.forEach((n=>{n.setStage(e,t)}))}bindIconEvent(){this.addEventListener(\`pointermove\`,(e=>{let t=this.pickIcon(e.global);t&&t===this._currentHoverIcon||(t?this.setAttribute(\`hoverIconId\`,t.richtextId):!t&&this._currentHoverIcon&&this.setAttribute(\`hoverIconId\`,void 0))})),this.addEventListener(\`pointerleave\`,(e=>{this._currentHoverIcon&&this.setAttribute(\`hoverIconId\`,void 0)}))}updateHoverIconState(e){var t,n,r,i,a;e?((t=this._currentHoverIcon)==null||t.setHoverState(!1),this._currentHoverIcon=e,this._currentHoverIcon.setHoverState(!0),(n=this.stage)==null||n.setCursor(e.attribute.cursor),(r=this.stage)==null||r.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(i=this.stage)==null||i.setCursor(),(a=this.stage)==null||a.renderNextFrame())}pickIcon(e){let t=this.getFrameCache(),{e:n,f:r}=this.globalTransMatrix,i;return t.icons.forEach(((t,a)=>{let o=t.AABBBounds.clone();o.translate(t._marginArray[3],t._marginArray[0]),o.containsPoint({x:e.x-n,y:e.y-r})&&(i=t,i.globalX=(i.attribute.x??0)+n+t._marginArray[3],i.globalY=(i.attribute.y??0)+r+t._marginArray[0])})),i}getNoWorkAnimateAttr(){return vu.NOWORK_ANIMATE_ATTR}}function yu(e){return new vu(e)}vu.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},Yc);let bu=[\`path\`,\`customPath\`,...Wc];class xu extends Xc{constructor(e){super(e),this.type=\`path\`,this.numberType=jc}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{path:e}=this.attribute;return e!=null&&e!==\`\`}getParsedPathShape(){let e=this.getGraphicTheme();if(!this.valid)return e.path;let t=this.attribute;return t.path instanceof pi?t.path:(f(this.cache)&&this.doUpdatePathShape(),this.cache instanceof pi?this.cache:e.path)}getGraphicTheme(){return Qa(this).path}updateAABBBounds(e,t,n){if(!this.updatePathProxyAABBBounds(n)){let e=this.getParsedPathShape();n.union(e.getBounds())}let{tb1:r,tb2:i}=B.graphicService.updateTempAABBBounds(n);Jl(e,t,r),n.union(r),r.setValue(i.x1,i.y1,i.x2,i.y2);let{lineJoin:a=t.lineJoin}=e;return B.graphicService.transformAABBBounds(e,n,t,a===\`miter\`,this),n}doUpdateAABBBounds(e){return this.doUpdatePathShape(),super.doUpdateAABBBounds(e)}doUpdatePathShape(){let e=this.attribute;v(e.path,!0)?this.cache=new pi().fromString(e.path):e.customPath&&(this.cache=new pi,e.customPath(this.cache,this))}needUpdateTags(e){return super.needUpdateTags(e,bu)}needUpdateTag(e){return super.needUpdateTag(e,bu)}toCustomPath(){return new pi().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new xu(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return xu.NOWORK_ANIMATE_ATTR}}function Su(e){return new xu(e)}xu.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},Yc);let Cu=[\`segments\`,\`points\`,\`curveType\`,\`curveTension\`,...Wc];class wu extends Xc{constructor(e){super(e),this.type=\`area\`,this.numberType=Tc}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;let{points:e,segments:t}=this.attribute;return t?t.length!==0:!!e&&e.length!==0}getGraphicTheme(){return Qa(this).area}updateAABBBounds(e,t,n){this.updatePathProxyAABBBounds(n)||(e.segments?this.updateAreaAABBBoundsBySegments(e,t,n):this.updateAreaAABBBoundsByPoints(e,t,n)),B.graphicService.updateTempAABBBounds(n);let{lineJoin:r=t.lineJoin}=e;return B.graphicService.transformAABBBounds(e,n,t,r===\`miter\`,this),n}updateAreaAABBBoundsByPoints(e,t,n,r){let{points:i=t.points}=e,a=n;return i.forEach((e=>{a.add(e.x,e.y),a.add(e.x1??e.x,e.y1??e.y)})),a}updateAreaAABBBoundsBySegments(e,t,n,r){let{segments:i=t.segments}=e,a=n;return i.forEach((e=>{e.points.forEach((e=>{a.add(e.x,e.y),a.add(e.x1??e.x,e.y1??e.y)}))})),a}_interpolate(e,t,n,r,i){e===\`points\`&&(i.points=Mo(n,r,t))}needUpdateTags(e){return super.needUpdateTags(e,Cu)}needUpdateTag(e){return super.needUpdateTag(e,Cu)}toCustomPath(){let e=new pi,t=this.attribute,n=t.segments,r=t=>{if(t&&t.length){let n=!0,r=[];if(t.forEach((t=>{!1!==t.defined&&(n?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y),r.push({x:t.x1??t.x,y:t.y1??t.y}),n=!1)})),r.length){for(let t=r.length-1;t>=0;t--)e.lineTo(r[t].x,r[t].y);e.closePath()}}};return t.points?r(t.points):n&&n.length&&n.forEach((e=>{r(e.points)})),e}clone(){return new wu(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return wu.NOWORK_ANIMATE_ATTR}}function Tu(e){return new wu(e)}wu.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Yc);let Eu=[\`innerRadius\`,\`outerRadius\`,\`startAngle\`,\`endAngle\`,\`cornerRadius\`,\`padAngle\`,\`padRadius\`,\`cap\`,...Wc];class Du extends Xc{constructor(e){super(e),this.type=\`arc\`,this.numberType=Cc}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{startAngle:e,endAngle:t,outerRadius:n,innerRadius:r}=this.attribute;return this._validNumber(e)&&this._validNumber(t)&&this._validNumber(n)&&this._validNumber(r)}getParsedCornerRadius(){let e=this.getGraphicTheme(),{cornerRadius:t=e.cornerRadius,innerPadding:n=e.innerPadding,outerPadding:r=e.outerPadding}=this.attribute,{outerRadius:i=e.outerRadius,innerRadius:a=e.innerRadius}=this.attribute;if(i+=r,a-=n,t===0||t===\`0%\`)return 0;let o=Math.abs(i-a),s=e=>Math.min(S(e,!0)?e:o*parseFloat(e)/100,o/2);if(y(t)){let e=t.map((e=>s(e)||0));return e.length===0?[e[0],e[0],e[0],e[0]]:e.length===2?[e[0],e[1],e[0],e[1]]:(e.length===3&&e.push(0),e)}return s(t)}getParsedAngle(){let e=this.getGraphicTheme(),{startAngle:t=e.startAngle,endAngle:n=e.endAngle}=this.attribute,{cap:r=e.cap}=this.attribute,i=n-t>=0?1:-1,a=n-t;if(t=nt(t),n=t+a,r&&Ve(a)<F-Le){let a=1,o=1;r.length&&(a=Number(r[0]),o=Number(r[1]));let{outerRadius:s=e.outerRadius,innerRadius:c=e.innerRadius}=this.attribute,{outerPadding:l=e.outerPadding,innerPadding:u=e.innerPadding}=this.attribute;s+=l,c-=u;let d=Math.abs(s-c)/2,f=d/s;if(d>Le&&s>Le)return{startAngle:t-i*f*a,endAngle:n+i*f*o,sc:i*f*a,ec:i*f*o}}return{startAngle:t,endAngle:n}}getParsePadAngle(e,t){let n=this.getGraphicTheme(),{innerPadding:r=n.innerPadding,outerPadding:i=n.outerPadding,padAngle:a=n.padAngle}=this.attribute,{outerRadius:o=n.outerRadius,innerRadius:s=n.innerRadius}=this.attribute;o+=i,s-=r;let{padRadius:c=qe(o*o+s*s)}=this.attribute,l=Ve(t-e),u=e,d=t,f=e,p=t,m=a/2,h=l,g=l;if(m>Le&&c>Le){let n=t>e?1:-1,r=Ye(Number(c)/s*Ke(m)),i=Ye(Number(c)/o*Ke(m));return(h-=2*r)>Le?(r*=n,f+=r,p-=r):(h=0,f=p=(e+t)/2),(g-=2*i)>Le?(i*=n,u+=i,d-=i):(g=0,u=d=(e+t)/2),{outerStartAngle:u,outerEndAngle:d,innerStartAngle:f,innerEndAngle:p,innerDeltaAngle:h,outerDeltaAngle:g}}return{outerStartAngle:u,outerEndAngle:d,innerStartAngle:f,innerEndAngle:p,innerDeltaAngle:h,outerDeltaAngle:g}}getGraphicTheme(){return Qa(this).arc}updateAABBBounds(e,t,n,r){this.updatePathProxyAABBBounds(n)||(r?this.updateArcAABBBoundsImprecise(e,t,n):this.updateArcAABBBoundsAccurate(e,t,n));let{tb1:i,tb2:a}=B.graphicService.updateTempAABBBounds(n);Jl(e,t,i),n.union(i),i.setValue(a.x1,a.y1,a.x2,a.y2);let{lineJoin:o=t.lineJoin}=e;return B.graphicService.transformAABBBounds(e,n,t,o===\`miter\`,this),n}updateArcAABBBoundsImprecise(e,t,n){let{outerRadius:r=t.outerRadius,innerRadius:i=t.innerRadius}=e,{outerPadding:a=t.outerPadding,innerPadding:o=t.innerPadding}=e;return r+=a,i-=o,r<i&&(r=i),n.set(-r,-r,r,r),n}updateArcAABBBoundsAccurate(e,t,n){let{outerRadius:r=t.outerRadius,innerRadius:i=t.innerRadius}=e,{outerPadding:a=t.outerPadding,innerPadding:o=t.innerPadding}=e;if(r+=a,i-=o,r<i){let e=r;r=i,i=e}let{endAngle:s=t.endAngle,startAngle:c=t.startAngle}=e;if(c>s){let e=c;c=s,s=e}return r<=Le?n.set(0,0,0,0):Math.abs(s-c)>F-Le?n.set(-r,-r,r,r):(Ao(c,s,r,n),Ao(c,s,i,n)),n}needUpdateTags(e){return super.needUpdateTags(e,Eu)}needUpdateTag(e){return super.needUpdateTag(e,Eu)}toCustomPath(){let e=this.attribute,{startAngle:t,endAngle:n}=this.getParsedAngle(),r=(e.innerRadius??0)-(e.innerPadding??0),i=(e.outerRadius??0)-(e.outerPadding??0),a=Ve(n-t),o=n>t;if(i<r){let e=i;i=r,r=e}let s=new pi;if(i<=Le)s.moveTo(0,0);else if(a>=F-Le)s.moveTo(0+i*Ue(t),0+i*Ke(t)),s.arc(0,0,i,t,n,!o),r>Le&&(s.moveTo(0+r*Ue(n),0+r*Ke(n)),s.arc(0,0,r,n,t,o));else{let e=i*Ue(t),a=i*Ke(t),c=r*Ue(n),l=r*Ke(n);s.moveTo(0+e,0+a),s.arc(0,0,i,t,n,!o),s.lineTo(0+c,0+l),s.arc(0,0,r,n,t,o),s.closePath()}return s}clone(){return new Du(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Du.NOWORK_ANIMATE_ATTR}}function Ou(e){return new Du(e)}Du.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},Yc);let ku=[\`points\`,\`cornerRadius\`,...Wc];class Au extends Xc{constructor(e){super(e),this.type=\`polygon\`,this.numberType=Mc}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{points:e}=this.attribute;return e&&e.length>=2}getGraphicTheme(){return Qa(this).polygon}updateAABBBounds(e,t,n){this.updatePathProxyAABBBounds(n)||this.updatePolygonAABBBoundsImprecise(e,t,n),B.graphicService.updateTempAABBBounds(n);let{lineJoin:r=t.lineJoin}=e;return B.graphicService.transformAABBBounds(e,n,t,r===\`miter\`,this),n}updatePolygonAABBBoundsImprecise(e,t,n){let{points:r=t.points}=e;return r.forEach((e=>{n.add(e.x,e.y)})),n}_interpolate(e,t,n,r,i){e===\`points\`&&(i.points=Mo(n,r,t))}needUpdateTags(e){return super.needUpdateTags(e,ku)}needUpdateTag(e){return super.needUpdateTag(e,ku)}toCustomPath(){let e=this.attribute.points,t=new pi;return e.forEach(((e,n)=>{n===0?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)})),t.closePath(),t}clone(){return new Au(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Au.NOWORK_ANIMATE_ATTR}}function ju(e){return new Au(e)}Au.NOWORK_ANIMATE_ATTR=Yc;class Mu extends Qc{constructor(e){super({x:0,y:0}),this.type=\`shadowroot\`,this.shadowHost=e}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];if(this.shouldUpdateGlobalMatrix()){let t=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f):this._globalTransMatrix=t.clone(),this.doUpdateGlobalMatrix(),e&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){let e=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(e.a,e.b,e.c,e.d,e.e,e.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function Nu(e){return new Mu(e)}let U=new class{constructor(){this.store=new Map}RegisterGraphicCreator(e,t){this.store.set(e,t),this[e]=t}CreateGraphic(e,t){let n=this.store.get(e);return n?n(t):null}},Pu,Fu;function Iu(e){return Pu||=U.CreateGraphic(\`text\`,{}),Pu.initAttributes(e),Pu.AABBBounds}var Lu=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ru=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},zu=function(e,t){return function(n,r){t(n,r,e)}};class Bu{constructor(){this.time=wr.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){let{background:p,backgroundOpacity:m=e.attribute.fillOpacity??c.backgroundOpacity,opacity:h=c.opacity,backgroundMode:g=c.backgroundMode,backgroundFit:_=c.backgroundFit,backgroundKeepAspectRatio:v=c.backgroundKeepAspectRatio,backgroundScale:y=c.backgroundScale,backgroundOffsetX:b=c.backgroundOffsetX,backgroundOffsetY:x=c.backgroundOffsetY,backgroundClip:S=c.backgroundClip}=e.attribute;if(p)if(e.backgroundImg&&e.resources){let i=e.resources.get(p);if(i.state!==\`success\`||!i.data)return;if(t.save(),e.parent&&!e.transMatrix.onlyTranslate()){let n=Qa(e.parent).group,{scrollX:r=n.scrollX,scrollY:i=n.scrollY}=e.parent.attribute;t.setTransformFromMatrix(e.parent.globalTransMatrix,!0),t.translate(r,i)}S&&t.clip();let a=e.AABBBounds;t.setCommonStyle(e,e.attribute,n,r,c),t.globalAlpha=m*h,this.doDrawImage(t,i.data,a,{backgroundMode:g,backgroundFit:_,backgroundKeepAspectRatio:v,backgroundScale:y,backgroundOffsetX:b,backgroundOffsetY:x}),t.restore(),e.transMatrix.onlyTranslate()||t.setTransformForCurrent()}else t.highPerformanceSave(),t.setCommonStyle(e,e.attribute,n,r,c),t.globalAlpha=m*h,t.fillStyle=p,t.fill(),t.highPerformanceRestore()}doDrawImage(e,t,n,r){let{backgroundMode:i,backgroundFit:a,backgroundKeepAspectRatio:o,backgroundScale:s=1,backgroundOffsetX:c=0,backgroundOffsetY:l=0}=r,u=n.width(),d=n.height(),f=u,p=d;if(i===\`no-repeat\`)if(a)if(o){let r=Math.max(u/t.width,d/t.height);e.drawImage(t,n.x1+c,n.y1+l,t.width*r*s,t.height*r*s)}else e.drawImage(t,n.x1,n.y1,n.width(),n.height());else{let r=t.width*s,i=t.height*s;e.drawImage(t,n.x1+c,n.y1+l,r,i)}else{if(a&&i!==\`repeat\`&&(t.width||t.height)){let n=t.width,r=t.height;i===\`repeat-x\`?(f=n*(d/r),p=d):i===\`repeat-y\`&&(p=r*(u/n),f=u);let a=e.dpr,o=Na.allocate({width:f,height:p,dpr:a}),s=o.getContext(\`2d\`);s&&(s.inuse=!0,s.clearMatrix(),s.setTransformForCurrent(!0),s.clearRect(0,0,f,p),s.drawImage(t,0,0,f,p),t=o.nativeCanvas),Na.free(o)}let r=e.dpr,o=e.createPattern(t,i);o.setTransform&&o.setTransform(new DOMMatrix([1/r,0,0,1/r,0,0])),e.fillStyle=o,e.translate(n.x1,n.y1),e.fillRect(0,0,u,d),e.translate(-n.x1,-n.y1)}}}let Vu=new Bu,Hu=class{constructor(e){this.subRenderContribitions=e,this.time=wr.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){this._subRenderContribitions||=this.subRenderContribitions.getContributions(),this._subRenderContribitions.forEach((p=>{p.render(e,t,n,r,i,a,o,s,c,l,u,d,f)}))}};Hu=Lu([R(),zu(0,L(Kn)),zu(0,Fn(Ml)),Ru(\`design:paramtypes\`,[Object])],Hu);let Uu=new class{constructor(){this.time=wr.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){let{clipConfig:p}=e.attribute;if(!p)return;let m=e.getClipPath();if(!m)return;let h=!(u||d),g=e.AABBBounds,_=e.attribute.width??g.width(),v=e.attribute.height??g.height();h&&t.save(),t.beginPath(),!1===m.draw(t,[_,v],n+_/2,r+v/2,0)&&t.closePath(),u&&u(t,e.attribute,c,!0),h&&t.clip()}},Wu=new class{constructor(){this.time=wr.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){let{clipConfig:p}=e.attribute;p&&e.getClipPath()&&(u||d||t.restore())}};class Gu{constructor(){this.time=wr.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(e,t,n,r,i){let a=(e-2*t)/2,o=r.dpr,s=Na.allocate({width:e,height:e,dpr:o}),c=s.getContext(\`2d\`);if(!c)return null;c.inuse=!0,c.clearMatrix(),c.setTransformForCurrent(!0),c.clearRect(0,0,e,e),i(a,c);let l=r.createPattern(s.nativeCanvas,\`repeat\`);return l.setTransform&&l.setTransform(new DOMMatrix([1/o,0,0,1/o,0,0])),Na.free(s),l}createCirclePattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((e,t)=>{t.fillStyle=n,t.arc(e,e,e,0,F),t.fill()}))}createDiamondPattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((t,r)=>{let i=e/2,a=i;r.fillStyle=n,r.moveTo(i,a-t),r.lineTo(t+i,a),r.lineTo(i,a+t),r.lineTo(i-t,a),r.closePath(),r.fill()}))}createRectPattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((e,r)=>{let i=t,a=i;r.fillStyle=n,r.fillRect(i,a,2*e,2*e)}))}createVerticalLinePattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((r,i)=>{let a=t;i.fillStyle=n,i.fillRect(a,0,2*r,e)}))}createHorizontalLinePattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((r,i)=>{let a=t;i.fillStyle=n,i.fillRect(0,a,e,2*r)}))}createBiasLRLinePattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((t,r)=>{r.strokeStyle=n,r.lineWidth=t,r.moveTo(0,0),r.lineTo(e,e);let i=e/2,a=-i;r.moveTo(i,a),r.lineTo(i+e,a+e),r.moveTo(-i,-a),r.lineTo(-i+e,-a+e),r.stroke()}))}createBiasRLLinePattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((t,r)=>{r.strokeStyle=n,r.lineWidth=t,r.moveTo(e,0),r.lineTo(0,e);let i=e/2,a=i;r.moveTo(e+i,a),r.lineTo(i,a+e),r.moveTo(e-i,-a),r.lineTo(-i,-a+e),r.stroke()}))}createGridPattern(e,t,n,r){return this.createCommonPattern(e,t,n,r,((e,r)=>{let i=t,a=i;r.fillStyle=n,r.fillRect(i,a,e,e),r.fillRect(i+e,a+e,e,e)}))}initTextureMap(e,t){this.textureMap=new Map}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){this.textureMap||this.initTextureMap(t,e.stage);let{texture:p=c.texture,textureColor:m=c.textureColor,textureSize:h=c.textureSize,texturePadding:g=c.texturePadding}=e.attribute;p&&this.drawTexture(p,e,t,n,r,c,m,h,g)}drawTexture(e,t,n,r,i,a,o,s,c){var l;let{textureRatio:u=a.textureRatio,textureOptions:d=null}=t.attribute,f=this.textureMap.get(e);if(!f)switch(e){case\`circle\`:f=this.createCirclePattern(s,c,o,n);break;case\`diamond\`:f=this.createDiamondPattern(s,c,o,n);break;case\`rect\`:f=this.createRectPattern(s,c,o,n);break;case\`vertical-line\`:f=this.createVerticalLinePattern(s,c,o,n);break;case\`horizontal-line\`:f=this.createHorizontalLinePattern(s,c,o,n);break;case\`bias-lr\`:f=this.createBiasLRLinePattern(s,c,o,n);break;case\`bias-rl\`:f=this.createBiasRLLinePattern(s,c,o,n);break;case\`grid\`:f=this.createGridPattern(s,c,o,n)}if(d&&d.dynamicTexture){let{gridConfig:f={},useNewCanvas:p}=d,m=t.AABBBounds;r=m.x1,i=m.y1;let h=n,g;if(p){g=Na.allocate({width:m.width(),height:m.height(),dpr:n.dpr});let e=g.getContext(\`2d\`);e.clearRect(0,0,m.width(),m.height()),r=0,i=0,n=e}if(h.save(),t.parent&&!t.transMatrix.onlyTranslate()){let{scrollX:e=0,scrollY:n=0}=t.parent.attribute;h.setTransformFromMatrix(t.parent.globalTransMatrix),h.translate(e,n,!0)}h.setCommonStyle(t,t.attribute,r,i,a),h.clip();let _=m.width(),v=m.height(),y=c,b=s,x=f.columns?f.columns:Math.ceil(_/b),S=f.rows?f.rows:Math.ceil(v/b),C=f.gutterColumn?f.gutterColumn:2*y,w=f.gutterRow?f.gutterRow:2*y;this._tempSymbolGraphic||=tu({});let T=f.columns?_/f.columns:b,E=f.rows?v/f.rows:b;this._tempSymbolGraphic.setAttributes({size:[T-C,E-w],symbolType:e});let D=this._tempSymbolGraphic.getParsedPath();for(let e=0;e<S;e++)for(let a=0;a<x;a++){let s=r+b/2+a*b,c=i+b/2+e*b;(l=d.beforeDynamicTexture)==null||l.call(d,n,e,a,S,x,u,t,m.width(),m.height()),n.beginPath(),!1===D.draw(n,Math.min(T-C,E-w),s,c,0)&&n.closePath(),n.fillStyle=o,d.dynamicTexture(n,e,a,S,x,u,t,m.width(),m.height())}p&&(h.globalAlpha=1,h.drawImage(g.nativeCanvas,0,0,g.nativeCanvas.width,g.nativeCanvas.height,m.x1,m.y1,m.width()*h.dpr,m.height()*h.dpr)),h.restore()}else if(f)n.highPerformanceSave(),n.setCommonStyle(t,t.attribute,r,i,a),n.fillStyle=f,n.fill(),n.highPerformanceRestore();else if(e===\`wave\`){n.save(),n.setCommonStyle(t,t.attribute,r,i,a),n.clip();let e=t.AABBBounds;(function(e,t,n,r,i,a,o){let{fill:s=\`orange\`,percent:c=.6,frequency:l=4,opacity:u,phi:d=0}=i,{amplitude:f=10}=i;f*=function(e){return e<=.5?4*e-1:-4*e+3}(t);let p=r*(1-c),m=n,h=Math.max(Math.round(m/70),2);e.beginPath(),e.moveTo(0+a,r+o),e.lineTo(0+a,p+o);let g=m/l*t,_=m/Math.PI/(2*l);for(let t=0;t<m;t+=h){let n=f*Math.sin((t+g+d)/_+d);e.lineTo(t+a,p+n+o)}e.lineTo(m+a,r+o),e.closePath(),e.fillStyle=s,isFinite(u)&&(e.globalAlpha=u),e.fill()})(n,u,e.width(),e.height(),Object.assign(Object.assign({},d||{}),{fill:o}),r+e.x1-r,i+e.y1-i),n.restore()}}}let Ku=new Gu,qu=new class{constructor(){this.time=wr.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d){let{outerBorder:f,innerBorder:p}=e.attribute,m=f&&!1!==f.visible,h=p&&!1!==p.visible;if(!m&&!h)return;let{innerPadding:g=c.innerPadding,outerPadding:_=c.outerPadding,startAngle:v=c.startAngle,endAngle:y=c.endAngle,opacity:b=c.opacity,x=c.x,y:S=c.y,scaleX:C=c.scaleX,scaleY:w=c.scaleY,keepStrokeScale:T=c.keepStrokeScale}=e.attribute,{innerRadius:E=c.innerRadius,outerRadius:D=c.outerRadius}=e.attribute;D+=_,E-=g;let O=(i,a)=>{let o=!(!i||!i.stroke),{distance:s=c[a].distance}=i,l=T?s:Bi(t,s,t.dpr),u=s/D,f=a===\`outerBorder\`?1:-1;if(e.setAttributes({outerRadius:D+f*l,innerRadius:E-f*l,startAngle:v-f*u,endAngle:y+f*u}),t.beginPath(),bl(e,t,n,r,D+f*l,E-f*l),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),d)d(t,i,c[a]);else if(o){let o=c[a].opacity;c[a].opacity=b,t.setStrokeStyle(e,i,(x-n)/C,(S-r)/w,c[a]),c[a].opacity=o,t.stroke()}};m&&O(f,\`outerBorder\`),h&&O(p,\`innerBorder\`),e.setAttributes({outerRadius:D,innerRadius:E,startAngle:v,endAngle:y})}},Ju=Ku,Yu=Vu,Xu=new class extends Bu{constructor(){super(...arguments),this.time=wr.beforeFillStroke}drawShape(e,t,n,r,i,a,o,s,c,l,u,d){let{background:f,backgroundMode:p=c.backgroundMode,backgroundFit:m=c.backgroundFit,backgroundKeepAspectRatio:h=c.backgroundKeepAspectRatio,backgroundScale:g=c.backgroundScale,backgroundOffsetX:_=c.backgroundOffsetX,backgroundOffsetY:v=c.backgroundOffsetY}=e.attribute;if(f)if(e.backgroundImg&&e.resources){let n=e.resources.get(f);if(n.state!==\`success\`||!n.data)return;t.highPerformanceSave(),t.setTransformFromMatrix(e.parent.globalTransMatrix,!0);let r=e.AABBBounds;this.doDrawImage(t,n.data,r,{backgroundMode:p,backgroundFit:m,backgroundKeepAspectRatio:h,backgroundScale:g,backgroundOffsetX:_,backgroundOffsetY:v}),t.highPerformanceRestore(),t.setTransformForCurrent()}else t.highPerformanceSave(),t.fillStyle=f,t.fill(),t.highPerformanceRestore()}},Zu=Re/2;function Qu(e,t,n,r,i,a){let o,s=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6],c=arguments.length>7?arguments[7]:void 0;if(Array.isArray(s)&&(c=s,s=!0),r<0&&(t+=r,r=-r),i<0&&(n+=i,i=-i),S(a,!0))o=[a=Ve(a),a,a,a];else if(Array.isArray(a)){let e=a,t,n;switch(e.length){case 0:o=[0,0,0,0];break;case 1:t=Ve(e[0]),o=[t,t,t,t];break;case 2:case 3:t=Ve(e[0]),n=Ve(e[1]),o=[t,n,t,n];break;default:o=e,o[0]=Ve(o[0]),o[1]=Ve(o[1]),o[2]=Ve(o[2]),o[3]=Ve(o[3])}}else o=[0,0,0,0];if(r<0||o[0]+o[1]+o[2]+o[3]<1e-12)return e.rect(t,n,r,i);let[l,u,d,f]=[[t,n],[t+r,n],[t+r,n+i],[t,n+i]],p=Math.min(r/2,i/2),m=[Math.min(p,o[0]),Math.min(p,o[1]),Math.min(p,o[2]),Math.min(p,o[3])],h=[l[0]+m[0],l[1]],g=[l[0],l[1]+m[0]],_=[u[0]-m[1],u[1]],v=[u[0],u[1]+m[1]],y=[d[0]-m[2],d[1]],b=[d[0],d[1]-m[2]],x=[f[0]+m[3],f[1]],C=[f[0],f[1]-m[3]];if(e.moveTo(h[0],h[1]),s){if(c&&c[0]?c[0](h[0],h[1],_[0],_[1]):e.lineTo(_[0],_[1]),!me(_,v)){c&&c[0]&&e.moveTo(_[0],_[1]);let t=_[0],n=_[1]+m[1];e.arc(t,n,m[1],-Zu,0,!1)}if(c&&c[1]?c[1](v[0],v[1],b[0],b[1]):e.lineTo(b[0],b[1]),!me(y,b)){let t=b[0]-m[2],n=b[1];c&&c[1]&&e.moveTo(b[0],b[1]),e.arc(t,n,m[2],0,Zu,!1)}if(c&&c[2]?c[2](y[0],y[1],x[0],x[1]):e.lineTo(x[0],x[1]),!me(x,C)){let t=x[0],n=x[1]-m[3];c&&c[2]&&e.moveTo(x[0],x[1]),e.arc(t,n,m[3],Zu,Re,!1)}if(c&&c[3]?c[3](C[0],C[1],g[0],g[1]):e.lineTo(g[0],g[1]),!me(h,g)){let t=h[0],n=h[1]+m[0];c&&c[3]&&e.moveTo(g[0],g[1]),e.arc(t,n,m[0],Re,Re+Zu,!1)}}else c&&c[0]?c[0](h[0],h[1],_[0],_[1]):e.lineTo(_[0],_[1]),c&&c[1]?c[1](_[0],_[1],y[0],y[1]):e.lineTo(y[0],y[1]),c&&c[2]?c[2](y[0],y[1],x[0],x[1]):e.lineTo(x[0],x[1]),c&&c[2]?c[2](x[0],x[1],h[0],h[1]):e.lineTo(h[0],h[1]);return!c&&e.closePath(),e}var $u=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let ed=class{constructor(){this.time=wr.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){let{stroke:p=c.stroke}=e.attribute;Array.isArray(p)&&p.some((e=>!1===e))&&(f.doStroke=!1)}};ed=$u([R()],ed);let td=class{constructor(){this.time=wr.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d){let{x1:f,y1:p,x:m=c.x,y:h=c.y,stroke:g=c.stroke,cornerRadius:_=c.cornerRadius,cornerType:v=c.cornerType}=e.attribute,{width:b,height:x}=e.attribute;if(b=(b??f-m)||0,x=(x??p-h)||0,Array.isArray(g)&&g.some((e=>!1===e))){if(t.setStrokeStyle(e,e.attribute,n,r,c),!(_===0||y(_)&&_.every((e=>e===0)))){let i,a=0;Qu(t,n,r,b,x,_,v!==\`bevel\`,[,,,,].fill(0).map(((o,s)=>(o,l,u,d)=>{g[s]&&(a===s-1&&g[s]===i||(t.setStrokeStyle(e,Object.assign(Object.assign({},e.attribute),{stroke:g[s]}),n,r,c),t.beginPath(),t.moveTo(o,l),i=g[s]),a=s,t.lineTo(u,d),t.stroke(),s===3&&t.beginPath())}))),t.stroke();return}if(t.beginPath(),t.moveTo(n,r),g[0]?t.lineTo(n+b,r):t.moveTo(n+b,r),g[1]?t.lineTo(n+b,r+x):t.moveTo(n+b,r+x),g[2]?t.lineTo(n,r+x):t.moveTo(n,r+x),g[3]){let e=g[0]?r-t.lineWidth/2:r;t.lineTo(n,e)}else t.moveTo(n,r);t.stroke()}}};td=$u([R()],td);let nd=new class{constructor(){this.time=wr.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d){let{outerBorder:f,innerBorder:p}=e.attribute,m=f&&!1!==f.visible,h=p&&!1!==p.visible;if(!m&&!h)return;let{cornerRadius:g=c.cornerRadius,cornerType:_=c.cornerType,opacity:v=c.opacity,x:b=c.x,y:x=c.y,scaleX:S=c.scaleX,scaleY:C=c.scaleY,x1:w,y1:T,keepStrokeScale:E=c.keepStrokeScale}=e.attribute,{width:D,height:O}=e.attribute;D=(D??w-n)||0,O=(O??T-r)||0;let k=(i,a)=>{let o=!(!i||!i.stroke),s=a===\`outerBorder\`?-1:1,{distance:l=c[a].distance}=i,u=E?l:Bi(t,l,t.dpr),f=n+s*u,p=r+s*u,m=2*u;if(g===0||y(g)&&g.every((e=>e===0))?(t.beginPath(),t.rect(f,p,D-s*m,O-s*m)):(t.beginPath(),Qu(t,f,p,D-s*m,O-s*m,g,_!==\`bevel\`)),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),d)d(t,i,c[a]);else if(o){let o=c[a].opacity;c[a].opacity=v,t.setStrokeStyle(e,i,(b-n)/S,(x-r)/C,c[a]),c[a].opacity=o,t.stroke()}};m&&k(f,\`outerBorder\`),h&&k(p,\`innerBorder\`)}},rd=Ku,id=Vu,ad=new class{constructor(){this.time=wr.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d){let f=e.getParsedPath();if(!f)return;let{outerBorder:p,innerBorder:m}=e.attribute,h=p&&!1!==p.visible,g=m&&!1!==m.visible;if(!h&&!g)return;let{size:_=c.size,opacity:v=c.opacity,x:y=c.x,y:b=c.y,scaleX:x=c.scaleX,scaleY:S=c.scaleY,keepStrokeScale:C=c.keepStrokeScale}=e.attribute,w=(i,a)=>{let o=!(!i||!i.stroke),{distance:s=c[a].distance}=i,l=C?s:Bi(t,s,t.dpr),u=a===\`outerBorder\`?1:-1;if(t.beginPath(),!1===f.drawOffset(t,_,n,r,u*l)&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),d)d(t,i,c[a]);else if(o){let o=c[a].opacity;c[a].opacity=v,t.setStrokeStyle(e,i,(y-n)/x,(b-r)/S,c[a]),c[a].opacity=o,t.stroke()}};h&&w(p,\`outerBorder\`),g&&w(m,\`innerBorder\`)}},od=new class{constructor(){this.time=wr.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){let{clipRange:p=c.clipRange,x:m=c.x,y:h=c.y,z:g=c.z,size:_=c.size,scaleX:v=c.scaleX,scaleY:y=c.scaleY}=e.attribute,b=e.getParsedPath();b&&p<1&&p>0&&(t.beginPath(),b.drawWithClipRange&&b.drawWithClipRange(t,_,n,r,p,g,((i,a)=>{if(e._parsedPath.svgCache){let t=Object.assign({},a);t.fill=a.fill??e.attribute.fill,t.opacity=a.opacity??e.attribute.opacity,t.fillOpacity=e.attribute.fillOpacity,t.stroke=a.stroke??e.attribute.stroke,t.lineWidth=a.lineWidth??e.attribute.lineWidth,a=t}a.stroke&&(d?d(t,e.attribute,c):s&&(t.setStrokeStyle(e,a,(m-n)/v,(h-r)/y,c),t.stroke()))})),a&&!b.isSvg&&(d?d(t,e.attribute,c):s&&(t.setStrokeStyle(e,e.attribute,(m-n)/v,(h-r)/y,c),t.stroke())))}},sd=Ku,cd=Vu,ld={x:0,y:0,z:0,lastModelMatrix:null};class ud{init(e){e&&(this._renderContribitions=e.getContributions()),this._renderContribitions||=[],this.builtinContributions||=[],this.builtinContributions.push(Uu),this.builtinContributions.push(Wu),this.builtinContributions.forEach((e=>this._renderContribitions.push(e))),this._renderContribitions.length&&(this._renderContribitions.sort(((e,t)=>t.order-e.order)),this._beforeRenderContribitions=this._renderContribitions.filter((e=>e.time===wr.beforeFillStroke)),this._afterRenderContribitions=this._renderContribitions.filter((e=>e.time===wr.afterFillStroke)))}beforeRenderStep(e,t,n,r,i,a,o,s,c,l,u,d,f){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach((p=>{p.supportedAppName&&e.stage&&e.stage.params&&e.stage.params.context&&e.stage.params.context.appName&&!(Array.isArray(p.supportedAppName)?p.supportedAppName:[p.supportedAppName]).includes(e.stage.params.context.appName)||p.drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f)}))}afterRenderStep(e,t,n,r,i,a,o,s,c,l,u,d,f){this._afterRenderContribitions&&this._afterRenderContribitions.forEach((p=>{p.supportedAppName&&e.stage&&e.stage.params&&e.stage.params.context&&e.stage.params.context.appName&&!(Array.isArray(p.supportedAppName)?p.supportedAppName:[p.supportedAppName]).includes(e.stage.params.context.appName)||p.drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f)}))}drawPathProxy(e,t,n,r,i,a,o,s){if(!e.pathProxy)return!1;let c=Qa(e,a?.theme)[e.type.replace(\`3d\`,\`\`)],{fill:l=c.fill,stroke:u=c.stroke,opacity:d=c.opacity,fillOpacity:f=c.fillOpacity,lineWidth:p=c.lineWidth,strokeOpacity:m=c.strokeOpacity,visible:h=c.visible,x:g=c.x,y:_=c.y}=e.attribute,v=ml(d,f,l),y=gl(d,m),b=fl(l),x=pl(u,p);return!h||!b&&!x||!(v||y||o||s)?!0:(t.beginPath(),Or((typeof e.pathProxy==\`function\`?e.pathProxy(e.attribute):e.pathProxy).commandList,t,n,r),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,n,r,b,x,v,y,c,i,o,s),x&&(s?s(t,e.attribute,c):y&&(t.setStrokeStyle(e,e.attribute,n-g,r-_,c),t.stroke())),b&&(o?o(t,e.attribute,c):v&&(t.setCommonStyle(e,e.attribute,n-g,r-_,c),t.fill())),this.afterRenderStep(e,t,n,r,b,x,v,y,c,i,o,s),!0)}valid(e,t,n,r){let{fill:i=t.fill,background:a,stroke:o=t.stroke,opacity:s=t.opacity,fillOpacity:c=t.fillOpacity,lineWidth:l=t.lineWidth,strokeOpacity:u=t.strokeOpacity,visible:d=t.visible}=e.attribute,f=ml(s,c,i),p=gl(s,u),m=fl(i,a),h=pl(o,l);return!(!e.valid||!d)&&!(!m&&!h)&&!!(f||p||n||r||a)&&{fVisible:f,sVisible:p,doFill:m,doStroke:h}}transform(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],{x:i=t.x,y:a=t.y,z:o=t.z,scaleX:s=t.scaleX,scaleY:c=t.scaleY,angle:l=t.angle,postMatrix:u}=e.attribute,d=n.modelMatrix,f=n.camera;ld.x=i,ld.y=a,ld.z=o,ld.lastModelMatrix=d;let p=f&&(r||function(e){let{alpha:t,beta:n}=e.attribute;return t||n}(e)),m=p?e.transMatrix.onlyTranslate()&&!u:s===1&&c===1&&l===0&&!u;if(p){let r=Hl.allocate(),i=Hl.allocate();Kl(i,e,t),Rl(r,d||r,i),ld.x=0,ld.y=0,ld.z=0,n.modelMatrix=r,n.setTransform(1,0,0,1,0,0,!0),Hl.free(i)}if(m&&!d){let r=e.getOffsetXY(t);ld.x+=r.x,ld.y+=r.y,ld.z=o,n.setTransformForCurrent()}else if(p)ld.x=0,ld.y=0,ld.z=0,n.setTransform(1,0,0,1,0,0,!0);else if(f&&n.project){let r=e.getOffsetXY(t);ld.x+=r.x,ld.y+=r.y,this.transformWithoutTranslate(n,ld.x,ld.y,ld.z,s,c,l)}else n.transformFromMatrix(e.transMatrix,!0),ld.x=0,ld.y=0,ld.z=0;return ld}transformUseContext2d(e,t,n,r){let i=r.camera;if(this.camera=i,i){let t=e.AABBBounds,i=t.x2-t.x1,a=t.y2-t.y1,o=r.project(0,0,n),s=r.project(i,0,n),c=r.project(i,a,n),l={x:0,y:0},u={x:i,y:0},d={x:i,y:a};r.camera=null;let f=1/(l.x*(d.y-u.y)-u.x*d.y+d.x*u.y+(u.x-d.x)*l.y),p=-(l.y*(c.x-s.x)-u.y*c.x+d.y*s.x+(u.y-d.y)*o.x)*f,m=(u.y*c.y+l.y*(s.y-c.y)-d.y*s.y+(d.y-u.y)*o.y)*f,h=(l.x*(c.x-s.x)-u.x*c.x+d.x*s.x+(u.x-d.x)*o.x)*f,g=-(u.x*c.y+l.x*(s.y-c.y)-d.x*s.y+(d.x-u.x)*o.y)*f,_=(l.x*(d.y*s.x-u.y*c.x)+l.y*(u.x*c.x-d.x*s.x)+(d.x*u.y-u.x*d.y)*o.x)*f,v=(l.x*(d.y*s.y-u.y*c.y)+l.y*(u.x*c.y-d.x*s.y)+(d.x*u.y-u.x*d.y)*o.y)*f;r.setTransform(p,m,h,g,_,v,!0)}}restoreTransformUseContext2d(e,t,n,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(e,t,n,r,i,a,o){let s=e.project(t,n,r);e.translate(s.x,s.y,!1),e.scale(i,a,!1),e.rotate(o,!1),e.translate(-s.x,-s.y,!1),e.setTransformForCurrent()}_draw(e,t,n,r,i){let{context:a}=r;if(!a)return;let{renderable:o}=e.attribute;if(!1===o)return;a.highPerformanceSave();let{x:s,y:c,z:l,lastModelMatrix:u}=this.transform(e,t,a,n);this.z=l,this.drawPathProxy(e,a,s,c,r,i)||(this.drawShape(e,a,s,c,r,i),this.z=0,a.modelMatrix!==u&&Hl.free(a.modelMatrix),a.modelMatrix=u),a.highPerformanceRestore()}}var dd=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},fd=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},pd=function(e,t){return function(n,r){t(n,r,e)}};let md=class extends ud{constructor(e){super(),this.arcRenderContribitions=e,this.numberType=Cc,this.builtinContributions=[qu,Yu,Ju],this.init(e)}drawArcTailCapPath(e,t,n,r,i,a,o,s){let c=s-o,l=e.getParsedAngle(),u=l.startAngle,d=l.endAngle;d=s;let f=d>u,p=!1;if(i<a){let e=i;i=a,a=e}let{outerDeltaAngle:m,xors:h,yors:g,xirs:_,yirs:v,limitedOcr:y,outerCornerRadiusStart:b,outerCornerRadiusEnd:x,maxOuterCornerRadius:S,xore:C,yore:w,xire:T,yire:E,limitedIcr:D,innerDeltaAngle:O,innerStartAngle:k,innerCornerRadiusStart:A,innerCornerRadiusEnd:j,maxInnerCornerRadius:ee}=yl(e,u,d,a,i);if(y>Le){let e=Ge(b,y),a=Ge(x,y),o=vl(_,v,h,g,i,e,Number(f)),s=vl(C,w,T,E,i,a,Number(f));if(y<S&&e===a)t.moveTo(n+o.cx+o.x01,r+o.cy+o.y01),t.arc(n+o.cx,r+o.cy,y,He(o.y01,o.x01),He(s.y01,s.x01),!f);else{let e=d-c-.03,o=He(s.y11,s.x11);t.arc(n,r,i,e,o,!f),a>0&&t.arc(n+s.cx,r+s.cy,a,He(s.y11,s.x11),He(s.y01,s.x01),!f)}}else t.moveTo(n+h,r+g);if(!(a>Le)||O<.001)t.lineTo(n+T,r+E),p=!0;else if(D>Le){let e=Ge(A,D),i=Ge(j,D),o=vl(T,E,C,w,a,-i,Number(f)),s=vl(h,g,_,v,a,-e,Number(f));if(t.lineTo(n+o.cx+o.x01,r+o.cy+o.y01),D<ee&&e===i){let e=He(s.y01,s.x01);t.arc(n+o.cx,r+o.cy,D,He(o.y01,o.x01),e,!f)}else{i>0&&t.arc(n+o.cx,r+o.cy,i,He(o.y01,o.x01),He(o.y11,o.x11),!f);let e=He(o.cy+o.y11,o.cx+o.x11),s=d-c-.03;t.arc(n,r,a,e,s,f)}}else t.lineTo(n+a*Ue(k),r+a*Ke(k));return p}drawShape(e,t,n,r,i,a,o,s){let c=Qa(e,a?.theme).arc,{fill:l=c.fill,stroke:d=c.stroke,x:f=c.x,y:p=c.y,fillStrokeOrder:m=c.fillStrokeOrder}=e.attribute,h=this.valid(e,c,o,s);if(!h)return;let{fVisible:g,sVisible:_,doFill:v,doStroke:y}=h,{outerPadding:b=c.outerPadding,innerPadding:x=c.innerPadding,cap:S=c.cap,forceShowCap:C=c.forceShowCap}=e.attribute,{outerRadius:w=c.outerRadius,innerRadius:T=c.innerRadius}=e.attribute;w+=b,T-=x;let E=0,D=(u(S)&&S||S[0])&&l.gradient===\`conical\`;if(D){let{sc:t,startAngle:n,endAngle:r}=e.getParsedAngle();Ve(r-n)<F-Le&&(E=t||0,l.startAngle-=E,l.endAngle-=E)}let O=!1,{isFullStroke:k,stroke:A}=(e=>{var t;let n=!0;if(u(e,!0)){for(let r=0;r<4;r++)To[r]=e,n&&=!((t=To[r])!=null&&!t);n=e}else if(Array.isArray(e))for(let t=0;t<4;t++)To[t]=!!e[t],n&&=!!To[t];else To[0]=!1,To[1]=!1,To[2]=!1,To[3]=!1;return{isFullStroke:n,stroke:To}})(d);if(v||k){t.beginPath(),bl(e,t,n,r,w,T),O=!0,t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,n,r,v,y,g,_,c,i,o,s);let a=()=>{v&&(o?o(t,e.attribute,c):g&&(t.setCommonStyle(e,e.attribute,f-n,p-r,c),t.fill()))},l=()=>{y&&k&&(s?s(t,e.attribute,c):_&&(t.setStrokeStyle(e,e.attribute,f-n,p-r,c),t.stroke()))};m?(l(),a()):(a(),l())}if(!k&&y&&(t.beginPath(),bl(e,t,n,r,w,T,A),O||this.beforeRenderStep(e,t,n,r,v,y,g,_,c,i,o,s),s?s(t,e.attribute,c):_&&(t.setStrokeStyle(e,e.attribute,n,r,c),t.stroke())),(u(S)&&S||S[1])&&C){let{startAngle:a,endAngle:l}=e.getParsedAngle();if(Ve(l-a)>=F-Le){t.beginPath();let a=Math.abs(w-T)/2/w,{endAngle:l=c.endAngle,fill:u=c.fill}=e.attribute,d=l;this.drawArcTailCapPath(e,t,n,r,w,T,d,d+a),O||this.beforeRenderStep(e,t,n,r,v,y,g,_,c,i,o,s),(()=>{if(v){let i=u;if(i.gradient===\`conical\`){let a=function(e,t,n,r){let{stops:i,startAngle:a,endAngle:o}=r;for(;n<0;)n+=F;for(;n>F;)n-=F;if(n<a||n>o)return i[0].color;let s,c,l=(n-a)/(o-a);for(let e=0;e<i.length;e++)if(i[e].offset>=l){s=i[e-1],c=i[e];break}return l=(l-s.offset)/(c.offset-s.offset),Uo(s.color,c.color,l,!1)}(0,0,l,i);o||ml&&(t.setCommonStyle(e,e.attribute,n,r,c),t.fillStyle=a,t.fill())}}})(),y&&(s||_&&(t.setStrokeStyle(e,e.attribute,n,r,c),t.stroke()))}}this.afterRenderStep(e,t,n,r,v,y,g,_,c,i,o,s),D&&(l.startAngle+=E,l.endAngle+=E)}draw(e,t,n,r){let i=Qa(e,r?.theme).arc;this._draw(e,i,!1,n,r)}};function hd(e,t,n,r){if(!t.p1)return;let{offsetX:i=0,offsetY:a=0,offsetZ:o=0}=r||{};if(n===1)t.p2&&t.p3?e.bezierCurveTo(i+t.p1.x,a+t.p1.y,i+t.p2.x,a+t.p2.y,i+t.p3.x,a+t.p3.y,o):e.lineTo(i+t.p1.x,a+t.p1.y,o);else if(t.p2&&t.p3){let[r]=Ir(t,n);e.bezierCurveTo(i+r.p1.x,a+r.p1.y,i+r.p2.x,a+r.p2.y,i+r.p3.x,a+r.p3.y,o)}else{let r=t.getPointAt(n);e.lineTo(i+r.x,a+r.y,o)}}function gd(e,t,n,r,i,a,o){let s=t.p0,c=r;if(n&&n.originP1===n.originP2&&(s=n.p0),t.defined)r||(e.lineTo(s.x+i,s.y+a,o),c=!r);else{let{originP1:l,originP2:u}=t,d;if(l&&!1!==l.defined&&!n?d=s:l&&!1!==u.defined&&(d=t.p3??t.p1),r){c=!r;let n=d?d.x:t.p0.x,s=d?d.y:t.p0.y;e.moveTo(n+i,s+a,o)}else d&&(c=!r,e.lineTo(d.x+i,d.y+a,o))}return c}function _d(e,t,n,r,i){let{offsetX:a=0,offsetY:o=0,offsetZ:s=0,mode:c=\`none\`,drawConnect:l=!1}=i||{};if(l&&c===\`none\`||!t)return;let u=!0,{curves:d}=t;if(n>=1){if(l){let t,n=!0;d.forEach(((r,i)=>{r.originP1===r.originP2||(n=gd(e,r,t,n,a,o,s)),t=r}))}else d.forEach((t=>{t.defined?(u&&e.moveTo(t.p0.x+a,t.p0.y+o,s),hd(e,t,1,i),u=!1):u=!0}));return}if(n<=0)return;let f;r===\`x\`?f=Sr.ROW:r===\`y\`?f=Sr.COLUMN:r===\`auto\`&&(f=t.direction);let p=n*t.tryUpdateLength(f),m=0,h=!0,g=null;for(let t=0,n=d.length;t<n;t++){let n=d[t],r=n.getLength(f),c=(p-m)/r;if(m+=r,c<0)break;if(l){if(n.originP1===n.originP2){g=n;continue}h=gd(e,n,g,h,a,o,s),g=n}else{if(!n.defined){u=!0;continue}u&&e.moveTo(n.p0.x+a,n.p0.y+o,s),hd(e,n,Ge(c,1),i),u=!1}}}md=dd([R(),pd(0,L(Kn)),pd(0,Fn(wl)),fd(\`design:paramtypes\`,[Object])],md);var vd=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let yd=class extends ud{constructor(){super(...arguments),this.numberType=Ac}draw(e,t,n,r){let i=Qa(e,r?.theme).line;this._draw(e,i,!1,n,r)}drawSegmentItem(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m){if(!t)return;e.beginPath();let h=this.z??0;_d(e.camera?e:e.nativeContext,t,c,l,{offsetX:u,offsetY:d,offsetZ:h}),f.cache&&!y(f.cache)&&f.cache.curves.every((e=>e.defined))&&f.attribute.curveType&&f.attribute.curveType.includes(\`Closed\`)&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(f,o,s);let{x:g=0,x:_=0}=o;return!1!==n&&(p?p(e,o,s):i&&(e.setCommonStyle(f,o,g-u,_-d,s),e.fill())),!1!==r&&(m?m(e,o,s):a&&(e.setStrokeStyle(f,o,g-u,_-d,s),e.stroke())),!1}drawLinearLineHighPerformance(e,t,n,r,i,a,o,s,c,l,u,d,f){t.beginPath();let p=this.z??0,{points:m}=e.attribute,h=m[0];t.moveTo(h.x+o,h.y+s,p);for(let e=1;e<m.length;e++){let n=m[e];t.lineTo(n.x+o,n.y+s,p)}t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c);let{x:g=0,x:_=0}=e.attribute;!1!==n&&(d?d(t,e.attribute,c):i&&(t.setCommonStyle(e,e.attribute,g-o,_-s,c),t.fill())),!1!==r&&(f?f(t,e.attribute,c):a&&(t.setStrokeStyle(e,e.attribute,g-o,_-s,c),t.stroke()))}drawShape(e,t,n,r,i,a,o,s){let c=Qa(e,a?.theme).line,{fill:l=c.fill,stroke:u=c.stroke,fillOpacity:d=c.fillOpacity,strokeOpacity:f=c.strokeOpacity,segments:p,points:m,closePath:h,curveTension:g=c.curveTension,connectedType:_=c.connectedType}=e.attribute;if(!this.valid(e,c,o,s))return;let{curveType:v=c.curveType}=e.attribute;h&&v===\`linear\`&&(v=\`linearClosed\`);let{clipRange:y=c.clipRange,clipRangeByDimension:b=c.clipRangeByDimension}=e.attribute;if(y===1&&!p&&!m.some((e=>!1===e.defined))&&v===\`linear\`)return this.drawLinearLineHighPerformance(e,t,!!l,!!u,d,f,n,r,c,i,a,o,s);function x(e,t){return t===\`none\`?e:e.filter((e=>!1!==e.defined))}if(e.shouldUpdateShape()){let{points:t,segments:n}=e.attribute,r=t;if(n&&n.length){let t,r;if(e.cache=n.map(((e,n)=>{if(e.points.length<=1&&n===0)return e.points[0]&&(r={endX:e.points[0].x,endY:e.points[0].y,curves:[{defined:!1!==e.points[0].defined}]}),null;n===1?t={x:r.endX,y:r.endY,defined:r.curves[r.curves.length-1].defined}:n>1&&(t.x=r.endX,t.y=r.endY,t.defined=r.curves[r.curves.length-1].defined);let i=fi(x(e.points,_),v,{startPoint:t,curveTension:g});return r=i,i})).filter((e=>!!e)),v===\`linearClosed\`){let t;for(let n=0;n<e.cache.length;n++){let r=e.cache[n];for(let e=0;e<r.curves.length;e++)if(r.curves[e].defined){t=r.curves[e].p0;break}if(t)break}e.cache[e.cache.length-1]&&e.cache[e.cache.length-1].lineTo(t.x,t.y,!0)}}else{if(!t||!t.length)return e.cache=null,void e.clearUpdateShapeTag();e.cache=fi(x(r,_),v,{curveTension:g})}e.clearUpdateShapeTag()}if(Array.isArray(e.cache)){let i=e.attribute.segments.filter((e=>e.points.length));if(i[0].points.length===1&&i.shift(),y===1){let a=!1;e.cache.forEach(((p,m)=>{a||=this.drawSegmentItem(t,p,!!l,!!u,d,f,i[m],[c,e.attribute],y,b,n,r,e,o,s)}))}else{let a=e.cache.reduce(((e,t)=>e+t.getLength()),0),p=y*a,m=0,h=!1;e.cache.forEach(((a,g)=>{if(h)return;let _=a.getLength(),v=(p-m)/_;m+=_,v>0&&(h=this.drawSegmentItem(t,a,!!l,!!u,d,f,i[g],[c,e.attribute],Ge(v,1),b,n,r,e,o,s))}))}}else this.drawSegmentItem(t,e.cache,!!l,!!u,d,f,e.attribute,c,y,b,n,r,e,o,s)}};function bd(e,t,n,r){let{offsetX:i=0,offsetY:a=0,offsetZ:o=0}=r||{},s=!0;t.forEach((t=>{t.defined?(s&&e.moveTo(t.p0.x+i,t.p0.y+a,o),hd(e,t,1,r),s=!1):s=!0})),s=!0;for(let t=n.length-1;t>=0;t--){let c=n[t];c.defined?(s&&e.lineTo(c.p0.x+i,c.p0.y+a,o),hd(e,c,1,r),s=!1):s=!0}e.closePath()}yd=vd([R()],yd);let xd=new class extends Gu{constructor(){super(...arguments),this.time=wr.afterFillStroke}drawShape(e,t,n,r,i,a,o,s,c,l,u,d,f){this.textureMap||this.initTextureMap(t,e.stage);let{attribute:p=e.attribute}=f||{},{texture:m=e.attribute.texture??No(c,\`texture\`),textureColor:h=e.attribute.textureColor??No(c,\`textureColor\`),textureSize:g=e.attribute.textureSize??No(c,\`textureSize\`),texturePadding:_=e.attribute.texturePadding??No(c,\`texturePadding\`)}=p;m&&this.drawTexture(m,e,t,n,r,c,h,g,_)}},Sd=Vu;var Cd=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},wd=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Td=function(e,t){return function(n,r){t(n,r,e)}};let Ed=class extends ud{constructor(e){super(),this.areaRenderContribitions=e,this.numberType=Tc,this.builtinContributions=[xd,Sd],this.init(e)}drawLinearAreaHighPerformance(e,t,n,r,i,a,o,s,c,l,u,d,f){let{points:p}=e.attribute;if(p.length<2)return;t.beginPath();let m=this.z??0,h=p[0];t.moveTo(h.x+o,h.y+s,m);for(let e=1;e<p.length;e++){let n=p[e];t.lineTo(n.x+o,n.y+s,m)}for(let e=p.length-1;e>=0;e--){let n=p[e];t.lineTo((n.x1??n.x)+o,(n.y1??n.y)+s,m)}t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,o,s,!!i,!1,n,!1,c,l,d,null,{attribute:e.attribute});let{x:g=0,x:_=0}=e.attribute;!1!==n&&(d?d(t,e.attribute,c):i&&(t.setCommonStyle(e,e.attribute,g-o,_-s,c),t.fill())),this.afterRenderStep(e,t,o,s,!!i,!1,n,!1,c,l,d,null,{attribute:e.attribute}),(()=>{if(r){let{stroke:n=c&&c.stroke}=e.attribute;if(y(n)&&(n[0]||n[2])&&!1===n[1]){if(t.beginPath(),n[0]){t.moveTo(h.x+o,h.y+s,m);for(let e=1;e<p.length;e++){let n=p[e];t.lineTo(n.x+o,n.y+s,m)}}else if(n[2]){let e=p[p.length-1];t.moveTo(e.x+o,e.y+s,m);for(let e=p.length-2;e>=0;e--){let n=p[e];t.lineTo((n.x1??n.x)+o,(n.y1??n.y)+s,m)}}}f?f(t,e.attribute,c):(t.setStrokeStyle(e,e.attribute,g-o,_-s,c),t.stroke())}})()}drawShape(e,t,n,r,i,a,o,s){let c=Qa(e,a?.theme).area,{fill:l=c.fill,stroke:u=c.stroke,fillOpacity:d=c.fillOpacity,z:f=c.z,strokeOpacity:p=c.strokeOpacity,curveTension:m=c.curveTension,connectedType:h=c.connectedType}=e.attribute,g=this.valid(e,c,o,s);if(!g)return;let{doFill:_}=g,v=g.doStroke&&g.sVisible,{clipRange:y=c.clipRange,closePath:b,points:x,segments:S}=e.attribute,{curveType:C=c.curveType}=e.attribute;function w(e,t){return t===\`connect\`?e.filter((e=>!1!==e.defined)):e}if(b&&C===\`linear\`&&(C=\`linearClosed\`),y===1&&!S&&!x.some((e=>!1===e.defined))&&C===\`linear\`)return this.drawLinearAreaHighPerformance(e,t,!!l,v,d,p,n,r,c,i,a,o,s);if(e.shouldUpdateShape()){if(S&&S.length){let t,n,r=S.map(((e,r)=>{if(e.points.length<=1&&r===0)return e.points[0]&&(n={endX:e.points[0].x,endY:e.points[0].y}),null;r===1?t={x:n.endX,y:n.endY}:r>1&&(t.x=n.endX,t.y=n.endY);let i=fi(w(e.points,h),C,{startPoint:t,curveTension:m});return n=i,i})).filter((e=>!!e)),i,a=[];for(let e=S.length-1;e>=0;e--){let t=S[e].points,n=[];for(let e=t.length-1;e>=0;e--)n.push({x:t[e].x1??t[e].x,y:t[e].y1??t[e].y});if(e!==0){let t=S[e-1].points,r=t[t.length-1];r&&n.push({x:r.x1??r.x,y:r.y1??r.y})}n.length>1&&(i=fi(w(n,h),C===\`stepBefore\`?\`stepAfter\`:C===\`stepAfter\`?\`stepBefore\`:C,{curveTension:m}),a.unshift(i))}e.cacheArea=a.map(((e,t)=>({top:r[t],bottom:e})))}else{if(!x||!x.length)return e.cacheArea=null,void e.clearUpdateShapeTag();{let t=w(x,h),n=[];for(let e=t.length-1;e>=0;e--)n.push({x:t[e].x1??t[e].x,y:t[e].y1??t[e].y});let r=fi(t,C,{curveTension:m}),i=fi(n,C===\`stepBefore\`?\`stepAfter\`:C===\`stepAfter\`?\`stepBefore\`:C,{curveTension:m});e.cacheArea={top:r,bottom:i}}}e.clearUpdateShapeTag()}if(Array.isArray(e.cacheArea)){let a=e.attribute.segments.filter((e=>e.points.length));if(a[0].points.length===1&&a.shift(),y===1){let l=!1;e.cacheArea.forEach(((u,m)=>{l||=this.drawSegmentItem(t,u,_,d,v,p,a[m],[c,e.attribute],y,n,r,f,e,i,o,s)}))}else{let l=e.cacheArea.reduce(((e,t)=>e+t.top.getLength()),0),u=y*l,m=0,h=!1;e.cacheArea.forEach(((l,g)=>{if(h)return;let y=l.top.getLength(),b=(u-m)/y;m+=y,b>0&&(h=this.drawSegmentItem(t,l,_,d,v,p,a[g],[c,e.attribute],Ge(b,1),n,r,f,e,i,o,s))}))}}else this.drawSegmentItem(t,e.cacheArea,_,d,v,p,e.attribute,c,y,n,r,f,e,i,o,s)}draw(e,t,n,r){let i=Qa(e,r?.theme).area;this._draw(e,i,!1,n,r)}drawSegmentItem(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){return this._drawSegmentItem(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h)}_drawSegmentItem(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){if(!(t&&t.top&&t.bottom&&t.top.curves&&t.top.curves.length&&t.bottom.curves&&t.bottom.curves.length))return;e.beginPath();let{points:g,segments:_}=f.attribute,v,b,x=Sr.ROW;if(_){let e=_[_.length-1];b=_[0].points[0],v=e.points[e.points.length-1]}else b=g[0],v=g[g.length-1];let S=Ve(v.x-b.x),C=Ve(v.y-b.y);x=v.x1==null?Sr.ROW:v.y1==null?Sr.COLUMN:Number.isFinite(S+C)?S>C?Sr.ROW:Sr.COLUMN:Sr.ROW,function(e,t,n,r){let{top:i,bottom:a}=t;if(i.curves.length!==a.curves.length)return;if(n>=1){let t=[],n=[],o=!0;for(let s=0,c=i.curves.length;s<c;s++){let l=i.curves[s];o===l.defined?o&&(t.push(l),n.push(a.curves[c-s-1])):(o?(bd(e,t,n,r),t.length=0,n.length=0):(t.push(l),n.push(a.curves[c-s-1])),o=!o)}bd(e,t,n,r);return}if(n<=0)return;let{direction:o}=r||{},{curves:s}=i,c=s[s.length-1].p3??s[s.length-1].p1,l=Ve(c.x-s[0].p0.x),u=Ve(c.y-s[0].p0.y);o??=l>u?Sr.ROW:Sr.COLUMN,Number.isFinite(l)||(o=Sr.COLUMN),Number.isFinite(u)||(o=Sr.ROW);let d=n*(o===Sr.ROW?l:u),f=0,p=!0,m=[],h=[];for(let t=0,n=i.curves.length;t<n;t++){let s=i.curves[t],c=s.getLength(o),l=(d-f)/c;if(l<0)break;f+=c;let u=null,g=null;p===s.defined?p&&(u=s,g=a.curves[n-t-1]):(p?(bd(e,m,h,r),m.length=0,h.length=0):(u=s,g=a.curves[n-t-1]),p=!p),u&&g&&(l<1&&(u=u.p2&&u.p3?Ir(u,l)[0]:Rr(u,l)[0],g=g.p2&&g.p3?Ir(g,1-l)[1]:Rr(g,1-l)[1]),u.defined=p,g.defined=p,m.push(u),h.push(g)),u=null,g=null}bd(e,m,h,r)}(e.camera?e:e.nativeContext,t,c,{offsetX:l,offsetY:u,offsetZ:d,direction:x}),this.beforeRenderStep(f,e,l,u,!!r,!1,n,!1,s,p,m,null,{attribute:o}),e.setShadowBlendStyle&&e.setShadowBlendStyle(f,o,s);let{x:w=0,x:T=0}=o;return!1!==n&&(m?m(e,o,s):r&&(e.setCommonStyle(f,o,w-l,T-u,s),e.fill())),this.afterRenderStep(f,e,l,u,!!r,!1,n,!1,s,p,m,null,{attribute:o}),(()=>{if(!1!==i)if(h)h(e,o,s);else{let{stroke:n=s&&s[1]&&s[1].stroke}=o;y(n)&&(n[0]||n[2])&&!1===n[1]&&(e.beginPath(),_d(e.camera?e:e.nativeContext,n[0]?t.top:t.bottom,c,x===Sr.ROW?\`x\`:\`y\`,{offsetX:l,offsetY:u,offsetZ:d})),e.setStrokeStyle(f,o,w-l,T-u,s),e.stroke()}})(),!1}};Ed=Cd([R(),Td(0,L(Kn)),Td(0,Fn(Tl)),wd(\`design:paramtypes\`,[Object])],Ed);let Dd=Ku,Od=Vu;var kd=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ad=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},jd=function(e,t){return function(n,r){t(n,r,e)}};let Md=class extends ud{constructor(e){super(),this.pathRenderContribitions=e,this.numberType=jc,this.builtinContributions=[Od,Dd],this.init(e)}drawShape(e,t,n,r,i,a,o,s){let c=this.tempTheme??Qa(e,a?.theme).path,{x:l=c.x,y:u=c.y,fillStrokeOrder:d=c.fillStrokeOrder}=e.attribute,f=this.z??0,p=this.valid(e,c,o,s);if(!p)return;let{fVisible:m,sVisible:h,doFill:g,doStroke:_}=p;t.beginPath(),e.pathShape?Or(e.pathShape.commandList,t,n,r,1,1,f):Or((e.attribute.path??c.path).commandList,t,n,r,1,1,f),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,n,r,g,_,m,h,c,i,o,s);let v=()=>{_&&(s?s(t,e.attribute,c):h&&(t.setStrokeStyle(e,e.attribute,l-n,u-r,c),t.stroke()))},y=()=>{g&&(o?o(t,e.attribute,c):m&&(t.setCommonStyle(e,e.attribute,l-n,u-r,c),t.fill()))};d?(v(),y()):(y(),v()),this.afterRenderStep(e,t,n,r,g,_,m,h,c,i,o,s)}draw(e,t,n,r){let i=Qa(e,r?.theme).path;this.tempTheme=i,this._draw(e,i,!1,n,r),this.tempTheme=null}};Md=kd([R(),jd(0,L(Kn)),jd(0,Fn(Dl)),Ad(\`design:paramtypes\`,[Object])],Md);var Nd=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Pd=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Fd=function(e,t){return function(n,r){t(n,r,e)}};let Id=class extends ud{constructor(e){super(),this.rectRenderContribitions=e,this.type=\`rect\`,this.numberType=Nc,this.builtinContributions=[nd,id,rd],this.init(e)}drawShape(e,t,n,r,i,a,o,s){let c=this.tempTheme??Qa(e,a?.theme).rect,{fill:l=c.fill,background:u,stroke:d=c.stroke,cornerRadius:f=c.cornerRadius,cornerType:p=c.cornerType,opacity:m=c.opacity,fillOpacity:h=c.fillOpacity,lineWidth:g=c.lineWidth,strokeOpacity:_=c.strokeOpacity,visible:v=c.visible,x1:b,y1:x,x:S=c.x,y:C=c.y,fillStrokeOrder:w=c.fillStrokeOrder}=e.attribute,{width:T,height:E}=e.attribute;T=(T??b-S)||0,E=(E??x-C)||0;let D=hl(m,h,T,E,l),O=_l(m,_,T,E),k=fl(l,u),A=pl(d,g);if(!e.valid||!v||!k&&!A||!(D||O||o||s||u))return;f===0||y(f)&&f.every((e=>e===0))?(t.beginPath(),t.rect(n,r,T,E)):(t.beginPath(),Qu(t,n,r,T,E,f,p!==\`bevel\`));let j={doFill:k,doStroke:A};t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,n,r,k,A,D,O,c,i,o,s,j);let ee=()=>{j.doFill&&(o?o(t,e.attribute,c):D&&(t.setCommonStyle(e,e.attribute,S-n,C-r,c),t.fill()))},te=()=>{j.doStroke&&(s?s(t,e.attribute,c):O&&(t.setStrokeStyle(e,e.attribute,S-n,C-r,c),t.stroke()))};w?(te(),ee()):(ee(),te()),this.afterRenderStep(e,t,n,r,k,A,D,O,c,i,o,s)}draw(e,t,n,r){let i=Qa(e,r?.theme).rect;this.tempTheme=i,this._draw(e,i,!1,n,r),this.tempTheme=null}};Id=Nd([R(),Fd(0,L(Kn)),Fd(0,Fn(kl)),Pd(\`design:paramtypes\`,[Object])],Id);var Ld=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Rd=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},zd=function(e,t){return function(n,r){t(n,r,e)}};let Bd=class extends ud{constructor(e){super(),this.symbolRenderContribitions=e,this.numberType=Fc,this.builtinContributions=[ad,cd,sd,od],this.init(e)}drawShape(e,t,n,r,i,a,o,s){let c=Qa(e,a?.theme).symbol,{size:l=c.size,x:u=c.x,y:d=c.y,scaleX:f=c.scaleX,scaleY:p=c.scaleY,fillStrokeOrder:m=c.fillStrokeOrder,clipRange:h=c.clipRange}=e.attribute,g=this.valid(e,c,o,s);if(!g)return;let{fVisible:_,sVisible:v,doFill:b,doStroke:x}=g,S=e.getParsedPath();if(!S)return;let{keepDirIn3d:C=c.keepDirIn3d}=e.attribute,w=this.z??0;t.beginPath();let T=n,E=r,D=w,O=t.camera;if(C&&O&&t.project){let e=t.project(n,r,w);t.camera=null,y(l)&&(l[0],l[1]),T=e.x,E=e.y,D=void 0}!1===S.draw(t,l,T,E,D,((i,a)=>{if(e._parsedPath.svgCache){let t=Object.assign({},a);t.fill=a.fill??e.attribute.fill,t.opacity=a.opacity??e.attribute.opacity,t.fillOpacity=e.attribute.fillOpacity,t.stroke=a.stroke??e.attribute.stroke,t.lineWidth=a.lineWidth??e.attribute.lineWidth,a=t}let l=()=>{a.fill&&(o?o(t,e.attribute,c):(t.setCommonStyle(e,a,u-n,d-r,c),t.fill()))},g=()=>{a.stroke&&(s?s(t,e.attribute,c):v&&h>=1&&(t.setStrokeStyle(e,a,(u-n)/f,(d-r)/p,c),t.stroke()))};m?(g(),l()):(l(),g())}))&&t.closePath(),t.camera=O,t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,n,r,b,x,_,v,c,i,o,s);let k=()=>{b&&!S.isSvg&&(o?o(t,e.attribute,c):_&&(t.setCommonStyle(e,e.attribute,u-n,d-r,c),t.fill()))},A=()=>{x&&!S.isSvg&&(s?s(t,e.attribute,c):v&&h>=1&&(t.setStrokeStyle(e,e.attribute,(u-n)/f,(d-r)/p,c),t.stroke()))};m?(A(),k()):(k(),A()),this.afterRenderStep(e,t,n,r,b,x,_,v,c,i,o,s)}draw(e,t,n,r){let i=Qa(e,r?.theme).symbol;this._draw(e,i,!1,n,r)}};Bd=Ld([R(),zd(0,L(Kn)),zd(0,Fn(Al)),Rd(\`design:paramtypes\`,[Object])],Bd);let Vd=new class{constructor(){this.pools=[];for(let e=0;e<10;e++)this.pools.push(new St)}allocate(e,t,n,r){if(!this.pools.length)return new St().setValue(e,t,n,r);let i=this.pools.pop();return i.x1=e,i.y1=t,i.x2=n,i.y2=r,i}allocateByObj(e){if(!this.pools.length)return new St(e);let t=this.pools.pop();return t.x1=e.x1,t.y1=e.y1,t.x2=e.x2,t.y2=e.y2,t}free(e){this.pools.push(e)}get length(){return this.pools.length}release(){this.pools=[]}},Hd=new class extends Bu{constructor(){super(...arguments),this.time=wr.beforeFillStroke}drawShape(e,t,n,r,i,a,o,s,c,l,u,d){let{backgroundMode:f=c.backgroundMode,backgroundFit:p=c.backgroundFit,backgroundKeepAspectRatio:h=c.backgroundKeepAspectRatio}=e.attribute,g,{background:_}=e.attribute;if(!_)return;let v=()=>{e.type===\`richtext\`&&(t.restore(),t.save(),g&&t.setTransformFromMatrix(g,!0,1))},y;e.type===\`richtext\`&&(g=t.currentMatrix.clone(),t.restore(),t.save(),t.setTransformForCurrent());let b=m(_)&&_.background,x=e.transMatrix.onlyTranslate();if(b){let t=e.AABBBounds,n=(_.x??t.x1)+(_.dx??0),r=(_.y??t.y1)+(_.dy??0),i=_.width??t.width(),a=_.height??t.height();if(y=Vd.allocate(n,r,n+i,r+a),_=_.background,!x){let e=y.width(),t=y.height();y.set((_.x??0)+(_.dx??0),(_.y??0)+(_.dy??0),e,t)}}else y=e.AABBBounds,x||(y=Iu(Object.assign(Object.assign({},e.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(e.backgroundImg&&e.resources){let i=e.resources.get(_);if(i.state!==\`success\`||!i.data)return void v();t.highPerformanceSave(),x&&t.setTransformFromMatrix(e.parent.globalTransMatrix,!0),t.setCommonStyle(e,e.attribute,n,r,c),this.doDrawImage(t,i.data,y,{backgroundMode:f,backgroundFit:p,backgroundKeepAspectRatio:h}),t.highPerformanceRestore(),t.setTransformForCurrent()}else{let{backgroundCornerRadius:i}=e.attribute;t.highPerformanceSave(),t.setCommonStyle(e,e.attribute,n,r,c),t.fillStyle=_,i?(Qu(t,y.x1,y.y1,y.width(),y.height(),i,!0),t.fill()):t.fillRect(y.x1,y.y1,y.width(),y.height()),t.highPerformanceRestore()}b&&Vd.free(y),v()}};var Ud=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Wd=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Gd=function(e,t){return function(n,r){t(n,r,e)}};let Kd=class extends ud{constructor(e){super(),this.textRenderContribitions=e,this.numberType=Ic,this.builtinContributions=[Hd],this.init(e)}drawShape(e,t,n,r,i,a,o,s){let c=Qa(e,a?.theme).text,{text:l,underline:u=c.underline,lineThrough:d=c.lineThrough,keepDirIn3d:f=c.keepDirIn3d,direction:p=c.direction,fontSize:m=c.fontSize,verticalMode:h=c.verticalMode,x:g=c.x,y:_=c.y}=e.attribute,v=Io(e.attribute.lineHeight,m)??m,y=this.valid(e,c,o,s);if(!y)return;let{fVisible:b,sVisible:x,doFill:S,doStroke:C}=y,w=!f,T=this.z||0;t.beginPath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,n,r,S,C,b,x,c,i,o,s),w&&this.transformUseContext2d(e,c,T,t);let E=(i,a,l,u)=>{let d=n+a,f=r+l;if(u){t.highPerformanceSave(),d+=m;let e=Vl.allocate(1,0,0,1,0,0);e.rotateByCenter(Math.PI/2,d,f),t.transformFromMatrix(e,!0),Vl.free(e)}C&&(s?s(t,e.attribute,c):x&&(t.setStrokeStyle(e,e.attribute,g-n,_-r,c),t.strokeText(i,d,f,T))),S&&(o?o(t,e.attribute,c):b&&(t.setCommonStyle(e,e.attribute,g-n,_-r,c),t.fillText(i,d,f,T))),u&&(t.highPerformanceRestore(),t.setTransformForCurrent())};if(t.setTextStyleWithoutAlignBaseline(e.attribute,c,T),p===\`horizontal\`){let{multilineLayout:i}=e;if(!i)return void t.highPerformanceRestore();let{xOffset:a,yOffset:l}=i.bbox;C&&(s?s(t,e.attribute,c):x&&(t.setStrokeStyle(e,e.attribute,g-n,_-r,c),i.lines.forEach((e=>{t.strokeText(e.str,(e.leftOffset||0)+a+n,(e.topOffset||0)+l+r,T)})))),S&&(o?o(t,e.attribute,c):b&&(t.setCommonStyle(e,e.attribute,g-n,_-r,c),i.lines.forEach((i=>{t.fillText(i.str,(i.leftOffset||0)+a+n,(i.topOffset||0)+l+r,T),this.drawUnderLine(u,d,e,(i.leftOffset||0)+a+n,(i.topOffset||0)+l+r,i.descent,(i.descent-i.ascent)/2,T,c,t,{width:i.width})}))))}else{let{textAlign:n=c.textAlign,textBaseline:r=c.textBaseline}=e.attribute;if(!h){let t=n;n=e.getBaselineMapAlign()[r]??\`left\`,r=e.getAlignMapBaseline()[t]??\`top\`}e.tryUpdateAABBBounds();let{verticalList:i}=e.cache;t.textAlign=\`left\`,t.textBaseline=\`top\`;let a=v*i.length,o=0;i.forEach((e=>{let t=e.reduce(((e,t)=>e+(t.width||0)),0);o=We(t,o)}));let s=0,l=0;r===\`bottom\`?l=-a:r===\`middle\`&&(l=-a/2),n===\`center\`?s-=o/2:n===\`right\`&&(s-=o),i.forEach(((e,t)=>{let r=e.reduce(((e,t)=>e+(t.width||0)),0),i=o-r,c=s;n===\`center\`?c+=i/2:n===\`right\`&&(c+=i),e.forEach((e=>{let{text:n,width:r,direction:i}=e;E(n,a-(t+1)*v+l,c,i),c+=r}))}))}w&&this.restoreTransformUseContext2d(e,c,T,t),this.afterRenderStep(e,t,n,r,S,C,b,x,c,i,o,s)}draw(e,t,n,r){let i=Qa(e,r?.theme).text,{keepDirIn3d:a=i.keepDirIn3d}=e.attribute,o=!a;this._draw(e,i,o,n,r)}drawUnderLine(e,t,n,r,i,a,o,s,c,l,u){if(t+e<=0)return;let{textAlign:d=c.textAlign,fill:p=c.fill,opacity:m=c.opacity,underlineOffset:h=c.underlineOffset,underlineDash:g=c.underlineDash,fillOpacity:_=c.fillOpacity}=n.attribute,v=!f(u),y=v?u.width:n.clipedWidth,b=v?0:Nl(d,y),x={lineWidth:0,stroke:p,opacity:m,strokeOpacity:_};if(e){x.lineWidth=e,l.setStrokeStyle(n,x,r,i,c),g&&l.setLineDash(g),l.beginPath();let t=i+a+h;l.moveTo(r+b,t,s),l.lineTo(r+b+y,t,s),l.stroke()}if(t){x.lineWidth=t,l.setStrokeStyle(n,x,r,i,c),l.beginPath();let e=i+o;l.moveTo(r+b,e,s),l.lineTo(r+b+y,e,s),l.stroke()}}};function qd(e,t,n,r){e.moveTo(t[0].x+n,t[0].y+r);for(let i=1;i<t.length;i++)e.lineTo(t[i].x+n,t[i].y+r)}function Jd(e,t){return Math.sqrt(e*e+t*t)}function Yd(e,t,n,r,i){let a=t/n;return{x:e.x-r*a,y:e.y-i*a}}Kd=Ud([R(),Gd(0,L(Kn)),Gd(0,Fn(jl)),Wd(\`design:paramtypes\`,[Object])],Kd);let Xd=Ku,Zd=Vu;var Qd=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},$d=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},ef=function(e,t){return function(n,r){t(n,r,e)}};let tf=class extends ud{constructor(e){super(),this.polygonRenderContribitions=e,this.numberType=Mc,this.builtinContributions=[Zd,Xd],this.init(e)}drawShape(e,t,n,r,i,a,o,s){let c=Qa(e,a?.theme).polygon,{points:l=c.points,cornerRadius:u=c.cornerRadius,x:d=c.x,y:f=c.y,closePath:p=c.closePath,fillStrokeOrder:m=c.fillStrokeOrder}=e.attribute,h=this.valid(e,c,o,s);if(!h)return;let{fVisible:g,sVisible:_,doFill:v,doStroke:b}=h;t.beginPath(),u<=0||y(u)&&u.every((e=>e===0))?qd(t.camera?t:t.nativeContext,l,n,r):function(e,t,n,r,i){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];if(t.length<3)return void qd(e,t,n,r);let o=0,s=t.length-1;a||(o+=1,--s,e.moveTo(t[0].x+n,t[0].y+r));for(let a=o;a<=s;a++){let o=t[a===0?s:(a-1)%t.length],c=t[a%t.length],l=t[(a+1)%t.length],u=c.x-o.x,d=c.y-o.y,f=c.x-l.x,p=c.y-l.y,m=(Math.atan2(d,u)-Math.atan2(p,f))/2,h=Math.abs(Math.tan(m)),g=Array.isArray(i)?i[a%t.length]??0:i,_=g/h,v=Jd(u,d),y=Jd(f,p),b=Math.min(v,y);_>b&&(_=b,g=b*h);let x=Yd(c,_,v,u,d),S=Yd(c,_,y,f,p),C=2*c.x-x.x-S.x,w=2*c.y-x.y-S.y,T=Jd(C,w),E=Yd(c,Jd(_,g),T,C,w),D=Math.atan2(x.y-E.y,x.x-E.x),O=Math.atan2(S.y-E.y,S.x-E.x),k=O-D;k<0&&(D=O,k=-k),k>Math.PI&&(k-=Math.PI),a===0?e.moveTo(x.x+n,x.y+r):e.lineTo(x.x+n,x.y+r),k&&e.arcTo(c.x+n,c.y+r,S.x+n,S.y+r,g),e.lineTo(S.x+n,S.y+r)}a||e.lineTo(t[s+1].x+n,t[s+1].y+r)}(t.camera?t:t.nativeContext,l,n,r,u,p),p&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this.beforeRenderStep(e,t,n,r,v,b,g,_,c,i,o,s);let x=()=>{v&&(o?o(t,e.attribute,c):g&&(t.setCommonStyle(e,e.attribute,d-n,f-r,c),t.fill()))},S=()=>{b&&(s?s(t,e.attribute,c):_&&(t.setStrokeStyle(e,e.attribute,d-n,f-r,c),t.stroke()))};m?(S(),x()):(x(),S()),this.afterRenderStep(e,t,n,r,v,b,g,_,c,i,o,s)}draw(e,t,n,r){let i=Qa(e,r?.theme).polygon;this._draw(e,i,!1,n,r)}};tf=Qd([R(),ef(0,L(Kn)),ef(0,Fn(Ol)),$d(\`design:paramtypes\`,[Object])],tf);var nf=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},rf=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},af=function(e,t){return function(n,r){t(n,r,e)}};let sf=class{constructor(e){this.groupRenderContribitions=e,this.numberType=Oc}drawShape(e,t,n,r,i,a,o,s){let c=Qa(e,a?.theme).group,{fill:l=c.fill,background:u,stroke:d=c.stroke,opacity:f=c.opacity,width:p=c.width,height:m=c.height,clip:h=c.clip,fillOpacity:g=c.fillOpacity,strokeOpacity:_=c.strokeOpacity,cornerRadius:v=c.cornerRadius,path:b=c.path,lineWidth:x=c.lineWidth,visible:S=c.visible,fillStrokeOrder:C=c.fillStrokeOrder,cornerType:w=c.cornerType,x:T=c.x,y:E=c.y}=e.attribute,D=hl(f,g,p,m,l),O=_l(f,_,p,m),k=fl(l,u),A=pl(d,x);if(!e.valid||!S||!h&&(!k&&!A||!(D||O||o||s||u)))return;if(b&&b.length&&i.drawContribution){let e=t.disableFill,n=t.disableStroke,r=t.disableBeginPath;t.disableFill=!0,t.disableStroke=!0,t.disableBeginPath=!0,b.forEach((e=>{i.drawContribution.getRenderContribution(e).draw(e,i.renderService,i,a)})),t.disableFill=e,t.disableStroke=n,t.disableBeginPath=r}else v===0||y(v)&&v.every((e=>e===0))?(t.beginPath(),t.rect(n,r,p,m)):(t.beginPath(),Qu(t,n,r,p,m,v,w!==\`bevel\`));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(Xu));let j={doFill:k,doStroke:A};t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,c),this._groupRenderContribitions.forEach((a=>{a.time===wr.beforeFillStroke&&a.drawShape(e,t,n,r,k,A,D,O,c,i,o,s,j)})),h&&t.clip();let ee=()=>{j.doFill&&(o?o(t,e.attribute,c):D&&(t.setCommonStyle(e,e.attribute,T-n,E-r,c),t.fill()))},te=()=>{j.doStroke&&(s?s(t,e.attribute,c):O&&(t.setStrokeStyle(e,e.attribute,T-n,E-r,c),t.stroke()))};C?(te(),ee()):(ee(),te()),this._groupRenderContribitions.forEach((a=>{a.time===wr.afterFillStroke&&a.drawShape(e,t,n,r,k,A,D,O,c,i,o,s)}))}draw(e,t,n,r){let{context:i}=n;if(!i)return;let{clip:a,baseOpacity:o=1,drawMode:s,x:c,y:l,width:u,height:d}=e.attribute,f=i.nativeContext,p=i.canvas.nativeCanvas;if(s>0){let e=i.canvas,t=jp.createCanvas({width:e.width,height:e.height,dpr:1}),n=t.getContext(\`2d\`),r=i.nativeContext.getTransform();n.setTransform(r.a,r.b,r.c,r.d,r.e,r.f),s===1&&(n.save(),n.clearRect(0,0,e.width,e.height),n.beginPath(),n.rect(c,l,u,d),n.clip(),n.drawImage(e.nativeCanvas,0,0,e.width,e.height,0,0,e.displayWidth,e.displayHeight),n.restore()),i.nativeContext=n,e.nativeCanvas=t}a?i.save():i.highPerformanceSave();let m=i.baseGlobalAlpha;i.baseGlobalAlpha*=o;let h=Qa(e,r?.theme).group,g=i.modelMatrix;if(i.camera){let t=Hl.allocate(),n=Hl.allocate();Kl(n,e,h),Rl(t,g||t,n),i.modelMatrix=t,Hl.free(n),i.setTransform(1,0,0,1,0,0,!0)}else i.transformFromMatrix(e.transMatrix,!0);i.beginPath(),r.skipDraw?this.drawShape(e,i,0,0,n,r,(()=>!1),(()=>!1)):this.drawShape(e,i,0,0,n);let{scrollX:_=h.scrollX,scrollY:v=h.scrollY}=e.attribute,y;if((_||v)&&i.translate(_,v),r&&r.drawingCb&&(y=r.drawingCb()),i.modelMatrix!==g&&Hl.free(i.modelMatrix),i.modelMatrix=g,i.baseGlobalAlpha=m,s>0){let e=i.nativeContext,t=i.canvas.nativeCanvas;f.save(),f.setTransform(i.dpr,0,0,i.dpr,0,0,!0),s===1&&e.rect(c,l,u,d),f.drawImage(t,0,0,t.width,t.height,0,0,i.canvas.displayWidth,i.canvas.displayHeight);let n=e.getTransform();f.setTransform(n.a,n.b,n.c,n.d,n.e,n.f),i.nativeContext=f,i.canvas.nativeCanvas=p,f.restore()}y&&y.then?y.then((()=>{a?i.restore():i.highPerformanceRestore()})):a?i.restore():i.highPerformanceRestore()}};sf=nf([R(),af(0,L(Kn)),af(0,Fn(El)),rf(\`design:paramtypes\`,[Object])],sf);let cf=Symbol.for(\`IncrementalDrawContribution\`),lf=Symbol.for(\`ArcRender\`),uf=Symbol.for(\`AreaRender\`),df=Symbol.for(\`CircleRender\`),ff=Symbol.for(\`GraphicRender\`),pf=Symbol.for(\`GroupRender\`),mf=Symbol.for(\`LineRender\`),hf=Symbol.for(\`PathRender\`),gf=Symbol.for(\`PolygonRender\`),_f=Symbol.for(\`RectRender\`),vf=Symbol.for(\`SymbolRender\`),yf=Symbol.for(\`TextRender\`),bf=Symbol.for(\`RichTextRender\`),xf=Symbol.for(\`GlyphRender\`),Sf=Symbol.for(\`DrawContribution\`),Cf=(e,t,n,r)=>{let i,a=!1,o=!1;if(t.forEachChildren((e=>(a=e.numberType===wc,!a))),t.forEachChildren((e=>(o=!!e.findFace,!o))),a){let e=t.getChildren(),s=[...e];s.sort(((e,t)=>{let n=(e.attribute.startAngle??0+e.attribute.endAngle??0)/2,r=(t.attribute.startAngle??0+t.attribute.endAngle??0)/2;for(;n<0;)n+=F;for(;r<0;)r+=F;return r-n})),s.forEach((e=>{e._next=null,e._prev=null})),t.removeAllChild(),t.update(),s.forEach((e=>{t.appendChild(e)})),r.hack_pieFace=\`outside\`,i=n(a,o),i&&i.graphic||(r.hack_pieFace=\`inside\`,i=n(a,o)),i&&i.graphic||(r.hack_pieFace=\`top\`,i=n(a,o)),t.removeAllChild(),e.forEach((e=>{e._next=null,e._prev=null})),e.forEach((e=>{t.appendChild(e)}))}else if(o){let r=t.getChildren(),s=r.map((t=>({ave_z:t.findFace().vertices.map((n=>e.view(n[0],n[1],n[2]+t.attribute.z??0)[2])).reduce(((e,t)=>e+t),0),g:t})));s.sort(((e,t)=>t.ave_z-e.ave_z)),t.removeAllChild(),s.forEach((e=>{e.g._next=null,e.g._prev=null})),t.update(),s.forEach((e=>{t.add(e.g)})),i=n(a,o),t.removeAllChild(),r.forEach((e=>{e._next=null,e._prev=null})),t.update(),r.forEach((e=>{t.add(e)}))}else i=n(a,o);return i};var wf=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Tf=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let Ef=Symbol.for(\`DrawItemInterceptor\`),Df=new St,Of=new St;class kf{constructor(){this.order=1}afterDrawItem(e,t,n,r,i){return e.attribute.shadowRootIdx==null&&e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx<0||(e.attribute.shadowRootIdx>0||!e.attribute.shadowRootIdx||e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(e,t,n,r,i),!1}beforeDrawItem(e,t,n,r,i){return e.attribute.shadowRootIdx==null&&e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx>0||(e.attribute.shadowRootIdx<0||e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(e,t,n,r,i),!1}drawItem(e,t,n,r,i){if(!e.shadowRoot)return!1;let{context:a}=n;if(a.highPerformanceSave(),a.transformFromMatrix(e.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){Df.copy(r.dirtyBounds),Of.copy(r.backupDirtyBounds);let t=e.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(t),r.backupDirtyBounds.copy(r.dirtyBounds)}return r.renderGroup(e.shadowRoot,n,Vl.allocate(1,0,0,1,0,0)),a.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&(r.dirtyBounds.copy(Df),r.backupDirtyBounds.copy(Of)),!0}}class Af{constructor(){this.order=1}afterDrawItem(e,t,n,r,i){return e.attribute._debug_bounds&&this.drawItem(e,t,n,r,i),!1}drawItem(e,t,n,r,i){if(!e.attribute._debug_bounds)return!1;let{context:a}=n;a.highPerformanceSave(),e.parent&&a.setTransformFromMatrix(e.parent.globalTransMatrix,!0),e.glyphHost&&e.glyphHost.parent&&a.setTransformFromMatrix(e.glyphHost.parent.globalTransMatrix,!0);let o=e.AABBBounds;return!0!==e.attribute._debug_bounds&&e.attribute._debug_bounds(a,e),a.strokeRect(o.x1,o.y1,o.width(),o.height()),a.highPerformanceRestore(),!0}}let jf=class{constructor(){this.order=1,this.interceptors=[new kf,new Nf,new Mf,new Af]}afterDrawItem(e,t,n,r,i){for(let a=0;a<this.interceptors.length;a++)if(this.interceptors[a].afterDrawItem&&this.interceptors[a].afterDrawItem(e,t,n,r,i))return!0;return!1}beforeDrawItem(e,t,n,r,i){if((!e.in3dMode||n.in3dInterceptor)&&!e.shadowRoot&&!(e.baseGraphic||e.attribute.globalZIndex||e.interactiveGraphic))return!1;for(let a=0;a<this.interceptors.length;a++)if(this.interceptors[a].beforeDrawItem&&this.interceptors[a].beforeDrawItem(e,t,n,r,i))return!0;return!1}};jf=wf([R(),Tf(\`design:paramtypes\`,[])],jf);class Mf{constructor(){this.order=1}beforeDrawItem(e,t,n,r,i){return!this.processing&&(e.baseGraphic?this.beforeDrawInteractive(e,t,n,r,i):this.beforeSetInteractive(e,t,n,r,i))}beforeSetInteractive(e,t,n,r,i){let a=e.interactiveGraphic;if(e.attribute.globalZIndex){a||(a=e.clone(),e.interactiveGraphic=a,a.baseGraphic=e),a.setAttributes({globalZIndex:0,zIndex:e.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),n.stage.tryInitInteractiveLayer();let t=n.stage.getLayer(\`_builtin_interactive\`);return t&&this.getShadowRoot(t).add(a),!0}if(a){n.stage.tryInitInteractiveLayer();let t=n.stage.getLayer(\`_builtin_interactive\`);t&&this.getShadowRoot(t).removeChild(a),e.interactiveGraphic=null,a.baseGraphic=null}return!1}beforeDrawInteractive(e,t,n,r,i){let a=e.baseGraphic,o=!!a.stage,s=a.parent;for(;o&&s&&s.stage!==s;)o=!!s.stage,s=s.parent;if(!o){let t=n.stage.getLayer(\`_builtin_interactive\`);return t&&this.getShadowRoot(t).removeChild(e),!0}if(a){this.processing=!0;let{context:e}=n;return e.highPerformanceSave(),e.setTransformFromMatrix(a.parent.globalTransMatrix,!0),a.isContainer?r.renderGroup(a,n,a.parent.globalTransMatrix):r.renderItem(a,n),e.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(e){let t=e.getElementById(\`_interactive_group\`);return t||(t=U.CreateGraphic(\`group\`,{}),t.id=\`_interactive_group\`,e.add(t)),t.shadowRoot??t.attachShadow()}}class Nf{constructor(){this.order=1}beforeDrawItem(e,t,n,r,i){if(!e.in3dMode||n.in3dInterceptor)return!1;n.in3dInterceptor=!0;let{context:a,stage:o}=t.drawParams;a.canvas,a.save(),this.initCanvasCtx(a),a.camera=o.camera;let s=a.currentMatrix;s.a/=a.dpr,s.b/=a.dpr,s.c/=a.dpr,s.d/=a.dpr,s.e/=a.dpr,s.f/=a.dpr;let c=Hl.allocate();Ll(c,s);let l=a.modelMatrix;if(l){if(c){let e=Hl.allocate();a.modelMatrix=Rl(e,l,c)}}else a.modelMatrix=c;return a.setTransform(1,0,0,1,0,0,!0),e.isContainer?Cf(a,e,((t,i)=>r.renderGroup(e,n,e.parent.globalTransMatrix,!t&&i)),n):r.renderItem(e,n),a.camera=null,a.restore(),a.modelMatrix!==l&&Hl.free(a.modelMatrix),a.modelMatrix=l,n.in3dInterceptor=!1,!0}initCanvasCtx(e){e.setTransformForCurrent()}}var Pf=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ff=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},If=function(e,t){return function(n,r){t(n,r,e)}};let Lf=Symbol.for(\`RenderService\`),Rf=class{constructor(e){this.drawContribution=e}prepare(e){e&&this.renderTreeRoots.forEach((t=>{this._prepare(t,e)}))}_prepare(e,t){e.forEachChildren((e=>{this._prepare(e,t)})),e.update({bounds:t,trans:!0})}prepareRenderList(){}beforeDraw(e){}draw(e){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(e){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(e,t){this.renderTreeRoots=e,this.drawParams=t;let n=t.updateBounds;this.prepare(n),this.prepareRenderList(),this.beforeDraw(t),this.draw(t),this.afterDraw(t),this.drawParams=null}};Rf=Pf([R(),If(0,L(Sf)),Ff(\`design:paramtypes\`,[Object])],Rf);var zf=new I((e=>{e(Lf).to(Rf)}));let Bf=Symbol.for(\`PickerService\`),Vf=Symbol.for(\`GlobalPickerService\`),Hf=Symbol.for(\`PickItemInterceptor\`),Uf=Symbol.for(\`PickServiceInterceptor\`);var Wf=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let Gf=class{constructor(){this.order=1}afterPickItem(e,t,n,r,i){if(e.graphic){let t=e.graphic;for(;t.parent;)t=t.parent;t.shadowHost&&(e.params={shadowTarget:e.graphic},e.graphic=t.shadowHost)}return e}};Gf=Wf([R()],Gf);let Kf=class{constructor(){this.order=1}afterPickItem(e,t,n,r,i){return e.attribute.shadowRootIdx>0||!e.attribute.shadowRootIdx?this._pickItem(e,t,n,r,i):null}beforePickItem(e,t,n,r,i){return e.attribute.shadowRootIdx<0?this._pickItem(e,t,n,r,i):null}_pickItem(e,t,n,r,i){if(!e.shadowRoot)return null;let{parentMatrix:a}=i||{};if(!a)return null;let o=t.pickContext;o.highPerformanceSave();let s=Qa(e)?.[e.type],{shadowPickMode:c=s?.shadowPickMode}=e.attribute,l=e.shadowRoot,u=Vl.allocateByObj(a),d=new $e(u.a*n.x+u.c*n.y+u.e,u.b*n.x+u.d*n.y+u.f),f=t.pickGroup(l,d,u,r);return o.highPerformanceRestore(),!f.graphic&&f.group&&c===\`full\`&&(f.graphic=f.group),f}};Kf=Wf([R()],Kf);let qf=class{constructor(){this.order=1}beforePickItem(e,t,n,r,i){let a=e.baseGraphic;if(a&&a.parent){let e=new $e(n.x,n.y),i=t.pickContext;i.highPerformanceSave();let o=a.parent.globalTransMatrix;o.transformPoint(e,e);let s=a.isContainer?t.pickGroup(a,e.clone(),o,r):t.pickItem(a,e.clone(),o,r);return i.highPerformanceRestore(),s}return null}};qf=Wf([R()],qf);let Jf=class{constructor(){this.order=1}beforePickItem(e,t,n,r,i){if(!e.in3dMode||r.in3dInterceptor)return null;let a=t.pickContext,o=e.stage;if(!a||!o)return null;if(r.in3dInterceptor=!0,a.save(),this.initCanvasCtx(a),a.camera=o.camera,e.isContainer){let o=Cf(a,e,(()=>t.pickGroup(e,n,i.parentMatrix,r)),r);return a.camera=null,r.in3dInterceptor=!1,a.restore(),o}return a.restore(),null}initCanvasCtx(e){e.setTransformForCurrent()}};Jf=Wf([R()],Jf);var Yf=new I(((e,t,n)=>{n(Bf)||(e(Vf).toSelf(),e(Bf).toService(Vf)),e(Jf).toSelf().inSingletonScope(),e(Hf).toService(Jf),e(Kf).toSelf().inSingletonScope(),e(Hf).toService(Kf),e(qf).toSelf().inSingletonScope(),e(Hf).toService(qf),Jn(e,Hf),e(Gf).toSelf().inSingletonScope(),e(Uf).toService(Gf),Jn(e,Uf)})),Xf=new I((e=>{e(Lc).to(ql).inSingletonScope(),e(Rc).toConstantValue(U)}));let Zf=Symbol.for(\`AutoEnablePlugins\`),Qf=Symbol.for(\`PluginService\`);var $f=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ep=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},tp=function(e,t){return function(n,r){t(n,r,e)}};let np=class{constructor(e){this.autoEnablePlugins=e,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(e,t){this.stage=e,this.actived=!0;let{pluginList:n}=t;n&&V.isBound(Zf)&&this.autoEnablePlugins.getContributions().forEach((e=>{n.includes(e.name)&&this.register(e)}))}findPluginsByName(e){let t=[];return this.onStartupFinishedPlugin.forEach((n=>{n.name===e&&t.push(n)})),this.onRegisterPlugin.forEach((n=>{n.name===e&&t.push(n)})),t}register(e){e.activeEvent===\`onStartupFinished\`?this.onStartupFinishedPlugin.push(e):e.activeEvent===\`onRegister\`&&(this.onRegisterPlugin.push(e),e.activate(this))}unRegister(e){e.activeEvent===\`onStartupFinished\`?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(e),1):e.activeEvent===\`onRegister\`&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(e),1),e.deactivate(this)}release(){this.onStartupFinishedPlugin.forEach((e=>{e.deactivate(this)})),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach((e=>{e.deactivate(this)})),this.onRegisterPlugin=[]}};np=$f([R(),tp(0,L(Kn)),tp(0,Fn(Zf)),ep(\`design:paramtypes\`,[Object])],np);var rp=new I((e=>{e(Qf).to(np),function(e,t){e(Kn).toDynamicValue((e=>{let{container:n}=e;return new qn(t,n)})).whenTargetNamed(t)}(e,Zf)})),ip=new I((e=>{Jn(e,Zn)})),ap=new I((e=>{e(ea).to(ta).inSingletonScope(),Jn(e,ea)})),op=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},sp=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let cp=class{constructor(){this.type=\`static\`,this.offscreen=!1,this.global=B.global}setDpr(e){this.canvas.dpr=e}init(e,t,n){if(this.layer=e,this.window=t,n.main)this.main=!0,this.context=t.getContext(),this.canvas=this.context.getCanvas();else{let e;this.main=!1,n.canvasId&&(e=this.global.getElementById(n.canvasId)),e||=this.global.createCanvas({width:t.width,height:t.height}),e.style&&(e.style[\`pointer-events\`]=\`none\`);let r=t.getContext().getCanvas().nativeCanvas,i=ia({nativeCanvas:e,width:t.width,height:t.height,dpr:t.dpr,id:n.canvasId,canvasControled:!0,container:t.getContainer(),x:r.offsetLeft,y:r.offsetTop});i.applyPosition(),this.canvas=i,this.context=i.getContext()}}resize(e,t){this.canvas.resize(e,t)}resizeView(e,t){}render(e,t,n){if(!this.main){let e=this.window.getContext().getCanvas().nativeCanvas;!e||this.canvas.x===e.offsetLeft&&this.canvas.y===e.offsetTop||(this.canvas.x=e.offsetLeft,this.canvas.y=e.offsetTop,this.canvas.applyPosition())}t.renderService.render(e,Object.assign(Object.assign({context:this.context,clear:t.background??\`#ffffff\`},t),n))}merge(e){e.forEach((e=>{let t=e.getContext().canvas.nativeCanvas;this.context.drawImage(t,0,0)}))}prepare(e,t){}drawTo(e,t,n){let r=e.getContext();n.renderService.render(t,Object.assign(Object.assign({context:r},n),{clear:n.clear?n.background??\`#fff\`:void 0}))}getContext(){return this.context}release(){this.canvas.release()}};cp=op([R(),sp(\`design:paramtypes\`,[])],cp);var lp=new I((e=>{e(cp).toSelf(),e(il).toService(cp)})),up=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};function dp(e,t,n){let r={},i=[];return e.forEachChildren((e=>{let{zIndex:n=t}=e.attribute;r[n]?r[n].push(e):(r[n]=[e],i.push(n))}),n),i.sort(((e,t)=>n?t-e:e-t)),{childMap:r,zIdxArray:i}}function fp(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],i=arguments.length>4&&arguments[4]!==void 0&&arguments[4],a=!1;if(i)a=!0;else{let n;e.forEachChildren(((e,r)=>{let{zIndex:i=t}=e.attribute;if(r===0)n=i;else if(n!==i)return a=!0,!0;return!1}),r)}if(a){let{childMap:a,zIdxArray:o}=dp(e,t,r),s=!1;for(let e=0;e<o.length&&!s;e++){let t=a[o[e]];i&&t.sort(((e,t)=>(r?-1:1)*((t.attribute.z??0)-(e.attribute.z??0))));for(let e=0;e<t.length;e++)if(n(t[e],e)){s=!0;break}}}else e.forEachChildren(n,r)}function pp(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];return up(this,void 0,void 0,(function*(){yield e.forEachChildrenAsync(n,r)}))}function mp(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],i=!1;e.forEachChildren(((e,t)=>{let{zIndex:r=n}=e.attribute;return t!==0&&r!==void 0?(i=!0,!0):!1}),r);let a=null,o=!1;if(i){let{childMap:i,zIdxArray:s}=dp(e,n,r),c=!1;for(let e=0;e<s.length&&!c;e++){let n=i[s[e]];for(let e=0;e<n.length;e++){if(o){c=!0,a=n[e];break}n[e]._uid!==t||(o=!0)}}}else e.forEachChildren((e=>o?(a=e,!0):(e._uid===t&&(o=!0),!1)),r);return a}var hp=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},gp=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},_p=function(e,t){return function(n,r){t(n,r,e)}};let vp=class{constructor(e,t){this.contributions=e,this.drawItemInterceptorContributions=t,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new xt,this.backupDirtyBounds=new xt,this.global=B.global,this.layerService=B.layerService,y(this.contributions)||(this.contributions=[this.contributions]),this.init()}init(){this.contributions.forEach((e=>{if(e.style){let t=this.styleRenderMap.get(e.style)||new Map;t.set(e.numberType,e),this.styleRenderMap.set(e.style,t)}else this.defaultRenderMap.set(e.numberType,e)})),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort(((e,t)=>e.order-t.order))}prepareForDraw(e,t){t.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!t.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(e,t){this.prepareForDraw(e,t),t.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(t.renderStyle)||this.defaultRenderMap,this.currentRenderService=e;let{context:n,stage:r,viewBox:i,transMatrix:a}=t;if(!n)return;let o=this.dirtyBounds.setValue(0,0,i.width(),i.height());if(r.dirtyBounds&&!r.dirtyBounds.empty()){let e=function(e,t,n){if(e===null)return t;if(t===null)return e;let{x11:r,x12:i,y11:a,y12:o,x21:s,x22:c,y21:l,y22:u}=ct(e,t,n);return r>=c||i<=s||a>=u||o<=l?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(r,s),y1:Math.max(a,l),x2:Math.min(i,c),y2:Math.min(o,u)}}(o,r.dirtyBounds,!1);o.x1=Math.floor(e.x1),o.y1=Math.floor(e.y1),o.x2=Math.ceil(e.x2),o.y2=Math.ceil(e.y2)}let s=n.dpr%1;(s||s!==.5)&&(o.x1=Math.floor(o.x1*n.dpr)/n.dpr,o.y1=Math.floor(o.y1*n.dpr)/n.dpr,o.x2=Math.ceil(o.x2*n.dpr)/n.dpr,o.y2=Math.ceil(o.y2*n.dpr)/n.dpr),this.backupDirtyBounds.copy(o),n.inuse=!0,n.setClearMatrix(a.a,a.b,a.c,a.d,a.e,a.f),n.clearMatrix(),n.setTransformForCurrent(!0),n.translate(i.x1,i.y1,!0),n.beginPath(),n.rect(o.x1,o.y1,o.width(),o.height()),n.clip(),r.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(e,n,t),n.save(),e.renderTreeRoots.sort(((e,t)=>(e.attribute.zIndex??Ci.zIndex)-(t.attribute.zIndex??Ci.zIndex))).forEach((e=>{e.isContainer?this.renderGroup(e,t,Vl.allocate(1,0,0,1,0,0)):this.renderItem(e,t)})),n.restore(),n.setClearMatrix(1,0,0,1,0,0),n.inuse=!1,n.draw()}doRegister(){throw Error(\`暂不支持\`)}_findNextGraphic(e){let t=e.parent,n=e._uid;for(;t;){let e=mp(t,n,Ci.zIndex);if(e)return e;n=t._uid,t=t.parent}return null}renderGroup(e,t,n,r){if(t.break||!1===e.attribute.visibleAll)return;if(e.incremental&&(t.startAtId==null||t.startAtId===e._uid))return t.break=!0,void this._increaseRender(e,t);if(this.useDirtyBounds&&!lt(e.AABBBounds,this.dirtyBounds,!1)&&e.attribute.boundsMode!==\`empty\`)return;let i,a=n;if(this.useDirtyBounds){i=Vd.allocateByObj(this.dirtyBounds);let t=e.transMatrix;a=Vl.allocateByObj(n).multiply(t.a,t.b,t.c,t.d,t.e,t.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(a.getInverse())}this.renderItem(e,t,{drawingCb:()=>{r?e.forEachChildren((e=>{t.break||(e.isContainer?this.renderGroup(e,t,a):this.renderItem(e,t))})):fp(e,Ci.zIndex,(e=>{t.break||(e.isContainer?this.renderGroup(e,t,a):this.renderItem(e,t))}),!1,!!t.context?.camera)}}),this.useDirtyBounds&&(this.dirtyBounds.copy(i),Vd.free(i),Vl.free(a))}_increaseRender(e,t){let{layer:n,stage:r}=t,{subLayers:i}=n,a=i.get(e._uid);a||(a={layer:this.layerService.createLayer(r),zIndex:i.size,group:e},i.set(e._uid,a));let o=a.layer.getNativeHandler().getContext(),s=a.drawContribution||V.get(cf);s.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),s.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),s.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:s,clear:\`transparent\`,layer:a.layer,context:o,startAtId:e._uid,break:!1})),a.drawContribution=s;let c=this._findNextGraphic(e);if(c)if(c.isContainer&&c.incremental)this._increaseRender(c,t);else{let e=i.get(c._uid);e||(e={layer:this.layerService.createLayer(r),zIndex:i.size},i.set(c._uid,e));let n=e.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:s,clear:\`transparent\`,layer:e.layer,context:n,startAtId:c._uid,break:!1}))}}getRenderContribution(e){let t;return t||=this.selectRenderByNumberType(e.numberType,e),t||=this.selectRenderByType(e.type),t}renderItem(e,t,n){if(this.InterceptorContributions.length)for(let r=0;r<this.InterceptorContributions.length;r++){let i=this.InterceptorContributions[r];if(i.beforeDrawItem&&i.beforeDrawItem(e,this.currentRenderService,t,this,n))return}let r=this.getRenderContribution(e);if(!r)return;let i,a=this.scrollMatrix&&(this.scrollMatrix.e!==0||this.scrollMatrix.f!==0);if(e.parent){let{scrollX:t=0,scrollY:n=0}=e.parent.attribute;(t||n)&&(a=!0,this.scrollMatrix||=Vl.allocate(1,0,0,1,0,0),this.scrollMatrix.translate(-t,-n))}if(a&&(i=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!e.isContainer&&e.attribute.boundsMode!==\`empty\`&&!lt(e.AABBBounds,i??this.dirtyBounds,!1)){if(a&&e.parent){let{scrollX:t=0,scrollY:n=0}=e.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(t,n)}return}let o=t.startAtId!=null&&e._uid!==t.startAtId;if(e._uid===t.startAtId&&(t.startAtId=null),n&&(n.skipDraw=o),o?e.isContainer&&r.draw(e,this.currentRenderService,t,n):r.draw(e,this.currentRenderService,t,n),a&&e.parent){let{scrollX:t=0,scrollY:n=0}=e.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(t,n)}if(this.InterceptorContributions.length)for(let n=0;n<this.InterceptorContributions.length;n++){let r=this.InterceptorContributions[n];if(r.afterDrawItem&&r.afterDrawItem(e,this.currentRenderService,t,this))return}}selectRenderByType(e){return xe.getInstance().warn(\`未知错误，不应该走到这里\`),null}selectRenderByNumberType(e,t){let n;if(t.attribute.renderStyle){let r=this.styleRenderMap.get(t.attribute.renderStyle);n=r&&r.get(e)}return n||this.currentRenderMap.get(e)||this.defaultRenderMap.get(e)}clearScreen(e,t,n){let{clear:r,viewBox:i}=n,a=i.width(),o=i.height();if(r){t.clearRect(0,0,a,o);let n=e.drawParams?.stage;if(n&&(t.globalAlpha=n.attribute.opacity??1),n&&n.backgroundImg&&n.resources){let e=n.resources.get(r);e&&e.state===\`success\`&&e.data&&t.drawImage(e.data,0,0,a,o)}else t.fillStyle=Vi(t,r,{AABBBounds:{x1:0,y1:0,x2:0+a,y2:0+o}},0,0),t.fillRect(0,0,a,o)}}afterDraw(e,t){}};vp=hp([R(),_p(0,Pn(ff)),_p(1,L(Kn)),_p(1,Fn(Ef)),gp(\`design:paramtypes\`,[Array,Object])],vp);var yp=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let bp=class extends yd{constructor(){super(...arguments),this.numberType=Ac}drawShape(e,t,n,r,i,a,o,s){if(e.incremental&&i.multiGraphicOptions){let{startAtIdx:t,length:a}=i.multiGraphicOptions,{segments:c=[]}=e.attribute;if(t>c.length)return;let l=Qa(e).line,{fill:u=l.fill,stroke:d=l.stroke,opacity:f=l.opacity,fillOpacity:p=l.fillOpacity,strokeOpacity:m=l.strokeOpacity,lineWidth:h=l.lineWidth,visible:g=l.visible}=e.attribute,_=ml(f,p,u),v=gl(f,m),y=fl(u),b=pl(d,h);if(!e.valid||!g||!y&&!b||!(_||v||o||s))return;let{context:x}=i;for(let i=t;i<t+a;i++)this.drawIncreaseSegment(e,x,c[i-1],c[i],e.attribute.segments[i],[l,e.attribute],n,r)}else super.drawShape(e,t,n,r,i,a,o,s)}drawIncreaseSegment(e,t,n,r,i,a,o,s){r&&(t.beginPath(),function(e,t,n,r){let{offsetX:i=0,offsetY:a=0}=r||{},o=t?t.points[t.points.length-1]:n.points[0];e.moveTo(o.x+i,o.y+a),n.points.forEach((t=>{!1===t.defined?e.moveTo(t.x+i,t.y+a):e.lineTo(t.x+i,t.y+a)}))}(t.nativeContext,n,r,{offsetX:o,offsetY:s}),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,i,a),t.setStrokeStyle(e,i,o,s,a),t.stroke())}};bp=yp([R()],bp);var xp=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let Sp=class extends Ed{constructor(){super(...arguments),this.numberType=Tc}drawShape(e,t,n,r,i,a,o){if(e.incremental&&i.multiGraphicOptions){let{startAtIdx:a,length:s}=i.multiGraphicOptions,{segments:c=[]}=e.attribute;if(a>c.length)return;let l=Qa(e).area,{fill:u=l.fill,fillOpacity:d=l.fillOpacity,opacity:f=l.opacity,visible:p=l.visible}=e.attribute,m=ml(f,d,u),h=fl(u);if(!e.valid||!p||!h||!m&&!o)return;for(let i=a;i<a+s;i++)this.drawIncreaseSegment(e,t,c[i-1],c[i],e.attribute.segments[i],[l,e.attribute],n,r)}else super.drawShape(e,t,n,r,i,a,o)}drawIncreaseSegment(e,t,n,r,i,a,o,s){r&&(t.beginPath(),function(e,t,n,r){let{offsetX:i=0,offsetY:a=0}=r||{},{points:o}=n,s=[];for(let e=0;e<o.length;e++)o[e].defined;s.push(o),s.forEach(((n,r)=>{let o=t&&r===0?t.points[t.points.length-1]:n[0];e.moveTo(o.x+i,o.y+a),n.forEach((t=>{!1===t.defined?e.moveTo(t.x+i,t.y+a):e.lineTo(t.x+i,t.y+a)}));for(let t=n.length-1;t>=0;t--){let r=n[t];e.lineTo(r.x1??r.x,r.y1??r.y)}e.lineTo(o.x1??o.x,o.y1??o.y),e.closePath()}))}(t.camera?t:t.nativeContext,n,r,{offsetX:o,offsetY:s}),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,i,a),t.setCommonStyle(e,i,o,s,a),t.fill())}};Sp=xp([R()],Sp);var Cp,wp=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Tp=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Ep=function(e,t){return function(n,r){t(n,r,e)}},Dp=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};(function(e){e[e.NORMAL=0]=\`NORMAL\`,e[e.STOP=1]=\`STOP\`})(Cp||={});let Op=class extends vp{constructor(e,t,n,r){super(e,r),this.contributions=e,this.lineRender=t,this.areaRender=n,this.drawItemInterceptorContributions=r,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=Cp.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new Xn([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(e,t){return Dp(this,void 0,void 0,(function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=e,this.lastDrawContext=t,this.checkingForDrawPromise=this.checkForDraw(t);let n=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,n)return;this.currentRenderService=e;let{context:r,viewBox:i}=t;r&&(r.inuse=!0,r.clearMatrix(),r.setTransformForCurrent(!0),r.save(),t.restartIncremental&&this.clearScreen(this.currentRenderService,r,t),r.translate(i.x1,i.y1,!0),r.save(),e.renderTreeRoots.sort(((e,t)=>(e.attribute.zIndex??Ci.zIndex)-(t.attribute.zIndex??Ci.zIndex))).forEach((e=>{this.renderGroup(e,t)})),this.hooks.completeDraw.tap(\`top-draw\`,(()=>{r.restore(),r.restore(),r.draw(),r.inuse=!1,this.rendering=!1})))}))}_increaseRender(e,t){return Dp(this,void 0,void 0,(function*(){this.rendering=!0,yield this._renderIncrementalGroup(e,t)}))}_renderIncrementalGroup(e,t){return Dp(this,void 0,void 0,(function*(){this.count=e.count,yield new Promise((n=>{this.renderItem(e,t,{drawingCb:()=>Dp(this,void 0,void 0,(function*(){if(e.count!==2)yield pp(e,Ci.zIndex,((n,r)=>{if(this.status===Cp.STOP)return!0;if(n.isContainer||r<this.currentIdx)return!1;let i=this.currFrameStartAt+e.incremental;return r<i&&(this.currentIdx=r+1,this.renderItem(n,t)),r===i-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())})),n(!1);else{let r=e.getChildAt(0);if(r.incremental&&r.attribute.segments)for(r.incrementalAt||=0;r.incrementalAt<r.attribute.segments.length;)t.multiGraphicOptions={startAtIdx:r.incrementalAt,length:r.incremental},this.renderItem(r,t),r.incrementalAt+=r.incremental,yield this.waitToNextFrame();else this.renderItem(r,t);n(!1)}}))})})),this.hooks.completeDraw.call()}))}waitToNextFrame(){return Dp(this,void 0,void 0,(function*(){return new Promise((e=>{this.global.getRequestAnimationFrame()((()=>{e(!1)}))}))}))}checkForDraw(e){return Dp(this,void 0,void 0,(function*(){let t=this.rendering;return e.restartIncremental&&(t=!1,yield this.forceStop(),this.resetToInit()),t}))}forceStop(){return Dp(this,void 0,void 0,(function*(){this.rendering&&(this.status=Cp.STOP,yield new Promise((e=>{this.hooks.completeDraw.tap(\`stopCb\`,(()=>{this.status=Cp.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter((e=>e.name!==\`stopCb\`)),e(!1)}))})))}))}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(e,t){return Dp(this,void 0,void 0,(function*(){if(!t.break&&!1!==e.attribute.visibleAll)return e.incremental&&t.startAtId===e._uid?(yield this._increaseRender(e,t),void(t.break=!0)):void(yield new Promise((n=>{this.renderItem(e,t,{drawingCb:()=>Dp(this,void 0,void 0,(function*(){yield pp(e,Ci.zIndex,(e=>Dp(this,void 0,void 0,(function*(){t.break||e.isContainer&&(yield this.renderGroup(e,t))})))),n(!1)}))})})))}))}};Op=wp([R(),Ep(0,Pn(ff)),Ep(1,L(bp)),Ep(2,L(Sp)),Ep(3,L(Kn)),Ep(3,Fn(Ef)),Tp(\`design:paramtypes\`,[Array,Object,Object,Object])],Op);var kp=new I((e=>{e(Bu).toSelf().inSingletonScope(),e(Gu).toSelf().inSingletonScope(),e(Sf).to(vp),e(cf).to(Op),e(pf).to(sf).inSingletonScope(),e(ff).toService(pf),Jn(e,El),e(Hu).toSelf().inSingletonScope(),Jn(e,Ml),Jn(e,ff),e(jf).toSelf().inSingletonScope(),e(Ef).toService(jf),Jn(e,Ef)}));function Ap(){Ap.__loaded||(Ap.__loaded=!0,V.load(dl),V.load(Xf),V.load(zf),V.load(Yf),V.load(rp),function(e){e.load(ip),e.load(ap),e.load(lp)}(V),function(e){e.load(kp)}(V))}Ap.__loaded=!1,Ap();let jp=V.get(Qn);B.global=jp,B.graphicUtil=V.get(nl),B.transformUtil=V.get(tl),B.graphicService=V.get(Lc),B.layerService=V.get(rl);class Mp{constructor(){this.name=\`AutoRenderPlugin\`,this.activeEvent=\`onRegister\`,this._uid=Cn.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=e=>{e.glyphHost&&(e=e.glyphHost),e.stage===this.pluginService.stage&&e.stage!=null&&e.stage.renderNextFrame()}}activate(e){this.pluginService=e,B.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),B.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),B.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(e){let t=e=>e.filter((e=>e.name!==this.key));B.graphicService.hooks.onAttributeUpdate.taps=t(B.graphicService.hooks.onAttributeUpdate.taps),B.graphicService.hooks.onSetStage.taps=t(B.graphicService.hooks.onSetStage.taps),B.graphicService.hooks.onRemove.taps=t(B.graphicService.hooks.onRemove.taps)}}class Np{constructor(){this.name=\`AutoRefreshPlugin\`,this.activeEvent=\`onRegister\`,this._uid=Cn.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=e=>{e.glyphHost&&(e=e.glyphHost),e.stage===this.pluginService.stage&&e.stage!=null&&e.stage.renderNextFrame()}}activate(e){this.pluginService=e,this.dpr=B.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){this.rafId=B.global.getRequestAnimationFrame()((()=>{B.global.devicePixelRatio!==this.dpr&&(this.dpr=B.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()}))}_refreshByMediaQuery(){try{let e=\`(resolution: \${window.devicePixelRatio}dppx)\`,t=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},n=matchMedia(e);n&&n.addEventListener(\`change\`,t),this.autoRefreshCbs||=[],this.autoRefreshCbs.push((()=>{n&&n.removeEventListener(\`change\`,t)}))}catch{return!1}return!0}deactivate(e){var t;let n=B.global.getCancelAnimationFrame();n&&this.rafId&&n(this.rafId),(t=this.autoRefreshCbs)==null||t.forEach((e=>{e()})),this.autoRefreshCbs=void 0}}class Pp{constructor(){this.name=\`IncrementalAutoRenderPlugin\`,this.activeEvent=\`onRegister\`,this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=Cn.GenAutoIncrementId(),this.key=this.name+this._uid}activate(e){this.pluginService=e,B.graphicService.hooks.onAddIncremental.tap(this.key,((t,n,r)=>{t.glyphHost&&(t=t.glyphHost),t.stage===e.stage&&t.stage!=null&&(this.nextUserParams.startAtId=n._uid,this.renderNextFrame(n))})),B.graphicService.hooks.onClearIncremental.tap(this.key,((t,n)=>{t.stage===e.stage&&t.stage!=null&&(this.nextUserParams.startAtId=t._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(t))}))}deactivate(e){B.graphicService.hooks.onAddIncremental.taps=B.graphicService.hooks.onAddIncremental.taps.filter((e=>e.name!==this.key)),B.graphicService.hooks.onClearIncremental.taps=B.graphicService.hooks.onClearIncremental.taps.filter((e=>e.name!==this.key))}renderNextFrame(e){this.nextFrameRenderGroupSet.add(e),this.willNextFrameRender||(this.willNextFrameRender=!0,B.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){let e=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach((t=>{let n=t.layer;if(!n||!t.layer.subLayers)return;let r=t.layer.subLayers.get(t._uid);r&&r.drawContribution&&r.drawContribution.draw(e.renderService,Object.assign({stage:e,layer:n,viewBox:e.window.getViewBox(),transMatrix:e.window.getViewBoxTransform(),clear:\`transparent\`,renderService:e.renderService,updateBounds:!1,startAtId:t._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))})),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}let Fp=new St;class Ip{constructor(){this.name=\`DirtyBoundsPlugin\`,this.activeEvent=\`onRegister\`,this._uid=Cn.GenAutoIncrementId(),this.key=this.name+this._uid}activate(e){this.pluginService=e,e.stage.hooks.afterRender.tap(this.key,(e=>{e&&e===this.pluginService.stage&&e.dirtyBounds.clear()})),B.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((e,t,n,r)=>{e.glyphHost&&(e=e.glyphHost),t&&t===this.pluginService.stage&&t.renderCount&&(e.isContainer&&!e.shouldSelfChangeUpdateAABBBounds()||n&&(Fp.setValue(r.x1,r.y1,r.x2,r.y2),t.dirty(Fp,e.parent&&e.parent.globalTransMatrix)))})),B.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((e,t,n,r,i)=>{t&&t===this.pluginService.stage&&t.renderCount&&(e.isContainer&&!i||t.dirty(r.globalAABBBounds))})),B.graphicService.hooks.clearAABBBounds.tap(this.key,((e,t,n)=>{t&&t===this.pluginService.stage&&t.renderCount&&t&&t.dirty(n)})),B.graphicService.hooks.onRemove.tap(this.key,(e=>{let t=e.stage;t&&t===this.pluginService.stage&&t.renderCount&&t&&t.dirty(e.globalAABBBounds)}))}deactivate(e){B.graphicService.hooks.beforeUpdateAABBBounds.taps=B.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((e=>e.name!==this.key)),B.graphicService.hooks.afterUpdateAABBBounds.taps=B.graphicService.hooks.afterUpdateAABBBounds.taps.filter((e=>e.name!==this.key)),B.graphicService.hooks.clearAABBBounds.taps=B.graphicService.hooks.clearAABBBounds.taps.filter((e=>e.name!==this.key)),e.stage.hooks.afterRender.taps=e.stage.hooks.afterRender.taps.filter((e=>e.name!==this.key)),B.graphicService.hooks.onRemove.taps=B.graphicService.hooks.onRemove.taps.filter((e=>e.name!==this.key))}}let Lp=new class extends c{set mode(e){this._mode!==e&&(this._mode=e,this.setupTickHandler())}get mode(){return this._mode}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];super(),this.handleTick=(e,t)=>{let{once:n=!1}=t??{};this.ifCanStop()?this.stop():(this._handlerTick(),n||e.tick(this.interval,this.handleTick))},this._handlerTick=()=>{let e=this.tickerHandler.getTime(),t=0;this.lastFrameTime>=0&&(t=e-this.lastFrameTime),this.lastFrameTime=e,this.status===po.RUNNING&&(this.tickCounts++,this.timelines.forEach((e=>{e.tick(t)})),this.emit(\`tick\`))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=e,this.autoStop=!0}init(){this.interval=NaN,this.status=po.INITIAL,B.global.hooks.onSetEnv.tap(\`default-ticker\`,(()=>{this.initHandler()})),B.global.env&&this.initHandler()}addTimeline(e){this.timelines.push(e)}remTimeline(e){this.timelines=this.timelines.filter((t=>t!==e))}getTimelines(){return this.timelines}initHandler(){if(this._mode)return null;let e=[{mode:\`raf\`,cons:mo},{mode:\`timeout\`,cons:ho}];for(let t=0;t<e.length;t++)if(e[t].cons.Avaliable()){this.mode=e[t].mode;break}return null}setupTickHandler(){let e;switch(this._mode){case\`raf\`:e=new mo;break;case\`timeout\`:e=new ho;break;default:xe.getInstance().warn(\`非法的计时器模式\`),e=new mo}return!!e.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=e,!0)}setInterval(e){this.interval=e}getInterval(){return this.interval}setFPS(e){this.setInterval(1e3/e)}getFPS(){return 1e3/this.interval}tick(e){this.tickerHandler.tick(e,(e=>{this.handleTick(e,{once:!0})}))}tickTo(e){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(e,(e=>{this.handleTick(e,{once:!0})}))}pause(){return this.status!==po.INITIAL&&(this.status=po.PAUSE,!0)}resume(){return this.status!==po.INITIAL&&(this.status=po.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce(((e,t)=>e+t.animateCount),0)===0))}start(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return this.status===po.RUNNING||!this.tickerHandler||!e&&(this.status===po.PAUSE||!this.timelines.length||this.timelines.reduce(((e,t)=>e+t.animateCount),0)===0)?!1:(this.status=po.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=po.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}release(){this.stop(),this.timelines=[],this.tickerHandler.release(),this.emit(\`afterTick\`)}trySyncTickStatus(){this.status===po.RUNNING&&this._handlerTick()}},Rp;function zp(){(function(){if(Rp==null)try{let e=document.createElement(\`canvas\`),t=e.getContext(\`2d\`);Rp=!!(window&&e.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&t&&t.isPointInPath&&t.isPointInStroke),Rp&&=!!document.createElement}catch{Rp=!1}})();let e=B.global&&B.global.env;return e?e===\`browser\`:Rp}Lp.addTimeline(vo),Lp.setFPS(60);let Bp=class e{static registerPlugin(t,n){e._pluginClasses[t]=n}static getPlugin(t){return e._pluginClasses[t]}};Bp._pluginClasses={};let Vp=\`white\`;class Hp extends Qc{set viewBox(e){this.window.setViewBox(e)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(e){let t=this.window.getViewBox();t.translate(e-t.x1,0),this.window.setViewBox(t)}get y(){return this.window.getViewBox().y1}set y(e){let t=this.window.getViewBox();t.translate(0,e-t.y1),this.window.setViewBox(t)}get width(){return this.window.width}set width(e){this.resize(e,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(e){this.resizeView(e,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(e){this.resizeView(this.viewWidth,e)}get height(){return this.window.height}set height(e){this.resize(this.width,e)}get dpr(){return this.window.dpr}set dpr(e){this.setDpr(e)}get background(){return this._background??Vp}set background(e){this._background=e}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({}),this.tickedBeforeRender=!0,this._onVisibleChange=e=>{if(!(this._skipRender<0))if(e){if(this.dirtyBounds){let e=this.window.getViewBox();this.dirtyBounds.setValue(e.x1,e.y1,e.width(),e.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=e=>{this._beforeRender&&this._beforeRender(e)},this.afterRender=e=>{this.renderCount++,this._afterRender&&this._afterRender(e),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach((t=>t(e))),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{this.tickedBeforeRender=!0,this.params.optimize?.tickRenderMode===\`performance\`||this.state!==\`rendering\`&&this.render()},this.params=e,this.theme=new Xa,this.hooks={beforeRender:new Xn([\`stage\`]),afterRender:new Xn([\`stage\`])},this.global=B.global,!this.global.env&&zp()&&this.global.setEnv(\`browser\`),this.window=V.get(Ia),this.renderService=V.get(Lf),this.pluginService=V.get(Qf),this.layerService=V.get(rl),this.pluginService.active(this,e),this.window.create({width:e.width,height:e.height,viewBox:e.viewBox,container:e.container,dpr:e.dpr||this.global.devicePixelRatio,canvasControled:!1!==e.canvasControled,title:e.title||\`\`,canvas:e.canvas}),this.state=\`normal\`,this.renderCount=0,this.tryInitEventSystem(),this._background=e.background??Vp,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=e.renderStyle,e.autoRender&&this.enableAutoRender(),e.autoRefresh&&this.enableAutoRefresh(),!1===e.disableDirtyBounds&&this.enableDirtyBounds(),e.enableHtmlAttribute&&this.enableHtmlAttribute(e.enableHtmlAttribute),e.ReactDOM&&this.enableReactAttribute(e.ReactDOM),e.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap(\`constructor\`,this.beforeRender),this.hooks.afterRender.tap(\`constructor\`,this.afterRender),this._beforeRender=e.beforeRender,this._afterRender=e.afterRender,this.ticker=e.ticker||Lp,this.supportInteractiveLayer=!1!==e.interactiveLayer,this.timeline=new _o,this.ticker.addTimeline(this.timeline),this.timeline.pause(),e.optimize||={},this.optmize(e.optimize),e.background&&v(this._background)&&this._background.includes(\`/\`)&&this.setAttributes({background:this._background}),this.ticker.on(\`afterTick\`,this.afterTickCb)}pauseRender(){this._skipRender=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new fo(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(e){e?this._skipRender=-1/0:!1===this.params.optimize.skipRenderWithOutRange?this._skipRender=0:this._skipRender=this.window.isVisible()?0:1}optmize(e){this.optmizeRender(e.skipRenderWithOutRange),this.params.optimize=e}optmizeRender(){arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(e){let{center:t={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:n={},alpha:r=0,beta:i=0,camera:a,fieldRatio:o=1,fieldDepth:s}=e;return Object.assign(Object.assign({},e),{center:t,light:n,alpha:r,beta:i,camera:a,fieldRatio:o,fieldDepth:s})}set3dOptions(e){this.option3d=e;let{light:t,center:n,camera:r,alpha:i,beta:a,fieldRatio:o,fieldDepth:s}=this.get3dOptions(e),{dir:c=[1,1,-1],color:l=\`white\`,ambient:u}=t,d=(n.x??this.width/2)+(n.dx??0),f=(n.y??this.height/2)+(n.dy??0),p=[d,f,(n.z??0)+(n.dz??0)],m=0,h=0,g=0;r||(m=Math.sin(i)+d,h=Math.sin(a)+f,g=Math.cos(i)*Math.cos(a)*1);let _=Bp.getPlugin(\`DirectionalLight\`);_&&(this.light=new _(c,l,u));let v={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:o,fieldDepth:s,viewParams:{pos:[m,h,g],center:p,up:[0,1,0]}};if(this.camera)this.camera.params=v;else{let e=Bp.getPlugin(\`OrthoCamera\`);e&&(this.camera=new e(v))}e.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(e){this._beforeRender=e}setAfterRender(e){this._afterRender=e}afterNextRender(e){this._afterNextRenderCbs||=[],this._afterNextRenderCbs.push(e)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;let e=Bp.getPlugin(\`ViewTransform3dPlugin\`);e&&this.pluginService.register(new e)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName(\`ViewTransform3dPlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new Mp))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName(\`AutoRenderPlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new Np))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName(\`AutoRefreshPlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new Pp))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName(\`IncrementalAutoRenderPlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new xt;let e=this.pluginService.findPluginsByName(\`DirtyBoundsPlugin\`)[0];e?e.activate(this.pluginService):(e=new Ip,this.pluginService.register(e))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName(\`DirtyBoundsPlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;let e=Bp.getPlugin(\`FlexLayoutPlugin\`);e&&this.pluginService.register(new e)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName(\`FlexLayoutPlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}enableHtmlAttribute(e){if(this.htmlAttribute)return;let t=Bp.getPlugin(\`HtmlAttributePlugin\`);t&&(this.htmlAttribute=e,this.pluginService.register(new t))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName(\`HtmlAttributePlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}enableReactAttribute(e){if(this.reactAttribute)return;let t=Bp.getPlugin(\`ReactAttributePlugin\`);t&&(this.reactAttribute=e,this.pluginService.register(new t))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName(\`ReactAttributePlugin\`).forEach((e=>{this.pluginService.unRegister(e)})))}getPluginsByName(e){return this.pluginService.findPluginsByName(e)}tryUpdateAABBBounds(){let e=this.window.getViewBox();return this._AABBBounds.setValue(e.x1,e.y1,e.x2,e.y2),this._AABBBounds}combineLayer(e,t){throw Error(\`暂不支持\`)}createLayer(e,t){if(this.releaseStatus===\`released\`)return;let n=this.layerService.createLayer(this,{main:!1,layerMode:t,canvasId:e});return this.appendChild(n),n}sortLayer(e){let t=this.children;t.sort(e),this.removeAllChild(),t.forEach((e=>{this.appendChild(e)}))}removeLayer(e){return this.removeChild(this.findChildByUid(e))}tryInitInteractiveLayer(){this.releaseStatus!==\`released\`&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name=\`_builtin_interactive\`,this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(e){this.window.clearViewBox(e)}render(e,t){if(this.releaseStatus===\`released\`)return;this.ticker.start(),this.timeline.resume();let n=this.state;this.state=\`rendering\`,this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=t,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=n,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env===\`harmony\`){let e=this.window.getContext().nativeContext;this.forEachChildren(((t,n)=>{if(n>0){let n=t.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();e.transferFromImageBitmap(n)}}))}}renderNextFrame(e,t){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(e||this).forEach((e=>{this.nextFrameRenderLayerSet.add(e)})),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){if(this.releaseStatus===\`released\`)return;this.timeline.resume(),this.ticker.start();let e=this.state;this.state=\`rendering\`,this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=e,this._skipRender&&this._skipRender++}renderLayerList(e,t){let n=[];for(let t=0;t<e.length;t++){let r=e[t];r.layerMode===\`virtual\`&&(r=r.getNativeHandler().mainHandler.layer),n.includes(r)||n.push(r)}n.forEach((e=>{e.renderCount>this.renderCount||(e.renderCount=this.renderCount+1,e===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),e.render({renderService:this.renderService,background:e===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},t)))})),this.interactiveLayer&&!e.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},t)))}resizeWindow(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.window.resize(e,t),n&&this.render()}resize(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.releaseStatus!==\`released\`&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+e,this.viewBox.y1+t),this.window.resize(e,t),this.forEachChildren((n=>{n.resize(e,t)})),this.camera&&this.option3d&&this.set3dOptions(this.option3d),n&&this.render())}resizeView(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.releaseStatus!==\`released\`&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+e,this.viewBox.y1+t),this.forEachChildren((n=>{n.resizeView(e,t)})),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),n&&this.render())}setViewBox(e,t,n,r,i){let a=!0;typeof e==\`object\`?(this.viewBox.setValue(e.x1,e.y1,e.x2,e.y2),!1===t&&(a=!1)):(this.viewBox.setValue(e,t,e+n,t+r),!1===i&&(a=!1)),this.forEachChildren((e=>{e.resizeView(this.viewBox.width(),this.viewBox.height())})),a&&this.render()}setDpr(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.forEachChildren((t=>{t.setDpr(e)})),t&&this.render()}setOrigin(e,t){throw Error(\`暂不支持\`)}export(e){throw Error(\`暂不支持\`)}pick(e,t){if(this.releaseStatus===\`released\`)return;let n=this.getPickerService().pick(this.children,new $e(e,t),{bounds:this.AABBBounds});return!(!n?.graphic&&!n?.group)&&n}startAnimate(e){throw Error(\`暂不支持\`)}setToFrame(e){throw Error(\`暂不支持\`)}release(){super.release(),this.hooks.beforeRender.unTap(\`constructor\`,this.beforeRender),this.hooks.afterRender.unTap(\`constructor\`,this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach((e=>{e.release()})),this.interactiveLayer&&(this.interactiveLayer.forEachChildren((e=>{e.setStage&&e.setStage(null,null),this.interactiveLayer.removeChild(e)})),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener(\`afterTick\`,this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(e){}dirty(e,t){this.releaseStatus!==\`released\`&&(t&&e.transformWithMatrix(t),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(e.x1,e.y1,e.x2,e.y2),this.dirtyBounds.union(e))}getLayer(e){return this.children.filter((t=>t.name===e))[0]}renderTo(e){this.releaseStatus!==\`released\`&&this.forEachChildren(((t,n)=>{t.drawTo(e,{renderService:this.renderService,viewBox:e.getViewBox(),transMatrix:e.getViewBoxTransform(),background:t===this.defaultLayer?this.background:void 0,clear:n===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})}))}renderToNewWindow(){let e=arguments.length>1?arguments[1]:void 0;if(this.releaseStatus===\`released\`)return;let t=V.get(Ia),n=e?-e.x1:0,r=e?-e.y1:0,i=e?e.x2:this.viewWidth,a=e?e.y2:this.viewHeight,o=e?e.width():this.viewWidth,s=e?e.height():this.viewHeight;return t.create({viewBox:{x1:n,y1:r,x2:i,y2:a},width:o,height:s,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:\`\`}),this.renderTo(t),t}toCanvas(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.releaseStatus===\`released\`)return;let n=this.renderToNewWindow(e,t).getNativeHandler();return n.nativeCanvas?n.nativeCanvas:null}setCursor(e){this._cursor=e,this.eventSystem.setCursor(e,\`ignore\`)}getCursor(){return this._cursor}eventPointTransform(e){let t=this.global.mapToCanvasPoint(e,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(t.x,t.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||=V.get(Bf),this.pickerService}}var Up=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Wp=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let Gp=new wt(1,0,0,1,0,0),Kp={x:0,y:0},qp=class{get nativeContext(){return this.path}constructor(e,t){this.matrix=new wt(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new wt(1,0,0,1,0,0),this.path=new pi,this._clearMatrix=new wt(1,0,0,1,0,0)}getCanvas(){throw Error(\`不支持getCanvas\`)}getContext(){throw Error(\`不支持getContext\`)}setTransformForCurrent(){!(arguments.length>0&&arguments[0]!==void 0&&arguments[0])&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix=this.cloneMatrix(this.matrix))}get currentMatrix(){return this.matrix}cloneMatrix(e){return Vl.allocateByObj(e)}clear(){this.save(),this.resetTransform(),this.restore()}restore(){this.stack.length>0&&(Vl.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent())}highPerformanceRestore(){this.stack.length>0&&(Vl.free(this.matrix),this.matrix=this.stack.pop())}rotate(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.matrix.rotate(e),t&&this.setTransformForCurrent()}save(){let e=this.cloneMatrix(this.matrix);this.stack.push(e)}highPerformanceSave(){let e=this.cloneMatrix(this.matrix);this.stack.push(e)}scale(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.scale(e,t),n&&this.setTransformForCurrent()}setScale(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.setScale(e,t),n&&this.setTransformForCurrent()}scalePoint(e,t,n,r){let i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];this.translate(n,r,!1),this.scale(e,t,!1),this.translate(-n,-r,!1),i&&this.setTransformForCurrent()}setTransform(e,t,n,r,i,a){let o=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6],s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:this.dpr;this.matrix.setValue(s*e,s*t,s*n,s*r,s*i,s*a),o&&this.setTransformForCurrent()}setTransformFromMatrix(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.dpr;this.matrix.setValue(e.a*n,e.b*n,e.c*n,e.d*n,e.e*n,e.f*n),t&&this.setTransformForCurrent()}resetTransform(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransform(t,0,0,t,0,0),e&&this.setTransformForCurrent()}transform(e,t,n,r,i,a){let o=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6];this.matrix.multiply(e,t,n,r,i,a),o&&this.setTransformForCurrent()}transformFromMatrix(e,t){this.matrix.multiply(e.a,e.b,e.c,e.d,e.e,e.f),t&&this.setTransformForCurrent()}translate(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.translate(e,t),n&&this.setTransformForCurrent()}rotateDegrees(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=e*Math.PI/180;this.rotate(n,t)}rotateAbout(e,t,n){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,n,!1),this.rotate(e,!1),this.translate(-t,-n,!1),r&&this.setTransformForCurrent()}rotateDegreesAbout(e,t,n){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,n,!1),this.rotateDegrees(e,!1),this.translate(-t,-n,!1),r&&this.setTransformForCurrent()}beginPath(){this.path.clear()}clip(e,t){}arc(e,t,n,r,i,a){this.path.arc(e,t,n,r,i,a)}arcTo(e,t,n,r,i){this.path.arcTo(e,t,n,r,i)}bezierCurveTo(e,t,n,r,i,a){this.path.bezierCurveTo(e,t,n,r,i,a)}closePath(){this.path.closePath()}ellipse(e,t,n,r,i,a,o,s){}lineTo(e,t){this.path.lineTo(e,t)}moveTo(e,t){this.path.moveTo(e,t)}quadraticCurveTo(e,t,n,r){this.path.quadraticCurveTo(e,t,n,r)}rect(e,t,n,r){this.path.rect(e,t,n,r)}createImageData(e,t){return null}createLinearGradient(e,t,n,r){throw Error(\`不支持createLinearGradient\`)}createPattern(e,t){throw Error(\`不支持createPattern\`)}createRadialGradient(e,t,n,r,i,a){throw Error(\`不支持createRadialGradient\`)}createConicGradient(e,t,n,r){return null}fill(e,t){}fillRect(e,t,n,r){this.path.rect(e,t,n,r)}clearRect(e,t,n,r){}fillText(e,t,n){}getImageData(e,t,n,r){return null}getLineDash(){return[]}isPointInPath(e,t){return this.matrix.transformPoint({x:e,y:t},Kp),function(e,t,n){return Ma(e,0,!1,t,n)}(this.path.commandList,Kp.x,Kp.y)}isPointInStroke(e,t){if(!this.lineWidth)return!1;this.matrix.transformPoint({x:e,y:t},Kp);let n=Bi(this,this.lineWidth,this.dpr);return function(e,t,n,r){return Ma(e,t,!0,n,r)}(this.path.commandList,n,Kp.x,Kp.y)}measureText(e){throw Error(\`不支持measureText\`)}putImageData(e,t,n){throw Error(\`不支持measureText\`)}setLineDash(e){}stroke(e){}strokeRect(e,t,n,r){this.path.rect(e,t,n,r)}strokeText(e,t,n){}drawImage(){}setCommonStyle(e,t,n,r,i){}_setCommonStyle(e,t,n,r){}setStrokeStyle(e,t,n,r,i){}_setStrokeStyle(e,t,n,r){}setTextStyleWithoutAlignBaseline(e,t){}setTextStyle(e,t){}draw(){}clearMatrix(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransformFromMatrix(Gp,e,t)}setClearMatrix(e,t,n,r,i,a){this._clearMatrix.setValue(e,t,n,r,i,a)}onlyTranslate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.dpr;return this.matrix.a===e&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===e}release(){this.stack.forEach((e=>Vl.free(e))),this.stack.length=0}};qp=Up([R(),Wp(\`design:paramtypes\`,[Object,Number])],qp);let Jp={WIDTH:500,HEIGHT:500,DPR:1};class Yp{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(e){this._nativeCanvas=e}get width(){return this._pixelWidth}set width(e){this._pixelWidth=e,this._displayWidth=e/(this._dpr||1)}get height(){return this._pixelHeight}set height(e){this._pixelHeight=e,this._displayHeight=e/(this._dpr||1)}getContext(e){return this._context}get visiable(){return this._visiable}set visiable(e){this._visiable=e,e?this.show():this.hide()}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this.resize(this._displayWidth,this._displayHeight)}constructor(e){let{nativeCanvas:t,width:n=Jp.WIDTH,height:r=Jp.HEIGHT,dpr:i=Jp.DPR,x:a,y:o,id:s,canvasControled:c=!0}=e;this._x=a??0,this._y=o??0,this._pixelWidth=n*i,this._pixelHeight=r*i,this._visiable=!1!==e.visiable,this.controled=c,this._displayWidth=n,this._displayHeight=r,this._dpr=i,this._nativeCanvas=t,this._id=t.id??s,s&&(t.id=s),this.init(e)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(e){}resize(e,t){}toDataURL(e,t){return\`\`}readPixels(e,t,n,r){return this._context.getImageData(e,t,n,r)}convertToBlob(e){throw Error(\`暂未实现\`)}transferToImageBitmap(){throw Error(\`暂未实现\`)}release(){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}Yp.env=\`browser\`;var Xp=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Zp=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};let Qp=class{configure(e){e.env===this.type&&e.setActiveEnvContribution(this)}getNativeAABBBounds(e){return new St}removeDom(e){return!1}createDom(e){return null}updateDom(e,t){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(e){return document.getElementById(e)}getRootElement(){return document.body}loadJson(e){let t=fetch(e).then((e=>e.json()));return t.then((e=>({data:e,state:\`success\`}))).catch((()=>({data:null,state:\`fail\`}))),t}loadArrayBuffer(e){return fetch(e).then((e=>e.arrayBuffer())).then((e=>({data:e,loadState:\`success\`}))).catch((()=>({data:null,loadState:\`fail\`})))}loadBlob(e){return fetch(e).then((e=>e.blob())).then((e=>({data:e,loadState:\`success\`}))).catch((()=>({data:null,loadState:\`fail\`})))}getElementTop(e,t){return 0}getElementLeft(e,t){return 0}getElementTopLeft(e,t){return{top:0,left:0}}loadFont(e,t,n){return Zp(this,void 0,void 0,(function*(){return{loadState:\`fail\`}}))}isMacOS(){return!1}copyToClipBoard(e){return Promise.resolve(null)}};Qp=Xp([R()],Qp);var $p=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},em=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let tm=class{constructor(){this._uid=Cn.GenAutoIncrementId(),this.viewBox=new St,this.modelMatrix=new wt(1,0,0,1,0,0)}onChange(e){this._onChangeCb=e}configure(e,t){t.env===this.type&&e.setWindowHandler(this)}release(){this.releaseWindow()}isVisible(e){return!0}onVisibleChange(e){}getTopLeft(e){return{top:0,left:0}}setViewBox(e){this.viewBox.setValue(e.x1,e.y1,e.x2,e.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(e,t,n,r,i,a){this.modelMatrix.setValue(e,t,n,r,i,a)}getViewBoxTransform(){return this.modelMatrix}};tm=$p([R(),em(\`design:paramtypes\`,[])],tm);var nm=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},rm=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},im=function(e,t){return function(n,r){t(n,r,e)}};let am=class{constructor(e,t){this.pickItemInterceptorContributions=e,this.pickServiceInterceptorContributions=t,this.type=\`default\`,this.global=B.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort(((e,t)=>e.order-t.order)),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort(((e,t)=>e.order-t.order))}pick(e,t,n){let r={graphic:null,group:null};n.pickerService=this;let i=n.bounds.width(),a=n.bounds.height();if(!new St().setValue(0,0,i,a).containsPoint(t))return r;this.pickContext&&(this.pickContext.inuse=!0),n.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);let o=new wt(1,0,0,1,0,0),s;for(let i=e.length-1;i>=0&&(r=e[i].isContainer?this.pickGroup(e[i],t,o,n):this.pickItem(e[i],t,o,n),!r.graphic);i--)s||=r.group;if(r.graphic||(r.group=s),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let e=0;e<this.pickerServiceInterceptorContributions.length;e++){let i=this.pickerServiceInterceptorContributions[e];i.afterPickItem&&(r=i.afterPickItem(r,this,t,n,{parentMatrix:o}))}return r}containsPoint(e,t,n){return!!this.pickItem(e,t,null,n??{pickContext:this.pickContext,pickerService:this})?.graphic}pickGroup(e,t,n,r){let i={group:null,graphic:null};if(!1===e.attribute.visibleAll)return i;let a=r.pickContext,o=a.modelMatrix;if(a.camera){let t=e.transMatrix,n=Hl.allocate();if(Ll(n,t),o){if(n){let e=Hl.allocate();a.modelMatrix=Rl(e,o,n),Hl.free(n)}}else Ll(n,e.globalTransMatrix),a.modelMatrix=n}if(this.InterceptorContributions.length)for(let i=0;i<this.InterceptorContributions.length;i++){let s=this.InterceptorContributions[i];if(s.beforePickItem){let i=s.beforePickItem(e,this,t,r,{parentMatrix:n});if(i)return a.modelMatrix!==o&&Hl.free(a.modelMatrix),a.modelMatrix=o,i}}let s=e.transMatrix,c=Vl.allocateByObj(n),l=new $e(t.x,t.y);c.transformPoint(l,l);let u=e.AABBBounds.containsPoint(l);if(!u&&!e.stage.camera)return i;let d=this.pickItem(e,l.clone(),n,r);d&&d.graphic&&(i.graphic=d.graphic,i.params=d.params);let f=!1!==e.attribute.pickable&&u;return c.multiply(s.a,s.b,s.c,s.d,s.e,s.f),!1===e.attribute.childrenPickable||d&&d.graphic||fp(e,Ci.zIndex,(a=>{if(a.isContainer){let n=new $e(t.x,t.y),o=Qa(e).group,{scrollX:s=o.scrollX,scrollY:l=o.scrollY}=e.attribute;n.x-=s,n.y-=l,i=this.pickGroup(a,n,c,r)}else{let o=new $e(t.x,t.y);c.transformPoint(o,o);let s=Qa(e).group,{scrollX:l=s.scrollX,scrollY:u=s.scrollY}=e.attribute;o.x-=l,o.y-=u;let d=this.pickItem(a,o,n,r);d&&d.graphic&&(i.graphic=d.graphic,i.params=d.params)}return!!i.graphic||!!i.group}),!0,!!a.camera),a.modelMatrix!==o&&Hl.free(a.modelMatrix),a.modelMatrix=o,i.graphic||i.group||!f||e.stage.camera||(i.group=e),Vl.free(c),i}selectPicker(e){return this.pickerMap.get(e.numberType)||null}};am=nm([R(),im(0,L(Kn)),im(0,Fn(Hf)),im(1,L(Kn)),im(1,Fn(Uf)),rm(\`design:paramtypes\`,[Object,Object])],am);let om=!1,sm=new I((e=>{om||(om=!0,e(md).toSelf().inSingletonScope(),e(lf).to(md).inSingletonScope(),e(ff).toService(lf),e(wl).toService(Hu),Jn(e,wl))})),cm=!1,lm=new I((e=>{cm||(cm=!0,e(Id).toSelf().inSingletonScope(),e(_f).to(Id).inSingletonScope(),e(ff).toService(_f),e(td).toSelf(),e(ed).toSelf(),e(kl).toService(td),e(kl).toService(ed),e(kl).toService(Hu),Jn(e,kl))})),um=!1,dm=new I((e=>{um||(um=!0,e(yd).toSelf().inSingletonScope(),e(bp).toSelf().inSingletonScope(),e(mf).to(yd).inSingletonScope(),e(ff).toService(mf))})),fm=!1,pm=new I((e=>{fm||(fm=!0,e(Ed).toSelf().inSingletonScope(),e(uf).to(Ed).inSingletonScope(),e(ff).toService(uf),e(Tl).toService(Hu),Jn(e,Tl),e(Sp).toSelf().inSingletonScope())})),mm=!1,hm=new I((e=>{mm||(mm=!0,e(Bd).toSelf().inSingletonScope(),e(vf).to(Bd).inSingletonScope(),e(ff).toService(vf),e(Al).toService(Hu),Jn(e,Al))})),gm=!1,_m=new I((e=>{gm||(gm=!0,e(yf).to(Kd).inSingletonScope(),e(ff).toService(yf),e(jl).toService(Hu),Jn(e,jl))})),vm=!1,ym=new I((e=>{vm||(vm=!0,e(Md).toSelf().inSingletonScope(),e(hf).to(Md).inSingletonScope(),e(ff).toService(hf),e(Dl).toService(Hu),Jn(e,Dl))})),bm=!1,xm=new I((e=>{bm||(bm=!0,e(gf).to(tf).inSingletonScope(),e(ff).toService(gf),e(Ol).toService(Hu),Jn(e,Ol))}));var Sm=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Cm=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let wm=class extends ud{constructor(){super(),this.numberType=Pc,this.builtinContributions=[Hd],this.init()}drawShape(e,t,n,r,i){let a=Qa(e).richtext,{strokeOpacity:o=a.strokeOpacity,opacity:s=a.opacity,fillOpacity:c=a.fillOpacity,visible:l=a.visible}=e.attribute;if(!e.valid||!l)return;let u=ml(s,c,!0),d=ml(s,o,!0);u&&(t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,a),t.translate(n,r),this.beforeRenderStep(e,t,n,r,u,d,u,d,a,i),e.getFrameCache().draw(t,this.drawIcon),this.afterRenderStep(e,t,n,r,u,d,u,d,a,i))}drawIcon(e,t,n,r,i){let a=Qa(e).richtextIcon,{width:o=a.width,height:s=a.height,opacity:c=a.opacity,image:l,backgroundFill:u=a.backgroundFill,backgroundFillOpacity:d=a.backgroundFillOpacity,backgroundStroke:f=a.backgroundStroke,backgroundStrokeOpacity:p=a.backgroundStrokeOpacity,backgroundRadius:m=a.backgroundRadius,margin:h}=e.attribute,{backgroundWidth:g=o,backgroundHeight:_=s}=e.attribute;if(h&&(n+=e._marginArray[3],r+=e._marginArray[0]),e._hovered){let e=(g-o)/2,i=(_-s)/2;m===0?(t.beginPath(),t.rect(n-e,r-i,g,_)):(t.beginPath(),Qu(t,n-e,r-i,g,_,m,!0)),u&&(t.globalAlpha=d,t.fillStyle=u,t.fill()),f&&(t.globalAlpha=p,t.strokeStyle=f,t.stroke())}let v=l&&(e?.resources)?.get(l);v&&v.state===\`success\`&&(t.globalAlpha=c,t.drawImage(v.data,n,r,o,s))}draw(e,t,n){let r=Qa(e).richtext;this._draw(e,r,!1,n)}};wm=Sm([R(),Cm(\`design:paramtypes\`,[])],wm);let Tm=!1,Em=new I((e=>{Tm||(Tm=!0,e(bf).to(wm).inSingletonScope(),e(ff).toService(bf))}));function Dm(e){let t=[];for(let n=0;n<e.length;n++){let r=e[n];n!==0&&r[0]===t[t.length-1]||t.push(r[0]),t.push(r[1])}return t}let Om=(e,t)=>(d(Am.warnHandler)&&Am.warnHandler.call(null,e,t),t?xe.getInstance().warn(\`[VChart warn]: \${e}\`,t):xe.getInstance().warn(\`[VChart warn]: \${e}\`)),km=(e,t,n)=>{if(!d(Am.errorHandler))throw Error(e);Am.errorHandler.call(null,e,t)},Am={silent:!1,warnHandler:!1,errorHandler:!1},jm=zp(),Mm=jm&&globalThis?globalThis.document:void 0;function Nm(e){return(e===\`desktop-browser\`||e===\`mobile-browser\`)&&jm}function Pm(e){return Fm(e)||e===\`mobile-browser\`}function Fm(e){return e.includes(\`miniApp\`)||e===\`lynx\`||e===\`wx\`||e===\`harmony\`}let Im=0;function Lm(){return Im>=9999999&&(Im=0),Im++}function Rm(e){return e!=null&&e!==\`\`&&(!!S(e)||+e==+e)}function zm(e){return!(!e||e.length===0)&&!f(e[0])&&!f(e[0].dataId)&&y(e[0].fields)}let Bm=e=>t=>j(t,e),Vm=e=>e,Hm=e=>{xe.getInstance().error(e)},Um=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(d(e))return e;let r=(e=>{let t=[],n=e.length,r,i,a,o=null,s=0,c=\`\`;e+=\`\`;let l=()=>{t.push(c+e.substring(r,i)),c=\`\`,r=i+1};for(r=0,i=0;i<n;i+=1)if(a=e[i],a===\`\\\\\`)c+=e.substring(r,i),c+=e.substring(++i,++i),r=i;else if(a===o)l(),o=null,s=-1;else{if(o)continue;r===s&&a===\`"\`||r===s&&a===\`'\`?(r=i+1,o=a):a!==\`.\`||s?a===\`[\`?(i>r&&l(),r=i+1,s=r):a===\`]\`&&(s||Hm(\`Access path missing open bracket: \`+e),s>0&&l(),s=0,r=i+1):i>r?l():r=i+1}return s&&Hm(\`Access path missing closing bracket: \`+e),o&&Hm(\`Access path missing closing quote: \`+e),i>r&&(i+=1,l()),t})(e),i=r.length===1?r[0]:e;return((e,t,n)=>(e.fields=t||[],e.fname=n,e))((n&&n.get||Bm)(r),[i],t||i)},Wm=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(y(e)){let r=e.map((e=>Um(e,t,n)));return e=>r.map((t=>t(e)))}return Um(e,t,n)},Gm=[\`x\`,\`y\`,\`dx\`,\`dy\`,\`scaleX\`,\`scaleY\`,\`angle\`,\`anchor\`,\`postMatrix\`,\`visible\`,\`clip\`,\`pickable\`,\`childrenPickable\`,\`zIndex\`,\`cursor\`];class Km extends Qc{constructor(e,t){super(e),this._skipRenderAttributes=Gm,t!=null&&t.mode&&(this.mode=t.mode,this.setMode(t.mode)),t!=null&&t.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=e,this.onSetStage((()=>{this.render(),this.bindEvents()}))}setAttribute(e,t,n,r){let i=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[e]:t},this.attribute,e,r);if(i)return this._setAttributes(i,n);g(this.attribute[e])&&g(t)&&!d(this.attribute[e])&&!d(t)?N(this.attribute[e],t):this.attribute[e]=t,this._skipRenderAttributes.includes(e)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!n&&!this.needUpdateTag(e)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(e,t,n){return e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,n)||e,this._setAttributes(e,t)}_setAttributes(e,t){let n=Object.keys(e);this._mergeAttributes(e,n),n.every((e=>this._skipRenderAttributes.includes(e)))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!t&&!this.needUpdateTags(n)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(e,t){f(t)&&(t=Object.keys(e));for(let n=0;n<t.length;n++){let r=t[n];!g(this.attribute[r])||d(this.attribute[r])||d(e[r])?this.attribute[r]=e[r]:N(this.attribute[r],e[r])}}bindEvents(){}_getNodeId(e){return\`\${this.id??this._uid}-\${this.name}-\${e}\`}_dispatchEvent(e,t){let n=new ao(e,t);n.manager=this.stage?.eventSystem.manager,this.dispatchEvent(n)}}let qm=Symbol.for(\`MathPickerContribution\`),Jm=Symbol.for(\`MathArcPicker\`),Ym=Symbol.for(\`MathAreaPicker\`),Xm=Symbol.for(\`MathCirclePicker\`),Zm=Symbol.for(\`MathImagePicker\`),Qm=Symbol.for(\`MathLinePicker\`),$m=Symbol.for(\`MathPathPicker\`),eh=Symbol.for(\`MathRectPicker\`),th=Symbol.for(\`MathSymbolPicker\`),nh=Symbol.for(\`MathTextPicker\`),rh=Symbol.for(\`MathPolygonPicker\`),ih=Symbol.for(\`MathGlyphPicker\`),ah=Symbol.for(\`CanvasArcPicker\`),oh=Symbol.for(\`CanvasAreaPicker\`),sh=Symbol.for(\`CanvasLinePicker\`),ch=Symbol.for(\`CanvasPathPicker\`),lh=Symbol.for(\`CanvasRectPicker\`),uh=Symbol.for(\`CanvasSymbolPicker\`),dh=Symbol.for(\`CanvasTextPicker\`),fh=Symbol.for(\`CanvasPolygonPicker\`),ph=Symbol.for(\`CanvasRichTextPicker\`),mh=Symbol.for(\`CanvasGroupPicker\`),hh=Symbol.for(\`CanvasPickerContribution\`),gh=(e,t)=>{let n=t.x-e.x,r=t.y-e.y;return Math.abs(n)>Math.abs(r)?n>0?\`right\`:\`left\`:r>0?\`down\`:\`up\`},_h=(e,t)=>{let n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(n*n+r*r)};class vh extends c{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=e=>{this.startTime=oo.now();let{cachedEvents:t,startPoints:n}=this;e&&t.push(e.clone()),n.length=t.length;for(let e=0;e<t.length;e++){let{x:r,y:i}=t[e];n[e]={x:r,y:i}}if(n.length!==1)this.startDistance=_h(n[0],n[1]),this.center=(e=>{let t=e.length;if(t===1)return{x:Math.round(e[0].x),y:Math.round(e[0].y)};let n=0,r=0,i=0;for(;i<t;)n+=e[i].x,r+=e[i].y,i++;return{x:Math.round(n/t),y:Math.round(r/t)}})([n[0],n[1]]);else{let e=t[0];this.pressTimeout=setTimeout((()=>{e.direction=\`none\`,e.deltaX=0,e.deltaY=0,e.points=n,this.triggerStartEvent(\`press\`,e),this.triggerEvent(\`press\`,e),this.eventType=\`press\`,this.direction=\`none\`,this.pressTimeout=null}),this.config.press.time)}},this.onMove=e=>{this.clearPressTimeout();let{startPoints:t,cachedEvents:n}=this;if(!t.length)return;let r=e.clone(),{x:i,y:a,pointerId:o}=r;for(let e=0,t=n.length;e<t;e++)if(o===n[e].pointerId){n[e]=r;break}let s={x:i,y:a},c=n.map((e=>({x:e.x,y:e.y}))),l=oo.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=l,this.lastMovePoint=s,t.length===1){let e=t[0],n=i-e.x,o=a-e.y,l=this.direction||gh(e,s);this.direction=l;let u=this.getEventType(s);r.direction=l,r.deltaX=n,r.deltaY=o,r.points=c,this.triggerStartEvent(u,r),this.triggerEvent(u,r);return}let{startDistance:u}=this;r.scale=_h(c[0],c[1])/u,r.center=this.center,r.points=c,this.triggerStartEvent(\`pinch\`,r),this.triggerEvent(\`pinch\`,r)},this.onEnd=e=>{let t=e.clone(),{cachedEvents:n,startPoints:r}=this;if(t.points=n.map((e=>({x:e.x,y:e.y}))),this.triggerEndEvent(t),n.length===1){let n=oo.now(),i=this.lastMoveTime;if(n-i<100){let e=i-(this.prevMoveTime||this.startTime);if(e>0){let n=this.prevMovePoint||r[0],i=this.lastMovePoint||r[0],a=_h(n,i),o=a/e;if(o>this.config.swipe.velocity&&a>this.config.swipe.threshold)return t.velocity=o,t.direction=gh(n,i),this.triggerEvent(\`swipe\`,t),this.cachedEvents=[],this.startPoints=[],void this.reset()}}n-this.startTime<this.config.press.time&&(n-this.lastTapTime<this.config.tap.interval&&e.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=n,this.lastTapTarget=e.target,this.tapCount===1?this.triggerEvent(\`tap\`,t):this.tapCount===2&&(this.triggerEvent(\`doubletap\`,t),this.tapCount=0))}for(let e=0,i=n.length;e<i;e++)if(n[e].pointerId===t.pointerId){n.splice(e,1),r.splice(e,1);break}this.reset(),n.length>0&&this.onStart()},this.element=e,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:t?.press?.time??251,threshold:t?.press?.threshold??9},swipe:{threshold:t?.swipe?.threshold??10,velocity:t?.swipe?.velocity??.3},tap:{interval:t?.tap?.interval??300}},this.initEvents()}initEvents(){let{element:e}=this;e&&(e.addEventListener(\`pointerdown\`,this.onStart),e.addEventListener(\`pointermove\`,this.onMove),e.addEventListener(\`pointerup\`,this.onEnd),e.addEventListener(\`pointerleave\`,this.onEnd),e.addEventListener(\`pointerupoutside\`,this.onEnd))}removeEvents(){let{element:e}=this;e&&(e.removeEventListener(\`pointerdown\`,this.onStart),e.removeEventListener(\`pointermove\`,this.onMove),e.removeEventListener(\`pointerup\`,this.onEnd),e.removeEventListener(\`pointerleave\`,this.onEnd),e.removeEventListener(\`pointerupoutside\`,this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(e){let{eventType:t,startTime:n,startPoints:r}=this;if(t===\`press\`)return t;let i;return i=oo.now()-n>this.config.press.time&&_h(r[0],e)<this.config.press.threshold?\`press\`:\`pan\`,this.eventType=i,i}enable(e){this.processEvent[e]=!0}isProcess(e){return this.processEvent[e]}pushEvent(e,t){let{emitThrottles:n}=this,r={type:e,ev:t};for(let t=0,i=n.length;t<i;t++)if(n[t].type===e)return void n.splice(t,1,r);n.push(r)}clearPressTimeout(){this.pressTimeout&&=(clearTimeout(this.pressTimeout),null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(e,t){this.pushEvent(e,t);let{throttleTimer:n,emitThrottles:r}=this;n||(this.throttleTimer=B.global.getRequestAnimationFrame()((()=>{B.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let e=0,t=r.length;e<t;e++){let{type:t,ev:n}=r[e];this.emitEvent(t,n)}this.emitThrottles.length=0})))}triggerStartEvent(e,t){this.isProcess(e)||(this.enable(e),this.triggerEvent(\`\${e}start\`,t))}triggerEndEvent(e){let t=this.processEvent;Object.keys(t).forEach((n=>{this.triggerEvent(\`\${n}end\`,e),n===\`press\`&&this.triggerEvent(\`\${n}up\`,e),delete t[n]}))}emitEvent(e,t){if(!this.element)return;let n=this.element._events[\`*\`];if(n)if(\`fn\`in n)n.fn.call(n.context,t,e);else for(let r=0,i=n.length;r<i&&!t.propagationImmediatelyStopped;r++)n[r].fn.call(n[r].context,t,e);this.emit(e,t)}}var yh=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},bh=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let W=[0,0,0],xh=class{set fillStyle(e){this.nativeContext.fillStyle=e}get fillStyle(){return this.nativeContext.fillStyle}set font(e){this.nativeContext.font=e}get font(){return this.nativeContext.font}set globalAlpha(e){this.nativeContext.globalAlpha=e*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(e){this.nativeContext.lineCap=e}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(e){this.nativeContext.lineDashOffset=e}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(e){this.nativeContext.lineJoin=e}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(e){this.nativeContext.lineWidth=e}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(e){this.nativeContext.miterLimit=e}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(e){this.nativeContext.shadowBlur=e}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(e){this.nativeContext.shadowColor=e}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(e){this.nativeContext.shadowOffsetX=e}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(e){this.nativeContext.shadowOffsetY=e}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(e){this.nativeContext.strokeStyle=e}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(e){this.nativeContext.textAlign=e}get textAlign(){return this.nativeContext.textAlign}set textBaseline(e){this.nativeContext.textBaseline=e}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(e){e!==!!this._inuse&&(this._inuse=e,e?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(e,t){this.fillAttributes=Object.assign(Object.assign({},_i),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},yi),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},bi),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;let n=e.nativeCanvas.getContext(\`2d\`);if(!n)throw Error(\`发生错误，获取2d上下文失败\`);this.nativeContext=n,this.canvas=e,this.matrix=new wt(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new wt(1,0,0,1,0,0),this._clearMatrix=new wt(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&xe.getInstance().warn(\`可能存在bug，matrix没有清空\`),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new wt(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(){!(arguments.length>0&&arguments[0]!==void 0&&arguments[0])&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(e){return Vl.allocateByObj(e)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(Vl.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(Vl.free(this.matrix),this.matrix=this.stack.pop())}rotate(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.matrix.rotate(e),t&&this.setTransformForCurrent()}save(){let e=this.cloneMatrix(this.matrix);this.stack.push(e),this.nativeContext.save()}highPerformanceSave(){let e=this.cloneMatrix(this.matrix);this.stack.push(e)}scale(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.scale(e,t),n&&this.setTransformForCurrent()}setScale(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.setScale(e,t),n&&this.setTransformForCurrent()}scalePoint(e,t,n,r){let i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];this.translate(n,r,!1),this.scale(e,t,!1),this.translate(-n,-r,!1),i&&this.setTransformForCurrent()}setTransform(e,t,n,r,i,a){let o=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6],s=arguments.length>7&&arguments[7]!==void 0?arguments[7]:this.dpr;this.matrix.setValue(s*e,s*t,s*n,s*r,s*i,s*a),o&&this.setTransformForCurrent()}setTransformFromMatrix(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.dpr;this.matrix.setValue(e.a*n,e.b*n,e.c*n,e.d*n,e.e*n,e.f*n),t&&this.setTransformForCurrent()}resetTransform(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransform(t,0,0,t,0,0),e&&this.setTransformForCurrent()}transform(e,t,n,r,i,a){let o=!(arguments.length>6&&arguments[6]!==void 0)||arguments[6];this.matrix.multiply(e,t,n,r,i,a),o&&this.setTransformForCurrent()}transformFromMatrix(e,t){this.matrix.multiply(e.a,e.b,e.c,e.d,e.e,e.f),t&&this.setTransformForCurrent()}translate(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.matrix.translate(e,t),n&&this.setTransformForCurrent()}rotateDegrees(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=e*Math.PI/180;this.rotate(n,t)}rotateAbout(e,t,n){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,n,!1),this.rotate(e,!1),this.translate(-t,-n,!1),r&&this.setTransformForCurrent()}rotateDegreesAbout(e,t,n){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];this.translate(t,n,!1),this.rotateDegrees(e,!1),this.translate(-t,-n,!1),r&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(e,t){e?typeof e==\`string\`?this.nativeContext.clip(e):this.nativeContext.clip(e,t):this.nativeContext.clip()}arc(e,t,n,r,i,a,o){if(o||=0,this.camera){let s=[];((e,t,n,r,i,a,o,s)=>{if(s)for(;n>t;)n-=F;else for(;n<t;)n+=F;let c=Re/3*(n>t?1:-1),l=t,u=l;for(;u!==n;){u=c>0?Math.min(u+c,n):Math.max(u+c,n);let t=Math.abs(u-l),s=4*Math.tan(t/4)/3,d=u<l?-1:1,f=Math.cos(l),p=Math.sin(l),m=Math.cos(u),h=Math.sin(u),g=f*a+r,_=p*o+i,v=m*a+r,y=h*o+i,b=a*s*d,x=o*s*d;e.push([g-b*p,_+x*f,v+b*h,y-x*m,v,y]),l=u}})(s,r,i,e,t,n,n,a);for(let e=0;e<s.length;++e){let t=s[e];this.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5],o)}}else this.nativeContext.arc(e,t,Math.max(0,n),r,i,a)}arcTo(e,t,n,r,i){this.nativeContext.arcTo(e,t,n,r,i)}bezierCurveTo(e,t,n,r,i,a,o){if(o||=0,this.camera){let s=o,c=o;this.modelMatrix&&(zl(W,[e,t,o],this.modelMatrix),e=W[0],t=W[1],s=W[2],zl(W,[n,r,o],this.modelMatrix),n=W[0],r=W[1],c=W[2],zl(W,[i,a,o],this.modelMatrix),i=W[0],a=W[1],o=W[2]);let l=this.camera.vp(i,a,o);i=l.x,a=l.y,l=this.camera.vp(e,t,s),e=l.x,t=l.y,l=this.camera.vp(n,r,c),n=l.x,r=l.y}this.nativeContext.bezierCurveTo(e,t,n,r,i,a)}closePath(){this.nativeContext.closePath()}ellipse(e,t,n,r,i,a,o,s){s==null?this.nativeContext.ellipse(e,t,n,r,i,a,o):this.nativeContext.ellipse(e,t,n,r,i,a,o,s)}lineTo(e,t,n){if(n||=0,this.camera){this.modelMatrix&&(zl(W,[e,t,n],this.modelMatrix),e=W[0],t=W[1],n=W[2]);let r=this.camera.vp(e,t,n);e=r.x,t=r.y}this.nativeContext.lineTo(e,t)}moveTo(e,t,n){if(n||=0,this.camera){this.modelMatrix&&(zl(W,[e,t,n],this.modelMatrix),e=W[0],t=W[1],n=W[2]);let r=this.camera.vp(e,t,n);e=r.x,t=r.y}this.nativeContext.moveTo(e,t)}quadraticCurveTo(e,t,n,r,i){if(i||=0,this.camera){let a=i;this.modelMatrix&&(zl(W,[e,t,i],this.modelMatrix),e=W[0],t=W[1],a=W[2],zl(W,[n,r,i],this.modelMatrix),n=W[0],r=W[1],i=W[2]);let o=this.camera.vp(n,r,i);n=o.x,r=o.y,o=this.camera.vp(e,t,a),e=o.x,t=o.y}this.nativeContext.quadraticCurveTo(e,t,n,r)}rect(e,t,n,r,i){i||=0,this.camera?(this.moveTo(e,t,i),this.lineTo(e+n,t,i),this.lineTo(e+n,t+r,i),this.lineTo(e,t+r,i),this.closePath()):this.nativeContext.rect(e,t,n,r)}createImageData(){let e=arguments;return e.length===2?this.nativeContext.createImageData(e[0],e[1]):e.length===1?this.nativeContext.createImageData(e[0]):null}createLinearGradient(e,t,n,r){return isFinite(e+t+n+r)||(e=0,t=0,n=0,r=0),this.nativeContext.createLinearGradient(e,t,n,r)}createPattern(e,t){return e.width===0||e.height===0?null:this.nativeContext.createPattern(e,t)}createRadialGradient(e,t,n,r,i,a){return this.nativeContext.createRadialGradient(e,t,n,r,i,a)}createConicGradient(e,t,n,r){let i,a=!1,o=this;return{stops:[],addColorStop(e,t){this.stops.push([e,t]),a=!0},GetPattern(s,c,l){return a&&=(l||=r-n,i=function(e,t,n,r,i,a,o,s,c){let l=Math.floor(180*i/Math.PI),u=xl.GetCanvas(),d=xl.GetCtx();if(!d)return null;let f=Cl.GetSize(s),p=Cl.GetSize(c),m=Cl.Get(t,n,r,a,o,f,p);if(m)return m;let h=Math.sqrt(Math.max(Math.max(n**2+r**2,(f-n)**2+r**2),Math.max((f-n)**2+(p-r)**2,n**2+(p-r)**2))),g=l+1,_=i/Math.max(1,g-1),v=Sl.getInstance().GetOrCreate(n,r,f,p,t,g),y=2*Math.PI*h/360;u.width=f,u.height=p,d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,f,p),d.translate(n,r),d.rotate(a);for(let e=0,t=g-1;e<t&&!(a+e*_>o);e++){let t=v.getColor(e);d.beginPath(),d.rotate(_),d.moveTo(0,0),d.lineTo(h,-2*y),d.lineTo(h,0),d.fillStyle=t,d.closePath(),d.fill()}let b=d.getImageData(0,0,f,p);return u.width=b.width,u.height=b.height,d.putImageData(b,0,0),m=e.createPattern(u,\`no-repeat\`),m&&Cl.Set(t,n,r,a,o,m,f,p),m}(o,this.stops,e,t,l,n,r,s,c),!1),i}}}fill(e,t){this.disableFill||(e?this.nativeContext.fill(e):this.nativeContext.fill())}fillRect(e,t,n,r){this.nativeContext.fillRect(e,t,n,r)}clearRect(e,t,n,r){this.nativeContext.clearRect(e,t,n,r)}project(e,t,n){if(n||=0,this.camera){this.modelMatrix&&(zl(W,[e,t,n],this.modelMatrix),e=W[0],t=W[1],n=W[2]);let r=this.camera.vp(e,t,n);e=r.x,t=r.y}return{x:e,y:t}}view(e,t,n){return n||=0,this.camera?(this.modelMatrix&&(zl(W,[e,t,n],this.modelMatrix),e=W[0],t=W[1],n=W[2]),this.camera.view(e,t,n)):[e,t,n]}fillText(e,t,n,r){if(r||=0,this.camera){this.modelMatrix&&(zl(W,[t,n,r],this.modelMatrix),t=W[0],n=W[1],r=W[2]);let e=this.camera.vp(t,n,r);t=e.x,n=e.y}this.nativeContext.fillText(e,t,n)}getImageData(e,t,n,r){return this.nativeContext.getImageData(e,t,n,r)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(e,t){return this.nativeContext.isPointInPath(e,t)}isPointInStroke(e,t){return this.nativeContext.isPointInStroke(e,t)}measureText(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:B.global.measureTextMethod;if(!t||t===\`native\`)return this.nativeContext.measureText(e);this.mathTextMeasure||=B.graphicUtil.createTextMeasureInstance({},{},(()=>this.canvas.nativeCanvas));let n=this.fontFamily??bi.fontFamily,r=this.fontSize??bi.fontSize;return this.mathTextMeasure.textSpec.fontFamily===n&&this.mathTextMeasure.textSpec.fontSize===r||(this.mathTextMeasure.textSpec.fontFamily=n,this.mathTextMeasure.textSpec.fontSize=r,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(e,t)}putImageData(e,t,n){this.nativeContext.putImageData(e,t,n)}setLineDash(e){let t=arguments,n=this.nativeContext;this.nativeContext.setLineDash?t[0]&&n.setLineDash(t[0]):\`mozDash\`in n?n.mozDash=t[0]:\`webkitLineDash\`in n&&(n.webkitLineDash=t[0])}stroke(e){this.disableStroke||(e?this.nativeContext.stroke(e):this.nativeContext.stroke())}strokeRect(e,t,n,r){this.nativeContext.strokeRect(e,t,n,r)}strokeText(e,t,n,r){if(r||=0,this.camera){this.modelMatrix&&(zl(W,[t,n,r],this.modelMatrix),t=W[0],n=W[1],r=W[2]);let e=this.camera.vp(t,n,r);t=e.x,n=e.y}this.nativeContext.strokeText(e,t,n)}drawImage(){let e=this.nativeContext,t=arguments;t.length===3?e.drawImage(t[0],t[1],t[2]):t.length===5?e.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&e.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}setCommonStyle(e,t,n,r,i){if(Array.isArray(i)){if(i.length<=1)return this._setCommonStyle(e,t,n,r,i[0]);let a=Object.create(i[0]);return i.forEach(((e,t)=>{t!==0&&Object.assign(a,e)})),this._setCommonStyle(e,t,n,r,a)}return this._setCommonStyle(e,t,n,r,i)}_setCommonStyle(e,t,n,r,i){let a=this.nativeContext;i||=this.fillAttributes;let{fillOpacity:o=i.fillOpacity,opacity:s=i.opacity,fill:c=i.fill}=t;a.globalAlpha=o*s*this.baseGlobalAlpha,o>1e-12&&s>1e-12&&(a.fillStyle=Vi(this,c,e,n,r))}setShadowBlendStyle(e,t,n){if(Array.isArray(n)){if(n.length<=1)return this._setShadowBlendStyle(e,n[0]);let r=Object.create(n[0]);return n.forEach(((e,t)=>{t!==0&&Object.assign(r,e)})),this._setShadowBlendStyle(e,t,r)}return this._setShadowBlendStyle(e,t,n)}_setShadowBlendStyle(e,t,n){let r=this.nativeContext;n||=this.fillAttributes;let{opacity:i=n.opacity,shadowBlur:a=n.shadowBlur,shadowColor:o=n.shadowColor,shadowOffsetX:s=n.shadowOffsetX,shadowOffsetY:c=n.shadowOffsetY,blur:l=n.blur,filter:u=n.filter,globalCompositeOperation:d=n.globalCompositeOperation}=t;i<=1e-12||(a||s||c?(r.shadowBlur=a*this.dpr,r.shadowColor=o,r.shadowOffsetX=s*this.dpr,r.shadowOffsetY=c*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0),l?(r.filter=\`blur(\${l}px)\`,this._clearFilterStyle=!0):u?(r.filter=u,this._clearFilterStyle=!0):this._clearFilterStyle&&=(r.filter=\`blur(0px)\`,!1),d?(r.globalCompositeOperation=d,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&=(r.globalCompositeOperation=\`source-over\`,!1))}setStrokeStyle(e,t,n,r,i){if(Array.isArray(i)){if(i.length<=1)return this._setStrokeStyle(e,t,n,r,i[0]);let a=Object.create(i[0]);return i.forEach(((e,t)=>{t!==0&&Object.assign(a,e)})),this._setStrokeStyle(e,t,n,r,a)}return this._setStrokeStyle(e,t,n,r,i)}_setStrokeStyle(e,t,n,r,i){let a=this.nativeContext;i||=this.strokeAttributes;let{strokeOpacity:o=i.strokeOpacity,opacity:s=i.opacity}=t;if(a.globalAlpha=o*s*this.baseGlobalAlpha,o>1e-12&&s>1e-12){let{lineWidth:o=i.lineWidth,stroke:s=i.stroke,lineJoin:c=i.lineJoin,lineDash:l=i.lineDash,lineDashOffset:u=i.lineDashOffset,lineCap:d=i.lineCap,miterLimit:f=i.miterLimit,keepStrokeScale:p=i.keepStrokeScale}=t;a.lineWidth=p?o:Bi(this,o,this.dpr),a.strokeStyle=Vi(this,s,e,n,r),a.lineJoin=c,l&&(a.setLineDash(l),a.lineDashOffset=u),a.lineCap=d,a.miterLimit=f}}setTextStyleWithoutAlignBaseline(e,t,n){let r=this.nativeContext;t||=this.textAttributes;let{scaleIn3d:i=t.scaleIn3d}=e;e.font?r.font=e.font:r.font=vt(e,t,i&&this.camera&&this.camera.getProjectionScale(n));let{fontFamily:a=t.fontFamily,fontSize:o=t.fontSize}=e;this.fontFamily=a,this.fontSize=o,r.textAlign=\`left\`,r.textBaseline=\`alphabetic\`}setTextStyle(e,t,n){let r=this.nativeContext;t||=this.textAttributes,e.font?r.font=e.font:r.font=vt(e,t,this.camera&&this.camera.getProjectionScale(n));let{fontFamily:i=t.fontFamily,fontSize:a=t.fontSize}=e;this.fontFamily=i,this.fontSize=a,r.textAlign=e.textAlign??t.textAlign,r.textBaseline=e.textBaseline??t.textBaseline}draw(){}clearMatrix(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.dpr;this.setTransformFromMatrix(this._clearMatrix,e,t)}setClearMatrix(e,t,n,r,i,a){this._clearMatrix.setValue(e,t,n,r,i,a)}onlyTranslate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.dpr;return this.matrix.a===e&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===e}release(){this.stack.forEach((e=>Vl.free(e))),this.stack.length=0}};xh.env=\`browser\`,xh=yh([R(),bh(\`design:paramtypes\`,[Object,Number])],xh);var Sh=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ch=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let wh=class extends Yp{constructor(e){super(e)}init(e){let{container:t}=e;if(typeof t==\`string\`){let e=B.global.getElementById(t);e&&(this._container=e)}else this._container=t;this._context=new xh(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;let{nativeCanvas:e}=this;e.width=this._pixelWidth,e.height=this._pixelHeight,!e.style||this.setCanvasStyle(e,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(e),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display=\`none\`)}show(){this._nativeCanvas&&(this._nativeCanvas.style.display=\`block\`)}applyPosition(){let e=this._nativeCanvas;e.style.position=\`absolute\`,e.style.top=\`\${this._y}px\`,e.style.left=\`\${this._x}px\`}resetStyle(e){if(!this.controled)return;let{width:t=this._displayWidth,height:n=this._displayHeight,dpr:r=this._dpr,x:i=this._x,y:a=this._y}=e,{nativeCanvas:o}=this;o.width=t*r,o.height=n*r,!o.style||this.setCanvasStyle(o,i,a,t,n),e.id&&(o.id=e.id),this.visiable||this.hide()}setCanvasStyle(e,t,n,r,i){this.controled&&(e.style.width=\`\${r}px\`,e.style.height=\`\${i}px\`)}toDataURL(e,t){return e===\`image/jpeg\`?this._nativeCanvas.toDataURL(e,t):e===\`image/png\`?this._nativeCanvas.toDataURL(e):this._nativeCanvas.toDataURL(e,t)}resize(e,t){this.controled&&(this._pixelWidth=e*this._dpr,this._pixelHeight=t*this._dpr,this._displayWidth=e,this._displayHeight=t,this._nativeCanvas.style&&(this._nativeCanvas.style.width=\`\${e}px\`,this._nativeCanvas.style.height=\`\${t}px\`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};function Th(e,t){return new I((n=>{n(na).toDynamicValue((()=>t=>new e(t))).whenTargetNamed(e.env),n(ra).toDynamicValue((()=>(e,n)=>new t(e,n))).whenTargetNamed(t.env)}))}wh.env=\`browser\`,wh=Sh([R(),Ch(\`design:paramtypes\`,[Object])],wh);let Eh=Th(wh,xh);var Dh=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Oh=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},kh=function(e,t){return function(n,r){t(n,r,e)}};let Ah=class extends am{constructor(e,t,n,r){super(n,r),this.contributions=e,this.drawContribution=t,this.pickItemInterceptorContributions=n,this.pickServiceInterceptorContributions=r,this.global.hooks.onSetEnv.tap(\`canvas-picker-service\`,((e,t,n)=>{this.configure(n,t)})),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach((e=>{this.pickerMap.set(e.numberType,e)})),super._init()}configure(e,t){this.pickCanvas=Na.shareCanvas(),this.pickContext=this.pickCanvas.getContext(\`2d\`)}pickItem(e,t,n,r){if(!1===e.attribute.pickable)return null;if(this.InterceptorContributions.length)for(let i=0;i<this.InterceptorContributions.length;i++){let a=this.InterceptorContributions[i];if(a.beforePickItem){let i=a.beforePickItem(e,this,t,r,{parentMatrix:n});if(i)return i}}let i=this.pickerMap.get(e.numberType);if(!i)return null;let a=i.contains(e,t,r),o=a?e:null,s={graphic:o,params:a};if(o)return s;if(this.InterceptorContributions.length)for(let i=0;i<this.InterceptorContributions.length;i++){let a=this.InterceptorContributions[i];if(a.afterPickItem){let i=a.afterPickItem(e,this,t,r,{parentMatrix:n});if(i)return i}}return s}};Ah=Dh([R(),kh(0,L(Kn)),kh(0,Fn(hh)),kh(1,L(Sf)),kh(2,L(Kn)),kh(2,Fn(Hf)),kh(3,L(Kn)),kh(3,Fn(Uf)),Oh(\`design:paramtypes\`,[Object,Object,Object,Object])],Ah);var jh=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let Mh=class{constructor(){this.type=\`group\`,this.numberType=Oc}contains(e,t,n){return!1}};Mh=jh([R()],Mh);let Nh=new I(((e,t,n,r)=>{Nh.__vloaded||(Nh.__vloaded=!0,e(mh).to(Mh).inSingletonScope(),e(hh).toService(mh),Jn(e,hh))}));Nh.__vloaded=!1;var Ph=Nh;let Fh=new I(((e,t,n,r)=>{n(Ah)||e(Ah).toSelf().inSingletonScope(),n(Bf)?r(Bf).toService(Ah):e(Bf).toService(Ah)}));var Ih,Lh=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Rh=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let zh=Ih=class extends tm{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return\`\${Ih.idprefix}_\${Ih.prefix_count++}\`}constructor(){super(),this.type=\`browser\`,this._canvasIsIntersecting=!0,this.global=B.global,this.viewBox=new St,this.modelMatrix=new wt(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(e){e.canvas?this.createWindowByCanvas(e):this.createWindowByConfig(e),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{console.error(\`发生错误，该环境不存在IntersectionObserver\`)}}isElementVisible(e){let t=e.getBoundingClientRect(),n=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight;return!(t.right<0||t.bottom<0||t.left>n||t.top>r)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);let e=new IntersectionObserver(((e,t)=>{e.forEach((e=>{this._canvasIsIntersecting===e.isIntersecting?this._canvasIsIntersecting=e.isIntersecting:(this._canvasIsIntersecting=e.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(e.isIntersecting))}))}));e&&e.observe(this.canvas.nativeCanvas)}createWindowByConfig(e){let t=this.global.createCanvas({width:e.width,height:e.height}),n;if(n=typeof e.container==\`string\`?this.global.getElementById(e.container):e.container?e.container:this.global.getRootElement(),!n)throw Error(\`发生错误，containerId可能传入有误\`);e.offscreen?n=null:n.appendChild(t);let r={width:e.width,height:e.height,dpr:e.dpr,nativeCanvas:t,container:n,id:Ih.GenerateCanvasId(),canvasControled:!0};this.canvas=new wh(r)}createWindowByCanvas(e){let t;if(typeof e.canvas==\`string\`){if(t=this.global.getElementById(e.canvas),!t)throw Error(\`canvasId 参数不正确，请确认canvas存在并插入dom\`)}else t=e.canvas;if(!t)throw Error(\`发生错误，传入的canvas不正确\`);let n=e.width,r=e.height;if(n==null||r==null||!e.canvasControled){let e=t.getBoundingClientRect();n=e.width,r=e.height}let i=e.dpr;i??=t.getContext(\`2d\`).pixelRatio??t.width/n,this.canvas=new wh({width:n,height:r,dpr:i,nativeCanvas:t,canvasControled:e.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(e,t){this.canvas.resize(e,t)}setDpr(e){this.canvas.dpr=e}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(e,t,n){return this.canvas.nativeCanvas.addEventListener(e,t,n)}removeEventListener(e,t,n){return this.canvas.nativeCanvas.removeEventListener(e,t,n)}dispatchEvent(e){return this.canvas.nativeCanvas.dispatchEvent(e)}getStyle(){return this.canvas.nativeCanvas.style??{}}setStyle(e){this.canvas.nativeCanvas.style=e}getBoundingClientRect(){let e=this.canvas.nativeCanvas,t=this.getWH();return e.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:t.width,height:t.height,left:0,top:0,right:0,bottom:0}}clearViewBox(e){let t=this.viewBox,n=this.getContext(),r=this.getDpr();n.nativeContext.save(),n.nativeContext.setTransform(r,0,0,r,0,0),n.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),e&&(n.fillStyle=e,n.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),n.nativeContext.restore()}isVisible(e){return this._canvasIsIntersecting}onVisibleChange(e){this._onVisibleChangeCb=e}getTopLeft(e){return this.global.getElementTopLeft(this.canvas.nativeCanvas,e)}};zh.env=\`browser\`,zh.idprefix=\`visactor_window\`,zh.prefix_count=0,zh=Ih=Lh([R(),Rh(\`design:paramtypes\`,[])],zh);let Bh=new I((e=>{e(zh).toSelf(),e(La).toDynamicValue((e=>e.container.get(zh))).whenTargetNamed(zh.env)}));var Vh=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Hh=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Uh=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};class Wh{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(e){this.dom=e}}function Gh(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=document.createElement(\`img\`);if(B.global.isImageAnonymous&&(n.crossOrigin=\`anonymous\`),t){let t=new Blob([e],{type:\`image/svg+xml\`});e=window.URL.createObjectURL(t)}return n.src=e,n.complete?Promise.resolve(n):new Promise(((e,t)=>{n.onload=()=>{e(n)},n.onerror=()=>{t(Error(\`加载失败\`))}}))}let Kh=class extends Qp{constructor(){super(),this.type=\`browser\`,this.supportEvent=!0;try{this.supportsTouchEvents=\`ontouchstart\`in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(e,t){let n=0,r=0,i=0,a=0;if(e.changedTouches){let t=e.changedTouches[0]??{};n=t.clientX||0,r=t.clientY||0,i=n,a=r}else n=e.clientX||0,r=e.clientY||0,i=e.offsetX||0,a=e.offsetY||0;if(t){let e=n,i=r,a=t.getBoundingClientRect(),o=t.getNativeHandler?.call(t).nativeCanvas,s,c;return o&&(s=a.width/o.offsetWidth,c=a.height/o.offsetHeight),{x:(e-a.left)/(C(s)?s:1),y:(i-a.top)/(C(c)?c:1)}}return{x:i,y:a}}getNativeAABBBounds(e){let t=e;if(typeof e==\`string\`&&(t=new DOMParser().parseFromString(e,\`text/html\`).firstChild,t.lastChild&&(t=t.lastChild.firstChild)),t.getBoundingClientRect){let e=t.getBoundingClientRect();return new Wh(e)}return new St}removeDom(e){return e.parentElement.removeChild(e),!0}updateDom(e,t){let{width:n,height:r,style:i}=t;return i&&(v(i)?e.setAttribute(\`style\`,i):Object.keys(i).forEach((t=>{e.style[t]=i[t]}))),n!=null&&(e.style.width=\`\${n}px\`),r!=null&&(e.style.height=\`\${r}px\`),!0}createDom(e){let{tagName:t=\`div\`,parent:n}=e,r=document.createElement(t);if(this.updateDom(r,e),n){let e=v(n)?this.getElementById(n):n;e&&e.appendChild&&e.appendChild(r)}return r}loadImage(e){return Gh(e,!1).then((e=>({data:e,loadState:\`success\`}))).catch((()=>({data:null,loadState:\`fail\`})))}loadSvg(e){return Gh(e,!0).then((e=>({data:e,loadState:\`success\`}))).catch((()=>({data:null,loadState:\`fail\`})))}createCanvas(e){let t=document.createElement(\`canvas\`);e.id&&(t.id=e.id??Cn.GenAutoIncrementId().toString());let n=e.dpr??window.devicePixelRatio;return e.width&&e.height&&(t.style.width=\`\${e.width}px\`,t.style.height=\`\${e.height}px\`,t.width=e.width*n,t.height=e.height*n),t}createOffscreenCanvas(e){let t=e.dpr??window.devicePixelRatio;return new OffscreenCanvas(e.width*t,e.height*t)}releaseCanvas(e){let t;t=typeof e==\`string\`?document.getElementById(e):e,t&&t.parentElement&&t.parentElement.removeChild(t)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(e,t,n){return document.addEventListener(e,t,n)}removeEventListener(e,t,n){return document.removeEventListener(e,t,n)}dispatchEvent(e){return document.dispatchEvent(e)}getElementById(e){return document.getElementById(e)}getRootElement(){return document.body}getDocument(){return document}release(){}getElementTop(e,t){let n=e.offsetTop,r=e.offsetParent;for(;r!==null;)n+=r.offsetTop,r=r.offsetParent;return n}getElementLeft(e,t){let n=e.offsetLeft,r=e.offsetParent;for(;r!==null;)n+=r.offsetLeft,r=r.offsetParent;return n}getElementTopLeft(e,t){let n=e.offsetTop,r=e.offsetLeft,i=e.offsetParent;for(;i!==null;)n+=i.offsetTop,r+=i.offsetLeft,i=i.offsetParent;return{top:n,left:r}}loadFont(e,t,n){return Uh(this,void 0,void 0,(function*(){return new FontFace(e,v(t)?\`url(\${t})\`:t,n).load().then((function(e){return document.fonts.add(e),{loadState:\`success\`}})).catch((function(e){return console.error(\`Failed to load font:\`,e),{loadState:\`fail\`}}))}))}isMacOS(){if(this._isMacOS===void 0)try{this._isMacOS=navigator.platform.toUpperCase().indexOf(\`MAC\`)>=0}catch{this._isMacOS=!1}return this._isMacOS}copyToClipBoard(e){return navigator.clipboard.writeText(e).then((()=>{})).catch((e=>{}))}};Kh=Vh([R(),Hh(\`design:paramtypes\`,[])],Kh);let qh=new I((e=>{qh.isBrowserBound||(qh.isBrowserBound=!0,e(Kh).toSelf().inSingletonScope(),e(Zn).toService(Kh))}));function Jh(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];Jh.__loaded||(Jh.__loaded=!0,e.load(qh),e.load(Eh),e.load(Bh),t&&function(e){e.load(Ph),e.load(Fh)}(e))}qh.isBrowserBound=!1,Jh.__loaded=!1;var Yh=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Xh=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Zh=function(e,t){return function(n,r){t(n,r,e)}};let Qh=class extends am{constructor(e,t,n){super(t,n),this.contributions=e,this.pickItemInterceptorContributions=t,this.pickServiceInterceptorContributions=n,this.global.hooks.onSetEnv.tap(\`math-picker-service\`,((e,t,n)=>{this.configure(n,t)})),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach((e=>{this.pickerMap.set(e.numberType,e)})),super._init()}configure(e,t){this.pickContext=new qp(null,1)}pickItem(e,t,n,r){if(!1===e.attribute.pickable)return null;let i=this.pickerMap.get(e.numberType);if(!i)return null;let a=i.contains(e,t,r),o=a?e:null;return o?{graphic:o,params:a}:null}};Qh=Yh([R(),Zh(0,L(Kn)),Zh(0,Fn(qm)),Zh(1,L(Kn)),Zh(1,Fn(Hf)),Zh(2,L(Kn)),Zh(2,Fn(Uf)),Xh(\`design:paramtypes\`,[Object,Object,Object])],Qh);let $h=new I((e=>{$h.__vloaded||($h.__vloaded=!0,Jn(e,qm))}));$h.__vloaded=!1;var eg=$h;class tg{contains(e,t,n){if(!e.AABBBounds.containsPoint(t))return!1;if(e.attribute.pickMode===\`imprecise\`||!this.canvasRenderer)return!0;let{pickContext:r}=n??{};if(!r)return!1;let i=e.getGraphicTheme();r.highPerformanceSave();let{x:a=i.x,y:o=i.y}=e.attribute;if(e.transMatrix.onlyTranslate()){let t=e.getOffsetXY(i);a+=t.x,o+=t.y,r.setTransformForCurrent()}else a=0,o=0,r.transformFromMatrix(e.transMatrix,!0);let s=!1,c=!1;return this.canvasRenderer.drawShape(e,r,a,o,{},null,((e,n,r,i)=>!(!s&&!c)||(s=e.isPointInPath(t.x,t.y),c=i||c,s)),((e,n,i,a)=>{if(s||c)return!0;let o=n.lineWidth||i.lineWidth,l=n.pickStrokeBuffer||i.pickStrokeBuffer;return r.lineWidth=n.keepStrokeScale||i.keepStrokeScale?o+l:Bi(r,o+l,r.dpr),s=e.isPointInStroke(t.x,t.y),c=a||c,s})),r.highPerformanceRestore(),s}}var ng=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},rg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},ig=function(e,t){return function(n,r){t(n,r,e)}};let ag=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`arc\`,this.numberType=Cc}};ag=ng([R(),ig(0,L(lf)),rg(\`design:paramtypes\`,[Object])],ag);let og=!1,sg=new I(((e,t,n,r)=>{og||(og=!0,e(Jm).to(ag).inSingletonScope(),e(qm).toService(Jm))}));var cg=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},lg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},ug=function(e,t){return function(n,r){t(n,r,e)}};let dg=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`area\`,this.numberType=Tc}};dg=cg([R(),ug(0,L(uf)),lg(\`design:paramtypes\`,[Object])],dg);let fg=!1,pg=new I(((e,t,n,r)=>{fg||(fg=!0,e(Ym).to(dg).inSingletonScope(),e(qm).toService(Ym))}));var mg=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},hg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},gg=function(e,t){return function(n,r){t(n,r,e)}};let _g=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`circle\`,this.numberType=Ec}};_g=mg([R(),gg(0,L(df)),hg(\`design:paramtypes\`,[Object])],_g);let vg=!1,yg=new I(((e,t,n,r)=>{vg||(vg=!0,e(Xm).to(_g).inSingletonScope(),e(qm).toService(Xm))}));class bg{constructor(){this.type=\`glyph\`,this.numberType=Dc}contains(e,t,n){if(!e.AABBBounds.containsPoint(t))return!1;if(e.attribute.pickMode===\`imprecise\`)return!0;let{pickContext:r}=n??{};if(!r)return!1;let i=n?.pickerService;if(i){let r=!1;return e.getSubGraphic().forEach((e=>{if(r)return;let a=i.pickItem(e,t,null,n);r=!(!a||!a.graphic)})),r}return!1}}var xg=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Sg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Cg=function(e,t){return function(n,r){t(n,r,e)}};let wg=class extends bg{constructor(e){super(),this.canvasRenderer=e}};wg=xg([R(),Cg(0,L(xf)),Sg(\`design:paramtypes\`,[Object])],wg);let Tg=!1,Eg=new I(((e,t,n,r)=>{Tg||(Tg=!0,e(ih).to(wg).inSingletonScope(),e(wg).toService(ih))}));var Dg=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let Og=class{constructor(){this.type=\`image\`,this.numberType=kc}contains(e,t,n){let{pickContext:r}=n??{};return!!r&&!!e.AABBBounds.containsPoint(t)}};Og=Dg([R()],Og);let kg=!1,Ag=new I(((e,t,n,r)=>{kg||(kg=!0,e(Zm).to(Og).inSingletonScope(),e(Og).toService(Zm))}));var jg=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Mg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Ng=function(e,t){return function(n,r){t(n,r,e)}};let Pg=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`line\`,this.numberType=Ac}};Pg=jg([R(),Ng(0,L(mf)),Mg(\`design:paramtypes\`,[Object])],Pg);let Fg=!1,Ig=new I(((e,t,n,r)=>{Fg||(Fg=!0,e(Qm).to(Pg).inSingletonScope(),e(qm).toService(Qm))}));var Lg=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Rg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},zg=function(e,t){return function(n,r){t(n,r,e)}};let Bg=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`polygon\`,this.numberType=Mc}};Bg=Lg([R(),zg(0,L(gf)),Rg(\`design:paramtypes\`,[Object])],Bg);let Vg=!1,Hg=new I(((e,t,n,r)=>{Vg||(Vg=!0,e(rh).to(Bg).inSingletonScope(),e(qm).toService(rh))}));var Ug=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Wg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Gg=function(e,t){return function(n,r){t(n,r,e)}};let Kg=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`path\`,this.numberType=jc}};Kg=Ug([R(),Gg(0,L(hf)),Wg(\`design:paramtypes\`,[Object])],Kg);let qg=!1,Jg=new I(((e,t,n,r)=>{qg||(qg=!0,e($m).to(Kg).inSingletonScope(),e(qm).toService($m))})),Yg=new St;class Xg{constructor(){this.type=\`rect\`,this.numberType=Nc}contains(e,t,n){if(!e.AABBBounds.containsPoint(t))return!1;if(e.attribute.pickMode===\`imprecise\`)return!0;let{pickContext:r}=n??{};if(!r)return!1;let i=e.getGraphicTheme(),{cornerRadius:a=i.cornerRadius}=e.attribute,{x:o=i.x,y:s=i.y}=e.attribute;r.highPerformanceSave();let c=!0;if(e.transMatrix.onlyTranslate()){let t=e.getOffsetXY(i);o+=t.x,s+=t.y,r.setTransformForCurrent()}else o=0,s=0,c=!1,r.transformFromMatrix(e.transMatrix,!0);let l=!0;if(!c||e.shadowRoot||S(a,!0)&&a!==0||y(a)&&a.some((e=>e!==0)))l=!1,this.canvasRenderer.drawShape(e,r,o,s,{},null,((e,n,r)=>!!l||(l=e.isPointInPath(t.x,t.y),l)),((e,n,i)=>{if(l)return!0;let a=n.lineWidth||i.lineWidth,o=n.pickStrokeBuffer||i.pickStrokeBuffer;return r.lineWidth=n.keepStrokeScale||i.keepStrokeScale?a+o:Bi(r,a+o,r.dpr),l=e.isPointInStroke(t.x,t.y),l}));else{let{fill:n=i.fill,stroke:r=i.stroke,lineWidth:a=i.lineWidth}=e.attribute;if(n)l=!0;else if(r){let n=e.AABBBounds;Yg.setValue(n.x1,n.y1,n.x2,n.y2),Yg.expand(-a/2),l=!Yg.containsPoint(t)}}return r.highPerformanceRestore(),l}}var Zg=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Qg=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},$g=function(e,t){return function(n,r){t(n,r,e)}};let e_=class extends Xg{constructor(e){super(),this.canvasRenderer=e}};e_=Zg([R(),$g(0,L(_f)),Qg(\`design:paramtypes\`,[Object])],e_);let t_=!1,n_=new I(((e,t,n,r)=>{t_||(t_=!0,e(eh).to(e_).inSingletonScope(),e(qm).toService(eh))})),r_=!1,i_=new I(((e,t,n,r)=>{r_||(r_=!0,e(Zm).to(Og).inSingletonScope(),e(Og).toService(Zm))}));var a_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},o_=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},s_=function(e,t){return function(n,r){t(n,r,e)}};let c_=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`symbol\`,this.numberType=Fc}};c_=a_([R(),s_(0,L(vf)),o_(\`design:paramtypes\`,[Object])],c_);let l_=!1,u_=new I(((e,t,n,r)=>{l_||(l_=!0,e(th).to(c_).inSingletonScope(),e(qm).toService(th))}));var d_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let f_=class{constructor(){this.type=\`text\`,this.numberType=Ic}contains(e,t,n){return!!e.AABBBounds.containsPoint(t)}};f_=d_([R()],f_);let p_=!1,m_=new I(((e,t,n,r)=>{p_||(p_=!0,e(nh).to(f_).inSingletonScope(),e(qm).toService(nh))})),h_=new I(((e,t,n,r)=>{n(Qh)||e(Qh).toSelf().inSingletonScope(),n(Bf)?r(Bf).toService(Qh):e(Bf).toService(Qh)}));var g_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},__=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let v_=class extends xh{constructor(e,t){super(e,t);let n=e.nativeCanvas.getContext(\`2d\`);if(!n)throw Error(\`发生错误，获取2d上下文失败\`);this.nativeContext=n,this.canvas=e,this.matrix=new wt(1,0,0,1,0,0),this.stack=[],this.dpr=t??1}release(){}};v_.env=\`node\`,v_=g_([R(),__(\`design:paramtypes\`,[Object,Number])],v_);var y_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},b_=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let x_=class extends Yp{constructor(e){super(e)}init(){this._context=new v_(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(){this._nativeCanvas.release&&d(this._nativeCanvas.release)&&this._nativeCanvas.release()}};x_.env=\`node\`,x_=y_([R(),b_(\`design:paramtypes\`,[Object])],x_);let S_=Th(x_,v_);var C_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},w_=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},T_=function(e,t){return function(n,r){t(n,r,e)}};let E_=class extends tm{get container(){return null}constructor(e){super(),this.global=e,this.type=\`node\`}getTitle(){return\`\`}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(e){e.canvas?this.createWindowByCanvas(e):this.createWindowByConfig(e)}createWindowByConfig(e){let t=this.global.createCanvas({width:e.width,height:e.height}),n={width:e.width,height:e.height,dpr:e.dpr,nativeCanvas:t,id:Cn.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new x_(n)}createWindowByCanvas(e){let t=e.canvas,n=e.dpr??1,r=e.width,i=e.height;r!=null&&i!=null&&e.canvasControled||(r=t.width/n,i=t.height/n),this.canvas=new x_({width:r,height:i,dpr:n,nativeCanvas:t,canvasControled:e.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(e,t){this.canvas.resize(e,t)}setDpr(e){this.canvas.dpr=e}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:\`image/png\`;return this.canvas.nativeCanvas.toBuffer(e)}addEventListener(e,t,n){}dispatchEvent(e){return!0}removeEventListener(e,t,n){}getStyle(){}setStyle(e){}getBoundingClientRect(){return null}clearViewBox(e){}};E_.env=\`node\`,E_=C_([R(),T_(0,L(Qn)),w_(\`design:paramtypes\`,[Object])],E_);let D_=new I((e=>{e(E_).toSelf(),e(La).toDynamicValue((e=>e.container.get(E_))).whenTargetNamed(E_.env)}));var O_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let k_=class extends Qp{constructor(){super(...arguments),this.type=\`node\`,this._lastTime=0,this.supportEvent=!1}configure(e,t){e.env===this.type&&(e.setActiveEnvContribution(this),this.pkg=t)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(e){let t=fetch(e).then((e=>e.json()));return t.then((e=>({data:e,state:\`success\`}))).catch((()=>({data:null,state:\`fail\`}))),t}loadArrayBuffer(e){return fetch(e).then((e=>e.arrayBuffer())).then((e=>({data:e,loadState:\`success\`}))).catch((()=>({data:null,loadState:\`fail\`})))}loadImage(e){let{loadImage:t}=this.pkg;return t?t(e).then((e=>({loadState:e?\`success\`:\`fail\`,data:e}))).catch((()=>({loadState:\`fail\`,data:null}))):Promise.reject(Error(\`node-canvas loadImage could not be found!\`))}loadSvg(e){let t=this.pkg.Resvg;if(!t)return Promise.reject(Error(\`@resvg/resvg-js svgParser could not be found!\`));let n=new t(e).render().asPng();return this.loadImage(n)}createCanvas(e){return this.pkg.createCanvas(e.width,e.height)}releaseCanvas(e){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(e){return Fo.call(e)}}getCancelAnimationFrame(){return e=>{Fo.clear(e)}}addEventListener(e,t,n){}removeEventListener(e,t,n){}getElementById(e){return null}getRootElement(){return null}dispatchEvent(e){}release(){}createOffscreenCanvas(e){}};k_=O_([R()],k_);let A_=new I((e=>{A_.isNodeBound||(A_.isNodeBound=!0,e(k_).toSelf().inSingletonScope(),e(Zn).toService(k_))}));function j_(e){j_.__loaded||(j_.__loaded=!0,e.load(A_),e.load(S_),e.load(D_))}A_.isNodeBound=!1,j_.__loaded=!1;var M_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let N_=class extends xh{draw(){}createPattern(e,t){return null}};N_.env=\`wx\`,N_=M_([R()],N_);var P_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},F_=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)};let I_=class extends Yp{constructor(e){super(e)}init(){this._context=new N_(this,this._dpr)}release(){}};I_.env=\`wx\`,I_=P_([R(),F_(\`design:paramtypes\`,[Object])],I_);let L_=Th(I_,N_);var R_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},z_=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},B_=function(e,t){return function(n,r){t(n,r,e)}};class V_{constructor(){this.cache={}}addEventListener(e,t){e&&t&&(this.cache[e]=this.cache[e]||{listener:[]},this.cache[e].listener.push(t))}removeEventListener(e,t){if(!e||!t||!this.cache[e])return;let n=this.cache[e].listener.findIndex((e=>e===t));n>=0&&this.cache[e].listener.splice(n,1)}cleanEvent(){this.cache={}}}let H_=class extends tm{get container(){return null}constructor(e){super(),this.global=e,this.type=\`wx\`,this.eventManager=new V_}getTitle(){return this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return{x:0,y:0}}createWindow(e){e.canvas?this.createWindowByCanvas(e):this.createWindowByConfig(e)}createWindowByConfig(e){let t=this.global.createCanvas({width:e.width,height:e.height}),n={width:e.width,height:e.height,dpr:e.dpr,nativeCanvas:t,id:Cn.GenAutoIncrementId().toString(),canvasControled:!1};this.canvas=new I_(n)}createWindowByCanvas(e){let t;if(typeof e.canvas==\`string\`){if(t=this.global.getElementById(e.canvas),!t)throw Error(\`canvasId 参数不正确，请确认canvas存在并插入dom\`)}else t=e.canvas;let n=e.width,r=e.height;if(n==null||r==null||!e.canvasControled){let e=t.getBoundingClientRect();n=e.width,r=e.height}let i=e.dpr;i??=t.width/n,this.canvas=new I_({width:n,height:r,dpr:i,nativeCanvas:t,canvasControled:e.canvasControled})}releaseWindow(){}resizeWindow(e,t){}setDpr(e){this.canvas.dpr=e}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(e,t){this.eventManager.addEventListener(e,t)}removeEventListener(e,t){this.eventManager.removeEventListener(e,t)}dispatchEvent(e){let{type:t}=e;return!!this.eventManager.cache[t]&&(e.changedTouches&&e.changedTouches[0]&&(e.offsetX=e.changedTouches[0].x,e.changedTouches[0].offsetX=e.changedTouches[0].x??e.changedTouches[0].pageX,e.changedTouches[0].clientX=e.changedTouches[0].x??e.changedTouches[0].pageX,e.offsetY=e.changedTouches[0].y,e.changedTouches[0].offsetY=e.changedTouches[0].y??e.changedTouches[0].pageY,e.changedTouches[0].clientY=e.changedTouches[0].y??e.changedTouches[0].pageY),e.preventDefault=()=>{},e.stopPropagation=()=>{},this.eventManager.cache[t].listener&&this.eventManager.cache[t].listener.forEach((t=>{t(e)})),!0)}getStyle(){return{}}setStyle(e){}getBoundingClientRect(){let e=this.getWH();return{x:0,y:0,width:e.width,height:e.height,left:0,top:0,right:0,bottom:0}}clearViewBox(e){let t=this.viewBox,n=this.getContext(),r=this.getDpr();n.nativeContext.save(),n.nativeContext.setTransform(r,0,0,r,0,0),n.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),e&&(n.fillStyle=e,n.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),n.nativeContext.restore()}};H_.env=\`wx\`,H_=R_([R(),B_(0,L(Qn)),z_(\`design:paramtypes\`,[Object])],H_);let U_=new I((e=>{e(H_).toSelf(),e(La).toDynamicValue((e=>e.container.get(H_))).whenTargetNamed(H_.env)}));var W_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},G_=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},K_=function(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};let q_=class extends Qp{constructor(){super(),this.type=\`wx\`,this.supportEvent=!0,this.canvasMap=new Map,this.freeCanvasList=[],this.canvasIdx=0,this.supportsTouchEvents=!0;try{this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsPointerEvents=!1,this.supportsMouseEvents=!1}this.applyStyles=!0}configure(e,t){if(e.env===this.type)return e.setActiveEnvContribution(this),function(e,t,n,r,i,a,o){return K_(this,void 0,void 0,(function*(){let e=wx.getSystemInfoSync().pixelRatio;for(let s=0;s<t.length;s++){let c=t[s];!o&&n.has(c)||(yield new Promise((t=>{let o=wx.createSelectorQuery();a&&(o=o.in(a)),o.select(\`#\${c}\`).fields({node:!0,size:!0}).exec((a=>{if(!a[0])return;let o=a[0].node,l=a[0].width,u=a[0].height;o.width=l*e,o.height=u*e,n.set(c,o),s>=r&&i.push(o),t(null)}))})))}}))}(t.domref,t.canvasIdLists,this.canvasMap,t.freeCanvasIdx,this.freeCanvasList,t.component,t.forceUpdate).then((()=>{}))}loadImage(e){return Promise.resolve({data:e,loadState:\`success\`})}loadSvg(e){return Promise.reject()}createCanvas(e){let t=this.freeCanvasList[this.canvasIdx]||this.freeCanvasList[this.freeCanvasList.length-1];return this.canvasIdx++,t}createOffscreenCanvas(e){}releaseCanvas(e){}getDevicePixelRatio(){return wx.getSystemInfoSync().pixelRatio}getRequestAnimationFrame(){return function(e){return Fo.call(e)}}getCancelAnimationFrame(){return e=>{Fo.clear(e)}}addEventListener(e,t,n){return null}removeEventListener(e,t,n){return null}dispatchEvent(e){return null}getElementById(e){return this.canvasMap.get(e)}getRootElement(){return null}getDocument(){return null}release(){}mapToCanvasPoint(e){var t;return(t=e?.type)==null||t.startsWith(\`mouse\`),e}};q_=W_([R(),G_(\`design:paramtypes\`,[])],q_);let J_=new I((e=>{J_._isWxBound||(J_._isWxBound=!0,e(q_).toSelf().inSingletonScope(),e(Zn).toService(q_))}));function Y_(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];Y_.__loaded||(Y_.__loaded=!0,e.load(J_),e.load(L_),e.load(U_),t&&function(e){e.load(eg),e.load(h_),e.load(sg),e.load(pg),e.load(yg),e.load(Eg),e.load(Ag),e.load(Ig),e.load(Hg),e.load(Jg),e.load(n_),e.load(i_),e.load(u_),e.load(m_)}(e))}J_._isWxBound=!1,Y_.__loaded=!1;var X_=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Z_=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Q_=function(e,t){return function(n,r){t(n,r,e)}};let $_=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`arc\`,this.numberType=Cc}};$_=X_([R(),Q_(0,L(lf)),Z_(\`design:paramtypes\`,[Object])],$_);let ev=!1,tv=new I(((e,t,n,r)=>{ev||(ev=!0,e(ah).to($_).inSingletonScope(),e(hh).toService(ah))}));var nv=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},rv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},iv=function(e,t){return function(n,r){t(n,r,e)}};let av=class extends Xg{constructor(e){super(),this.canvasRenderer=e}};av=nv([R(),iv(0,L(_f)),rv(\`design:paramtypes\`,[Object])],av);let ov=!1,sv=new I(((e,t,n,r)=>{ov||(ov=!0,e(lh).to(av).inSingletonScope(),e(hh).toService(lh))}));class cv extends ud{contains(e,t,n){if(!e.AABBBounds.containsPoint(t))return!1;if(e.attribute.pickMode===\`imprecise\`)return!0;let{pickContext:r}=n??{};if(!r)return!1;r.highPerformanceSave();let i=e.getGraphicTheme(),{x:a,y:o,z:s,lastModelMatrix:c}=this.transform(e,i,r),l=t;if(r.camera){l=t.clone();let n=e.parent.globalTransMatrix;l.x=n.a*t.x+n.c*t.y+n.e,l.y=n.b*t.x+n.d*t.y+n.f}this.canvasRenderer.z=s;let u=!1;return this.canvasRenderer.drawShape(e,r,a,o,{},null,(e=>!!u||(u=e.isPointInPath(l.x,l.y),u)),((e,t,n)=>{if(u)return!0;let i=t.lineWidth||n.lineWidth,a=t.pickStrokeBuffer||n.pickStrokeBuffer;return r.lineWidth=t.keepStrokeScale||n.keepStrokeScale?i+a:Bi(r,i+a,r.dpr),u=e.isPointInStroke(l.x,l.y),u})),this.canvasRenderer.z=0,r.modelMatrix!==c&&Hl.free(r.modelMatrix),r.modelMatrix=c,r.highPerformanceRestore(),u}}var lv=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},uv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},dv=function(e,t){return function(n,r){t(n,r,e)}};let fv=class extends cv{constructor(e){super(),this.canvasRenderer=e,this.type=\`line\`,this.numberType=Ac}};fv=lv([R(),dv(0,L(mf)),uv(\`design:paramtypes\`,[Object])],fv);let pv=!1,mv=new I(((e,t,n,r)=>{pv||(pv=!0,e(sh).to(fv).inSingletonScope(),e(hh).toService(sh))}));var hv=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},gv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},_v=function(e,t){return function(n,r){t(n,r,e)}};let vv=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`area\`,this.numberType=Tc}};vv=hv([R(),_v(0,L(uf)),gv(\`design:paramtypes\`,[Object])],vv);let yv=!1,bv=new I(((e,t,n,r)=>{yv||(yv=!0,e(oh).to(vv).inSingletonScope(),e(hh).toService(oh))}));class xv extends ud{contains(e,t,n){let{pickContext:r}=n??{};if(!r)return!1;let i=e.getGraphicTheme();r.highPerformanceSave();let{x:a,y:o,z:s,lastModelMatrix:c}=this.transform(e,i,r),l=t;if(r.camera){l=t.clone();let n=e.parent.globalTransMatrix;l.x=n.a*t.x+n.c*t.y+n.e,l.y=n.b*t.x+n.d*t.y+n.f}this.canvasRenderer.z=s;let u=!1;return this.canvasRenderer.drawShape(e,r,a,o,n,null,((e,t,n)=>!!u||(u=e.isPointInPath(l.x,l.y),u))),this.canvasRenderer.z=0,r.modelMatrix!==c&&Hl.free(r.modelMatrix),r.modelMatrix=c,r.highPerformanceRestore(),u}}var Sv=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Cv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},wv=function(e,t){return function(n,r){t(n,r,e)}};let Tv=class extends xv{constructor(e){super(),this.canvasRenderer=e,this.type=\`symbol\`,this.numberType=Fc}contains(e,t,n){let{pickContext:r}=n??{};if(!r)return!1;let i=e.getParsedPath();if(!r.camera){if(!e.AABBBounds.containsPoint(t))return!1;if(i.isSvg||e.attribute.pickMode===\`imprecise\`)return!0}r.highPerformanceSave();let a=e.getGraphicTheme(),{x:o,y:s,z:c,lastModelMatrix:l}=this.transform(e,a,r),u=t;if(r.camera){u=t.clone();let n=e.parent.globalTransMatrix;u.x=n.a*t.x+n.c*t.y+n.e,u.y=n.b*t.x+n.d*t.y+n.f}this.canvasRenderer.z=c;let d=!1;return this.canvasRenderer.drawShape(e,r,o,s,{},null,((e,t,n)=>!!d||(d=e.isPointInPath(u.x,u.y),d)),((e,t,n)=>{if(d)return!0;let i=t.lineWidth||n.lineWidth,a=t.pickStrokeBuffer||n.pickStrokeBuffer;return r.lineWidth=t.keepStrokeScale||n.keepStrokeScale?i+a:Bi(r,i+a,r.dpr),d=e.isPointInStroke(u.x,u.y),d})),this.canvasRenderer.z=0,r.modelMatrix!==l&&Hl.free(r.modelMatrix),r.modelMatrix=l,r.highPerformanceRestore(),d}};Tv=Sv([R(),wv(0,L(vf)),Cv(\`design:paramtypes\`,[Object])],Tv);let Ev=!1,Dv=new I(((e,t,n,r)=>{Ev||(Ev=!0,e(uh).to(Tv).inSingletonScope(),e(hh).toService(uh))}));var Ov=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},kv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Av=function(e,t){return function(n,r){t(n,r,e)}};let jv=class extends xv{constructor(e){super(),this.canvasRenderer=e,this.type=\`text\`,this.numberType=Ic}contains(e,t,n){let{pickContext:r}=n??{};if(!r)return!1;let i=e.AABBBounds;if(!r.camera)return!!i.containsPoint(t);r.highPerformanceSave();let a=e.getGraphicTheme(),{keepDirIn3d:o=a.keepDirIn3d}=e.attribute,s=!o,{x:c,y:l,z:u,lastModelMatrix:d}=this.transform(e,a,r,s);this.canvasRenderer.z=u;let f=t;if(r.camera){f=t.clone();let n=e.parent.globalTransMatrix;f.x=n.a*t.x+n.c*t.y+n.e,f.y=n.b*t.x+n.d*t.y+n.f}let p=!1;return this.canvasRenderer.drawShape(e,r,c,l,{},null,((t,n,r)=>{if(p)return!0;let{fontSize:i=a.fontSize,textBaseline:o=a.textBaseline,textAlign:s=a.textAlign}=e.attribute,d=e.AABBBounds,m=d.height(),h=d.width(),g=Pl(o,m,i),_=Nl(s,h);return t.rect(_+c,g+l,h,m,u),p=t.isPointInPath(f.x,f.y),p}),((e,t,n)=>p)),this.canvasRenderer.z=0,r.modelMatrix!==d&&Hl.free(r.modelMatrix),r.modelMatrix=d,r.highPerformanceRestore(),p}};jv=Ov([R(),Av(0,L(yf)),kv(\`design:paramtypes\`,[Object])],jv);let Mv=!1,Nv=new I(((e,t,n,r)=>{Mv||(Mv=!0,e(dh).to(jv).inSingletonScope(),e(hh).toService(dh))}));var Pv=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Fv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Iv=function(e,t){return function(n,r){t(n,r,e)}};let Lv=class extends cv{constructor(e){super(),this.canvasRenderer=e,this.type=\`path\`,this.numberType=jc}};Lv=Pv([R(),Iv(0,L(hf)),Fv(\`design:paramtypes\`,[Object])],Lv);let Rv=!1,zv=new I(((e,t,n,r)=>{Rv||(Rv=!0,e(ch).to(Lv).inSingletonScope(),e(hh).toService(ch))}));var Bv=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Vv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Hv=function(e,t){return function(n,r){t(n,r,e)}};let Uv=class extends tg{constructor(e){super(),this.canvasRenderer=e,this.type=\`polygon\`,this.numberType=Mc}};Uv=Bv([R(),Hv(0,L(gf)),Vv(\`design:paramtypes\`,[Object])],Uv);let Wv=!1,Gv=new I(((e,t,n,r)=>{Wv||(Wv=!0,e(fh).to(Uv).inSingletonScope(),e(hh).toService(fh))}));var Kv=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r;if(typeof Reflect==\`object\`&&typeof Reflect.decorate==\`function\`)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},qv=function(e,t){if(typeof Reflect==\`object\`&&typeof Reflect.metadata==\`function\`)return Reflect.metadata(e,t)},Jv=function(e,t){return function(n,r){t(n,r,e)}};let Yv=class{constructor(e){this.canvasRenderer=e,this.type=\`richtext\`,this.numberType=Pc}contains(e,t,n){return!!e.AABBBounds.containsPoint(t)}};Yv=Kv([R(),Jv(0,L(bf)),qv(\`design:paramtypes\`,[Object])],Yv);let Xv=!1,Zv=new I(((e,t,n,r)=>{Xv||(Xv=!0,e(ph).to(Yv).inSingletonScope(),e(hh).toService(ph))})),Qv=zp();function $v(){$v.__loaded||($v.__loaded=!0,U.RegisterGraphicCreator(\`arc\`,Ou),V.load(sm),V.load(Qv?tv:sg))}$v.__loaded=!1;let ey=$v;function ty(){ty.__loaded||(ty.__loaded=!0,U.RegisterGraphicCreator(\`area\`,Tu),V.load(pm),V.load(Qv?bv:pg))}ty.__loaded=!1;let ny=ty;function ry(){ry.__loaded||(ry.__loaded=!0,U.RegisterGraphicCreator(\`group\`,$c))}ry.__loaded=!1;let iy=ry;function ay(){ay.__loaded||(ay.__loaded=!0,U.RegisterGraphicCreator(\`line\`,iu),V.load(dm),V.load(Qv?mv:Ig))}ay.__loaded=!1;let oy=ay;function sy(){sy.__loaded||(sy.__loaded=!0,U.RegisterGraphicCreator(\`path\`,Su),V.load(ym),V.load(Qv?zv:Jg))}sy.__loaded=!1;let cy=sy;function ly(){ly.__loaded||(ly.__loaded=!0,U.RegisterGraphicCreator(\`polygon\`,ju),V.load(xm),V.load(Qv?Gv:Hg))}ly.__loaded=!1;let uy=ly;function dy(){dy.__loaded||(dy.__loaded=!0,U.RegisterGraphicCreator(\`rect\`,su),V.load(lm),V.load(Qv?sv:n_))}dy.__loaded=!1;let fy=dy;function py(){py.__loaded||(py.__loaded=!0,U.RegisterGraphicCreator(\`richtext\`,yu),V.load(Em),V.load(Qv?Zv:i_))}py.__loaded=!1;let my=py;function hy(){hy.__loaded||(hy.__loaded=!0,U.RegisterGraphicCreator(\`shadowRoot\`,Nu))}hy.__loaded=!1;let gy=hy;function _y(){_y.__loaded||(_y.__loaded=!0,U.RegisterGraphicCreator(\`symbol\`,tu),V.load(hm),V.load(Qv?Dv:u_))}_y.__loaded=!1;let vy=_y;function yy(){yy.__loaded||(yy.__loaded=!0,U.RegisterGraphicCreator(\`text\`,Ql),V.load(_m),V.load(Qv?Nv:m_))}yy.__loaded=!1;let by=yy;function xy(){iy(),fy()}let Sy=-.5*Math.PI,Cy=1.5*Math.PI,wy=\`PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol\`;var Ty;(function(e){e.selected=\`selected\`,e.selectedReverse=\`selected_reverse\`,e.hover=\`hover\`,e.hoverReverse=\`hover_reverse\`})(Ty||={});let Ey={[Ty.selectedReverse]:{},[Ty.selected]:{},[Ty.hover]:{},[Ty.hoverReverse]:{}},Dy={container:\`\`,width:30,height:30,style:{}},Oy={debounce:je,throttle:Me};xy();class ky extends Km{constructor(e,t){super(t?.skipDefault?e:N({},ky.defaultAttributes,e)),this.name=\`scrollbar\`,this._onRailPointerDown=e=>{let{viewX:t,viewY:n}=e,{direction:r,width:i,height:a,range:o}=this.attribute,s=this._sliderSize,[c,l]=this._getScrollRange(),u;if(r===\`vertical\`){let e=n-this._viewPosition.y,t=De(e-s/2,c,l);u=e/a,this._slider.setAttribute(\`y\`,t,!0)}else{let e=t-this._viewPosition.x,n=De(e-s/2,c,l);u=e/i,this._slider.setAttribute(\`x\`,n,!0)}this.setScrollRange([u-(o[1]-o[0])/2,u+(o[1]-o[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=e=>{let{stopSliderDownPropagation:t=!0}=this.attribute;t&&e.stopPropagation();let{direction:n}=this.attribute,{x:r,y:i}=this.stage.eventPointTransform(e);this._prePos=n===\`horizontal\`?r:i,this._dispatchEvent(\`scrollDown\`,{pos:this._prePos,event:e}),jp.env===\`browser\`?(jp.addEventListener(\`pointermove\`,this._onSliderPointerMoveWithDelay,{capture:!0}),jp.addEventListener(\`pointerup\`,this._onSliderPointerUp)):(this.stage.addEventListener(\`pointermove\`,this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.addEventListener(\`pointerup\`,this._onSliderPointerUp),this.stage.addEventListener(\`pointerupoutside\`,this._onSliderPointerUp))},this._computeScrollValue=e=>{let{direction:t}=this.attribute,{x:n,y:r}=this.stage.eventPointTransform(e),i,a,o=0,{width:s,height:c}=this.getSliderRenderBounds();return t===\`vertical\`?(a=r,o=a-this._prePos,i=o/c):(a=n,o=a-this._prePos,i=o/s),[a,i]},this._onSliderPointerMove=e=>{let{stopSliderMovePropagation:t=!0}=this.attribute;t&&e.stopPropagation();let n=this.getScrollRange(),[r,i]=this._computeScrollValue(e);this.setScrollRange([n[0]+i,n[1]+i],!0),this._prePos=r},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:Oy[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=e=>{e.preventDefault();let{range:t,limitRange:n=[0,1]}=this.attribute,r=this.getScrollRange(),[i,a]=this._computeScrollValue(e),o=[r[0]+a,r[1]+a];this._dispatchEvent(\`scrollUp\`,{pre:t,value:Oe(o,n[0],n[1])}),jp.env===\`browser\`?(jp.removeEventListener(\`pointermove\`,this._onSliderPointerMoveWithDelay,{capture:!0}),jp.removeEventListener(\`pointerup\`,this._onSliderPointerUp)):(this.stage.removeEventListener(\`pointermove\`,this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.removeEventListener(\`pointerup\`,this._onSliderPointerUp),this.stage.removeEventListener(\`pointerupoutside\`,this._onSliderPointerUp))}}setScrollRange(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],{direction:n=\`horizontal\`,limitRange:r=[0,1],range:i,realTime:a=!0}=this.attribute,o=Oe(e,r[0],r[1]);if(t){let e=this._getSliderPos(o);if(this._slider){let t=e[1]-e[0];this._sliderSize=t,n===\`horizontal\`?this._slider.setAttributes({x:e[0],width:t},!0):this._slider.setAttributes({y:e[0],height:t},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=o,a&&this._dispatchEvent(\`scrollDrag\`,{pre:i,value:o})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;let{delayType:e=\`throttle\`,delayTime:t=0}=this.attribute;this._rail&&this._rail.addEventListener(\`pointerdown\`,Oy[e](this._onRailPointerDown,t)),this._slider&&this._slider.addEventListener(\`pointerdown\`,this._onSliderPointerDown)}render(){this._reset();let{direction:e=\`horizontal\`,width:t,height:n,range:r,limitRange:i=[0,1],railStyle:a,sliderStyle:o,padding:s=2}=this.attribute,c=this.createOrUpdateChild(\`scrollbar-container\`,{},\`group\`);this._rail=c.createOrUpdateChild(\`scrollbar-rail\`,Object.assign({x:0,y:0,width:t,height:n},a),\`rect\`);let l=this.getSliderRenderBounds(),u=this._getSliderPos(Oe(r,i[0],i[1])),d=u[1]-u[0],f;this._sliderSize=d,f=e===\`horizontal\`?{x:u[0],y:l.y1,width:d,height:l.height}:{x:l.x1,y:u[0],width:l.width,height:d},this._slider=c.createOrUpdateChild(\`slider\`,Object.assign(Object.assign(Object.assign(Object.assign({},f),{cornerRadius:this._getDefaultSliderCornerRadius()}),o),{boundsPadding:Bt(s),pickMode:\`imprecise\`}),\`rect\`),this._container=c;let p=this._container.AABBBounds;this._viewPosition={x:p.x1,y:p.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;let{width:e,height:t,padding:n=2}=this.attribute,[r,i,a,o]=Bt(n),s={x1:o,y1:r,x2:e-i,y2:t-a,width:Math.max(0,e-(o+i)),height:Math.max(0,t-(r+a))};return this._sliderRenderBounds=s,s}_getDefaultSliderCornerRadius(){let{direction:e,round:t}=this.attribute;if(t){let{width:t,height:n}=this.getSliderRenderBounds();return e===\`horizontal\`?n:t}return 0}_getSliderPos(e){let{direction:t}=this.attribute,{width:n,height:r,x1:i,y1:a}=this.getSliderRenderBounds();return t===\`horizontal\`?[n*e[0]+i,n*e[1]+i]:[r*e[0]+a,r*e[1]+a]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;let{limitRange:e=[0,1],direction:t}=this.attribute,[n,r]=Oe(e,0,1),{width:i,height:a,x1:o,y1:s}=this.getSliderRenderBounds(),c=this._sliderSize;return t===\`horizontal\`?Oe([o+n*i,o+r*i],o,i-c):Oe([s+n*a,s+r*a],s,a-c)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}}function Ay(e,t){e.forEachChildren((e=>{let n=t(e);e.isContainer&&!n&&Ay(e,t)}))}ky.defaultAttributes={direction:\`horizontal\`,round:!0,sliderSize:20,sliderStyle:{fill:\`rgba(0, 0, 0, .5)\`},railStyle:{fill:\`rgba(0, 0, 0, .0)\`},padding:2,scrollRange:[0,1],delayType:\`throttle\`,delayTime:0,realTime:!0};let jy=e=>!f(e)&&!1!==e.visible,My=[\`#ffffff\`,\`#000000\`];function Ny(e,t,n,r,i,a){if(typeof e!=\`string\`||typeof t!=\`string\`)return e;let o=new It(e).toHex(),s=new It(t).toHex();return Py(o,s,n,r,a)?o:function(e,t,n,r,i,a){let o=[];i&&(i instanceof Array?o.push(...i):o.push(i)),o.push(...My);for(let i of o)if(e!==i&&Py(i,t,n,r,a))return i}(o,s,n,r,i,a)}function Py(e,t,n,r,i){if(i===\`lightness\`){let n=It.getColorBrightness(new It(t));return It.getColorBrightness(new It(e))<.5?n>=.5:n<.5}return r?Fy(e,t)>r:n===\`largeText\`?Fy(e,t)>3:Fy(e,t)>4.5}function Fy(e,t){let n=Iy(e),r=Iy(t);return((n>r?n:r)+.05)/((n>r?r:n)+.05)}function Iy(e){let t=Rt(e),n=t[0]/255,r=t[1]/255,i=t[2]/255,a,o,s;return a=n<=.03928?n/12.92:((n+.055)/1.055)**2.4,o=r<=.03928?r/12.92:((r+.055)/1.055)**2.4,s=i<=.03928?i/12.92:((i+.055)/1.055)**2.4,.2126*a+.7152*o+.0722*s}function Ly(e,t,n,r){let i;switch(e){case\`base\`:i=t;break;case\`invertBase\`:i=n;break;case\`similarBase\`:i=r}return i}function Ry(e){let t=function(e){let[t,n]=e;return Math.sqrt(t*t+n*n)}(e);return t>0&&(t=1/t),[e[0]*t,e[1]*t]}function zy(e,t,n){let r=function(e,t){let[n,r]=e,[i,a]=t,o=Math.sqrt((n*n+r*r)*(i*i+a*a)),s=o&&(n*i+r*a)/o;return Math.acos(Math.min(Math.max(s,-1),1))}(e,t),i=(o=t,(a=e)[0]*o[1]-a[1]*o[0]>=0);var a,o;return n?i?2*Math.PI-r:r:i?r:2*Math.PI-r}let By=(e,t,n,r)=>new yt(Object.assign({defaultFontParams:Object.assign({fontFamily:wy,fontSize:14},r),getTextBounds:n?void 0:Iu,specialCharSet:\`-/: .,@%'"~\`+yt.ALPHABET_CHAR_SET+yt.ALPHABET_CHAR_SET.toUpperCase()},t??{}),e);function Vy(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!e)return{width:0,height:0};let r=Iu({text:e,fontFamily:t.fontFamily||n.fontFamily||wy,fontSize:t.fontSize||n.fontSize||12,fontWeight:t.fontWeight||n.fontWeight,textAlign:t.textAlign||\`center\`,textBaseline:t.textBaseline,ellipsis:!!t.ellipsis,maxLineWidth:t.maxLineWidth||1/0,lineHeight:t.fontSize||n.fontSize||12});return{width:r.width(),height:r.height()}}function Hy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:\`type\`;var n;return m(e.text)&&\`type\`in e.text?e.text.type??\`text\`:t in e&&(n=e[t])!=null?n:\`text\`}function Uy(e){return p(e.maxLineWidth)&&(e.maxWidth=e.maxLineWidth,delete e.maxLineWidth),e.width=e.width??0,e.height=e.height??0,e.textConfig=e.text.text||e.text,e}function Wy(e){let t=Hy(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:\`type\`);return t===\`rich\`?U.richtext(Uy(e)):(t===\`html\`?e=function(e){let{text:t,_originText:n}=e,{text:r}=t;return e.html=r,e.text=n,e.renderable=!1,e}(e):t===\`react\`&&(e=function(e){let{text:t,_originText:n}=e,{text:r}=t;return e.react=r,e.text=n,e.renderable=!1,e}(e)),U.text(e))}function Gy(e,t,n,r,i){e===\`right\`?n===\`center\`?t.setAttribute(\`x\`,r-i/2):n===\`right\`||n===\`end\`?t.setAttribute(\`x\`,r):t.setAttribute(\`x\`,r-i):n===\`center\`?t.setAttribute(\`x\`,r+i/2):n===\`right\`||n===\`end\`?t.setAttribute(\`x\`,r+i):t.setAttribute(\`x\`,r)}function Ky(){iy(),fy(),vy(),my(),by()}var qy=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};Ky();class Jy extends Km{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(e,t){super(t?.skipDefault?e:N({},Jy.defaultAttributes,e)),this.name=\`tag\`,this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){this.cacheStates();let{text:e=\`\`,textStyle:t={},shape:n={},panel:r={},space:i=4,minWidth:a,maxWidth:o,padding:s=4,visible:c,state:l,type:d,textAlwaysCenter:h,containerTextAlign:g}=this.attribute,_=Bt(s),v=this.createOrUpdateChild(\`tag-content\`,{x:0,y:0,zIndex:1},\`group\`),y,b=-_[3],x=-_[0],C=_[1]+_[3],w=_[0]+_[2],T=0,E=0,{visible:D}=n,O=qy(n,[\`visible\`]);if(u(D)){let e=O?.size||10,t=S(e)?e:Math.max(e[0],e[1]);y=v.createOrUpdateChild(\`tag-shape\`,Object.assign(Object.assign({symbolType:\`circle\`,size:e,strokeBoundsBuffer:0},O),{visible:D,x:t/2,y:t/2}),\`symbol\`),A(l?.shape)||(y.states=l.shape),D&&(E=t+i)}let k,j,ee;if(C+=E,T+=E,function(e){return Hy(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:\`type\`)===\`rich\`}({text:e})||d===\`rich\`){let n=Object.assign(Object.assign(Object.assign({},Uy(Object.assign({type:d,text:e},t))),t),{visible:p(e)&&!1!==c,x:T,y:0});f(n.lineHeight)&&(n.lineHeight=t.fontSize),k=v.createOrUpdateChild(\`tag-text\`,n,\`richtext\`),j=k.AABBBounds.width(),ee=k.AABBBounds.height()}else{let n=Object.assign(Object.assign({text:m(e)&&\`type\`in e&&e.type===\`text\`?e.text:e,visible:p(e)&&!1!==c,lineHeight:t?.fontSize},t),{x:T,y:0});f(n.lineHeight)&&(n.lineHeight=t.fontSize),k=v.createOrUpdateChild(\`tag-text\`,n,\`text\`);let r=Vy(n.text,t,this.stage?.getTheme()?.text);j=r.width,ee=r.height}C+=j;let te=n.size??10,M=S(te)?te:Math.max(te[0],te[1]);w+=Math.max(ee,n.visible?M:0);let{textAlign:ne,textBaseline:re}=t;(p(a)||p(o))&&(p(a)&&C<a&&(C=a),p(o)&&C>o&&(C=o,k.setAttribute(\`maxLineWidth\`,o-_[1]-_[2]))),b=0,x=0;let ie=0;ne===\`left\`||ne===\`start\`?ie=1:ne===\`right\`||ne===\`end\`?ie=-1:ne===\`center\`&&(ie=0),ie?ie<0?(b-=C,y&&y.setAttribute(\`x\`,(y.attribute.x||0)-j),v.setAttribute(\`x\`,-_[1]-E)):ie>0&&v.setAttribute(\`x\`,_[3]):(b-=C/2,y&&y.setAttribute(\`x\`,(y.attribute.x||0)-j/2),v.setAttribute(\`x\`,-E/2));let N=g===\`right\`||g===\`end\`,ae=g===\`left\`||g===\`start\`,oe=(e,t)=>{k.type===\`richtext\`?k.setAttributes({x:e,textAlign:t,textConfig:P(k.attribute.textConfig).map((e=>Object.assign(Object.assign({},e),{textAlign:t})))}):k.setAttributes({x:e,textAlign:t})};if((g?g===\`center\`:h)&&ie){let e=C-_[1]-_[3],t=j+E,n=ie===1?(e-t)/2+E+j/2:_[0]+E-(C/2+t/2-E)+j/2;if(oe(n,\`center\`),y){let e=n-j/2-E+M/2;y.setAttributes({x:e})}}if(ae&&ie!==1){let e=C-_[1]-_[3],t=ie===0?-e/2+E/2:-C+_[3]+_[1]+E;if(oe(t+E,\`left\`),y){let e=t+M/2;y.setAttributes({x:e})}}if(N&&ie!==-1){let e=C-_[1]-_[3],t=ie===0?e/2+E/2:e;if(oe(t,\`right\`),y){let e=t-j-E+M/2;y.setAttributes({x:e})}}re===\`middle\`?(x-=w/2,y&&y.setAttribute(\`y\`,0)):re===\`bottom\`?(x-=w,y&&y.setAttribute(\`y\`,-ee/2),v.setAttribute(\`y\`,-_[2])):re===\`top\`&&(v.setAttribute(\`y\`,_[0]),y&&y.setAttribute(\`y\`,ee/2)),A(l?.text)||(k.states=l.text);let{visible:se}=r,ce=qy(r,[\`visible\`]);if(c&&u(se)){let t=this.createOrUpdateChild(\`tag-panel\`,Object.assign(Object.assign({},ce),{visible:se&&!!e,width:C,height:w,x:b,y:x}),\`rect\`);if(A(l?.panel)||(t.states=l.panel),ce.customShape){let e=ce.customShape;t.pathProxy=t=>e(this,t,new pi)}this._bgRect=t}this._textShape=k,this._symbol=y,this.resetStates()}initAttributes(e,t){e=t?.skipDefault?e:N({},Jy.defaultAttributes,e),super.initAttributes(e),this.render()}addState(e,t,n){super.addState(e,t,n),this._textShape&&this._textShape.addState(e,t,n),this._bgRect&&this._bgRect.addState(e,t,n),this._symbol&&this._symbol.addState(e,t,n)}removeState(e,t){super.removeState(e,t),this._textShape&&this._textShape.removeState(e,t),this._bgRect&&this._bgRect.removeState(e,t),this._symbol&&this._symbol.removeState(e,t)}cacheStates(){var e,t,n;this._tagStates=this.currentStates?.slice()??[],this._rectStates=(this._bgRect?.currentStates)?.slice()??[],this._symbolStates=(this._symbol?.currentStates)?.slice()??[],this._textStates=(this._textShape?.currentStates)?.slice()??[],this.clearStates(),(e=this._bgRect)==null||e.clearStates(),(t=this._symbol)==null||t.clearStates(),(n=this._textShape)==null||n.clearStates()}resetStates(){var e,t,n;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((e=this._bgRect)==null||e.useStates(this._rectStates)),this._symbolStates.length&&((t=this._symbol)==null||t.useStates(this._symbolStates)),this._textStates.length&&((n=this._textShape)==null||n.useStates(this._textStates))}}Jy.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:\`#000\`,textAlign:\`left\`,textBaseline:\`top\`},space:4,padding:4,shape:{fill:\`#000\`}};let Yy={visible:!0,position:\`auto\`,titleStyle:{fontSize:16,fill:\`#08979c\`},contentStyle:{fontSize:12,fill:\`green\`},panel:{visible:!0,fill:\`#e6fffb\`,size:12,space:0,stroke:\`#87e8de\`,lineWidth:1,cornerRadius:4}},Xy={poptip:N({},Yy)};class Zy extends Km{constructor(){super(...arguments),this.name=\`crosshair\`}render(){this.renderCrosshair(this)}}iy(),oy();class Qy extends Zy{constructor(e,t){super(t?.skipDefault?e:N({},Qy.defaultAttributes,e))}renderCrosshair(e){let{start:t,end:n,lineStyle:r}=this.attribute;return e.createOrUpdateChild(\`crosshair-line\`,Object.assign({points:[t,n]},r),\`line\`)}setLocation(e){let{start:t,end:n}=e;this.setAttributes({start:t,end:n})}}Qy.defaultAttributes={lineStyle:{stroke:\`#b2bacf\`,lineWidth:1,lineDash:[2]}},iy(),fy();class $y extends Zy{constructor(e,t){super(t?.skipDefault?e:N({},$y.defaultAttributes,e))}renderCrosshair(e){let{start:t,end:n,rectStyle:r}=this.attribute;return e.createOrUpdateChild(\`crosshair-rect\`,Object.assign({x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y},r),\`rect\`)}setLocation(e){let{start:t,end:n}=e;this.setAttributes({start:t,end:n})}}$y.defaultAttributes={rectStyle:{fill:\`#b2bacf\`,opacity:.2}},iy(),oy(),uy(),vy();class eb extends Km{getStartAngle(){return it(this._startAngle)}getEndAngle(){return it(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(e,t){super(t?.skipDefault?e:N({},eb.defaultAttributes,e)),this.name=\`segment\`,this.key=\`segment\`,this.lines=[]}render(){this.removeAllChild(!0),this._reset();let{startSymbol:e,endSymbol:t,lineStyle:n,state:r,visible:i=!0,multiSegment:a,mainSegmentIndex:o}=this.attribute;if(!i)return;this._computeLineAngle();let s=this._getMainSegmentPoints(),c=this._renderSymbol(e,s,\`start\`),l=this._renderSymbol(t,s,\`end\`);if(this.startSymbol=c,this.endSymbol=l,a){let e=[...this.attribute.points];if(C(o))e[o]=this._clipPoints(e[o]);else{let t=this._clipPoints(he(e));e[0][0]=t[0],e[e.length-1][e[e.length-1].length-1]=t[t.length-1]}e.forEach(((e,t)=>{let i=U.line(Object.assign(Object.assign({points:e},y(n)?n[t]??n[n.length-1]:n),{fill:!1}));i.name=\`\${this.name}-line\`,i.id=this._getNodeId(\`line\`+t),A(r?.line)||(i.states=y(r.line)?r.line[t]??r.line[r.line.length-1]:r.line),this.add(i),this.lines.push(i)}))}else{let e=U.line;P(n)[0].cornerRadius&&(e=U.polygon);let t=e(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},P(n)[0]),{fill:!1,closePath:!1}));t.name=\`\${this.name}-line\`,t.id=this._getNodeId(\`line\`),A(r?.line)||(t.states=[].concat(r.line)[0]),this.add(t),this.lines.push(t)}}_computeStartRotate(e){return e+Math.PI/2}_computeEndRotate(e){return e+Math.PI/2}_renderSymbol(e,t,n){if(!t.length)return;let{autoRotate:r=!0}=e,i;if(e&&e.visible){let a=this.getStartAngle(),o=this.getEndAngle(),{state:s}=this.attribute,c=t[0],l=t[t.length-1],{refX:u=0,refY:d=0,refAngle:f=0,style:p,symbolType:m,size:h=12}=e,g,_;n===\`start\`?(g={x:c.x+(C(a)?u*Math.cos(a)+d*Math.cos(a-Math.PI/2):0),y:c.y+(C(a)?u*Math.sin(a)+d*Math.sin(a-Math.PI/2):0)},_=this._computeStartRotate(this._startAngle)):(g={x:l.x+(C(o)?u*Math.cos(o)+d*Math.cos(o-Math.PI/2):0),y:l.y+(C(o)?u*Math.sin(o)+d*Math.sin(o-Math.PI/2):0)},_=this._computeEndRotate(this._endAngle)),i=U.symbol(Object.assign(Object.assign(Object.assign({},g),{symbolType:m,size:h,angle:r?_+f:0,strokeBoundsBuffer:0}),p)),i.name=\`\${this.name}-\${n}-symbol\`,i.id=this._getNodeId(\`\${n}-symbol\`),A(s?.symbol)||(i.states=s.symbol),n===\`start\`?A(s?.startSymbol)||(i.states=s.startSymbol):A(s?.endSymbol)||(i.states=s.endSymbol),this.add(i)}return i}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;let{points:e,multiSegment:t,mainSegmentIndex:n}=this.attribute,r;return r=t?C(n)?e[n]:he(e):e,this._mainSegmentPoints=r,r}_clipPoints(e){let{startSymbol:t={},endSymbol:n={}}=this.attribute,r=e;if(t.visible){let n=t.clip?t.size||10:0;r=[{x:e[0].x-n/2*(Math.cos(this._startAngle)||0),y:e[0].y-n/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(n.visible){let t=n.clip?n.size||10:0,i={x:e[e.length-1].x-t/2*(Math.cos(this._endAngle)||0),y:e[e.length-1].y-t/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),i]}return r}_computeLineAngle(){let e=this._getMainSegmentPoints();if(e.length<=1)return;let t=e[0],n=e[1],r=e[e.length-2],i=e[e.length-1],a=[t.x-n.x,t.y-n.y],o=Math.atan2(a[1],a[0]),s=[i.x-r.x,i.y-r.y],c=Math.atan2(s[1],s[0]);this._startAngle=o,this._endAngle=c}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}var tb,nb;eb.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:\`#000\`},startSymbol:{visible:!1,autoRotate:!0,symbolType:\`triangle\`,size:12,refX:0,refY:0,refAngle:0,style:{fill:\`#000\`,zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:\`triangle\`,size:12,refX:0,refY:0,refAngle:0,style:{fill:\`#000\`,zIndex:1}}},function(e){e.innerView=\`inner-view\`,e.axisContainer=\`axis-container\`,e.labelContainer=\`axis-label-container\`,e.tickContainer=\`axis-tick-container\`,e.tick=\`axis-tick\`,e.subTick=\`axis-sub-tick\`,e.label=\`axis-label\`,e.title=\`axis-title\`,e.gridContainer=\`axis-grid-container\`,e.grid=\`axis-grid\`,e.gridRegion=\`axis-grid-region\`,e.line=\`axis-line\`,e.background=\`axis-background\`,e.axisLabelBackground=\`axis-label-background\`,e.axisBreak=\`axis-break\`,e.axisBreakSymbol=\`axis-break-symbol\`}(tb||={}),function(e){e.selected=\`selected\`,e.selectedReverse=\`selected_reverse\`,e.hover=\`hover\`,e.hoverReverse=\`hover_reverse\`}(nb||={});let rb={[nb.selectedReverse]:{},[nb.selected]:{},[nb.hover]:{},[nb.hoverReverse]:{}},ib={title:{space:4,padding:0,textStyle:{fontSize:12,fill:\`#333333\`,fontWeight:\`normal\`,fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:\`#333\`,fontWeight:\`normal\`,fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:\`#000\`,strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:\`#999\`,strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:\`#000\`,strokeOpacity:1}}},ab={size:8,stroke:\`#000\`,lineWidth:1,zIndex:1},ob=Math.sin(Math.PI/10);function sb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ob,n=!f(e)&&e!==0,r=n?Math.cos(e):1;return n&&Math.abs(r)<=t}function cb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ob,n=!f(e)&&e!==0,r=n?Math.sin(e):0;return!n||Math.abs(r)<=t}function lb(e){let t={};return Ay(e,(e=>{e.type!==\`group\`&&e.id&&(t[e.id]=e)})),t}function ub(e,t){return{x:e.x+t[0],y:e.y+t[1]}}function db(e,t){let n=\`\`;return e.length===0||(e.forEach(((e,t)=>{t===0?n=\`M\${e.x},\${e.y}\`:n+=\`L\${e.x},\${e.y}\`})),t&&(n+=\`Z\`)),n}function fb(e,t,n){let r,i,a=(e,t,n)=>(r=e.AABBBounds,i=t.AABBBounds,n>Math.max(i.x1-r.x2,r.x1-i.x2,i.y1-r.y2,r.y1-i.y2));return cb(e.attribute?.angle,2**-52)?a(e,t,n):(r=e.OBBBounds,i=t.OBBBounds,!r||!i||r.empty()||i.empty()?a(e,t,n):r.intersects(i))}function pb(e,t){for(let n,r=1,i=e.length,a=e[0];r<i;a=n,++r)if(n=e[r],fb(a,n,t))return!0;return!1}class mb extends Km{constructor(){super(...arguments),this.name=\`axis\`,this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=e=>{this._lastHover=((e,t,n)=>{let r=e.target;return r!==n&&r.name&&!A(r.states)?(r.addState(Ty.hover,!0),Ay(t,(e=>{e!==r&&e.name&&!A(e.states)&&e.addState(Ty.hoverReverse,!0)})),r):n})(e,this.axisContainer,this._lastHover)},this._onUnHover=e=>{this._lastHover=((e,t,n)=>n&&(Ay(t,(e=>{e.name&&!A(e.states)&&(e.removeState(Ty.hoverReverse),e.removeState(Ty.hover))})),null))(0,this.axisContainer,this._lastHover)},this._onClick=e=>{this._lastSelect=((e,t,n)=>{let r=e.target;return n===r&&r.hasState(Ty.selected)?(Ay(t,(e=>{e.name&&!A(e.states)&&(e.removeState(Ty.selectedReverse),e.removeState(Ty.selected))})),null):r.name&&!A(r.states)?(r.addState(Ty.selected,!0),Ay(t,(e=>{e!==r&&e.name&&!A(e.states)&&e.addState(Ty.selectedReverse,!0)})),r):n})(e,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(e){let t=M(this.attribute);N(this.attribute,e);let n=U.group({x:this.attribute.x,y:this.attribute.y});return this.add(n),this._renderInner(n),this.removeChild(n),this.attribute=t,n.AABBBounds}render(){this._prevInnerView=this._innerView&&lb(this._innerView),this.removeAllChild(!0),this._innerView=U.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;let{hover:e,select:t}=this.attribute;e&&(this._innerView.addEventListener(\`pointermove\`,this._onHover),this._innerView.addEventListener(\`pointerout\`,this._onUnHover)),t&&this._innerView.addEventListener(\`pointerdown\`,this._onClick)}_renderInner(e){let{title:t,label:n,tick:r,line:i,items:a}=this.attribute,o=U.group({x:0,y:0,zIndex:1,pickable:!1});if(o.name=tb.axisContainer,o.id=this._getNodeId(\`container\`),o.setMode(this.mode),this.axisContainer=o,e.add(o),i&&i.visible&&this.renderLine(o),a&&a.length&&(this.data=this._transformItems(a[0]),r&&r.visible&&this.renderTicks(o),n&&n.visible)){let e=U.group({x:0,y:0,pickable:!1});e.name=tb.labelContainer,e.id=this._getNodeId(\`label-container\`),this.axisLabelsContainer=e,o.add(e),a.forEach(((t,n)=>{let r=this.renderLabels(e,t,n),i=r.getChildren();this.beforeLabelsOverlap(i,t,r,n,a.length),this.handleLabelsOverlap(i,t,r,n,a.length),this.afterLabelsOverlap(i,t,r,n,a.length);let o=0,s=0,c=\`center\`,l=\`middle\`,u=0;i.forEach(((e,t)=>{let n=e.attribute,r=n.angle??0,i=e.AABBBounds,a=i.width(),d=i.height();r&&(a=Math.abs(a*Math.cos(r)),d=Math.abs(d*Math.sin(r))),o=Math.max(o,a),s=Math.max(s,d),c=n.textAlign,l=n.textBaseline,t===0&&(u=n.x)})),this.axisLabelLayerSize[n]={width:o,height:s,labelPos:u,textAlign:c,textBaseline:l}}))}t&&t.visible&&this.renderTitle(o)}renderTicks(e){let t=this.getTickLineItems(),n=U.group({x:0,y:0,pickable:!1});n.name=tb.tickContainer,n.id=this._getNodeId(\`tick-container\`),e.add(n),t.forEach(((e,r)=>{let i=U.line(Object.assign({},this._getTickLineAttribute(\`tick\`,e,r,t)));if(i.name=tb.tick,i.id=this._getNodeId(e.id),A(this.attribute.tick?.state))i.states=Ey;else{let e=this.data[r],t=N({},Ey,this.attribute.tick.state);Object.keys(t).forEach((n=>{d(t[n])&&(t[n]=t[n](e.rawValue,r,e,this.data))})),i.states=t}n.add(i)})),this.tickLineItems=t;let{subTick:r}=this.attribute;if(r&&r.visible){let e=this.getSubTickLineItems();e.length&&e.forEach(((e,i)=>{let a=U.line(Object.assign({},this._getTickLineAttribute(\`subTick\`,e,i,t)));if(a.name=tb.subTick,a.id=this._getNodeId(\`\${i}\`),A(r.state))a.states=Ey;else{let n=N({},Ey,r.state);Object.keys(n).forEach((r=>{d(n[r])&&(n[r]=n[r](e.value,i,e,t))})),a.states=n}n.add(a)})),this.subTickLineItems=e}}renderLabels(e,t,n){let{dataFilter:r}=this.attribute.label;r&&d(r)&&(t=r(t,n));let i=this._transformItems(t),a=U.group({x:0,y:0,pickable:!1});return a.name=\`\${tb.labelContainer}-layer-\${n}\`,a.id=this._getNodeId(\`label-container-layer-\${n}\`),e.add(a),i.forEach(((e,t)=>{let r=Wy(this._getLabelAttribute(e,t,i,n));if(r.name=tb.label,r.id=this._getNodeId(\`layer\${n}-label-\${e.id}\`),A(this.attribute.label?.state))r.states=Ey;else{let a=N({},Ey,this.attribute.label.state);Object.keys(a).forEach((r=>{d(a[r])&&(a[r]=a[r](e,t,i,n))})),r.states=a}r.data=Object.assign(Object.assign({},e),{index:t,layer:n}),a.add(r)})),a}renderTitle(e){let t=this.getTitleAttribute(),n=new Jy(Object.assign({},t));n.name=tb.title,n.id=this._getNodeId(\`title\`),e.add(n)}getVerticalCoord(e,t,n){return ub(e,this.getVerticalVector(t,n,e))}getTickLineItems(){let{tick:e}=this.attribute,t=this.data,n=[],{alignWithLabel:r,inside:i=!1,length:a,dataFilter:o}=e,s=1;return t.length>=2&&(s=t[1].value-t[0].value),(o&&d(o)?o(t):t).forEach((e=>{let t=e.point,o=e.value;if(!r){let n=e.value-s/2;if(this.isInValidValue(n))return;t=this.getTickCoord(n),o=n}let c=this.getVerticalCoord(t,a,i);if(this.mode===\`3d\`){let r=this.getVerticalVector(a,i,t),s=0,l=0;Ve(r[0])>Ve(r[1])?s=Re/2*(c.x>t.x?1:-1):l=Re/2*(c.y>t.y?-1:1),n.push({start:t,end:c,value:o,id:\`tick-\${e.id}\`,anchor:[t.x,t.y],alpha:s,beta:l})}else n.push({start:t,end:c,value:o,id:\`tick-\${e.id}\`})})),n}getSubTickLineItems(){let{subTick:e}=this.attribute,t=[],{count:n=4,inside:r=!1,length:i=2}=e,a=this.tickLineItems,o=a.length;if(o>=2)for(let e=0;e<o-1;e++){let o=a[e],s=a[e+1];for(let e=0;e<n;e++){let a=(e+1)/(n+1),c=(1-a)*o.value+a*s.value,l=this.getTickCoord(c),u=this.getVerticalCoord(l,i,r);t.push({start:l,end:u,value:c,id:\`sub-tick-\${c}\`})}}return t}_getTickLineAttribute(e,t,n,r){let i=j(this.attribute,\`\${e}.style\`),a=this.data[n];i=d(i)?N({},j(ib,\`\${e}.style\`),e===\`tick\`?i(a.rawValue,n,a,this.data):i(t.value,n,t,r)):i;let{start:o,end:s,anchor:c,alpha:l,beta:u}=t;return Object.assign({points:[o,s],anchor:c,alpha:l,beta:u},i)}_getLabelAttribute(e,t,n,r){var i,a;let{space:o=4,inside:s=!1,formatMethod:c,type:l=\`text\`,text:u}=this.attribute.label,f=o,p=0;(i=this.attribute.tick)!=null&&i.visible&&this.attribute.tick.inside===s&&(p=this.attribute.tick.length||4),(a=this.attribute.subTick)!=null&&a.visible&&this.attribute.subTick.inside===s&&(p=Math.max(p,this.attribute.subTick.length||2)),f+=p;let m=this.getRelativeVector(e.point);r>0&&(m[1]===0?f+=(this.axisLabelLayerSize[r-1].height+j(this.attribute,\`label.space\`,4))*r:f+=(this.axisLabelLayerSize[r-1].width+j(this.attribute,\`label.space\`,4))*r);let h=this.getVerticalCoord(e.point,f,s),g=this.getVerticalVector(f||1,s,h),_=c?c(\`\${e.label}\`,e,t,n,r):e.label,{style:v}=this.attribute.label;return v=d(v)?N({},ib.label.style,v(e,t,n,r)):v,v=N(this.getLabelAlign(g,s,v.angle),v),d(v.text)&&(v.text=v.text({label:e.label,value:e.rawValue,index:e.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(h,g,_,v)),{text:u??_,_originText:e.label,lineHeight:v?.fontSize,type:l}),v)}getLabelPosition(e,t,n,r){return e}_transformItems(e){let t=[];return e.forEach((e=>{t.push(Object.assign(Object.assign({},e),{point:this.getTickCoord(e.value),id:e.id??e.label}))})),t}release(){super.release(),this._prevInnerView=null,this._innerView=null}}let hb={parity:function(e){return e.filter(((e,t)=>t%2?e.setAttribute(\`opacity\`,0):1))},greedy:function(e,t){let n;return e.filter(((e,r)=>r&&fb(n,e,t)?e.setAttribute(\`opacity\`,0):(n=e,1)))}};function gb(e){let t;return t=e.OBBBounds.empty()?e.AABBBounds:e.OBBBounds,t.width()>1&&t.height()>1}function _b(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0&&arguments[4];if(n&&!e.attribute.opacity){let n=t.length;if(n>1){e.setAttribute(\`opacity\`,1);for(let e=0;e<n;e++){let a=i?t[n-1-e]:t[e];if(!r(a))break;a.setAttribute(\`opacity\`,0)}}}}function vb(e){for(let a=1;a<e.length;a++)if(t=e[a-1],n=e[a],r=void 0,i=void 0,(r=t.OBBBounds)?.empty()||(i=n.OBBBounds)?.empty()?lt(t.AABBBounds,n.AABBBounds,!1)&&(!t.rotatedBounds||!n.rotatedBounds||ht(t.rotatedBounds,n.rotatedBounds,!0)):t.OBBBounds.intersects(n.OBBBounds))return!0;var t,n,r,i;return!1}function yb(e,t){e!==\`bottom\`&&e!==\`top\`||function(e,t){t.forEach((t=>{t.attribute.angle&&t.setAttributes(Object.assign(Object.assign({},xb(e,t.attribute.angle)),{angle:bb(t.attribute.angle)}))}))}(e,t),e!==\`left\`&&e!==\`right\`||function(e,t){t.forEach(((t,n)=>{t.attribute.angle&&t.setAttributes(Object.assign(Object.assign({},Sb(e,t.attribute.angle)),{angle:bb(t.attribute.angle)}))}))}(e,t),function(e){e.forEach((e=>{if(e.rotatedBounds||!e.attribute.angle)return;let t=function(e){let t=e.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:e.attribute.x,centerY:e.attribute.y,angle:e.attribute.angle}}(e),n=ft({x:e.attribute.x,y:e.attribute.y},t.angle,{x:t.centerX,y:t.centerY}),r=n.x-t.centerX,i=n.y-t.centerY;t.x1+=r,t.x2+=r,t.y1+=i,t.y2+=i,t.centerX+=r,t.centerY+=i,e.rotatedBounds=t}))}(t)}function bb(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e<0)for(;e<0;)e+=2*Math.PI;if(e>0)for(;e>=2*Math.PI;)e-=2*Math.PI;return e}function xb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=[\`center\`,\`left\`,\`left\`,\`left\`,\`center\`,\`right\`,\`right\`,\`right\`,\`left\`],r=[\`top\`,\`top\`,\`middle\`,\`bottom\`,\`bottom\`,\`bottom\`,\`middle\`,\`top\`,\`top\`];e===\`top\`&&(n=[\`center\`,\`right\`,\`right\`,\`right\`,\`center\`,\`left\`,\`left\`,\`left\`,\`right\`],r=[\`bottom\`,\`bottom\`,\`middle\`,\`top\`,\`top\`,\`top\`,\`middle\`,\`bottom\`,\`bottom\`]);let i=(t=bb(t))/(.5*Math.PI),a;return a=i===Math.floor(i)?2*Math.floor(i):2*Math.floor(i)+1,{textAlign:n[a],textBaseline:r[a]}}function Sb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=[\`right\`,\`right\`,\`center\`,\`left\`,\`left\`,\`left\`,\`center\`,\`right\`,\`right\`],r=[\`middle\`,\`middle\`,\`top\`,\`top\`,\`middle\`,\`middle\`,\`bottom\`,\`bottom\`,\`middle\`];e===\`right\`&&(n=[\`left\`,\`left\`,\`center\`,\`right\`,\`right\`,\`right\`,\`center\`,\`left\`,\`left\`],r=[\`middle\`,\`middle\`,\`bottom\`,\`bottom\`,\`middle\`,\`middle\`,\`top\`,\`middle\`,\`middle\`]);let i=(t=bb(t))/(.5*Math.PI),a;return a=i===Math.floor(i)?2*Math.floor(i):2*Math.floor(i)+1,{textAlign:n[a],textBaseline:r[a]}}function Cb(e,t){let{limitLength:n,verticalLimitLength:r,ellipsis:i=\`...\`,orient:a,axisLength:o}=t;if(A(e)||!C(n))return;let s=function(e){return C(e)?{left:e,right:e}:m(e)?{left:e.left||0,right:e.right||0}:{left:0,right:0}}(t.overflowLimitLength),c=e[0],l=c.attribute.angle,u=!f(l),d=u?Math.cos(l):1,p=u?Math.sin(l):0,h=cb(l),g=sb(l),_=a===\`top\`||a===\`bottom\`,v=c.attribute.direction,y=!h&&!g&&_&&(e.length<2||e.some((e=>Math.abs(e.AABBBounds.width()-c.AABBBounds.width())>=2)))&&c.AABBBounds.width()>Math.abs(n/p);e.forEach((e=>{if(_&&(g&&Math.floor(e.AABBBounds.height())<=n||h&&Math.floor(e.AABBBounds.width())<=r)||!_&&(v===\`vertical\`&&Math.floor(e.AABBBounds.height())<=r||v!==\`vertical\`&&(h&&Math.floor(e.AABBBounds.width())<=n||g&&Math.floor(e.AABBBounds.height())<=r)))return;let t=null;if(h||g)t=_?h?r:n:v===\`vertical\`||g?r:n;else if(_){let{x1:r,x2:i}=e.AABBBounds,a=p/d,c=Math.abs(n/p);if(y&&a>0&&r<=o+s.right&&n/a+r>o+s.right){let e=(o-r+s.right)/Math.abs(d);t=Math.min(e,c)}else if(y&&a<0&&i>=-s.left&&n/a+i<-s.left){let e=(i+s.left)/Math.abs(d);t=Math.min(e,c)}else t=c}else t=Math.abs(n/d);C(e.attribute.maxLineWidth)&&(t=C(t)?Math.min(e.attribute.maxLineWidth,t):e.attribute.maxLineWidth),e.setAttributes({maxLineWidth:t,ellipsis:e.attribute.ellipsis??i})}))}function wb(e,t,n){let r;return C(t)&&(r=Math.abs(t-e)),C(n)&&(r=C(r)?Math.min(Math.abs(e-n),r):Math.abs(e-n)),r}class Tb{isInValidValue(e){return e<0||e>1}getTickCoord(e){let{start:t}=this.attribute,n=this.getRelativeVector();return{x:t.x+n[0]*e,y:t.y+n[1]*e}}getRelativeVector(e){let{start:t,end:n}=this.attribute;return[n.x-t.x,n.y-t.y]}getVerticalVector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],{verticalFactor:n=1}=this.attribute,r=Ry(this.getRelativeVector());return function(e,t){return[e[0]*t,e[1]*t]}([r[1],-1*r[0]],e*(t?1:-1)*n)}}var Eb=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};iy(),oy(),my(),by(),fy();class Db extends mb{constructor(e,t){super(t?.skipDefault?e:N({},Db.defaultAttributes,e),t)}_renderInner(e){if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){let e=[];for(let t=0;t<this.attribute.breaks.length;t++){let{range:n,breakSymbol:r,rawRange:i}=this.attribute.breaks[t];e.push({startPoint:this.getTickCoord(n[0]),endPoint:this.getTickCoord(n[1]),range:n,breakSymbol:r,rawRange:i})}this._breaks=e}super._renderInner(e),this._breaks&&this._breaks.length&&this._breaks.forEach(((t,n)=>{let{startPoint:r,endPoint:i,breakSymbol:a,rawRange:o}=t;if(!1!==a?.visible){let t=U.group({zIndex:999});t.name=tb.axisBreak,t.id=this._getNodeId(\`\${tb.axisBreak}-\${n}\`),t.data=o;let s=function(){let{style:e={},angle:t=.5*Math.PI}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=N({},ab,e),r=n.size??ab.size;return Object.assign(Object.assign({},n),{symbolType:n.symbolType??\`M \${-r/2} \${r*Math.sin(t)} L \${r/2} \${-r*Math.sin(t)}\`,symbolSize:r})}(a),c=U.symbol(Object.assign({x:r.x,y:r.y},s));c.name=tb.axisBreakSymbol;let l=U.symbol(Object.assign({x:i.x,y:i.y},s));l.name=tb.axisBreakSymbol,t.add(c),t.add(l),e.add(t)}}));let{panel:t}=this.attribute;if(t&&t.visible){let e=this.axisContainer,n=e.AABBBounds,r=U.rect(Object.assign({x:n.x1,y:n.y1,width:n.width(),height:n.height()},t.style));r.name=tb.background,r.id=this._getNodeId(\`background\`),r.states=N({},rb,t.state??{}),e.insertBefore(r,e.firstChild)}}renderLine(e){let{start:t,end:n,line:r}=this.attribute,i=r,{startSymbol:a,endSymbol:o,style:s,state:c}=i,l=Eb(i,[\`startSymbol\`,\`endSymbol\`,\`style\`,\`state\`]),u=Object.assign({startSymbol:a,endSymbol:o,lineStyle:s},l);if(this._breaks&&this._breaks.length){let e=[],r=t;this._breaks.forEach((t=>{let{startPoint:n,endPoint:i}=t;e.push([r,n]),r=i})),e.push([r,n]),u.points=e,u.multiSegment=!0}else u.points=[t,n];A(c)||(u.state={line:N({},rb,c),symbol:N({},rb,c)});let d=new eb(u);d.name=tb.line,d.id=this._getNodeId(\`line\`),e.add(d)}getTextAlign(e){let t=\`center\`;return Ce(e[0],0)?Ce(e[1],0)?Object.is(e[1],-0)?t=\`start\`:Object.is(e[0],-0)&&(t=\`end\`):t=\`center\`:e[0]>0?t=\`start\`:e[0]<0&&(t=\`end\`),t}getTitleAttribute(){var e,t;let n=this.attribute.title,{position:r=\`middle\`,space:i=4,textStyle:a={},autoRotate:o=!0,shape:s,background:c,state:l={},maxWidth:u}=n,d=Eb(n,[\`position\`,\`space\`,\`textStyle\`,\`autoRotate\`,\`shape\`,\`background\`,\`state\`,\`maxWidth\`]),p=.5;r===\`start\`?p=0:r===\`end\`&&(p=1);let{verticalFactor:m=1}=this.attribute,h=-1*m,g=this.getTickCoord(p),_=this.getRelativeVector(),v=0;if(this.attribute.label?.visible&&!1===this.attribute.label.inside){let e=+j(this.attribute,\`label.space\`,4);v+=e;let t=Object.keys(this.axisLabelLayerSize).length;if(_[1]===0){let n=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(n)?v+=n+(t-1)*e:v=0}else if(_[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){let n=this.axisLabelLayerSize[0].labelPos,r=this.axisLabelsContainer.AABBBounds;v+=(h===1?r.x2>n?Math.min(r.x2-n,r.width()):0:r.x1<n?Math.min(n-r.x1,r.width()):0)+(t-1)*e}else v=0;else Object.keys(this.axisLabelLayerSize).forEach(((t,n)=>{v+=this.axisLabelLayerSize[t].width+(n>0?e:0)}))}let y=0;(e=this.attribute.tick)!=null&&e.visible&&!1===this.attribute.tick.inside&&(y=this.attribute.tick.length||4),(t=this.attribute.subTick)!=null&&t.visible&&!1===this.attribute.subTick.inside&&(y=Math.max(y,this.attribute.subTick.length||2));let b=y+v+i,x=this.getVerticalCoord(g,b,!1),S=this.getVerticalVector(b,!1,{x:0,y:0}),w,T,{angle:E}=d;if(w=r===\`start\`?\`start\`:r===\`end\`?\`end\`:\`center\`,f(E)&&o){E=zy(_,[1,0],!0);let{verticalFactor:e=1}=this.attribute;T=-1*e==1?\`bottom\`:\`top\`}else w=this.getTextAlign(S),T=this.getTextBaseline(S,!1);let D=u;if(f(D)){let{verticalLimitSize:e,verticalMinSize:t,orient:n}=this.attribute,r=Math.min(e||1/0,t||1/0);if(C(r))if(n===\`bottom\`||n===\`top\`)if(E!==Math.PI/2){let e=Math.abs(Math.cos(E??0));D=e<1e-6?1/0:this.attribute.end.x/e}else D=r-b;else if(E&&E!==0){let e=Math.abs(Math.sin(E));D=e<1e-6?1/0:this.attribute.end.y/e}else D=r-b}let O=Object.assign(Object.assign(Object.assign({},x),d),{maxWidth:D,textStyle:Object.assign({textAlign:w,textBaseline:T},a),state:{text:N({},rb,l.text),shape:N({},rb,l.shape),panel:N({},rb,l.background)}});return O.angle=E,s&&s.visible&&(O.shape=Object.assign({visible:!0},s.style),s.space&&(O.space=s.space)),c&&c.visible&&(O.panel=Object.assign({visible:!0},c.style)),O}getTextBaseline(e,t){let n=\`middle\`,{verticalFactor:r=1}=this.attribute,i=(t?1:-1)*r;return Ce(e[1],0)?n=!Ce(e[0],0)||Object.is(e[0],-0)||Object.is(e[1],-0)?\`middle\`:i===1?\`bottom\`:\`top\`:e[1]>0?n=\`top\`:e[1]<0&&(n=\`bottom\`),n}getLabelAlign(e,t,n){let r=this.attribute.orient;if([\`top\`,\`bottom\`,\`right\`,\`left\`].includes(r)||e[0]===0&&e[1]===0){if(r===\`top\`||r===\`bottom\`)return xb(t?r===\`bottom\`?\`top\`:\`bottom\`:r,n);if(r===\`left\`||r===\`right\`)return Sb(t?r===\`left\`?\`right\`:\`left\`:r,n)}return{textAlign:this.getTextAlign(e),textBaseline:this.getTextBaseline(e,t)}}beforeLabelsOverlap(e,t,n,r,i){let{flush:a=!1}=this.attribute.label||{};if(a&&e.length){let{orient:t,start:n,end:r}=this.attribute,i=t===\`bottom\`||t===\`top\`,a=e[0],o=de(e),s=i?a.attribute.x>o.attribute.x:a.attribute.y<o.attribute.y;if(i){let e=s?o:a,t=s?a:o,i=n.x,c=r.x,l=e.AABBBounds.x1,u=t.AABBBounds.x2;l<i&&(e.attribute.angle?e.setAttributes({dx:(e.attribute.dx??0)+i-l}):e.setAttributes({x:i,textAlign:\`left\`})),u>c&&(t.attribute.angle?t.setAttributes({dx:(t.attribute.dx??0)+c-u}):t.setAttributes({x:c,textAlign:\`right\`}))}else{let e=s?o:a,t=s?a:o,i=e.AABBBounds.y2,c=t.AABBBounds.y1,l=n.y,u=r.y;c<l&&(t.attribute.angle?t.setAttributes({dy:(t.attribute.dy??0)+l-c}):t.setAttributes({y:l,textBaseline:\`top\`})),i>u&&(e.attribute.angle?e.setAttributes({dy:(e.attribute.dy??0)+u-i}):e.setAttributes({y:u,textBaseline:\`bottom\`}))}}}handleLabelsOverlap(e,t,n,r,i){if(A(e))return;let{verticalLimitSize:a,label:o,orient:s}=this.attribute,c=this._getAxisLabelLimitLength(a,i),{layoutFunc:l,autoRotate:u,autoRotateAngle:f,autoLimit:p,limitEllipsis:m,autoHide:h,autoHideMethod:g,autoHideSeparation:_,lastVisible:v,firstVisible:y,autoWrap:b,overflowLimitLength:x}=o;if(d(l))l(e,t,r,this);else{if(u?(function(e,t){if(A(e))return;let{orient:n,labelRotateAngle:r=[0,45,90]}=t;if(r.length===0||e.some((e=>!!e.attribute.angle)))return;let i=0,a=0;for(r&&r.length>0&&(a=r.length);i<a;){let t=r[i++];if(e.forEach((e=>{e.attribute.angle=tt(t)})),yb(n,e),!vb(e))break}})(e,{labelRotateAngle:f,orient:s}):b&&(function(e,t){let{limitLength:n,axisLength:r,ellipsis:i=\`...\`,orient:a}=t;if(A(e)||!C(n))return;let o=e[0].attribute.angle,s=cb(o),c=sb(o),l=a===\`top\`||a===\`bottom\`,u=r/e.length;e.forEach(((t,r)=>{if(l){if(c&&Math.floor(t.AABBBounds.height())<=n)return;if(s){let n=wb(t.attribute.x,e[r+1]?.attribute.x,e[r-1]?.attribute.x);C(n)&&(u=Ge(u,n))}}else{if(c){let n=wb(t.attribute.y,e[r+1]?.attribute.y,e[r-1]?.attribute.y);C(n)&&(u=Ge(u,n))}if(s&&Math.floor(t.AABBBounds.width())<=n)return}let a=null,o=null;l?c?(a=n,o=u):(a=u,o=n):c?(a=u,o=n):(a=n,o=u),t.setAttributes({maxLineWidth:a,ellipsis:t.attribute.ellipsis??i,whiteSpace:\`normal\`,heightLimit:o})}))})(e,{orient:s,limitLength:c,axisLength:s===\`left\`||s===\`right\`?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x),ellipsis:m}),!b&&p&&C(c)&&c>0){let t=s===\`left\`||s===\`right\`,n=t?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x);Cb(e,{limitLength:c,verticalLimitLength:t?n/e.length:h||u?1/0:n/e.length,ellipsis:m,orient:s,axisLength:n,overflowLimitLength:x})}h&&function(e,t){if(A(e))return;let n=e.filter(gb);if(A(n))return;let r;r=function(e){return e.forEach((e=>e.setAttribute(\`opacity\`,1))),e}(n);let{method:i=\`parity\`,separation:a=0}=t,o=d(i)?i:hb[i]||hb.parity;if(r.length>=3&&pb(r,a)){do r=o(r,a);while(r.length>=3&&pb(r,a));let e=function(e,t){return(!(arguments.length>2&&arguments[2]!==void 0)||arguments[2])&&e<3||t},i=e(r.length,t.firstVisible,!1),s=e(r.length,t.lastVisible),c=n[0],l=de(n);fb(c,l,a)&&i&&s&&(l.setAttribute(\`opacity\`,0),s=!1),_b(c,r,i,(e=>fb(e,c,a))),_b(l,r,s,(e=>fb(e,l,a)||!(!i||e===c)&&fb(e,c,a)),!0)}n.forEach((e=>{e.setAttribute(\`visible\`,!!e.attribute.opacity)}))}(e,{orient:s,method:g,separation:_,lastVisible:v,firstVisible:y})}}afterLabelsOverlap(e,t,n,r,i){let{verticalLimitSize:a,orient:o}=this.attribute,s=o===\`bottom\`||o===\`top\`,c=n.AABBBounds,l=s?c.height():c.width(),{verticalMinSize:u}=this.attribute;if(C(u)&&(!C(a)||u<=a)){let e=this._getAxisLabelLimitLength(u,i),t,r;l=Math.max(l,e),o===\`left\`?(t=c.x2-l,r=c.y1):o===\`right\`?(t=c.x1,r=c.y1):o===\`top\`?(t=c.x1,r=c.y2-l):o===\`bottom\`&&(t=c.x1,r=c.y1);let a=U.rect({x:t,y:r,width:s?c.width():l,height:s?l:c.height(),pickable:!1});a.name=tb.axisLabelBackground,a.id=this._getNodeId(\`axis-label-background\`),n.insertBefore(a,n.firstChild)}if(p(this.attribute.label.containerAlign)){let t;o===\`left\`?t=c.x2-l:o===\`right\`?t=c.x1:o===\`top\`?t=c.y2-l:o===\`bottom\`&&(t=c.y1),function(e,t,n,r,i){r===\`left\`||r===\`right\`?i===\`left\`?e.forEach((e=>{e.setAttributes({dx:(e.attribute.dx??0)+t-e.AABBBounds.x1})})):i===\`right\`?e.forEach((e=>{e.setAttributes({dx:(e.attribute.dx??0)+t+n-e.AABBBounds.x2})})):i===\`center\`&&e.forEach((e=>{e.setAttributes({dx:(e.attribute.dx??0)+t+n/2-(e.AABBBounds.x1+e.AABBBounds.x2)/2})})):r!==\`bottom\`&&r!==\`top\`||(i===\`top\`?e.forEach((e=>{e.setAttributes({dy:(e.attribute.dy??0)+t-e.AABBBounds.y1})})):i===\`bottom\`?e.forEach((e=>{e.setAttributes({dy:(e.attribute.dy??0)+t+n-e.AABBBounds.y2})})):i===\`middle\`&&e.forEach((e=>{e.setAttributes({dy:(e.attribute.dy??0)+t+n/2-(e.AABBBounds.y1+e.AABBBounds.y2)/2})})))}(e,t,l,o,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(e,t){let{label:n,title:r,line:i,tick:a}=this.attribute,o=n.space??4,s=e,c=0,l=0,u=i&&i.visible?i.style.lineWidth??1:0,d=a&&a.visible?a.length??4:0;if(r&&r.visible&&typeof r.text==\`string\`){c=Vy(r.text,r.textStyle,this.stage?.getTheme()?.text).height;let e=Bt(r.padding);l=r.space+e[0]+e[2]}return s&&=(s-o-l-c-u-d)/t,s}release(){super.release(),this._breaks=null}}Db.defaultAttributes=ib,ue(Db,Tb);class Ob extends yo{constructor(){super(...arguments),this.mode=br.NORMAL}onBind(){let e=this.target.getInnerView(),t=this.target.getPrevInnerView();t&&(this._newElementAttrMap={},Ay(e,(e=>{if(e.type!==\`group\`&&e.id){let n=t[e.id];if(n){if(!ce(e.attribute,n.attribute)){let t=M(e.attribute);this._newElementAttrMap[e.id]={state:\`update\`,node:e,attrs:Object.assign(Object.assign({},t),{opacity:t.opacity??1,fillOpacity:t.fillOpacity??1,strokeOpacity:t.strokeOpacity??1})},e.setAttributes(n.attribute)}}else{let t={opacity:e.attribute.opacity??1,fillOpacity:e.attribute.fillOpacity??1,strokeOpacity:e.attribute.strokeOpacity??1};this._newElementAttrMap[e.id]={state:\`enter\`,node:e,attrs:t},e.setAttributes({opacity:0,fillOpacity:0,strokeOpacity:0})}}})))}onStart(){let e=this.duration,t=this.easing;this._newElementAttrMap&&Object.keys(this._newElementAttrMap).forEach((n=>{let{node:r,attrs:i,state:a}=this._newElementAttrMap[n];if(a===\`enter\`){let{enter:n={}}=this.params??{};e=C(n.duration)?n.duration:e,t=n.easing?n.easing:t}r.type===\`path\`?r.animate({interpolate:(e,t,n,r,i)=>e===\`path\`&&(i.path=function(e,t){let n,r,i,a=Fe.lastIndex=Ie.lastIndex=0,o=-1,s=[],c=[];for(e+=\`\`,t+=\`\`;(n=Fe.exec(e))&&(r=Ie.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,c.push({i:o,x:Ne(n,r)})),a=Ie.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?c[0]?function(e){return function(t){return e(t)+\`\`}}(c[0].x):function(e){return function(){return e}}(t):(t=c.length,function(e){for(let n,r=0;r<t;++r)s[(n=c[r]).i]=n.x(e);return s.join(\`\`)})}(n,r)(t),!0)}).to(i,e,t):r.animate().to(i,e,t)}))}onUpdate(e,t,n){}}let kb=e=>e.map(((e,t)=>({index:t,value:e}))),Ab=(e,t,n,r)=>n<e?Math.max(e-t/2,n):n>e?Math.min(e-t/2,n-t):n<r?n:n-t,jb=(e,t,n)=>{let{labelStyle:r,axisOrientType:i,labelFlush:a,labelFormatter:o,startAngle:s=0}=n,c=r.angle??0;r.direction===\`vertical\`&&(c+=tt(90));let l=[\`bottom\`,\`top\`].includes(i),u=[\`left\`,\`right\`].includes(i),d=1,f=0;l||(u?(d=0,f=1):s&&(d=Math.cos(s),f=-Math.sin(s)));let p=By(r),m=e.range();return t.map(((n,i)=>{let s=o?o(n):\`\${n}\`,{width:h,height:g}=p.quickMeasure(s),_=Math.max(h,12),v=Math.max(g,12),y=e.scale(n),b=d*y,x=f*y,S,C,w=b,T=x;a&&l&&i===0?w=Ab(b,_,m[0],m[m.length-1]):a&&l&&i===t.length-1?w=Ab(b,_,m[m.length-1],m[0]):S=r.textAlign??\`center\`,S===\`right\`?w-=_:S===\`center\`&&(w-=_/2),a&&u&&i===0?T=Ab(x,v,m[0],m[m.length-1]):a&&u&&i===t.length-1?T=Ab(x,v,m[m.length-1],m[0]):C=r.textBaseline??\`middle\`,C===\`bottom\`?T-=v:C===\`middle\`&&(T-=v/2);let E=new St().set(w,T,w+_,T+v);return c&&E.rotate(c,b,x),E}))};var Mb;(function(e){e.Identity=\`identity\`,e.Linear=\`linear\`,e.Log=\`log\`,e.Pow=\`pow\`,e.Sqrt=\`sqrt\`,e.Symlog=\`symlog\`,e.Time=\`time\`,e.Quantile=\`quantile\`,e.Quantize=\`quantize\`,e.Threshold=\`threshold\`,e.Ordinal=\`ordinal\`,e.Point=\`point\`,e.Band=\`band\`})(Mb||={});let Nb={};function Pb(e){switch(e){case Mb.Linear:case Mb.Log:case Mb.Pow:case Mb.Sqrt:case Mb.Symlog:case Mb.Time:return!0;default:return!1}}function Fb(e){return!!Nb[e]}function Ib(e){switch(e){case Mb.Ordinal:case Mb.Point:case Mb.Band:return!0;default:return!1}}function Lb(e){return e}Object.values(Mb).forEach((e=>{Nb[e]=!0}));let Rb=e=>-Math.log(-e),zb=e=>-Math.exp(-e),Bb=e=>isFinite(e)?10**e:e<0?0:e,Vb=e=>e===10?Bb:e===Math.E?Math.exp:t=>e**+t,Hb=e=>e===Math.E?Math.log:e===10?Math.log10:e===2?Math.log2:(e=Math.log(e),t=>Math.log(t)/e),Ub=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Wb=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e;function Gb(e,t){if(e=Number(e),t=Number(t),t-=e)return n=>(n-e)/t;let n=Number.isNaN(t)?NaN:.5;return()=>n}function Kb(e,t,n){let r=e[0],i=e[1],a=t[0],o=t[1],s,c;return i<r?(s=Gb(i,r),c=n(o,a)):(s=Gb(r,i),c=n(a,o)),e=>c(s(e))}function qb(e,t,n){let r;return r=e===1?e+2*n:e-t+2*n,e?r>0?r:1:0}function Jb(e,t,n,r){return n===1&&(n=0),qb(e,n,r)*(t/(1-n))}function Yb(e,t){let n=(e[1]-e[0])/(t[1]-t[0]),r=e[0]-n*t[0];return[r,n+r]}function Xb(e,t,n){let r=Math.min(e.length,t.length)-1,i=Array(r),a=Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=Gb(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){let n=Se(e,t,1,r)-1;return a[n](i[n](t))}}let Zb=function(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=Math.floor(Math.log10(e)),r=e/10**n,i;return i=t?r<1.5?1:r<3?2:r<7?5:10:r<=1?1:r<=2?2:r<=5?5:10,i*10**n};class Qb{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(e){return this._wholeRange?this._wholeRange:p(this._rangeFactorStart)&&p(this._rangeFactorEnd)&&e.length===2?(this._wholeRange=Yb(e,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):e}rangeFactor(e,t,n){return e?(e.length===2&&e.every((e=>e>=0&&e<=1))&&(this._wholeRange=null,e[0]===0&&e[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=e[0],this._rangeFactorEnd=e[1])),this):n?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):p(this._rangeFactorStart)&&p(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(e,t){return f(e)?this._rangeFactorStart:(e>=0&&e<=1&&(this._wholeRange=null,e!==0||!f(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=e,this._rangeFactorEnd=this._rangeFactorEnd??1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(e,t){return f(e)?this._rangeFactorEnd:(e>=0&&e<=1&&(this._wholeRange=null,e!==0||!f(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=e,this._rangeFactorStart=this._rangeFactorStart??0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);let{distortion:e=2,radiusRatio:t=.1,radius:n}=this._fishEyeOptions,r=this.range(),i=r[0],a=r[r.length-1],o=Math.min(i,a),s=Math.max(i,a),c=De(this._fishEyeOptions.focus??0,o,s),l=f(n)?(s-o)*t:n,u=Math.exp(e);u=u/(u-1)*l;let d=e/l;this._fishEyeTransform=e=>{let t=Math.abs(e-c);if(t>=l)return e;if(t<=1e-6)return c;let n=u*(1-Math.exp(-t*d))/t*.75+.25;return c+(e-c)*n}}unknown(e){return arguments.length?(this._unknown=e,this):this._unknown}get(e,t){return(this==null?void 0:this[e])??t}}let $b=Symbol(\`implicit\`);class ex extends Qb{specified(e){return e?(this._specified=Object.assign(this._specified??{},e),this):Object.assign({},this._specified)}_getSpecifiedValue(e){if(this._specified)return this._specified[e]}constructor(){super(),this.type=Mb.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=$b}clone(){let e=new ex().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&e.specified(this._specified),e}calculateVisibleDomain(e){return p(this._rangeFactorStart)&&p(this._rangeFactorEnd)&&e.length===2?[this.invert(e[0]),this.invert(e[1])]:this._domain}scale(e){let t=\`\${e}\`,n=this._getSpecifiedValue(t);if(n!==void 0)return n;let r=this._index.get(t);if(!r){if(this._unknown!==$b)return this._unknown;r=this._domain.push(e),this._index.set(t,r)}let i=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(e){let t=0;for(;t<this._ordinalRange.length&&this._ordinalRange[t]!==e;)t++;return this._domain[(t-1)%this._domain.length]}domain(e){if(!e)return this._domain.slice();this._domain=[],this._index=new Map;for(let t of e){let e=\`\${t}\`;this._index.has(e)||this._index.set(e,this._domain.push(t))}return this}range(e){return e?(this._ordinalRange=Array.from(e),this):this._ordinalRange.slice()}index(e){var t;return this._index&&(t=this._index.get(\`\${e}\`))!=null?t:-1}}function tx(e,t,n,r){let i=[],a=e;for(;a<=t;)i.push(a),a+=n;return r&&i.reverse(),i}function nx(e,t,n,r){let i,a;if(t=Math.floor(+t),e=Math.floor(+e),!(n=Math.floor(+n)))return[];if(e===t)return[e];if(i=t<e){let n=e;e=t,t=n}let o=ke(1,t-e+1)(n);if(a=Math.floor((t-e+1)/o),!r)for(;Math.ceil((t-e+1)/a)>n&&o>1;)--o,a=Math.floor((t-e)/o);return tx(e,t,a,i)}class rx extends ex{constructor(e){super(),this.type=Mb.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(e)}rescale(e,t){if(e)return this;this._wholeRange=null;let n=this._calculateWholeRange(this._range,t),r=super.domain().length,i=n[1]<n[0],a=n[Number(i)-0],o=n[1-Number(i)],s=qb(r,this._paddingInner,this._paddingOuter);return this._step=(o-a)/Math.max(1,s||1),this._round&&(this._step=Math.floor(this._step)),a+=(o-a-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(a=Math.round(a),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:i,start:i?a+this._step*(r-1):a,count:r},this.generateFishEyeTransform(),this}scale(e){if(!this._bandRangeState)return;let t=\`\${e}\`,n=this._getSpecifiedValue(t);if(n!==void 0)return n;let r=this._index.get(t);if(!r){if(this._unknown!==$b)return this._unknown;r=this._domain.push(e),this._index.set(t,r)}let{count:i,start:a,reverse:o}=this._bandRangeState,s=a+(r-1)%i*(o?-1:1)*this._step;return this._fishEyeTransform?this._fishEyeTransform(s):s}_calculateWholeRange(e,t){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let t;if(p(this._rangeFactorStart)&&p(this._rangeFactorEnd)&&e.length===2){let n=Yb(e,[this._rangeFactorStart,this._rangeFactorEnd]);t=Math.abs(n[1]-n[0])}else t=Math.abs(e[1]-e[0]);let n=function(e,t,n,r,i){let a=qb(e,n,r),o=t/Math.max(1,a||1);i&&(o=Math.floor(o));let s=o*(1-n);return i&&(s=Math.round(s)),s}(super.domain().length,t,this._paddingInner,this._paddingOuter,this._round);n<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):n>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=n,this._isFixed=!1)}if(this.isBandwidthFixed()){let n=Jb(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(e[1]-e[0]),r=Math.min((e[1]-e[0])/n,1);if(p(this._rangeFactorStart)&&p(this._rangeFactorEnd)){let i=this._rangeFactorStart+r<=1,a=this._rangeFactorEnd-r>=0;if(t===\`rangeFactorStart\`&&i?this._rangeFactorEnd=this._rangeFactorStart+r:t===\`rangeFactorEnd\`&&a?this._rangeFactorStart=this._rangeFactorEnd-r:e[0]<=e[1]?i?this._rangeFactorEnd=this._rangeFactorStart+r:a?this._rangeFactorStart=this._rangeFactorEnd-r:(this._rangeFactorStart=0,this._rangeFactorEnd=r):a?this._rangeFactorStart=this._rangeFactorEnd-r:i?this._rangeFactorEnd=this._rangeFactorStart+r:(this._rangeFactorStart=1-r,this._rangeFactorEnd=1),n>0){let t=e[0]-n*this._rangeFactorStart,r=t+n;this._wholeRange=[t,r]}else{let t=e[1]+n*(1-this._rangeFactorEnd);this._wholeRange=[t-n,t]}}else this._rangeFactorStart=0,this._rangeFactorEnd=r,this._wholeRange=[e[0],e[0]+n];return this._wholeRange}return super._calculateWholeRange(e)}calculateWholeRangeSize(){let e=this._calculateWholeRange(this._range);return Math.abs(e[1]-e[0])}calculateVisibleDomain(e){let t=this._domain;if(p(this._rangeFactorStart)&&p(this._rangeFactorEnd)&&t.length){let n=this._getInvertIndex(e[0]),r=this._getInvertIndex(e[1]);return t.slice(Math.min(n,r),Math.max(n,r)+1)}return t}domain(e,t){return e?(super.domain(e),this.rescale(t)):super.domain()}range(e,t){return e?(this._range=[_e(e[0]),_e(e[1])],this.rescale(t)):this._range}rangeRound(e,t){return this._range=[_e(e[0]),_e(e[1])],this._round=!0,this.rescale(t)}ticks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=this.calculateVisibleDomain(this._range);return e===-1?t:nx(0,t.length-1,e,!1).map((e=>t[e]))}tickData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this.ticks(e).map(((e,t)=>({index:t,tick:e,value:(this.scale(e)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])})))}forceTicks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=this.calculateVisibleDomain(this._range);return nx(0,t.length-1,e,!0).filter((e=>e<t.length)).map((e=>t[e]))}stepTicks(e){let t=this.calculateVisibleDomain(this._range);return function(e,t,n){let r;if(n=ke(1,(t=Math.floor(+t))-(e=Math.floor(+e))+1)(Math.floor(+n)),r=t<e){let n=e;e=t,t=n}return tx(e,t,n,r)}(0,t.length-1,e).map((e=>t[e]))}_getInvertIndex(e){let t=0,n=this.step()/2,r=this.bandwidth()/2,i=this._domain.length,a=this.range(),o=a[0]>a[a.length-1];for(t=0;t<i;t++){let a=this.scale(this._domain[t])+r;if(t===0&&(!o&&!we(e,a+n)||o&&!Te(e,a-n))||t===i-1||!Te(e,a-n)&&!we(e,a+n))break}return t>=0&&t<=i-1?t:i-1}invert(e){return this._domain[this._getInvertIndex(e)]}padding(e,t){return e===void 0?this._paddingInner:(this._paddingOuter=Math.max(0,Math.min(Array.isArray(e)?Math.min.apply(null,e):e)),this._paddingInner=this._paddingOuter,this.rescale(t))}paddingInner(e,t){return e===void 0?this._paddingInner:(this._paddingInner=Math.max(0,Math.min(1,e)),this.rescale(t))}paddingOuter(e,t){return e===void 0?this._paddingOuter:(this._paddingOuter=Math.max(0,Math.min(1,e)),this.rescale(t))}step(){return this._step}round(e,t){return e===void 0?this._round:(this._round=e,this.rescale(t))}align(e,t){return e===void 0?this._align:(this._align=Math.max(0,Math.min(1,e)),this.rescale(t))}rangeFactor(e,t){return e?(super.rangeFactor(e),this.rescale(t)):super.rangeFactor()}rangeFactorStart(e,t){return f(e)?super.rangeFactorStart():(super.rangeFactorStart(e),this.rescale(t,\`rangeFactorStart\`))}rangeFactorEnd(e,t){return f(e)?super.rangeFactorEnd():(super.rangeFactorEnd(e),this.rescale(t,\`rangeFactorEnd\`))}bandwidth(e,t){return e?(e===\`auto\`?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=e,this._isFixed=!0),this._userBandwidth=e,this.rescale(t)):this._bandwidth}maxBandwidth(e,t){return e?(this._maxBandwidth=e===\`auto\`?void 0:e,this.rescale(t)):this._maxBandwidth}minBandwidth(e,t){return e?(this._minBandwidth=e===\`auto\`?void 0:e,this.rescale(t)):this._minBandwidth}fishEye(e,t,n){return e||n?(this._fishEyeOptions=e,this._fishEyeTransform=null,this.rescale(t)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&S(this._userBandwidth)}clone(){return new rx(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth(this._userBandwidth??\`auto\`,!0).maxBandwidth(this._maxBandwidth??\`auto\`,!0).minBandwidth(this._maxBandwidth??\`auto\`)}}let{interpolateRgb:ix}=zt;function ax(e,t){let n=typeof t,r;if(f(t)||n===\`boolean\`)return()=>t;if(n===\`number\`)return Ne(e,t);if(n===\`string\`){if(r=It.parseColorString(t)){let t=ix(It.parseColorString(e),r);return e=>t(e).formatRgb()}return Ne(Number(e),Number(t))}return t instanceof Lt?ix(e,t):t instanceof It?ix(e.color,t.color):t instanceof Date?function(e,t){let n=e.valueOf(),r=t.valueOf(),i=new Date;return e=>(i.setTime(n*(1-e)+r*e),i)}(e,t):Ne(Number(e),Number(t))}class ox extends Qb{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Lb,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Lb;super(),this._unknown=void 0,this.transformer=e,this.untransformer=t,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Lb,this._piecewise=Kb,this._interpolate=ax}calculateVisibleDomain(e){return p(this._rangeFactorStart)&&p(this._rangeFactorEnd)&&e.length===2?[this.invert(e[0]),this.invert(e[1])]:this._niceDomain??this._domain}fishEye(e,t,n){return e||n?(this._fishEyeOptions=e,this._fishEyeTransform=null,this.rescale(t)):this._fishEyeOptions}scale(e){if(e=Number(e),Number.isNaN(e)||this._domainValidator&&!this._domainValidator(e))return this._unknown;this._output||=this._piecewise((this._niceDomain??this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate);let t=this._output(this.transformer(this._clamp(e)));return this._fishEyeTransform?this._fishEyeTransform(t):t}invert(e){return this._input||=this._piecewise(this._calculateWholeRange(this._range),(this._niceDomain??this._domain).map(this.transformer),Ne),this._clamp(this.untransformer(this._input(e)))}domain(e,t){return e?(this._domainValidator=null,this._niceType=null,this._niceDomain=null,this._domain=Array.from(e,_e),this.rescale(t)):(this._niceDomain??this._domain).slice()}range(e,t){return e?(this._range=Array.from(e),this.rescale(t)):this._range.slice()}rangeRound(e,t){return this._range=Array.from(e),this._interpolate=Pe,this.rescale(t)}rescale(e){if(e)return this;let t=this._niceDomain??this._domain,n=t.length,r=this._range.length,i=Math.min(n,r);if(n&&n<r&&this._forceAlign){let e=r-n+1,a=t[n-1],o=n>=2?(a-t[n-2])/e:0;for(let r=1;r<=e;r++)t[n-2+r]=a-o*(e-r);i=r}return this._autoClamp&&(this._clamp=ke(t[0],t[i-1])),this._piecewise=i>2?Xb:Kb,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(e,t,n){return arguments.length?(t?(this._autoClamp=!1,this._clamp=t):(this._autoClamp=!!e,this._clamp=e?void 0:Lb),this.rescale(n)):this._clamp!==Lb}interpolate(e,t){return arguments.length?(this._interpolate=e,this.rescale(t)):this._interpolate}ticks(){return[]}tickData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return(this.ticks(e)??[]).map(((e,t)=>({index:t,tick:e,value:(this.scale(e)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(e,t){return e?(super.rangeFactor(e),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(e,t){return f(e)?super.rangeFactorStart():(super.rangeFactorStart(e),this._output=this._input=null,this)}rangeFactorEnd(e,t){return f(e)?super.rangeFactorEnd():(super.rangeFactorEnd(e),this._output=this._input=null,this)}forceAlignDomainRange(e){return arguments.length?(this._forceAlign=e,this):this._forceAlign}}let sx=Math.sqrt(50),cx=Math.sqrt(10),lx=Math.sqrt(2),ux=[1,2,5,10],dx=(e,t,n)=>{let r=1,i=e,a=Math.floor((t-1)/2),o=Math.abs(e);return e>=0&&e<=Number.MIN_VALUE?i=0:e<0&&e>=-Number.MIN_VALUE?i=-(t-1):!n&&o<1?r=hx(o).step:(n||o>1)&&(i=Math.floor(e)-a*r),r>0?(e>0?i=Math.max(i,0):e<0&&(i=Math.min(i,-(t-1)*r)),function(e,t,n){p(t)||(t=e,e=0),p(n)||(n=1);let r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=Array(i);for(;++r<i;)a[r]=e+r*n;return a}(0,t).map((e=>i+e*r))):e>0?px(0,-(t-1)/r,r):px((t-1)/r,0,r)},fx=Ee(((e,t,n,r)=>{let i,a,o,s,c=-1;if(n=+n,(e=+e)==(t=+t)||Math.abs(e-t)<=Number.MIN_VALUE&&n>0)return[e];if((i=t<e)&&(a=e,e=t,t=a),s=gx(e,t,n).step,!isFinite(s))return[];if(s>0){let n=Math.round(e/s),r=Math.round(t/s);for(n*s<e&&++n,r*s>t&&--r,o=Array(a=r-n+1);++c<a;)o[c]=(n+c)*s}else if(s<0&&r?.noDecimals){s=1;let n=Math.ceil(e),r=Math.floor(t);if(!(n<=r))return[];for(o=Array(a=r-n+1);++c<a;)o[c]=n+c}else{s=-s;let n=Math.round(e*s),r=Math.round(t*s);for(n/s<e&&++n,r/s>t&&--r,o=Array(a=r-n+1);++c<a;)o[c]=(n+c)/s}return i&&o.reverse(),o})),px=(e,t,n)=>{let r,i,a=-1;if(n>0){let o=Math.floor(e/n),s=Math.ceil(t/n);for((o+1)*n<e&&++o,(s-1)*n>t&&--s,i=Array(r=s-o+1);++a<r;)i[a]=(o+a)*n}else{n=-n;let o=Math.floor(e*n),s=Math.ceil(t*n);for((o+1)/n<e&&++o,(s-1)/n>t&&--s,i=Array(r=s-o+1);++a<r;)i[a]=(o+a)/n}return i},mx=Ee(((e,t,n,r)=>{let i,a,o;if(n=+n,(e=+e)==(t=+t)||Math.abs(e-t)<=Number.MIN_VALUE&&n>0)return dx(e,n,r?.noDecimals);(i=t<e)&&(o=e,e=t,t=o);let s=gx(e,t,n),c=s.step;if(!isFinite(c))return[];if(c>0){let r=1,{power:i,gap:o}=s,l=o===10?2*10**i:1*10**i;for(;r<=5&&(a=px(e,t,c),a.length>n+1)&&n>2;)c+=l,r+=1;n>2&&a.length<n-1&&(a=((e,t,n)=>{let r,i=e[0],a=e[e.length-1],o=t-e.length;if(a<=0){let t=[];for(r=o;r>=1;r--)t.push(i-r*n);return t.concat(e)}if(i>=0){for(r=1;r<=o;r++)e.push(a+r*n);return e}let s=[],c=[];for(r=1;r<=o;r++)r%2==0?s=[i-Math.floor(r/2)*n].concat(s):c.push(a+Math.ceil(r/2)*n);return s.concat(e).concat(c)})(a,n,c))}else r!=null&&r.noDecimals&&c<0&&(c=1),a=px(e,t,c);return i&&a.reverse(),a})),hx=e=>{let t=Math.floor(Math.log(e)/Math.LN10),n=e/10**t,r=ux[0];return n>=sx?r=ux[3]:n>=cx?r=ux[2]:n>=lx&&(r=ux[1]),t>=0?{step:r*10**t,gap:r,power:t}:{step:-(10**-t)/r,gap:r,power:t}};function gx(e,t,n){let r=(t-e)/Math.max(0,n);return hx(r)}function _x(e,t,n){let r;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if(n<=0||(r=function(e,t,n){return(t-e)/Math.max(1,n-1)}(e,t,n))===0||!isFinite(r))return[];let i=Array(n);for(let t=0;t<n;t++)i[t]=e+t*r;return i}function vx(e){let t,n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,i=0,a=e.length-1,o=e[i],s=e[a],c=10;for(s<o&&(n=o,o=s,s=n,n=i,i=a,a=n);c-- >0;){if(n=gx(o,s,r).step,n===t)return e[i]=o,e[a]=s,e;if(n>0)o=Math.floor(o/n)*n,s=Math.ceil(s/n)*n;else{if(!(n<0))break;o=Math.ceil(o*n)/n,s=Math.floor(s*n)/n}t=n}}function yx(e,t){let n=S(t.forceMin),r=S(t.forceMax),i=null,a=[],o=null,s=n&&r?e=>e>=t.forceMin&&e<=t.forceMax:n?e=>e>=t.forceMin:r?e=>e<=t.forceMax:null;return n?a[0]=t.forceMin:S(t.min)&&t.min<=Math.min(e[0],e[e.length-1])&&(a[0]=t.min),r?a[1]=t.forceMax:S(t.max)&&t.max>=Math.max(e[0],e[e.length-1])&&(a[1]=t.max),S(a[0])&&S(a[1])?(o=e.slice(),o[0]=a[0],o[o.length-1]=a[1]):i=S(a[0])||S(a[1])?S(a[0])?\`max\`:\`min\`:\`all\`,{niceType:i,niceDomain:o,niceMinMax:a,domainValidator:s}}let bx=(e,t,n)=>Math.abs(t-e)<1?+n.toFixed(1):Math.round(+n),xx=Ee(((e,t,n,r,i,a,o)=>{let s=e,c=t,l=c<s;l&&([s,c]=[c,s]);let u,d,f=i(s),p=i(c),m=[];if(!(r%1)&&p-f<n){if(f=Math.floor(f),p=Math.ceil(p),s>0){for(;f<=p;++f)for(u=1;u<r;++u)if(d=f<0?u/a(-f):u*a(f),!(d<s)){if(d>c)break;m.push(d)}}else for(;f<=p;++f)for(u=r-1;u>=1;--u)if(d=f>0?u/a(-f):u*a(f),!(d<s)){if(d>c)break;m.push(d)}2*m.length<n&&(m=mx(s,c,n))}else m=mx(f,p,Math.min(p-f,n)).map(a);return m=m.filter((e=>e!==0)),o!=null&&o.noDecimals&&(m=Array.from(new Set(m.map((e=>Math.floor(e)))))),l?m.reverse():m})),Sx=Ee(((e,t,n,r,i,a)=>{let o=[],s={},c=i(e),l=i(t),u=[];if(Number.isInteger(r))u=mx(c,l,n);else{let e=(l-c)/(n-1);for(let t=0;t<n;t++)u.push(c+t*e)}return u.forEach((n=>{let i=a(n),c=Number.isInteger(r)?bx(e,t,i):bx(e,t,Zb(i)),l=bx(e,t,((e,t)=>{let n,r;return t[0]<t[1]?(n=t[0],r=t[1]):(n=t[1],r=t[0]),Math.min(Math.max(e,n),r)})(c,[e,t]));!s[l]&&!isNaN(l)&&u.length>1&&(s[l]=1,o.push(l))})),o})),Cx=Ee(((e,t,n,r,i)=>_x(r(e),r(t),n).map((e=>Zb(i(e))))));class Tx extends ox{constructor(){super(...arguments),this.type=Mb.Linear}clone(){return new Tx().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=this.calculateVisibleDomain(this._range);return fx(n[0],n[n.length-1],e,t)}ticks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0;if(d(t?.customTicks))return t.customTicks(this,e);if(p(this._rangeFactorStart)&&p(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(e,t);let n=this._niceDomain??this._domain,r=this._domain,i=n[0],a=n[n.length-1],o=mx(r[0],r[r.length-1],e,t);if(!o.length)return o;if(this._domainValidator)o=o.filter(this._domainValidator);else if((o[0]!==i||o[o.length-1]!==a)&&this._niceType){let e=n.slice();if(this._niceType===\`all\`?(e[0]=o[0],e[e.length-1]=o[o.length-1],this._niceDomain=e,this.rescale()):this._niceType===\`min\`&&o[0]!==i?(e[0]=o[0],this._niceDomain=e,this.rescale()):this._niceType===\`max\`&&o[o.length-1]!==a&&(e[e.length-1]=o[o.length-1],this._niceDomain=e,this.rescale()),this._niceType!==\`all\`){let t=Math.min(e[0],e[e.length-1]),n=Math.max(e[0],e[e.length-1]);o=o.filter((e=>e>=t&&e<=n))}}return o}forceTicks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=this.calculateVisibleDomain(this._range);return _x(t[0],t[t.length-1],e)}stepTicks(e){let t=this.calculateVisibleDomain(this._range);return function(e,t,n){let r,i,a=-1;if(n=+n,(i=(t=+t)<(e=+e))&&(r=e,e=t,t=r),!isFinite(n)||t-e<=n)return[e];let o=Math.floor((t-e)/n+1),s=Array(o);for(;++a<o;)s[a]=e+a*n;return i&&s.reverse(),s}(t[0],t[t.length-1],e)}nice(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=this._domain,r=[];if(t){let e=yx(n,t);if(r=e.niceMinMax,this._domainValidator=e.domainValidator,this._niceType=e.niceType,e.niceDomain)return this._niceDomain=e.niceDomain,this.rescale(),this}else this._niceType=\`all\`;if(this._niceType){let t=vx(n.slice(),e);this._niceType===\`min\`?t[t.length-1]=r[1]??t[t.length-1]:this._niceType===\`max\`&&(t[0]=r[0]??t[0]),this._niceDomain=t,this.rescale()}return this}niceMin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;this._niceType=\`min\`;let t=this._domain[this._domain.length-1],n=vx(this.domain(),e);return n&&(n[n.length-1]=t,this._niceDomain=n,this.rescale()),this}niceMax(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;this._niceType=\`max\`;let t=this._domain[0],n=vx(this._domain.slice(),e);return n&&(n[0]=t,this._niceDomain=n,this.rescale()),this}}class Ex{nice(){let e=arguments.length>1?arguments[1]:void 0,t=this._domain,n=[],r=null;if(e){let i=yx(t,e);if(n=i.niceMinMax,this._domainValidator=i.domainValidator,r=i.niceType,i.niceDomain)return this._niceDomain=i.niceDomain,this.rescale(),this}else r=\`all\`;if(r){let e=((e,t)=>{let n=e.slice(),r=0,i=n.length-1,a=n[r],o=n[i];return o<a&&([r,i]=[i,r],[a,o]=[o,a]),n[r]=t.floor(a),n[i]=t.ceil(o),n})(t.slice(),this.getNiceConfig?.call(this)??{floor:e=>Math.floor(e),ceil:e=>Math.ceil(e)});return r===\`min\`?e[e.length-1]=n[1]??e[e.length-1]:r===\`max\`&&(e[0]=n[0]??e[0]),this._niceDomain=e,this.rescale(),this}return this}niceMin(){let e=this._domain[this._domain.length-1];this.nice();let t=this._domain.slice();return this._domain&&(t[t.length-1]=e,this._niceDomain=t,this.rescale()),this}niceMax(){let e=this._domain[0];this.nice();let t=this._domain.slice();return this._domain&&(t[0]=e,this._niceDomain=t,this.rescale()),this}}function Dx(e){return t=>-e(-t)}function Ox(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2**-52;return t=>Math.max(t,e)}class kx extends ox{constructor(){super(Hb(10),Vb(10)),this.type=Mb.Log,this._limit=Ox(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new kx().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(e){if(e)return this;super.rescale();let t=Hb(this._base),n=Vb(this._base);return(this._niceDomain??this._domain)[0]<0?(this._logs=Dx(t),this._pows=Dx(n),this._limit=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2**-52;return t=>Math.min(t,-e)}(),this.transformer=Rb,this.untransformer=zb):(this._logs=t,this._pows=n,this._limit=Ox(),this.transformer=this._logs,this.untransformer=n),this}scale(e){if(e=Number(e),Number.isNaN(e)||this._domainValidator&&!this._domainValidator(e))return this._unknown;this._output||=this._piecewise((this._niceDomain??this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate);let t=this._output(this.transformer(this._limit(this._clamp(e))));return this._fishEyeTransform?this._fishEyeTransform(t):t}base(e,t){return arguments.length?(this._base=e,this.rescale(t)):this._base}tickFormat(){return Lb}d3Ticks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=this.domain(),r=this._limit(n[0]),i=this._limit(n[n.length-1]);return xx(r,i,e,this._base,this.transformer,this.untransformer,t)}ticks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=this.calculateVisibleDomain(this._range);return Sx(this._limit(t[0]),this._limit(t[t.length-1]),e,this._base,this.transformer,this.untransformer)}forceTicks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=this.calculateVisibleDomain(this._range);return Cx(t[0],t[t.length-1],e,this.transformer,this.untransformer)}stepTicks(e){let t=this.calculateVisibleDomain(this._range);return Cx(this._limit(t[0]),this._limit(t[t.length-1]),e,this.transformer,this.untransformer)}getNiceConfig(){return{floor:e=>this._pows(Math.floor(this._logs(this._limit(e)))),ceil:e=>Math.abs(e)>=1?Math.ceil(e):this._pows(Math.ceil(this._logs(this._limit(e))))}}}ue(kx,Ex);class Ax extends Tx{constructor(){super(Ub(1),Wb(1)),this.type=Mb.Symlog,this._const=1}clone(){return new Ax().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(e,t){return arguments.length?(this._const=e,this.transformer=Ub(e),this.untransformer=Wb(e),this.rescale(t)):this._const}d3Ticks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,n=this.domain(),r=n[0],i=n[n.length-1];return xx(r,i,e,this._const,this.transformer,this.untransformer,t)}ticks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=this.calculateVisibleDomain(this._range);return Sx(t[0],t[t.length-1],e,this._const,this.transformer,this.untransformer)}forceTicks(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,t=this.calculateVisibleDomain(this._range);return Cx(t[0],t[t.length-1],e,this.transformer,this.untransformer)}stepTicks(e){let t=this.calculateVisibleDomain(this._range);return Cx(t[0],t[t.length-1],e,this.transformer,this.untransformer)}}ue(Ax,Ex);class jx{constructor(){this.type=Mb.Threshold,this._range=[0,1],this._domain=[.5],this.n=1}unknown(e){return arguments.length?(this._unknown=e,this):this._unknown}scale(e){return!f(e)&&C(+e)?this._range[Se(this._domain,e,0,this.n)]:this._unknown}invertExtent(e){let t=this._range.indexOf(e);return[this._domain[t-1],this._domain[t]]}domain(e){return e?(this._domain=Array.from(e),this.n=Math.min(this._domain.length,this._range.length-1),this):this._domain.slice()}range(e){return e?(this._range=Array.from(e),this.n=Math.min(this._domain.length,this._range.length-1),this):this._range.slice()}clone(){return new jx().domain(this._domain).range(this._range).unknown(this._unknown)}}function Mx(e,t,n,r){let i,{breakData:a}=e;if(a&&a()){let{breakDomains:e}=a(),o=t.domain();i=[];for(let t=0;t<o.length-1;t++)r(n,[o[t],o[t+1]]).forEach((t=>{e.some((e=>t>=e[0]&&t<=e[1]))||i.push(t)}));t.domain(o)}else i=r(n);return i}function Nx(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0&&arguments[4];if(n&&!t.includes(e)){let n=t.length;if(n>1){i?t.push(e):t.unshift(e);for(let e=0;e<n;e++){let a=i?n-1-e:e;if(!r(t[a]))break;t.splice(a,1),e--,n--}}}}let Px=(e,t)=>{if(!Pb(e.type))return kb(e.domain());let n=e.range(),r=Math.abs(n[n.length-1]-n[0]);if(r<2)return kb([e.domain()[0]]);let{tickCount:i,forceTickCount:a,tickStep:o,noDecimals:s=!1,labelStyle:c,breakData:l}=t,u;if(p(o))f=e.stepTicks(o),m=l&&l()?l().breakDomains:null,u=m&&m.length?f.filter((e=>m.every((t=>e<t[0]||e>t[1])))):f;else if(p(a))u=Mx(t,e,a,((t,n)=>n&&n.length?e.domain(n,!0).forceTicks(t):e.forceTicks(t)));else if(t.tickMode===\`d3\`){let n=(d(i)?i({axisLength:r,labelStyle:c}):i)??5;u=Mx(t,e,n,((t,n)=>n&&n.length?e.domain(n,!0).d3Ticks(t,{noDecimals:s}):e.d3Ticks(t,{noDecimals:s})))}else{let n=(d(i)?i({axisLength:r,labelStyle:c}):i)??5,a=d(t.tickMode)?t.tickMode:void 0;u=Mx(t,e,n,((t,n)=>n&&n.length?e.domain(n,!0).ticks(t,{noDecimals:s,customTicks:a}):e.ticks(t,{noDecimals:s,customTicks:a})))}var f,m;let h=e.domain();if(t.labelFirstVisible&&h[0]!==u[0]&&!u.includes(h[0])&&u.unshift(h[0]),t.labelLastVisible&&h[h.length-1]!==u[u.length-1]&&!u.includes(h[h.length-1])&&u.push(h[h.length-1]),t.sampling&&u.length>1&&(t.coordinateType===\`cartesian\`||t.coordinateType===\`polar\`&&t.axisOrientType===\`radius\`)){let{labelGap:n=4,labelFlush:i}=t,a;if(u.length*6>r){let n=[],i=Math.floor(u.length*6/r);u.forEach(((e,t)=>{t%i!=0&&t!==u.length-1||n.push(e)})),a=jb(e,n,t).map(((e,t)=>({AABBBounds:e,value:n[t]})))}else a=jb(e,u,t).map(((e,t)=>({AABBBounds:e,value:u[t]})));let o=a[0],s=de(a),c=l&&l()?Fx.greedy:Fx.parity;for(;a.length>=3&&pb(a,n);)a=c(a,n);let d=t.labelFirstVisible,f=t.labelLastVisible;fb(o,s,n)&&a.includes(s)&&a.length>1&&d&&f&&(a.splice(a.indexOf(s),1),f=!1),Nx(o,a,d,(e=>fb(e,o,n))),Nx(s,a,f,(e=>fb(e,s,n)||!(!d||e===o)&&fb(e,o,n)),!0);let p=a.map((e=>e.value));p.length<3&&i&&(p.length>1&&p.pop(),de(p)!==de(u)&&p.push(de(u))),u=p}return kb(u)},Fx={parity:function(e){return e.filter(((e,t)=>t%2==0))},greedy:function(e,t){let n;return e.filter(((e,r)=>!(r&&fb(n,e,t)||(n=e,0))))}},Ix=(e,t,n,r)=>jb(e,t,n).map((e=>r?[e.x1,e.x2,e.width()]:[e.y1,e.y2,e.height()])),Lx=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return Math.max(e[0],t[0])-n/2<=Math.min(e[1],t[1])+n/2},Rx=(e,t)=>e[1]<t[0]?t[0]-e[1]:t[1]<e[0]?e[0]-t[1]:0,zx=(e,t)=>{let n=e.domain();if(!n.length)return[];let{tickCount:r,forceTickCount:i,tickStep:a,labelGap:o=4,axisOrientType:s,labelStyle:c}=t,l=(e=>[\`bottom\`,\`top\`,\`z\`].includes(e))(s),u=e.range(),f=e.calculateWholeRangeSize();if(f<2)return t.labelLastVisible?kb([n[n.length-1]]):kb([n[0]]);let m;if(p(a))m=e.stepTicks(a);else if(p(i))m=e.forceTicks(i);else if(p(r)){let t=d(r)?r({axisLength:f,labelStyle:c}):r;m=e.ticks(t)}else if(t.sampling){let r=(t.labelStyle.fontSize??12)+2,i=pe(u),a=fe(u);if(n.length<=f/r){let r=(a-i)/n.length,s=Ix(e,n,t,l),c=Math.min(...s.map((e=>e[2]))),u=Bx(n,s,o,t.labelLastVisible,Math.floor(c/r),!1);m=e.stepTicks(u.step),t.labelLastVisible&&(u.delCount&&(m=m.slice(0,m.length-u.delCount)),m.push(n[n.length-1]))}else{let r=[n[0],n[Math.floor(n.length/2)],n[n.length-1]],s=Ix(e,r,t,l),c=null;s.forEach((e=>{c?c[2]<e[2]&&(c=e):c=e}));let u=a-i-o>0?Math.ceil(n.length*(o+c[2])/(a-i-o)):n.length-1;m=e.stepTicks(u),!t.labelLastVisible||m.length&&m[m.length-1]===n[n.length-1]||(m.length&&Math.abs(e.scale(m[m.length-1])-e.scale(n[n.length-1]))<c[2]&&(m=m.slice(0,-1)),m.push(n[n.length-1]))}}else m=e.domain();return kb(m)},Bx=(e,t,n,r,i,a)=>{let o=0,s=0,c=-1,l=Number.MAX_VALUE,u=r=>{let i=!0,a=0;do a+r<e.length&&Lx(t[a],t[a+r],n)&&(i=!1),a+=r;while(i&&a<e.length);return i},d=((e,t,n)=>{let r=e,i=t;for(;r<i;){let e=Math.floor((r+i)/2);n(e)>=0?i=e:r=e+1}return r})(i,e.length,(e=>u(e)?1:-1)),f=d;do if(f>d&&!a&&!u(f))f++;else{if(!r){s=f;break}{let r=e.length-1,i,a=0;i=e.length%f>0?e.length-e.length%f+f:e.length;do{if(i-=f,i!==r&&!Lx(t[i],t[r],n))break;a++}while(i>0);if(i===r){s=f,o=a;break}{let n=Math.floor(e.length/f)-a+1;if(n<c)break;{c=n;let e=Rx(t[i],t[r]),u=i-f>=0?Rx(t[i-f],t[i]):e,d=Math.abs(e-u);if(d<l&&(l=d,s=f,o=a),e<=u)break}}}f++}while(f<=e.length);return{step:s,delCount:o}},Vx=new Uint32Array(33),Hx=new Uint32Array(33);Hx[0]=0,Vx[0]=~Hx[0];for(let e=1;e<=32;++e)Hx[e]=Hx[e-1]<<1|1,Vx[e]=~Hx[e];function Ux(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,left:0,right:0,bottom:0},{top:r=0,left:i=0,right:a=0,bottom:o=0}=n,s=Math.max(1,Math.sqrt(e*t/1e6)),c=~~((e+i+a+s)/s),l=~~((t+r+o+s)/s),u=e=>~~(e/s);return u.bitmap=()=>function(e,t){let n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{let i=r*e+t;return n[i>>>5]&1<<(31&i)},set:(t,n)=>{let i=n*e+t;r(i>>>5,1<<(31&i))},clear:(t,n)=>{let r=n*e+t;i(r>>>5,~(1<<(31&r)))},getRange:r=>{let{x1:i,y1:a,x2:o,y2:s}=r;if(o<0||s<0||i>e||a>t)return!0;let c,l,u,d,f=s;for(;f>=a;--f)if(c=f*e+i,l=f*e+o,u=c>>>5,d=l>>>5,u===d){if(n[u]&Vx[31&c]&Hx[1+(31&l)])return!0}else{if(n[u]&Vx[31&c]||n[d]&Hx[1+(31&l)])return!0;for(let e=u+1;e<d;++e)if(n[e])return!0}return!1},setRange:n=>{let i,a,o,s,c,{x1:l,y1:u,x2:d,y2:f}=n;if(!(d<0||f<0||l>e||u>t))for(;u<=f;++u)if(i=u*e+l,a=u*e+d,o=i>>>5,s=a>>>5,o===s)r(o,Vx[31&i]&Hx[1+(31&a)]);else for(r(o,Vx[31&i]),r(s,Hx[1+(31&a)]),c=o+1;c<s;++c)r(c,4294967295)},clearRange:t=>{let n,r,a,o,s,{x1:c,y1:l,x2:u,y2:d}=t;for(;l<=d;++l)if(n=l*e+c,r=l*e+u,a=n>>>5,o=r>>>5,a===o)i(a,Hx[31&n]|Vx[1+(31&r)]);else for(i(a,Hx[31&n]),i(o,Vx[1+(31&r)]),s=a+1;s<o;++s)i(s,0)},outOfBounds:n=>{let{x1:r,y1:i,x2:a,y2:o}=n;return r<0||i<0||o>=t||a>=e},toImageData:r=>{let i=r.createImageData(e,t),a=i.data;for(let r=0;r<t;++r)for(let t=0;t<e;++t){let i=r*e+t,o=4*i,s=n[i>>>5]&1<<(31&i);a[o+0]=255*s,a[o+1]=255*s,a[o+2]=255*s,a[o+3]=31}return i}}}(c,l),u.x=e=>~~((e+i)/s),u.y=e=>~~((e+r)/s),u.ratio=s,u.padding=n,u.width=e,u.height=t,u}function Wx(e,t){let{x1:n,x2:r,y1:i,y2:a}=t,{top:o=0,left:s=0,right:c=0,bottom:l=0}=e.padding,u=De(n,-s,e.width+c),d=De(r,-s,e.width+c),f=De(i,-o,e.height+l),p=De(a,-o,e.height+l);return{x1:e.x(u),x2:e.x(d),y1:e.y(f),y2:e.y(p)}}function Gx(e,t){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?Wx(e,t):{x1:e.x(t.x1),x2:e.x(t.x2),y1:e.y(t.y1),y2:e.y(t.y2)}}function Kx(e,t,n){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,a=n;i>0&&(a={x1:n.x1-i,x2:n.x2+i,y1:n.y1-i,y2:n.y2+i}),a=Gx(e,a);let o=t.outOfBounds(a);return!(r&&o||(o&&(a=Wx(e,a)),t.getRange(a)))}function qx(e,t,n){let r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,a=arguments.length>6&&arguments[6]!==void 0&&arguments[6],o=(arguments.length>3&&arguments[3]!==void 0?arguments[3]:[]).filter((e=>p(e)));for(let s=0;s<o.length;s++){let c;if(c=a?n:n.clone(),c.setAttributes(o[s]),Kx(e,t,c.AABBBounds,r,i))return t.setRange(Gx(e,c.AABBBounds,!0)),o[s]}return!1}function Jx(e,t,n,r,i,a,o){let s=r.overlap?.clampForce,c=r.overlap?.overlapPadding;if(n.type===\`bound\`||n.type===\`position\`){if(d(o)){let u=((d(n.position)?n.position(i.attribute):n.position)||(l=r.type,l===\`rect\`?Xx:Yx)).map((e=>o(i.AABBBounds,a,e,r.offset))),f=!1===n.restorePosition;return qx(e,t,i,u,s,c,f)}return!1}var l;if(n.type===\`moveY\`){let r=(n.offset?d(n.offset)?n.offset(i.attribute):n.offset:[]).map((e=>({x:i.attribute.x,y:i.attribute.y+e})));return qx(e,t,i,r,s,c)}if(n.type===\`moveX\`){let r=(n.offset?d(n.offset)?n.offset(i.attribute):n.offset:[]).map((e=>({x:i.attribute.x+e,y:i.attribute.y})));return qx(e,t,i,r,s,c)}return!1}let Yx=[\`top\`,\`bottom\`,\`right\`,\`left\`,\`top-right\`,\`bottom-right\`,\`top-left\`,\`bottom-left\`],Xx=[\`top\`,\`inside-top\`,\`inside\`];function Zx(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},{x1:i,x2:a,y1:o,y2:s}=e.AABBBounds,{top:c=0,left:l=0,right:u=0,bottom:d=0}=r,f=Math.min(i,a),p=Math.max(i,a),m=Math.min(o,s),h=Math.max(o,s),g=t+u,_=n+d,v=0,y=0;return f<0-l?v=-f:p>g&&(v=g-p),m<0-c?y=-m:h>_&&(y=_-h),{dx:v,dy:y}}let Qx={fadeIn:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return{from:{opacity:0,fillOpacity:0,strokeOpacity:0},to:{opacity:e.opacity??1,fillOpacity:e.fillOpacity??1,strokeOpacity:e.strokeOpacity??1}}},fadeOut:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return{from:{opacity:e.opacity??1,fillOpacity:e.fillOpacity??1,strokeOpacity:e.strokeOpacity??1},to:{opacity:0,fillOpacity:0,strokeOpacity:0}}}};function $x(e,t){return Qx[t]?.call(Qx,e)??{from:{},to:{}}}let eS=(e,t,n,r)=>{let i=Object.assign({},e.attribute),a=Object.assign({},t.attribute);return P(r?.excludeChannels).forEach((e=>{delete a[e]})),Object.keys(a).forEach((e=>{n&&!n.includes(e)&&delete a[e]})),{from:i,to:a}};function tS(e,t,n,r){e.attribute.text!==t.attribute.text&&C(Number(e.attribute.text)*Number(t.attribute.text))&&e.animate().play(new Lo({text:e.attribute.text},{text:t.attribute.text},n,r))}let nS={mode:\`same-time\`,duration:300,easing:\`linear\`};function rS(e){return e===3||e===4}function iS(e,t){let{x1:n,y1:r,x2:i,y2:a}=e,{x1:o,y1:s,x2:c,y2:l}=t;return!(n<=o&&i<=o||n>=c&&i>=c||r<=s&&a<=s||r>=l&&a>=l)}let aS=e=>{if(!e||!e.attribute)return[];let{points:t,segments:n}=e.attribute;if(n&&n.length){let e=[];return n.forEach((t=>{t.points.forEach((t=>{e.push(t)}))})),e}return t};function oS(e,t,n,r,i,a){return Math.abs(t/e)<a/i?{x:n+(e>0?i:-i),y:r+t*i/Math.abs(e)}:{x:n+e*a/Math.abs(t),y:r+(t>0?a:-a)}}let sS=(e,t)=>Math.ceil(e)>Math.floor(t),cS=(e,t)=>{let[n,r]=e,[i,a]=t;return a>n&&r>i};function lS(e,t){let[n,r]=e,[i,a]=t,o=Math.max(n,i),s=Math.min(r,a);return Math.max(0,s-o)}var uS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};iy(),by(),my(),oy();class dS extends Km{setBitmap(e){this._bitmap=e}setBitmapTool(e){this._bmpTool=e}constructor(e,t){let{data:n}=e,r=uS(e,[\`data\`]);super(t?.skipDefault?e:Object.assign({data:n},N({},dS.defaultAttributes,r))),this.name=\`label\`,this._onHover=e=>{let t=e.target;t===this._lastHover||A(t.states)||(t.addState(Ty.hover,!0),Ay(this,(e=>{e===t||A(e.states)||e.addState(Ty.hoverReverse,!0)})),this._lastHover=t)},this._onUnHover=e=>{this._lastHover&&=(Ay(this,(e=>{A(e.states)||(e.removeState(Ty.hoverReverse),e.removeState(Ty.hover))})),null)},this._onClick=e=>{let t=e.target;if(this._lastSelect===t&&t.hasState(\`selected\`))return this._lastSelect=null,void Ay(this,(e=>{A(e.states)||(e.removeState(Ty.selectedReverse),e.removeState(Ty.selected))}));A(t.states)||(t.addState(Ty.selected,!0),Ay(this,(e=>{e===t||A(e.states)||e.addState(Ty.selectedReverse,!0)})),this._lastSelect=t)},this._handleRelatedGraphicSetState=e=>{if(e.detail?.type===vr.STATE||e.detail?.type===vr.ANIMATE_UPDATE&&e.detail.animationState?.isFirstFrameOfStep){let t=e.target?.currentStates??[],n=this._isCollectionBase?[...this._graphicToText.values()]:[this._graphicToText.get(e.target)];this.updateStatesOfLabels(n,t)}}}labeling(e,t,n,r){}_getLabelLinePoints(e,t){return function(e,t){if(!e||!t||lt(e,t,!0))return;let n=Math.min(e.x1,e.x2),r=Math.min(e.y1,e.y2),i=Math.min(t.x1,t.x2),a=Math.min(t.y1,t.y2),o=Math.abs(e.x2-n)/2,s=Math.abs(e.y2-r)/2,c=Math.abs(t.x2-i)/2,l=Math.abs(t.y2-a)/2,u=n+o,d=r+s,f=i+c,p=a+l,m=f-u,h=p-d;return[oS(m,h,u,d,o,s),oS(-m,-h,f,p,c,l)]}(e.AABBBounds,t?.AABBBounds)}_createLabelLine(e,t){let n=this._getLabelLinePoints(e,t);if(n){let r=U.line({points:n}),{line:i={}}=e.attribute;if(i.customShape){let n=i.customShape;r.pathProxy=r=>n({text:e,baseMark:t},r,new pi)}return t&&t.attribute.fill&&r.setAttribute(\`stroke\`,t.attribute.fill),this.attribute.line&&!A(this.attribute.line.style)&&r.setAttributes(this.attribute.line.style),this._setStatesOfLabelLine(r),r}}render(){if(this._prepare(),f(this._idToGraphic)||this._isCollectionBase&&f(this._idToPoint))return;let{overlap:e,smartInvert:t,dataFilter:n,customLayoutFunc:r,customOverlapFunc:i}=this.attribute,a=this.attribute.data;if(d(n)&&(a=n(a)),a&&a.length){let e=new Set;a=a.filter((t=>!e.has(t.id)&&e.add(t.id)))}let o=this._initText(a);o=d(r)?r(a,o,this.getRelatedGraphic.bind(this),this._isCollectionBase?e=>this._idToPoint.get(e.id):null,this):this._layout(o),d(i)?o=i(o,this.getRelatedGraphic.bind(this),this._isCollectionBase?e=>this._idToPoint.get(e.id):null,this):!1!==e&&(o=this._overlapping(o)),d(this.attribute.onAfterOverlapping)&&this.attribute.onAfterOverlapping(o,this.getRelatedGraphic.bind(this),this._isCollectionBase?e=>this._idToPoint.get(e.id):null,this),o&&o.length&&o.forEach((e=>{this._bindEvent(e),this._setStatesOfText(e)})),!1!==t&&this._smartInvert(o),this._renderLabels(o)}_bindEvent(e){if(this.attribute.disableTriggerEvent||!e)return;let{hover:t,select:n}=this.attribute;t&&(e.addEventListener(\`pointermove\`,this._onHover),e.addEventListener(\`pointerout\`,this._onUnHover)),n&&e.addEventListener(\`pointerdown\`,this._onClick)}_setStatesOfText(e){if(!e)return;let t=this.attribute.state;t&&!A(t)&&(e.states=t)}_setStatesOfLabelLine(e){if(!e)return;let t=this.attribute.labelLineState;t&&!A(t)&&(e.states=t)}_createLabelText(e){return Wy(Object.assign(Object.assign({},this.stage?.getTheme()?.text),e),\`textType\`)}_prepare(){var e,t;let n=[],r;if(r=d(this.attribute.getBaseMarks)?this.attribute.getBaseMarks():function(e,t){if(!t)return[];let n=e.find((e=>e.name===t),!0);return n?n.getChildren():[]}(this.getRootNode(),this.attribute.baseMarkGroupName),r.forEach((e=>{e.releaseStatus!==\`willRelease\`&&n.push(e)})),(e=this._idToGraphic)==null||e.clear(),(t=this._idToPoint)==null||t.clear(),this._baseMarks=n,this._isCollectionBase=this.attribute.type===\`line-data\`,!n||n.length===0)return;let{data:i}=this.attribute;if(i&&i.length!==0){if(this._idToGraphic||=new Map,this._isCollectionBase){this._idToPoint||=new Map;let e=0;for(let t=0;t<n.length;t++){let r=n[t],a=aS(r);if(a&&a.length)for(let t=0;t<a.length;t++){let n=i[e];n&&a[t]&&(p(n.id)||(n.id=\`vrender-component-\${this.name}-\${e}\`),this._idToPoint.set(n.id,a[t]),this._idToGraphic.set(n.id,r)),e++}}}else for(let e=0;e<n.length;e++){let t=i[e],r=n[e];t&&r&&(p(t.id)||(t.id=\`vrender-component-\${this.name}-\${e}\`),this._idToGraphic.set(t.id,r))}if(!1!==this.attribute.animation){let{animation:e,animationEnter:t,animationExit:n,animationUpdate:r}=this.attribute,i=m(e)?e:{};this._animationConfig={enter:!1!==t&&N({},nS,i,t??{}),exit:!1!==n&&N({},nS,i,n??{}),update:!1!==r&&(y(r)?r:N({},nS,i,r??{}))}}else this._animationConfig={enter:!1,exit:!1,update:!1}}}getRelatedGraphic(e){return this._idToGraphic.get(e.id)}_initText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],{textStyle:t={}}=this.attribute,n=[];for(let r=0;r<e.length;r++){let i=e[r],a=this.getRelatedGraphic(i);if(!a)continue;let o=Object.assign(Object.assign({fill:this._isCollectionBase?y(a.attribute.stroke)?a.attribute.stroke.find((e=>!!e&&!0!==e)):a.attribute.stroke:a.attribute.fill},t),i),s=this._createLabelText(o);n.push(s)}return n}_layout(e){let{position:t,offset:n}=this.attribute;for(let r=0;r<e.length;r++){let i=e[r];if(!i)return;let a=i.attribute,o=this.getRelatedGraphic(a);if(!o)continue;i.attachedThemeGraphic=this;let s=this.getGraphicBounds(i);i.attachedThemeGraphic=null;let c=d(t)?t(a):t,l=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(a.id),c):this.getGraphicBounds(o,{x:a.x,y:a.y},c),u=this.labeling(s,l,c,n);u&&i.setAttributes(u)}return e}_overlapping(e){if(e.length===0)return[];let t=m(this.attribute.overlap)?this.attribute.overlap:{},n=this.getBaseMarkGroup(),r=t.size??{width:n?.AABBBounds.width()??0,height:n?.AABBBounds.height()??0};if(r.width===0||r.height===0)return e;let{strategy:i,priority:a}=t,o=this._bmpTool||Ux(r.width,r.height),s=this._bitmap||o.bitmap();return a&&(e=e.sort(((e,t)=>a(t.attribute.data)-a(e.attribute.data)))),i?.type===\`shiftY\`?this._overlapGlobal(e,t,o,s):this._overlapByStrategy(e,t,o,s)}_overlapGlobal(e,t,n,r){let i=e.filter((e=>e.attribute.visible&&e.attribute.opacity!==0&&this.isMarkInsideRect(this.getRelatedGraphic(e.attribute),n))),{clampForce:a=!0,hideOnHit:o=!0,overlapPadding:s,strategy:c}=t;if(a)for(let t=0;t<i.length;t++){let r=e[t],{dx:i=0,dy:a=0}=Zx(r,n.width,n.height,n.padding);i===0&&a===0||(r.setAttributes({x:r.attribute.x+i,y:r.attribute.y+a}),r._isClamped=!0)}i=function(e,t){let{maxY:n=Number.MAX_VALUE,labelling:r,globalShiftY:i={enable:!0,maxIterations:10,maxError:.1,padding:1}}=t,a=e.length;if(a<=1)return e;let o=new Map,s=new Map,c=e=>s.get(e).y1Initial,l=e=>s.get(e).height,u=e=>s.get(e).y1,d=e=>s.get(e).x,f=e=>s.get(e).x1,p=e=>s.get(e).x2,m=e=>s.get(e).attempts,h=(e,t)=>{s.get(e).y1=t},g=(e,t)=>{s.get(e).attempts=t};function _(e){for(let i=e.length-1;i>=0;i--){let a=e[i],o=e[i-1],c=e[i+1];if(o&&sS(u(o)+l(o),u(a))||u(a)===0&&a._isClamped){let{y:e}=r(a);c&&sS(e+l(a)/2,u(c))||e+l(a)/2<=n&&h(a,u(a)+e-(t=a,s.get(t).y))}}var t}e.sort(((e,t)=>e.attribute.x-t.attribute.x));for(let t of e){let{y1:e,y2:n,x1:r,x2:i}=t.AABBBounds,{x:a,y:c}=t.attribute;s.set(t,{y1Initial:e,y1:e,y2:n,y:c,height:n-e,x1:r,x2:i,x:a,attempts:0});let l=!1;for(let[e,n]of o){let{start:s,end:c}=e;if(r>=s&&i<=c)n.push(t),l=!0;else if(Ce(a,d(n[0]),void 0,5)){let a={start:Math.min(s,r),end:Math.max(c,i)};n.push(t),o.set(a,n),o.delete(e),l=!0}else if(lS([s,c],[r,i])/(c-s)>.5){let a={start:Math.min(s,r),end:Math.max(c,i)};n.push(t),o.set(a,n),o.delete(e),l=!0}if(l)break}l||o.set({start:r,end:i},[t])}for(let e of o.values())e.sort(((e,t)=>c(e)-c(t))),_(e);if(!1!==i.enable){let{maxIterations:t=10,maxError:r=.1,padding:o=1,maxAttempts:s=1e3,deltaYTolerance:d=Number.MAX_VALUE}=i;for(let i=0;i<t;i++){e.sort(((e,t)=>c(e)-c(t)));let t=0;for(let r=0;r<a-1;r++){let i=e[r];if(m(i)>=s)continue;let a,_=r+1;for(;(a=e[_])&&!cS([f(i),p(i)],[f(a),p(a)]);)_+=1;if(a){let e=u(i),r=l(i),s=u(a),f=s-(e+r);if(f<o){let r=(o-f)/2;if(t=Math.max(t,r),e+r+l(a)>n){let t=e-(o-f),n=c(i)-t;Math.abs(n)<=d&&(h(i,t),g(i,m(i)+1))}else if(e-r<0){let e=s+(o-f),t=c(a)-e;Math.abs(t)<=d&&(h(a,e),g(a,m(a)+1))}else{let t=e-r,n=c(i)-t,o=s+r,l=c(a)-o;Math.abs(n)<=d&&Math.abs(l)<=d&&(h(i,t),h(a,o),g(i,m(i)+1),g(a,m(a)+1))}}}}if(t<r)break}}for(let t of e){let e=t.attribute.y+u(t)-c(t);t.setAttribute(\`y\`,e)}let v=[];e.sort(((e,t)=>e.attribute.x-t.attribute.x));let y=0,b=e.length-1;for(;y<=b;)y===b?v.push(e[y]):(v.push(e[y]),v.push(e[b])),y++,b--;return v}(i,Object.assign(Object.assign({maxY:n.height},c),{labelling:e=>{let t=this.getRelatedGraphic(e.attribute),n=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(e.attribute.id)):this.getGraphicBounds(t,e);return this.labeling(e.AABBBounds,n,\`bottom\`,this.attribute.offset)}}));for(let e=0;e<i.length;e++){let t=i[e],c=t.AABBBounds,l=Gx(n,c,!0);if(Kx(n,r,c,a,s))r.setRange(l);else{if(a&&this._processClampForce(t,n,r,s))continue;o?t.setAttributes({visible:!1}):r.setRange(l)}}return i}_processClampForce(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,{dy:i=0,dx:a=0}=Zx(e,t.width,t.height,t.padding);if(a===0&&i===0){if(Kx(t,n,e.AABBBounds,!1,r))return n.setRange(Gx(t,e.AABBBounds,!0)),!0}else if(Kx(t,n,{x1:e.AABBBounds.x1+a,x2:e.AABBBounds.x2+a,y1:e.AABBBounds.y1+i,y2:e.AABBBounds.y2+i}))return e.setAttributes({x:e.attribute.x+a,y:e.attribute.y+i}),n.setRange(Gx(t,e.AABBBounds,!0)),!0;return!1}_overlapByStrategy(e,t,n,r){var i;let{avoidBaseMark:a,strategy:o=[],hideOnHit:s=!0,clampForce:c=!0,avoidMarks:l=[],overlapPadding:u}=t,d=[],f=o.some((e=>e.type===\`bound\`));a&&((i=this._baseMarks)==null||i.forEach((e=>{e.AABBBounds&&r.setRange(Gx(n,e.AABBBounds,!0))}))),l.length>0&&l.forEach((e=>{v(e)?function(e,t){if(!t)return[];let n=e.find((e=>e.name===t),!0);return n?n.findAll((e=>e.type!==\`group\`),!0):[]}(this.getRootNode(),e).forEach((e=>{e.AABBBounds&&r.setRange(Gx(n,e.AABBBounds,!0))})):e.AABBBounds&&r.setRange(Gx(n,e.AABBBounds,!0))}));for(let t=0;t<e.length;t++){if(!1===e[t].attribute.visible)continue;let i=e[t],a=this.getRelatedGraphic(i.attribute);if(i.update(),!this.isMarkInsideRect(a,n))continue;if(Kx(n,r,i.AABBBounds,c,u)){if(!f){r.setRange(Gx(n,i.AABBBounds,!0)),d.push(i);continue}if(f&&a&&a.AABBBounds&&this._canPlaceInside(i.AABBBounds,a.AABBBounds)){r.setRange(Gx(n,i.AABBBounds,!0)),d.push(i);continue}}let l=!1;for(let s=0;s<o.length;s++)if(l=Jx(n,r,o[s],this.attribute,i,this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(e[t].attribute.id)):this.getGraphicBounds(a,e[t].attribute),this.labeling),!1!==l){i.setAttributes({x:l.x,y:l.y}),d.push(i);break}(!l&&c&&this._processClampForce(i,n,r,u)||!l&&!s)&&d.push(i)}return d}isMarkInsideRect(e,t){let{left:n,right:r,top:i,bottom:a}=t.padding,o={x1:-n,x2:t.width+r,y1:-i,y2:t.height+a},s=e.AABBBounds;if(s.width()!==0&&s.height()!==0)return lt(e.AABBBounds,o,!0);let{attribute:c}=e;if(e.type===\`rect\`){let{x:e,x1:t,y:n,y1:r}=c;return ut({x:e??t,y:n??r},o,!0)}return\`x\`in c&&\`y\`in c&&ut({x:c.x,y:c.y},o,!0)}getBaseMarkGroup(){let{baseMarkGroupName:e}=this.attribute;if(e)return this.getRootNode().find((t=>t.name===e),!0)}getGraphicBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(e){if(!1!==e.attribute.visible)return e.AABBBounds;let{x:t,y:n}=e.attribute;return{x1:t,x2:t,y1:n,y2:n}}if(t&&n&&n===\`inside-middle\`){let{x:e,y:n,x1:r=e,y1:i=n}=t;return{x1:(e+r)/2,x2:(e+r)/2,y1:(n+i)/2,y2:(n+i)/2}}let{x:r,y:i}=t;return{x1:r,x2:r,y1:i,y2:i}}_renderLabels(e){let{syncState:t}=this.attribute,n=new Map,r=this._graphicToText||new Map,i=[],a=[],{visible:o}=this.attribute.line??{};e&&e.forEach(((e,s)=>{let c=this.getRelatedGraphic(e.attribute),l=this._isCollectionBase?e.attribute.id:c,u=r?.get(l)?\`update\`:\`enter\`,d;if(o&&(d=this._createLabelLine(e,c)),t&&this.updateStatesOfLabels([d?{text:e,labelLine:d}:{text:e}],c.currentStates??[]),u===\`enter\`)i.push(e),n.set(l,d?{text:e,labelLine:d}:{text:e}),this._addLabel({text:e,labelLine:d},i,a,s);else if(u===\`update\`){let t=r.get(l);r.delete(l),n.set(l,t),this._updateLabel(t,{text:e,labelLine:d})}})),this._removeLabel(r),this._graphicToText=n}_addLabel(e,t,n,r){let{text:i,labelLine:a}=e,o=this.getRelatedGraphic(i.attribute);if(this._syncStateWithRelatedGraphic(o),!1!==this._enableAnimation&&!1!==this._animationConfig.enter){if(o){let{from:e,to:s}=$x(i.attribute,\`fadeIn\`);i&&this.add(i),a&&(n.push(a),this.add(a)),this._animationConfig.enter.duration>0&&o.once(\`animate-bind\`,(c=>{i.setAttributes(e),a&&a.setAttributes(e);let l=this._afterRelatedGraphicAttributeUpdate(i,t,a,n,r,o,s,this._animationConfig.enter);o.on(\`afterAttributeUpdate\`,l)}))}}else i&&this.add(i),a&&this.add(a)}_updateLabel(e,t){let{text:n,labelLine:r}=e,{text:i,labelLine:a}=t;if(!1!==this._enableAnimation&&!1!==this._animationConfig.update){let{duration:t,easing:o}=this._animationConfig.update;(function(e,t,n){let r=(e,t)=>{let n={};for(let r in t.attribute)e.attribute[r]!==t.attribute[r]&&(n[r]=t.attribute[r]);return n};if(!y(n)){let{duration:i,easing:a,increaseEffect:o=!0}=n;e.animate().to(r(e,t),i,a),o&&e.type===\`text\`&&t.type===\`text\`&&tS(e,t,i,a);return}n.forEach((n=>{let{duration:i,easing:a,increaseEffect:o=!0,channel:s}=n,{to:c}=eS(e,t,s,n.options);A(c)||e.animate().to(r(e,t),i,a),o&&e.type===\`text\`&&t.type===\`text\`&&tS(e,t,i,a)}))})(n,i,this._animationConfig.update),r&&a&&e.labelLine.animate().to(a.attribute,t,o)}else e.text.setAttributes(i.attribute),r&&a&&e.labelLine.setAttributes(a.attribute)}_removeLabel(e){let t=e=>{this.removeChild(e.text),e.labelLine&&this.removeChild(e.labelLine)};if(!1!==this._enableAnimation&&!1!==this._animationConfig.exit){let{duration:n,easing:r}=this._animationConfig.exit;e.forEach((e=>{var i;(i=e.text)==null||i.animate().to($x(e.text.attribute,\`fadeOut\`).to,n,r).onEnd((()=>{t(e)}))}))}else e.forEach((e=>{t(e)}))}updateStatesOfLabels(e,t){e.forEach((e=>{e&&(e.text&&e.text.useStates(t),e.labelLine&&e.labelLine.useStates(t))}))}_syncStateWithRelatedGraphic(e){this.attribute.syncState&&e&&e.on(\`afterAttributeUpdate\`,this._handleRelatedGraphicSetState)}_afterRelatedGraphicAttributeUpdate(e,t,n,r,i,a,o,s){let{mode:c,duration:l,easing:u,delay:d}=s,f=s=>{let{detail:p}=s;if(!p)return{};let m=p.animationState?.step;if(p.type!==vr.ANIMATE_UPDATE||!m||m.type===\`wait\`&&m.prev?.type==null)return{};if(p.type===vr.ANIMATE_END)return e.setAttributes(o),void(n&&n.setAttributes(o));let h=()=>{a&&(a.onAnimateBind=void 0,a.removeEventListener(\`afterAttributeUpdate\`,f))};switch(c){case\`after\`:p.animationState.end&&(e.animate({onStart:h}).wait(d).to(o,l,u),n&&n.animate().wait(d).to(o,l,u));break;case\`after-all\`:i===t.length-1&&p.animationState.end&&(t.forEach((e=>{e.animate({onStart:h}).wait(d).to(o,l,u)})),r.forEach((e=>{e.animate().wait(d).to(o,l,u)})));break;default:if(this._isCollectionBase){let t=this._idToPoint.get(e.attribute.id);!t||e.animates&&e.animates.has(\`label-animate\`)||!a.containsPoint(t.x,t.y,_r.LOCAL,this.stage?.getPickerService())||(e.animate({onStart:h}).wait(d).to(o,l,u),n&&n.animate().wait(d).to(o,l,u))}else p.animationState.isFirstFrameOfStep&&(e.animate({onStart:h}).wait(d).to(o,l,u),n&&n.animate().wait(d).to(o,l,u))}};return f}_smartInvert(e){var t;let n=m(this.attribute.smartInvert)?this.attribute.smartInvert:{},{textType:r,contrastRatiosThreshold:i,alternativeColors:a,mode:o,interactInvertType:s}=n,c=n.fillStrategy??\`invertBase\`,l=n.strokeStrategy??\`base\`,u=n.brightColor??\`#ffffff\`,d=n.darkColor??\`#000000\`,f=(t=n.outsideEnable)!=null&&t;if(c!==\`null\`||l!==\`null\`)for(let t=0;t<e.length;t++){let n=e[t];if(!n)continue;let p=this.getRelatedGraphic(n.attribute),h=p.attribute.fill,g=n.attribute.fill;if(m(h)&&h.gradient){let e=h.stops?.[0]?.color;e&&(h=e,g=e)}let _=Ny(g,h,r,i,a,o),v=Py(_,u)?u:d,y=this._canPlaceInside(n.AABBBounds,p.AABBBounds),b=!y&&n.AABBBounds&&p.AABBBounds&&p.AABBBounds.intersects(n.AABBBounds);if(y||f||b&&s===\`inside\`){let e=Ly(c,h,_,v);if(e&&n.setAttributes({fill:e}),n.attribute.lineWidth===0||n.attribute.strokeOpacity===0)continue;let t=Ly(l,h,_,v);t&&n.setAttributes({stroke:t})}else if(b&&s!==\`none\`){if(n.attribute.lineWidth===0||n.attribute.strokeOpacity===0)continue;if(n.attribute.stroke){n.setAttributes({fill:Ny(n.attribute.fill,n.attribute.stroke,r,i,a,o)});continue}let e=Ly(c,h,_,v);e&&n.setAttributes({fill:e});let t=Ly(l,h,_,v);t&&n.setAttributes({stroke:t})}}}_canPlaceInside(e,t){return!(!e||!t)&&t.encloses(e)}setLocation(e){this.translateTo(e.x,e.y)}disableAnimation(){this._enableAnimation=!1}enableAnimation(){this._enableAnimation=!0}}dS.defaultAttributes={textStyle:{fontSize:12,textAlign:\`center\`,textBaseline:\`middle\`,boundsPadding:[-2,-1,-2,-1]},offset:0,pickable:!1};let fS={},pS=(e,t)=>{fS[e]=t};var mS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class hS extends dS{constructor(e,t){let{data:n}=e,r=mS(e,[\`data\`]);super(t?.skipDefault?e:Object.assign({data:n},N({},hS.defaultAttributes,r))),this.name=\`symbol-label\`}labeling(e,t){return function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`top\`,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!e)return;let{x1:i,y1:a,x2:o,y2:s}=e,c=Math.abs(o-i),l=Math.abs(s-a),u=(t.x1+t.x2)/2,d=(t.y1+t.y2)/2,f=0,p=0,m=0,h=0;t&&(m=Math.abs(t.x1-t.x2)/2,h=Math.abs(t.y1-t.y2)/2);let g={"top-right":-235,"top-left":235,"bottom-right":45,"bottom-left":-45};switch(n){case\`top\`:p=-1;break;case\`bottom\`:p=1;break;case\`left\`:f=-1;break;case\`right\`:f=1;break;case\`bottom-left\`:case\`bottom-right\`:case\`top-left\`:case\`top-right\`:f=Math.sin(g[n]*(Math.PI/180)),p=Math.cos(g[n]*(Math.PI/180));break;case\`center\`:f=0,p=0}return{x:u+f*(r+m)+Math.sign(f)*(c/2),y:d+p*(r+h)+Math.sign(p)*(l/2)}}(e,t,arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`top\`,arguments.length>3&&arguments[3]!==void 0?arguments[3]:0)}}hS.defaultAttributes={textStyle:{fill:\`#000\`},position:\`top\`,offset:5};let gS=()=>{pS(\`symbol\`,hS),pS(\`line-data\`,hS)};var _S=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class vS extends dS{constructor(e,t){let{data:n}=e,r=_S(e,[\`data\`]);super(t?.skipDefault?e:Object.assign({data:n},N({},vS.defaultAttributes,r)))}labeling(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`top\`,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!e||!t)return;let{x1:i,y1:a,x2:o,y2:s}=e,c=Math.abs(o-i),l=Math.abs(s-a),{x:u,y:d}=((e,t)=>{let{x1:n,x2:r,y1:i,y2:a}=e,o=Math.abs(r-n),s=Math.abs(a-i),c=(n+r)/2,l=(i+a)/2,u=0,d=0;switch(t){case\`top\`:case\`inside-top\`:d=-.5;break;case\`bottom\`:case\`inside-bottom\`:d=.5;break;case\`left\`:case\`inside-left\`:u=-.5;break;case\`right\`:case\`inside-right\`:u=.5;break;case\`top-right\`:u=.5,d=-.5;break;case\`top-left\`:u=-.5,d=-.5;break;case\`bottom-right\`:u=.5,d=.5;break;case\`bottom-left\`:u=-.5,d=.5}return c+=u*o,l+=d*s,{x:c,y:l}})(t,n),f=0,p=0,m=n.includes(\`inside\`);switch(n.includes(\`top\`)?p=m?1:-1:n.includes(\`bottom\`)?p=m?-1:1:n.includes(\`left\`)?f=m?1:-1:n.includes(\`right\`)&&(f=m?-1:1),n){case\`top-right\`:case\`bottom-right\`:f=-1;break;case\`top-left\`:case\`bottom-left\`:f=1}return{x:u+f*r+f*c/2,y:d+p*r+p*l/2}}}vS.tag=\`rect-label\`,vS.defaultAttributes={textStyle:{fill:\`#000\`},position:\`top\`,offset:5};var yS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};let bS=class e extends dS{constructor(t,n){let{data:r}=t,i=yS(t,[\`data\`]);super(n?.skipDefault?t:Object.assign({data:r},N({},e.defaultAttributes,i))),this.name=\`line-label\`}getGraphicBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`end\`;if(!e||e.type!==\`line\`&&e.type!==\`area\`)return super.getGraphicBounds(e,t);let r=e.attribute.points,i=e.attribute.segments;!r&&i&&i.length&&(r=i.reduce(((e,t)=>e.concat(t.points??[])),[])),r&&r.length!==0||(r=[t]);let a=n===\`start\`?0:r.length-1;return r[a]?{x1:r[a].x,x2:r[a].x,y1:r[a].y,y2:r[a].y}:void 0}labeling(e,t){return function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`end\`,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!e||!t)return{x:1/0,y:1/0};let{x1:i,x2:a}=e,o=Math.abs(a-i),s=t.x1,c=s;return n===\`end\`?c=s+o/2+r:n===\`start\`&&(c=s-o/2-r),{x:c,y:t.y1}}(e,t,arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`end\`,arguments.length>3&&arguments[3]!==void 0?arguments[3]:0)}};bS.defaultAttributes={textStyle:{fill:\`#000\`},position:\`end\`,offset:6};let xS=()=>{pS(\`line\`,bS),pS(\`area\`,bS)};var SS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class CS{constructor(e,t,n,r,i,a,o,s,c){this.refDatum=e,this.center=t,this.outerCenter=n,this.quadrant=r,this.radian=i,this.middleAngle=a,this.innerRadius=o,this.outerRadius=s,this.circleCenter=c,this.labelVisible=!0}getLabelBounds(){return this.labelPosition&&this.labelSize?{x1:this.labelPosition.x-this.labelSize.width/2,y1:this.labelPosition.y-this.labelSize.height/2,x2:this.labelPosition.x+this.labelSize.width/2,y2:this.labelPosition.y+this.labelSize.height/2}:{x1:0,x2:0,y1:0,y2:0}}}class wS extends dS{constructor(e,t){let{data:n}=e,r=SS(e,[\`data\`]);super(t?.skipDefault?e:Object.assign({data:n},N({},wS.defaultAttributes,r))),this.name=\`arc-label\`,this._ellipsisWidth=0,this._arcLeft=new Map,this._arcRight=new Map,this._line2MinLength=0,this._alignOffset=0}_overlapping(e){return[\`inside\`,\`inside-center\`].includes(this.attribute.position)?super._overlapping(e):e}labeling(e,t){if(e&&t)return{x:0,y:0}}_layout(e){if(!e||!e.length)return;let t=super._layout(e),n=t.map((e=>this.getGraphicBounds(e))),r=Object.assign(Object.assign({},this.attribute.textStyle),{text:\`…\`}),i=1/0;if(!1!==r.ellipsis){let e=this._createLabelText(r),t=this.getGraphicBounds(e);i=t.x2-t.x1}let a=t.map((e=>e.attribute)),o=Array.from(this._idToGraphic.values());this._line2MinLength=d(this.attribute.line.line2MinLength)?this.attribute.line.line2MinLength(e,o,this.attribute):this.attribute.line.line2MinLength,this._alignOffset=(d(this.attribute.layout.alignOffset)?this.attribute.layout.alignOffset(e,o,this.attribute):this.attribute.layout.alignOffset)??0;let s=this.layoutArcLabels(this.attribute.position,this.attribute,o,a,n,i);for(let e=0;e<a.length;e++){let n=a[e],r=s.find((e=>e.refDatum?.id===n.id));if(r){let n={visible:r.labelVisible,x:r.labelPosition.x,y:r.labelPosition.y,angle:r.angle,points:r.pointA&&r.pointB&&r.pointC?[r.pointA,r.pointB,r.pointC]:void 0,line:r.labelLine};t[e].type===\`richtext\`?n.width=r.labelLimit??t[e].attribute.width:n.maxLineWidth=r.labelLimit??t[e].attribute.maxLineWidth,r.refArc&&r.refArc.type===\`arc3d\`&&(n.anchor3d=[r.circleCenter.x-n.x,r.circleCenter.y-n.y],n.beta=r.refArc.attribute.beta),t[e].setAttributes(n)}}return t}layoutArcLabels(e,t,n,r,i,a){this._arcLeft.clear(),this._arcRight.clear(),this._ellipsisWidth=a;let o=0;n.forEach((e=>{e.attribute.outerRadius>o&&(o=e.attribute.outerRadius)})),r.forEach(((e,n)=>{let a=this._idToGraphic.get(e.id),s=a.attribute,c={x:s?.x??0,y:s?.y??0};if(!f(r[n])&&!f(i[n])){let e=r[n]?r[n]:null,u=i[n]?i[n]:{x1:0,x2:0,y1:0,y2:0},d=(s.startAngle+s.endAngle)/2,f=s.endAngle-s.startAngle,p=ot(s.endAngle-f/2),m=rt(c,s.outerRadius,d),h=rt(c,o+t.line.line1MinLength,d),g=new CS(e,m,h,p,f,d,s.innerRadius,s.outerRadius,c);g.refArc=a,g.pointA=rt(c,this.computeDatumRadius(2*c.x,2*c.y,s.outerRadius),g.middleAngle),g.labelSize={width:u.x2-u.x1,height:u.y2-u.y1},(l=g.quadrant)===1||l===2?this._arcRight.set(g.refDatum,g):rS(g.quadrant)&&this._arcLeft.set(g.refDatum,g)}var l}));let s=Array.from(this._arcLeft.values()),c=Array.from(this._arcRight.values()),l=[];switch(e){case\`inside\`:case\`inside-inner\`:case\`inside-outer\`:case\`inside-center\`:l.push(...this._layoutInsideLabels(c,t,n)),l.push(...this._layoutInsideLabels(s,t,n));break;default:l.push(...this._layoutOutsideLabels(c,t,n)),l.push(...this._layoutOutsideLabels(s,t,n))}return l}_layoutInsideLabels(e,t,n){let r=t,i=r.spaceWidth,a=r.position??\`inside\`,o=r.offsetRadius??-i;return e.forEach((e=>{let{labelSize:n,radian:s}=e,c=e.innerRadius,l=e.outerRadius,u;if(s<function(e,t){return t>2*e?NaN:2*Math.asin(t/2/e)}(l,n.height))u=0;else{let e;e=s>=Math.PI?c:Math.max(c,n.height/2/Math.tan(s/2)),u=l-e-i}!0!==r.rotate&&(u=l-i),e.labelText=this._getFormatLabelText(e.refDatum,u);let d=Math.min(u,e.labelSize.width),f=this._computeAlign(e,t),p,m=0;if(a===\`inside\`&&(m=f===\`left\`?d:f===\`right\`?0:d/2),p=a===\`inside-inner\`?c-o+m:a===\`inside-center\`?c+(l-c)/2:l+o-m,e.labelPosition=rt(e.circleCenter,p,e.middleAngle),e.labelLimit=d,we(d,0)||(e.labelVisible=!1),!1!==r.rotate){e.angle=t.textStyle?.angle??e.middleAngle;let n=r.offsetAngle??0;[\`inside-inner\`,\`inside-outer\`].includes(a)&&(n+=Math.PI/2),e.angle+=n}})),e}_layoutOutsideLabels(e,t,n){let r=n[0].attribute.x??0,i=2*(n[0].attribute.y??0),a=t.layout,o=t.spaceWidth;if(e.forEach((e=>{let t=rS(e.quadrant)?-1:1;e.labelPosition={x:e.outerCenter.x+t*(e.labelSize.width/2+this._line2MinLength+o),y:e.outerCenter.y}})),e.sort(((e,t)=>e.labelPosition.y-t.labelPosition.y)),!1!==t.coverEnable||a.strategy===\`none\`){for(let r of e){let{labelPosition:e,labelSize:i}=r;r.labelLimit=i.width,r.pointB=rS(r.quadrant)?{x:e.x+i.width/2+this._line2MinLength+o,y:e.y}:{x:e.x-i.width/2-this._line2MinLength-o,y:e.y},this._computeX(r,t,n)}!1===t.coverEnable&&a.strategy===\`none\`&&this._coverLabels(e)}else{let r=i/(t.textStyle?.fontSize||16);this._adjustY(e,r,t,n);let{minY:a,maxY:o}=e.reduce(((e,t)=>{let{y1:n,y2:r}=t.getLabelBounds();return e.minY=Math.max(0,Math.min(n,e.minY)),e.maxY=Math.min(i,Math.max(r,e.maxY)),e}),{minY:1/0,maxY:-1/0}),s=Math.max(Math.abs(i/2-a),Math.abs(o-i/2)),c=this._computeLayoutRadius(s,t,n);for(let r of e)this._computePointB(r,c,t,n),this._computeX(r,t,n)}let s=2*r;return e.forEach((e=>{e.labelVisible&&(Te(e.pointB.x,this._line2MinLength+o)||we(e.pointB.x,s-this._line2MinLength-o))&&(e.labelVisible=!1),e.angle=t.textStyle?.angle??0,t.offsetAngle&&(e.angle+=t.offsetAngle),e.labelLine=Object.assign(Object.assign({},t.line),{visible:e.labelVisible})})),e}_computeX(e,t,n){let r=e.circleCenter,i=this.attribute.width;this.attribute.height;let a=0;n.forEach((e=>{e.attribute.outerRadius>a&&(a=e.attribute.outerRadius)}));let o=this.computeLayoutOuterRadius(a,t.width,t.height),s=t.line.line1MinLength,c=t.layout?.align,l=t.spaceWidth,{labelPosition:u,quadrant:d,pointB:f}=e;C(f.x*f.y)||(e.pointC={x:NaN,y:NaN},u.x=NaN,e.labelLimit=0);let p=this.computeRadius(o,t.width,t.height),m=rS(d)?-1:1,h=0,g=(m>0?i-f.x:f.x-0)+this._alignOffset-this._line2MinLength-l;c===\`labelLine\`&&(h=(p+s+this._line2MinLength)*m+r.x,g=(m>0?i-h:h-0)-l),e.labelText=this._getFormatLabelText(e.refDatum,g);let _=Math.min(g,e.labelSize.width);switch(c){case\`labelLine\`:break;case\`edge\`:h=m>0?i-_-l:0+_+l;break;default:h=f.x+m*this._line2MinLength}_=Math.max(this._ellipsisWidth,_);let v=_<e.labelSize.width-1;e.labelLimit=v?_:null,e.pointC={x:h,y:u.y};let y=function(e){return e===\`left\`?0:e===\`right\`?1:.5}(this._computeAlign(e,t))*(v?_:e.labelSize.width);c===\`edge\`?(u.x=(m>0?i:0)-m*y+m*this._alignOffset,e.pointC.x+=m*this._alignOffset):u.x=h+m*(this._alignOffset+l+y)}_computeAlign(e,t){let n=t,r=n.textStyle?.textAlign??n.textStyle?.align,i=n.layout?.textAlign??n.layout?.align;return n.position===\`inside\`?f(r)||r===\`auto\`?\`center\`:r:f(r)||r===\`auto\`?i===\`edge\`?rS(e.quadrant)?\`left\`:\`right\`:rS(e.quadrant)?\`right\`:\`left\`:r}_getFormatLabelText(e,t){return e?.text??\`\`}_adjustY(e,t,n,r){r[0].attribute.x;let i=2*(r[0].attribute.y??0),a=n.layout;if(a.strategy===\`vertical\`){let t,n=0,r=e.length;if(r<=0)return;for(let i=0;i<r;i++){let{y1:a}=e[i].getLabelBounds();if(t=a-n,Te(t,0)){let n=this._shiftY(e,i,r-1,-t);this._shiftY(e,n,0,t/2)}let{y2:o}=e[i].getLabelBounds();n=o}let{y1:a}=e[0].getLabelBounds();t=a-0,Te(t,0)&&this._shiftY(e,0,r-1,-t);for(let t=e.length-1;t>=0&&e[t].getLabelBounds().y2>i;t--)e[t].labelVisible=!1}else if(a.strategy!==\`none\`){let o=e.map(((e,t)=>({arc:e,originIndex:t,priorityIndex:0})));o.sort(((e,t)=>t.arc.radian-e.arc.radian)),o.forEach(((e,t)=>{e.priorityIndex=t,e.arc.labelVisible=!1}));let s=1/0,c=-1/0;for(let l=0;l<t&&l<e.length;l++){this._storeY(e);let t=o[l].arc;this._computeYRange(t,n,r),t.labelVisible=!0;let u=t.labelPosition.y,{lastIndex:d,nextIndex:f}=this._findNeighborIndex(e,o[l]),p=e[d],m=e[f];if(d===-1&&f!==-1){let n=m.labelPosition.y;u>n?t.labelPosition.y=n-m.labelSize.height/2-t.labelSize.height/2:this._twoWayShift(e,t,m,f)}else if(d!==-1&&f===-1){let n=p.labelPosition.y;u<n?t.labelPosition.y=n+p.labelSize.height/2+t.labelSize.height/2:this._twoWayShift(e,p,t,o[l].originIndex)}else if(d!==-1&&f!==-1){let n=p.labelPosition.y,r=m.labelPosition.y;u>r?(t.labelPosition.y=r-m.labelSize.height/2-t.labelSize.height/2,this._twoWayShift(e,p,t,o[l].originIndex)):u<n?(t.labelPosition.y=n+p.labelSize.height/2+t.labelSize.height/2,this._twoWayShift(e,t,m,f)):(this._twoWayShift(e,p,t,o[l].originIndex),this._twoWayShift(e,t,m,f))}let h=Math.min(s,o[l].originIndex),g=Math.max(c,o[l].originIndex),_;if(_=e[g].getLabelBounds().y2-i,we(_,0)&&this._shiftY(e,g,0,-_),_=e[h].getLabelBounds().y1-0,Te(_,0)&&this._shiftY(e,h,e.length-1,-_),_=e[g].getLabelBounds().y2-i,we(_,0)){t.labelVisible=!1,this._restoreY(e);break}a.tangentConstraint&&!this._checkYRange(e)?(t.labelVisible=!1,this._restoreY(e)):(s=h,c=g)}}}_shiftY(e,t,n,r){let i=t<n?1:-1,a=t;for(;a!==-1;){e[a].labelPosition.y+=r;let t=this._findNextVisibleIndex(e,a,n,i);if(t>=0&&t<e.length){let{y1:n,y2:r}=e[a].getLabelBounds(),{y1:o,y2:s}=e[t].getLabelBounds();if(i>0&&r<o||i<0&&n>s)return a}a=t}return n}_findNextVisibleIndex(e,t,n,r){let i=(n-t)*r;for(let n=1;n<=i;n++){let i=t+n*r;if(e[i].labelVisible)return i}return-1}_computePointB(e,t,n,r){let i=n,a=0;r.forEach((e=>{e.attribute.outerRadius>a&&(a=e.attribute.outerRadius)}));let o=this.computeLayoutOuterRadius(a,n.width,n.height),s=i.line.line1MinLength;if(i.layout.strategy===\`none\`)e.pointB={x:e.outerCenter.x,y:e.outerCenter.y};else{let r=e.circleCenter,i=this.computeRadius(o,n.width,n.height),{labelPosition:a,quadrant:c}=e,l=t-Math.max(i+s,e.outerRadius),u=Math.sqrt(t**2-Math.abs(r.y-a.y)**2)-l;C(u)?e.pointB={x:r.x+u*(rS(c)?-1:1),y:a.y}:e.pointB={x:NaN,y:NaN}}}_storeY(e){for(let t of e)t.labelVisible&&(t.lastLabelY=t.labelPosition.y)}_computeYRange(e,t,n){let r=e.circleCenter,i={width:2*r.x,height:2*r.y},a=0;n.forEach((e=>{e.attribute.outerRadius>a&&(a=e.attribute.outerRadius)}));let o=this.computeLayoutOuterRadius(a,t.width,t.height),s=t.line.line1MinLength,{width:c,height:l}=i,u=this.computeRadius(o,t.width,t.height),d=this._computeLayoutRadius(l/2,t,n),f=Math.abs(e.center.x-c/2),p=e.center.y-l/2,m,h,g;if(Ce(c/2,f))m=0,h=1,g=-p;else if(Ce(l/2,p))m=1,h=0,g=-f;else{let e=-1/(p/f);m=e,h=-1,g=p-e*f}let _=function(e,t,n,r,i,a){if(e===0&&t===0||a<=0)return[];if(e===0){let e=-n/t,o=a**2-(e-i)**2;return o<0?[]:o===0?[{x:r,y:e}]:[{x:Math.sqrt(o)+r,y:e},{x:-Math.sqrt(o)+r,y:e}]}if(t===0){let t=-n/e,o=a**2-(t-r)**2;return o<0?[]:o===0?[{x:t,y:i}]:[{x:t,y:Math.sqrt(o)+i},{x:t,y:-Math.sqrt(o)+i}]}let o=(t/e)**2+1,s=2*((n/e+r)*(t/e)-i),c=s**2-4*o*((n/e+r)**2+i**2-a**2);if(c<0)return[];let l=(-s+Math.sqrt(c))/(2*o),u=(-s-Math.sqrt(c))/(2*o),d=-(t*l+n)/e;return c===0?[{x:d,y:l}]:[{x:d,y:l},{x:-(t*u+n)/e,y:u}]}(m,h,g,s+u-d,0,d);if(_.length<2)return;let v,y;_[0].x>_[1].x&&_.reverse(),_[0].x<0?Ce(_[0].y,_[1].y)?we(e.middleAngle,-Math.PI)&&Te(e.middleAngle,0)||we(e.middleAngle,Math.PI)&&Te(e.middleAngle,2*Math.PI)?(v=0,y=_[1].y+l/2):(v=_[1].y+l/2,y=l):_[0].y<_[1].y?(v=0,y=_[1].y+l/2):(v=_[1].y+l/2,y=i.height):(v=Math.min(_[0].y,_[1].y)+l/2,y=Math.max(_[0].y,_[1].y)+l/2),e.labelYRange=[v,y]}_computeLayoutRadius(e,t,n){let r=t,i=r.layoutArcGap,a=r.line.line1MinLength,o=0;n.forEach((e=>{e.attribute.outerRadius>o&&(o=e.attribute.outerRadius)}));let s=this.computeLayoutOuterRadius(o,t.width,t.height),c=this.computeRadius(s,t.width,t.height)+a,l=c-i;return Math.max((l**2+e**2)/(2*l),c)}_findNeighborIndex(e,t){let n=t.originIndex,r=-1,i=-1;for(let t=n-1;t>=0;t--)if(e[t].labelVisible){r=t;break}for(let t=n+1;t<e.length;t++)if(e[t].labelVisible){i=t;break}return{lastIndex:r,nextIndex:i}}_twoWayShift(e,t,n,r){let i=n.getLabelBounds().y1-t.getLabelBounds().y2;if(Te(i,0)){let t=this._shiftY(e,r,e.length-1,-i);this._shiftY(e,t,0,i/2)}}_restoreY(e){for(let t of e)t.labelVisible&&(t.labelPosition.y=t.lastLabelY)}_checkYRange(e){for(let t of e){let{labelYRange:e,labelPosition:n}=t;if(t.labelVisible&&e&&(Te(n.y,e[0])||we(n.y,e[1])))return!1}return!0}_coverLabels(e){if(e.length<=1)return;let t=e[0].getLabelBounds();for(let n=1;n<e.length;n++){let r=e[n].getLabelBounds();iS(t,r)?e[n].labelVisible=!1:t=r}}_getLabelLinePoints(e,t){return e.attribute.points}_createLabelLine(e,t){var n;let{line:r={},visible:i}=e.attribute,a=super._createLabelLine(e,t);if(a&&(a.setAttributes({visible:(n=(r.visible&&i)??e.attribute?.visible)==null||n,lineWidth:r.style?.lineWidth??1}),r.smooth&&a.setAttributes({curveType:\`basis\`}),t.type===\`arc3d\`&&t)){let{beta:e,x:n,y:r}=t.attribute;a.setAttributes({beta:e,anchor3d:[n,r]})}return a}computeRadius(e,t,n,r){return this.computeLayoutRadius(t||0,n||0)*e*(f(r)?1:r)}computeLayoutRadius(e,t){return Math.min(e/2,t/2)}_canPlaceInside(e,t){return this.attribute.position===\`inside\`||this.attribute.position===\`inside-center\`}computeLayoutOuterRadius(e,t,n){return e/(Math.min(t,n)/2)}computeDatumRadius(e,t,n){let r=this.computeLayoutOuterRadius(n,e,t);return this.computeLayoutRadius(e||0,t||0)*r}}wS.defaultAttributes={coverEnable:!1,spaceWidth:5,layoutArcGap:6,textStyle:{visible:!0,fontSize:14,fontWeight:\`normal\`,fillOpacity:1,boundsPadding:[-1,0,-1,0],ellipsis:!0},position:\`outside\`,line:{visible:!0,line1MinLength:20,line2MinLength:10},layout:{align:\`arc\`,strategy:\`priority\`,tangentConstraint:!0}};var TS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class ES extends Km{constructor(e,t){let{dataLabels:n}=e,r=TS(e,[\`dataLabels\`]);super(t?.skipDefault?e:Object.assign({dataLabels:n},N({},ES.defaultAttributes,r))),this.name=\`data-label\`}render(){let{dataLabels:e,size:t}=this.attribute;if(!e||e.length===0)return;let{width:n=0,height:r=0,padding:i}=t||{};if(!n||!r||!C(r*n))return;this._componentMap||=new Map;let a=Ux(n,r,i),o=a.bitmap(),s=new Map,c=this._componentMap;for(let n=0;n<e.length;n++){let r=e[n],i=(l=r.type,fS[l]||dS);if(i){let{baseMarkGroupName:e,type:c}=r,l=r.id??\`\${e}-\${c}-\${n}\`;r.type===\`arc\`&&(r.width=t.width,r.height=t.height);let u=this._componentMap.get(l);u?(u.setBitmapTool(a),u.setBitmap(o),u.setAttributes(r),s.set(l,u)):(u=new i(r),u.setBitmap(o),u.setBitmapTool(a),this.add(u),s.set(l,u))}}var l;c.forEach(((e,t)=>{s.get(t)||this.removeChild(e)})),this._componentMap=s}setLocation(e){this.translateTo(e.x,e.y)}disableAnimation(){this._componentMap.forEach((e=>{e.disableAnimation()}))}enableAnimation(){this._componentMap.forEach((e=>{e.enableAnimation()}))}}function DS(e,t,n,r){let i=\`\`;if(!e||t.length===0)return i;let a=t[0],o=et.distancePP(e,a),s=n?0:1;return r?i+=\`M\${e.x},\${e.y-o}A\${o},\${o},0,0,\${s},\${e.x},\${e.y+o}A\${o},\${o},0,0,\${s},\${e.x},\${e.y-o}Z\`:t.forEach(((e,t)=>{t===0?i=\`M\${e.x},\${e.y}\`:i+=\`A\${o},\${o},0,0,\${s},\${e.x},\${e.y}\`})),i}function OS(e,t,n){let{type:r,closed:i}=n,a=t.slice(0).reverse(),o=\`\`,s=\`\`;if(r===\`line\`&&n.smoothLink&&n.center){let t=e[0],r=a[0],c=n.center;o=db(e,!!i),s=db(a,!!i);let l=et.distancePP(r,c),u=et.distancePP(t,c);o+=\`A\${l},\${l},0,0,1,\${r.x},\${r.y}L\${r.x},\${r.y}\`,s+=\`A\${u},\${u},0,0,0,\${t.x},\${t.y}\`}else if(r===\`circle\`){let{center:t}=n;o=DS(t,e,!1,!!i),s=DS(t,a,!0,!!i)}else r!==\`line\`&&r!==\`polygon\`||(o=db(e,!!i),s=db(a,!!i));return i?o+=s:(s=\`L\`+s.substring(1),o+=s,o+=\`Z\`),o}ES.defaultAttributes={pickable:!1};class kS extends Km{constructor(){super(...arguments),this.name=\`axis-grid\`,this.data=[]}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}render(){this._prevInnerView=this._innerView&&lb(this._innerView),this.removeAllChild(!0),this._innerView=U.group({x:0,y:0,pickable:!1}),this.add(this._innerView);let{items:e,visible:t}=this.attribute;e&&e.length&&!1!==t&&(this.data=this._transformItems(e),this._renderGrid(this._innerView))}getVerticalCoord(e,t,n){return ub(e,this.getVerticalVector(t,n,e))}_transformItems(e){let t=[];return e.forEach((e=>{t.push(Object.assign(Object.assign({},e),{point:this.getTickCoord(e.value),id:e.id??e.label}))})),t}_renderGrid(e){let{visible:t}=this.attribute.subGrid||{};t&&this._renderGridByType(!0,e),this._renderGridByType(!1,e)}_renderGridByType(e,t){let n=N({},this.attribute,this.getGridAttribute(e)),{type:r,items:i,style:a,closed:o,alternateColor:s,depth:c=0}=n,l=e?\`\${tb.grid}-sub\`:\`\${tb.grid}\`;if(i.forEach(((e,n)=>{let{id:i,points:s}=e,u=\`\`;if(r===\`line\`||r===\`polygon\`)u=db(s,!!o);else if(r===\`circle\`){let{center:e}=this.attribute;u=DS(e,s,!1,!!o)}let f=U.path(Object.assign({path:u,z:c},d(a)?N({},this.skipDefault?null:kS.defaultAttributes.style,a(e,n)):a));f.name=\`\${l}-line\`,f.id=this._getNodeId(\`\${l}-path-\${i}\`),t.add(f)})),c&&r===\`line\`&&i.forEach(((e,n)=>{let{id:r,points:i}=e,s=[];s.push(i[0]);let u=i[1].x-i[0].x,f=i[1].y-i[0].y,p=Math.sqrt(u*u+f*f),m=c/p;s.push({x:i[0].x+u*m,y:i[0].y+f*m});let h=db(s,!!o),g=Ve(s[0].x-s[1].x),_=Ve(s[0].y-s[1].y),v=U.path(Object.assign({path:h,z:0,alpha:g>_?(i[1].x-i[0].x>0?-1:1)*Re/2:0,beta:g<_?-Re/2:0,anchor3d:g>_?[s[0].x,0]:[0,s[0].y]},d(a)?N({},this.skipDefault?null:kS.defaultAttributes.style,a(e,n)):a));v.name=\`\${l}-line\`,v.id=this._getNodeId(\`\${l}-path-\${r}\`),t.add(v)})),i.length>1&&s){let e=y(s)?s:[s,\`transparent\`],r=t=>e[t%e.length],a=this.attribute.items,o=a[0],c=a[a.length-1],u=!Ce(o.value,0)&&!Ce(c.value,0),d=!Ce(o.value,1)&&!Ce(c.value,1),f=[],p=o.value>c.value;(p&&d||!p&&u)&&f.push(this.getGridPointsByValue(p?1:0)),i.forEach((e=>{f.push(e.points)})),(p&&u||!p&&d)&&f.push(this.getGridPointsByValue(p?0:1));for(let e=0;e<f.length-1;e++){let i=OS(f[e],f[e+1],n),a=U.path({path:i,fill:r(e)});a.name=\`\${l}-region\`,a.id=this._getNodeId(\`\${l}-region-\${e}\`),t.add(a)}}}_getNodeId(e){return\`\${this.id}-\${e}\`}_parseTickSegment(){let e=1;return this.data.length>=2&&(e=this.data[1].value-this.data[0].value),e}_getPointsOfSubGrid(e,t){let n=this.data.length,r=[];return n>=2&&this.data.forEach((n=>{let i=n.value;if(!t){let t=n.value-e/2;if(this.isInValidValue(t))return;i=t}r.push({value:i})})),r}release(){super.release(),this._prevInnerView=null,this._innerView=null}}kS.defaultAttributes={style:{lineWidth:1,stroke:\`#999\`,strokeOpacity:1,lineDash:[4,4]},subGrid:{visible:!1,style:{lineWidth:1,stroke:\`#999\`,strokeOpacity:1,lineDash:[4,4]}}},iy(),cy();class AS extends kS{constructor(e,t){super(t?.skipDefault?e:N({},kS.defaultAttributes,e),t)}_getGridPoint(e,t){let n;if(e===\`line\`){let{length:e}=this.attribute;n=[t,this.getVerticalCoord(t,e,!0)]}else if(e===\`circle\`||e===\`polygon\`){let{center:e,sides:r=6,startAngle:i=Sy,endAngle:a=Cy}=this.attribute;n=function(e,t,n,r,i){let a=[],o=i-r;for(let i=0;i<t;i++){let s=r+i*o/t;a.push(rt(e,n,s))}return a}(e,r,et.distancePP(e,t),i,a)}return n}getGridPointsByValue(e){let t=this.getTickCoord(e);return this._getGridPoint(this.attribute.type,t)}getGridAttribute(e){let{type:t,alignWithLabel:n=!0}=this.attribute,r=this._parseTickSegment(),i,a=[];if(e){i=N({},this.attribute,this.attribute.subGrid);let e=[],{count:t=4}=i;if(this.data.length>=2){let i=this._getPointsOfSubGrid(r,n);for(let n=0;n<i.length-1;n++){let r=i[n],a=i[n+1];e.push({id:\`sub-\${n}-0\`,points:this.getGridPointsByValue(r.value),datum:{}});for(let i=0;i<t;i++){let o=(i+1)/(t+1),s=(1-o)*r.value+o*a.value;e.push({id:\`sub-\${n}-\${i+1}\`,points:this.getGridPointsByValue(s),datum:{}})}n===i.length-2&&e.push({id:\`sub-\${n}-\${t+1}\`,points:this.getGridPointsByValue(a.value),datum:{}})}a=e}}else{i=this.attribute;let e=[];this.data.forEach((i=>{let{point:a}=i;if(!n){let e=i.value-r/2;if(this.isInValidValue(e))return;a=this.getTickCoord(e)}e.push({id:i.label,datum:i,points:this._getGridPoint(t,a)})})),a=e}return Object.assign(Object.assign({},i),{items:a})}}function jS(){iy(),vy(),by()}ue(AS,Tb);let MS={space:8,style:{fill:\`rgb(47, 69, 84)\`,cursor:\`pointer\`,size:15},state:{disable:{fill:\`rgb(170, 170, 170)\`,cursor:\`not-allowed\`},hover:{}}};jS();class NS extends Km{getCurrent(){return this._current}constructor(e,t){super(t?.skipDefault?e:N({},NS.defaultAttributes,e)),this.name=\`pager\`,this._current=1,this._onHover=e=>{let t=e.target;t.hasState(\`disable\`)||t.addState(\`hover\`)},this._onUnHover=e=>{e.target.removeState(\`hover\`)},this._onClick=e=>{let t=e.target;if(t.name===\`preHandler\`){if(this._current===1)return;--this._current,this._current===1?t.addState(\`disable\`):t.removeState(\`disable\`),this._dispatchEvent(\`toPrev\`,{current:this._current,total:this._total,direction:\`pre\`,event:e})}if(t.name===\`nextHandler\`){if(this._current===this._total)return;this._current+=1,this._current===this._total?t.addState(\`disable\`):t.removeState(\`disable\`),this._dispatchEvent(\`toNext\`,{current:this._current,total:this._total,direction:\`next\`,event:e})}this._current>1&&this.preHandler.removeState(\`disable\`),this._current<this._total&&this.nextHandler.removeState(\`disable\`),this.text.setAttribute(\`text\`,this._getPageText(this._current))}}render(){this._reset();let{layout:e=\`horizontal\`,handler:t=MS,total:n,defaultCurrent:r=1,textStyle:i,padding:a=0}=this.attribute;this._current=r;let o=Bt(a),s=e===\`horizontal\`,c=U.group({x:0,y:0}),l=t.style||{},u=l.size||15,d=t.space??8,f=t.state||{},{preShape:p,nextShape:m}=t;p||=s?\`triangleLeft\`:\`triangleUp\`,m||=s?\`triangleRight\`:\`triangleDown\`;let h=U.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:\`imprecise\`},l),{x:0,y:0,symbolType:p,size:u}));h.states=f,h.name=\`preHandler\`,this.preHandler=h,c.add(h);let{width:g,height:_}=Vy(this._getPageText(n),Object.assign({textAlign:\`center\`,textBaseline:\`middle\`},i),this.stage?.getTheme()?.text),v=S(u)?u:u[0],y=S(u)?u:u[1],b=U.text(Object.assign({x:s?v/2+d+g/2:0,y:s?0:y/2+d+_/2,text:this._getPageText(r),textAlign:\`center\`,textBaseline:\`middle\`,lineHeight:i?.fontSize},i));this.text=b,c.add(b);let x=U.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:\`imprecise\`},l),{x:s?v+2*d+g:0,y:s?0:y+2*d+_,symbolType:m,size:u}));x.name=\`nextHandler\`,x.states=f,this.nextHandler=x,c.add(x),this._total===1?(h.addState(\`disable\`),x.addState(\`disable\`)):this._current===1?h.addState(\`disable\`):this._current===n&&x.addState(\`disable\`);let C=c.AABBBounds,w=C.width(),T=C.height();c.translateTo(0-C.x1+o[3],0-C.y1+o[0]),this.add(c),this.attribute.width=w+o[1]+o[3],this.attribute.height=T+o[0]+o[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener(\`pointerenter\`,this._onHover),this.preHandler.addEventListener(\`pointerleave\`,this._onUnHover),this.preHandler.addEventListener(\`pointerdown\`,this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener(\`pointerenter\`,this._onHover),this.nextHandler.addEventListener(\`pointerleave\`,this._onUnHover),this.nextHandler.addEventListener(\`pointerdown\`,this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(e){let{pageFormatter:t}=this.attribute;return t?d(t)?t(e,this._total):\`\${t}\`.replace(\`{current}\`,\`\${e}\`).replace(\`{total}\`,\`\${this._total}\`):\`\${e}/\${this._total}\`}setTotal(e){e!==this.attribute.total&&(this._total=e,this._current!==1&&this._current<=e?this.setAttributes({total:e,defaultCurrent:this._current}):this.setAttribute(\`total\`,e))}}NS.defaultAttributes={handler:MS,textStyle:{fill:\`rgb(51, 51, 51)\`,fontSize:12}};var G,PS,FS;(function(e){e.selected=\`selected\`,e.unSelected=\`unSelected\`,e.selectedHover=\`selectedHover\`,e.unSelectedHover=\`unSelectedHover\`,e.focus=\`focus\`})(G||={}),function(e){e.legendItemHover=\`legendItemHover\`,e.legendItemUnHover=\`legendItemUnHover\`,e.legendItemClick=\`legendItemClick\`,e.legendItemAttributeUpdate=\`legendItemAttributeUpdate\`}(PS||={}),function(e){e.innerView=\`innerView\`,e.title=\`legendTitle\`,e.item=\`legendItem\`,e.itemShape=\`legendItemShape\`,e.itemLabel=\`legendItemLabel\`,e.itemValue=\`legendItemValue\`,e.focus=\`legendItemFocus\`}(FS||={});class IS extends Km{constructor(){super(...arguments),this.name=\`legend\`,this._title=null}render(){this.removeAllChild(!0);let{interactive:e=!0,title:t,padding:n=0}=this.attribute;this._parsedPadding=Bt(n);let r=U.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:e,childrenPickable:e});r.name=FS.innerView,this.add(r),this._innerView=r,t!=null&&t.visible&&this._renderTitle(t),this._renderContent(),this._adjustLayout(),e&&this._bindEvents();let i=this._innerView.AABBBounds;this.attribute.width=i.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=i.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(e){let{text:t=\`\`,textStyle:n,padding:r=0,background:i,minWidth:a,maxWidth:o,shape:s}=e,c={x:0,y:0,text:t,textStyle:n,padding:Bt(r),minWidth:a,maxWidth:o};s&&s.visible&&(c.shape=Object.assign({visible:!0},s.style),p(s.space)&&(c.space=s.space)),i&&i.visible&&(c.panel=Object.assign({visible:!0},i.style));let l=new Jy(c);l.name=FS.title,this._title=l,this._innerView.add(l)}_adjustLayout(){if(this._title){let e=this._innerView.AABBBounds.width(),t=this._title.AABBBounds.width(),n=this.attribute.title?.align;n===\`center\`?this._title.setAttribute(\`x\`,(e-t)/2):n===\`end\`&&this._title.setAttribute(\`x\`,e-t)}}}var LS=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};let RS={[G.focus]:{},[G.selected]:{},[G.selectedHover]:{},[G.unSelected]:{},[G.unSelectedHover]:{}};iy(),Ky(),jS(),xy();let zS=class e extends IS{constructor(t,n){super(n?.skipDefault?t:N({},e.defaultAttributes,t)),this.name=\`discreteLegend\`,this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=e=>{let t=e.target;if(t&&t.name&&t.name.startsWith(FS.item)){let n=t.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===n.id)return;this._unHover(this._lastActiveItem,e)}this._hover(n,e)}else this._lastActiveItem&&=(this._unHover(this._lastActiveItem,e),null)},this._onUnHover=e=>{this._lastActiveItem&&=(this._unHover(this._lastActiveItem,e),null)},this._onClick=e=>{var t,n,r,i;let a=e.target;if(a&&a.name&&a.name.startsWith(FS.item)){let o=a.delegate,{selectMode:s=\`multiple\`}=this.attribute;if(a.name===FS.focus||s===\`focus\`){let r=o.hasState(G.focus);o.toggleState(G.focus),r?(t=this._itemsContainer)==null||t.getChildren().forEach((t=>{this._removeLegendItemState(t,[G.unSelected,G.unSelectedHover,G.focus],e),this._setLegendItemState(t,G.selected,e)})):(this._setLegendItemState(o,G.selected,e),this._removeLegendItemState(o,[G.unSelected,G.unSelectedHover],e),(n=this._itemsContainer)==null||n.getChildren().forEach((t=>{o!==t&&(this._removeLegendItemState(t,[G.selected,G.selectedHover,G.focus],e),this._setLegendItemState(t,G.unSelected,e))})))}else{(r=this._itemsContainer)==null||r.getChildren().forEach((e=>{e.removeState(G.focus)}));let{allowAllCanceled:t=!0}=this.attribute,n=o.hasState(G.selected),a=this._getSelectedLegends();if(s===\`multiple\`){if(!1===t&&n&&a.length===1)return void this._dispatchLegendEvent(PS.legendItemClick,o,e);n?(this._removeLegendItemState(o,[G.selected,G.selectedHover],e),this._setLegendItemState(o,G.unSelected,e)):(this._setLegendItemState(o,G.selected,e),this._removeLegendItemState(o,[G.unSelected,G.unSelectedHover],e))}else this._setLegendItemState(o,G.selected,e),this._removeLegendItemState(o,[G.unSelected,G.unSelectedHover],e),(i=this._itemsContainer)==null||i.getChildren().forEach((t=>{o!==t&&(this._removeLegendItemState(t,[G.selected,G.selectedHover],e),this._setLegendItemState(t,G.unSelected,e))}))}this._dispatchLegendEvent(PS.legendItemClick,o,e)}}}render(){super.render(),this._lastActiveItem=null}setSelected(e){(this._itemsContainer?.getChildren()).forEach((t=>{let n=t.data;e.includes(n.label)?(this._setLegendItemState(t,G.selected),this._removeLegendItemState(t,[G.unSelected,G.unSelectedHover])):(this._removeLegendItemState(t,[G.selected,G.selectedHover]),this._setLegendItemState(t,G.unSelected))}))}_renderItems(){let{item:e={},maxCol:t=1,maxRow:n=2,maxWidth:r,defaultSelected:i,lazyload:a,autoPage:o}=this.attribute,{spaceCol:s=16,spaceRow:c=8,verticalAlign:l=\`middle\`}=e,u=this._itemsContainer,{items:d,isHorizontal:f,startIndex:m,isScrollbar:h}=this._itemContext,g=h?1:f?n:t,_=this._contentMaxHeight,v,{doWrap:b,maxWidthInCol:x,startX:S,startY:C,pages:w}=this._itemContext,T=0,E=0,D=[];for(let e=m,t=d.length;e<t&&!(a&&w>this._itemContext.currentPage*g);e++){a&&(this._itemContext.startIndex=e+1),v=d[e],v.id||=v.label,v.index=e;let t=!0;y(i)&&(t=i.includes(v.label));let n=this._renderEachItem(v,t,e,d),m=n.attribute.width,g=n.attribute.height;this._itemHeight=Math.max(this._itemHeight,g),x=Math.max(m,x),this._itemMaxWidth=Math.max(m,this._itemMaxWidth),f?(p(r)&&(h&&o?(w=Math.ceil((S+m)/r),b=w>1):S+m>r&&(b=!0,S>0&&(l!==\`middle\`&&l!==\`bottom\`||D.forEach((e=>{e.setAttributes({y:e.attribute.y+(E-e.attribute.height)/(l===\`middle\`?2:1)})})),w+=1,S=0,C+=E+c,E=0,D.length=0))),S===0&&C===0||n.setAttributes({x:S,y:C}),S+=s+m,E=Math.max(E,g),D.push(n)):(p(_)&&(h&&o?(w=Math.ceil((C+g)/_),b=w>1):_<=g?(w+=1,b=!0,C=0,e>0&&(S+=T+s)):_<C+g&&(w+=1,b=!0,C=0,S+=x+s,x=0)),S===0&&C===0||n.setAttributes({x:S,y:C}),C+=c+g),u.add(n),T=m}return!f||l!==\`middle\`&&l!==\`bottom\`||D.forEach((e=>{e.setAttributes({y:e.attribute.y+(E-e.attribute.height)/(l===\`middle\`?2:1)})})),this._itemContext.doWrap=b,this._itemContext.startX=S,this._itemContext.startY=C,this._itemContext.maxWidthInCol=x,this._itemContext.pages=w,this._itemContext.maxPages=g,h&&(this._itemContext.totalPage=w),a||(this._itemContext.startIndex=d.length),this._itemContext}_renderContent(){let{item:e={},items:t,reversed:n,maxWidth:r,maxHeight:i}=this.attribute;if(!1===e.visible||A(t))return;let a=t;n&&(a=t?.reverse()),this._contentMaxHeight=Math.max(0,i-this._parsedPadding[0]-this._parsedPadding[2]);let o=U.group({x:0,y:0});this._itemsContainer=o;let{layout:s,autoPage:c}=this.attribute,l=s===\`horizontal\`,{maxWidth:u,width:d,height:f}=e,m=[];p(u)&&m.push(u),p(d)&&m.push(d),m.length&&(p(r)&&m.push(r),this._itemWidthByUser=pe(m)),p(f)&&(this._itemHeightByUser=f);let h=this.attribute.pager;this._itemContext={currentPage:h&&h.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:a,isHorizontal:l,totalPage:1/0,isScrollbar:h&&h.type===\`scrollbar\`,clipContainer:void 0},this._itemContext=this._renderItems();let g=!1;this._itemContext.doWrap&&c&&this._itemContext.pages>this._itemContext.maxPages&&(g=this._renderPagerComponent()),g||(o.setAttribute(\`y\`,this._title?this._title.AABBBounds.height()+j(this.attribute,\`title.space\`,8):0),this._innerView.add(o))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;let{hover:e=!0,select:t=!0}=this.attribute;if(e){let t=\`pointermove\`,n=\`pointerleave\`;m(e)&&(e.trigger&&(t=e.trigger),e.triggerOff&&(n=e.triggerOff)),this._itemsContainer.addEventListener(t,this._onHover),this._itemsContainer.addEventListener(n,this._onUnHover)}if(t){let e=\`pointerdown\`;m(t)&&t.trigger&&(e=t.trigger),this._itemsContainer.addEventListener(e,this._onClick)}}_autoEllipsis(e,t,n,r){let{label:i,value:a}=this.attribute.item,o=r.AABBBounds,s=n.AABBBounds,c=o.width(),l=s.width(),u=!1;e===\`labelFirst\`?l>t?u=!0:r.setAttribute(\`maxLineWidth\`,t-l):e===\`valueFirst\`?c>t?u=!0:n.setAttribute(\`maxLineWidth\`,t-c):c+l>t&&(u=!0),u&&(r.setAttribute(\`maxLineWidth\`,Math.max(t*(i.widthRatio??.5),t-l)),n.setAttribute(\`maxLineWidth\`,Math.max(t*(a.widthRatio??.5),t-c)))}_renderEachItem(e,t,n,r){let{id:i,label:a,value:o,shape:s}=e,{padding:c=0,focus:l,focusIconStyle:u,align:d,autoEllipsisStrategy:m}=this.attribute.item,{shape:h,label:g,value:_,background:v}=this.attribute.item,b=this._handleStyle(h,e,t,n,r),x=this._handleStyle(g,e,t,n,r),S=this._handleStyle(_,e,t,n,r),C=this._handleStyle(v,e,t,n,r),w=Bt(c),T;!1===v.visible?(T=U.group({x:0,y:0,cursor:C.style?.cursor}),this._appendDataToShape(T,FS.item,e,T)):(T=U.group(Object.assign({x:0,y:0},C.style)),this._appendDataToShape(T,FS.item,e,T,C.state)),T.id=\`\${i??a}-\${n}\`,T.addState(t?G.selected:G.unSelected);let E=U.group({x:0,y:0,pickable:!1});T.add(E);let D,O=0,k=0,A=0;if(h&&!1!==h.visible){let n=j(b,\`style.size\`,10);k=y(n)?n[0]||0:n,A=j(h,\`space\`,8);let r=U.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:\`circle\`,strokeBoundsBuffer:0},s),b.style));Object.keys(b.state||{}).forEach((e=>{let t=b.state[e].fill||b.state[e].stroke;s.fill&&f(b.state[e].fill)&&t&&(b.state[e].fill=t),s.stroke&&f(b.state[e].stroke)&&t&&(b.state[e].stroke=t)})),this._appendDataToShape(r,FS.itemShape,e,T,b.state),r.addState(t?G.selected:G.unSelected),E.add(r)}let ee=0;if(l){let t=j(u,\`size\`,10);D=U.symbol(Object.assign(Object.assign({x:0,y:-t/2-1,strokeBoundsBuffer:0,boundsPadding:w},u),{visible:!0,pickMode:\`imprecise\`})),this._appendDataToShape(D,FS.focus,e,T),ee=t}let te=g.formatMethod?g.formatMethod(a,e,n):a,M=Wy(Object.assign(Object.assign({x:k/2+A,y:0,textAlign:\`start\`,textBaseline:\`middle\`,lineHeight:x.style?.fontSize},x.style),{text:te,_originText:g.formatMethod?a:void 0}));this._appendDataToShape(M,FS.itemLabel,e,T,x.state),M.addState(t?G.selected:G.unSelected),E.add(M);let ne=j(g,\`space\`,8);if(p(o)){let r=j(_,\`space\`,l?8:0),i=_.formatMethod?_.formatMethod(o,e,n):o,a=Wy(Object.assign(Object.assign({x:0,y:0,textAlign:\`start\`,textBaseline:\`middle\`,lineHeight:S.style.fontSize},S.style),{text:i,_originText:_.formatMethod?o:void 0}));if(this._appendDataToShape(a,FS.itemValue,e,T,S.state),a.addState(t?G.selected:G.unSelected),this._itemWidthByUser){let e=this._itemWidthByUser-w[1]-w[3]-k-A-ne-ee-r;this._autoEllipsis(m,e,M,a),_.alignRight?a.setAttributes({textAlign:\`right\`,x:this._itemWidthByUser-k/2-w[1]-w[3]-ee-r}):a.setAttribute(\`x\`,ne+(M.AABBBounds.empty()?0:M.AABBBounds.x2))}else a.setAttribute(\`x\`,ne+(M.AABBBounds.empty()?0:M.AABBBounds.x2));O=r+(a.AABBBounds.empty()?0:a.AABBBounds.x2),E.add(a)}else this._itemWidthByUser&&M.setAttribute(\`maxLineWidth\`,this._itemWidthByUser-w[1]-w[3]-k-A-ee),O=ne+(M.AABBBounds.empty()?0:M.AABBBounds.x2);D&&(D.setAttribute(\`x\`,O),E.add(D));let re=E.AABBBounds,ie=re.width();if(d===\`right\`){let e=re.x2,t=re.x1;E.forEachChildren(((n,r)=>{n.type!==\`symbol\`&&n.attribute.textAlign!==\`right\`||n===D?n.setAttribute(\`x\`,t+e-n.attribute.x-n.AABBBounds.width()):n.type===\`symbol\`?n.setAttribute(\`x\`,t+e-n.attribute.x):n.setAttributes({x:t+e-n.attribute.x,textAlign:\`left\`})}))}let N=re.height(),ae=p(this.attribute.item.width)?this.attribute.item.width:ie+w[1]+w[3],oe=this._itemHeightByUser||N+w[0]+w[2];return T.attribute.width=ae,T.attribute.height=oe,D&&D.setAttribute(\`visible\`,!1),E.translateTo(-re.x1+w[3],-re.y1+w[0]),T}_createPager(e){let{disableTriggerEvent:t,maxRow:n}=this.attribute,r=e=>e<=99?99:e<=999?999:9999;return this._itemContext.isHorizontal?new NS(Object.assign(Object.assign({layout:n===1?\`horizontal\`:\`vertical\`,total:r(this._itemContext.pages)},N({handler:{preShape:\`triangleUp\`,nextShape:\`triangleDown\`}},e)),{defaultCurrent:this.attribute.pager?.defaultCurrent,disableTriggerEvent:t})):new NS(Object.assign({layout:\`horizontal\`,total:r(this._itemContext.pages),disableTriggerEvent:t,defaultCurrent:this.attribute.pager?.defaultCurrent},e))}_createScrollbar(e,t){let{disableTriggerEvent:n}=this.attribute;return this._itemContext.isHorizontal?new ky(Object.assign(Object.assign({direction:\`horizontal\`,disableTriggerEvent:n,range:[0,.5],height:!1===e.visible?0:12},e),{width:t})):new ky(Object.assign(Object.assign({direction:\`vertical\`,width:!1===e.visible?0:12,range:[0,.5]},e),{height:t,disableTriggerEvent:n}))}_updatePositionOfPager(e,t,n){let{pager:r}=this.attribute,{totalPage:i,isHorizontal:a}=this._itemContext,o=r&&r.position||\`middle\`;if(this._pagerComponent.setTotal(i),a){let r;r=o===\`start\`?e:o===\`end\`?e+n-this._pagerComponent.AABBBounds.height()/2:e+n/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:t-this._pagerComponent.AABBBounds.width(),y:r})}else{let e;e=o===\`start\`?0:o===\`end\`?t-this._pagerComponent.AABBBounds.width():(t-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:e,y:n-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){let{isHorizontal:e,clipContainer:t}=this._itemContext,n=this._itemsContainer.AABBBounds,r=t.AABBBounds,i,a;return e?(a=r.width(),i=a/n.width()):(a=r.height(),i=a/n.height()),i}_updatePositionOfScrollbar(e,t,n){let{isHorizontal:r,currentPage:i,totalPage:a}=this._itemContext,o=(i-1)/a;this._pagerComponent.setScrollRange([o,o+this._computeScrollbarDelta()]),r?this._pagerComponent.setAttributes({x:0,y:n+t}):this._pagerComponent.setAttributes({x:e,y:n})}_bindEventsOfPager(e,t){let{animation:n=!0,animationDuration:r=450,animationEasing:i=\`quadIn\`}=this.attribute.pager||{},a=this._itemContext.isScrollbar?e=>{let{value:t}=e.detail,n;return n=t[0]===0?1:t[1]===1?this._itemContext.totalPage:t[0]*this._itemContext.totalPage+1,n}:e=>e.detail.current,o=e=>{let t=this._pagerComponent,n=t.getScrollRange(),{direction:r}=t.attribute,{width:i,height:a}=t.getSliderRenderBounds(),o=r===\`vertical\`?e.deltaY/a:e.deltaX/i;t.setScrollRange([n[0]+o,n[1]+o],!0),this.updateScrollMask()},s=o=>{let s=a(o);if(s!==this._itemContext.currentPage){if(this._itemContext.currentPage=s,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();let e=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=e,this._itemContext.isScrollbar&&this._pagerComponent){let e=this._computeScrollbarDelta(),[t]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([t,t+e])}}if(this._itemContext.isScrollbar){let[e]=this._pagerComponent.getScrollRange(),a;a=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();let o=a*e;this.updateScrollMask(),n?this._itemsContainer.animate().to({[t]:-o},r,i):this._itemsContainer.setAttribute(t,-o)}else n?this._itemsContainer.animate().to({[t]:-(s-1)*e},r,i):this._itemsContainer.setAttribute(t,-(s-1)*e)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener(\`scrollDrag\`,s),this._pagerComponent.addEventListener(\`scrollUp\`,s),this.attribute.pager.roamScroll&&(this.addEventListener(\`wheel\`,(e=>e.nativeEvent.preventDefault())),this.addEventListener(\`wheel\`,Me(o,50)))):(this._pagerComponent.addEventListener(\`toPrev\`,s),this._pagerComponent.addEventListener(\`toNext\`,s))}_renderPager(){let e=this._title?this._title.AABBBounds.height()+j(this.attribute,\`title.space\`,8):0,{maxWidth:t,maxCol:n=1,maxRow:r=2,item:i={},pager:a={}}=this.attribute,{spaceCol:o=16,spaceRow:s=8}=i,c=this._itemsContainer,{space:l=12,defaultCurrent:u=1}=a,d=LS(a,[\`space\`,\`defaultCurrent\`]),{isHorizontal:f}=this._itemContext,p=this._contentMaxHeight,m,h=0,g=0,_=0,v=0,y=0,b=0,x=1;if(f){if(g=(r-1)*s+this._itemHeight*r,h=t,m=this._createPager(d),this._pagerComponent=m,this._innerView.add(m),_=t-m.AABBBounds.width()-l,_<=0)return this._innerView.removeChild(m),!1;c.getChildren().forEach(((e,t)=>{let{width:n,height:r}=e.attribute;_<y+n&&(y=0,b+=r+s,x+=1),t>0&&e.setAttributes({x:y,y:b}),y+=o+n})),this._itemContext.startX=y,this._itemContext.startY=b,this._itemContext.pages=x;let n=Math.ceil(x/r);this._itemContext.totalPage=n,this._updatePositionOfPager(e,h,g)}else{if(h=this._itemMaxWidth*n+(n-1)*o,g=p,_=h,m=this._createPager(d),this._pagerComponent=m,this._innerView.add(m),v=p-m.AABBBounds.height()-l-e,v<=0)return this._innerView.removeChild(m),!1;c.getChildren().forEach(((e,t)=>{let{height:n}=e.attribute;v<b+n&&(b=0,y+=this._itemMaxWidth+o,x+=1),t>0&&e.setAttributes({x:y,y:b}),b+=s+n}));let t=Math.ceil(x/n);this._itemContext.totalPage=t,this._updatePositionOfPager(e,h,g)}u>1&&(f?c.setAttribute(\`y\`,-(u-1)*(g+s)):c.setAttribute(\`x\`,-(u-1)*(h+o)));let S=U.group({x:0,y:e,width:f?_:h,height:f?g:v,clip:!0,pickable:!1});return S.add(c),this._innerView.add(S),this._itemContext.clipContainer=S,this._bindEventsOfPager(f?g+s:h+o,f?\`y\`:\`x\`),!0}_renderScrollbar(){var e;let t=this._title?this._title.AABBBounds.height()+j(this.attribute,\`title.space\`,8):0,{maxWidth:n,item:r={},pager:i={}}=this.attribute,{spaceCol:a=16,spaceRow:o=8}=r,s=this._itemsContainer,{space:c=12,defaultCurrent:l=1}=i,u=LS(i,[\`space\`,\`defaultCurrent\`]),{isHorizontal:d}=this._itemContext,f=this._contentMaxHeight,p,m=0,h=0,g=0,_=1;if(d)m=n,h=this._itemHeight,p=this._createScrollbar(u,m),this._pagerComponent=p,this._innerView.add(p);else{if(h=f-t,m=this._itemMaxWidth,p=this._createScrollbar(u,h),this._pagerComponent=p,this._innerView.add(p),h<=0)return this._innerView.removeChild(p),!1;let e=s.getChildren(),n=e.map((e=>e.attribute.height));if(n.length===1||n.every((e=>e===n[0]))){let t=n[0],r=h,i=Math.floor(r/(o+t));h=i*(o+t),_=Math.ceil(e.length/i)}else e.forEach(((e,t)=>{let{height:n}=e.attribute,r=_,i=g;_=Math.floor((g+n)/h)+1,g+=o+n,r!==_&&t===s.getChildren().length-1&&g-h>=1/3*n&&(h=i+n,--_)}));this._itemContext.totalPage=_,this._itemContext.pages=_}if(l>1)if(d){let e=this._itemsContainer.AABBBounds.width()-m;s.setAttribute(\`x\`,-Math.min((l-1)*(m+a),e))}else{let e=this._itemsContainer.AABBBounds.height()-h;s.setAttribute(\`y\`,-Math.min((l-1)*(h+o),e))}let v=U.group({x:0,y:t,width:m,height:h,clip:!0,pickable:!1});return v.add(s),this._innerView.add(v),this._itemContext.clipContainer=v,this._updatePositionOfScrollbar(m,h,t),(e=i.scrollMask)!=null&&e.visible&&this.renderScrollMask(v),this._bindEventsOfPager(d?m:h,d?\`x\`:\`y\`),!0}renderScrollMask(e){let{scrollMask:t={}}=this.attribute.pager,{visible:n=!0,gradientLength:r=16,gradientStops:i}=t;if(!n||!i)return;let a=e.AABBBounds.width(),o=e.AABBBounds.height(),s=this._itemContext.isHorizontal?a:o,c=i.map((e=>({offset:r*e.offset/s,color:e.color}))),l=i.map((e=>({offset:(s-r*e.offset)/s,color:e.color}))),u=U.rect({x:0,y:0,width:a,height:o});this._scrollMask=u,this._scrollMaskContext={startStops:c,endStops:l},this.updateScrollMask(),e.add(u)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;let[e,t]=this._pagerComponent.getScrollRange(),n=[];Ce(De(t,0,1),1)||n.push(...this._scrollMaskContext.endStops),Ce(De(e,0,1),0)||n.push(...this._scrollMaskContext.startStops),n.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:\`linear\`,x0:0,y0:0,x1:1,y1:0,stops:n}}):this._scrollMask.setAttributes({fill:{gradient:\`linear\`,x0:0,y0:0,x1:0,y1:1,stops:n}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(e,t){this._lastActiveItem=e,e.hasState(G.selected)?this._setLegendItemState(e,G.selectedHover,t):this._setLegendItemState(e,G.unSelectedHover,t);let n=e.getChildren()[0].find((e=>e.name===FS.focus),!1);n&&n.setAttribute(\`visible\`,!0),this._dispatchLegendEvent(PS.legendItemHover,e,t)}_unHover(e,t){let n=!1;(e.hasState(G.unSelectedHover)||e.hasState(G.selectedHover))&&(n=!0),e.removeState(G.unSelectedHover),e.removeState(G.selectedHover),e.getChildren()[0].getChildren().forEach((e=>{n||!e.hasState(G.unSelectedHover)&&!e.hasState(G.selectedHover)||(n=!0),e.removeState(G.unSelectedHover),e.removeState(G.selectedHover)}));let r=e.getChildren()[0].find((e=>e.name===FS.focus),!1);r&&r.setAttribute(\`visible\`,!1),n&&this._dispatchLegendEvent(PS.legendItemAttributeUpdate,e,t),this._dispatchLegendEvent(PS.legendItemUnHover,e,t)}_setLegendItemState(e,t,n){let r=!1;e.hasState(t)||(r=!0),e.addState(t,!0),e.getChildren()[0].getChildren().forEach((e=>{e.name!==FS.focus&&(r||e.hasState(t)||(r=!0),e.addState(t,!0))})),r&&this._dispatchLegendEvent(PS.legendItemAttributeUpdate,e,n)}_removeLegendItemState(e,t,n){let r=!1;t.forEach((t=>{!r&&e.hasState(t)&&(r=!0),e.removeState(t)})),e.getChildren()[0].getChildren().forEach((e=>{e.name!==FS.focus&&t.forEach((t=>{!r&&e.hasState(t)&&(r=!0),e.removeState(t)}))})),r&&this._dispatchLegendEvent(PS.legendItemAttributeUpdate,e,n)}_getSelectedLegends(){var e;let t=[];return(e=this._itemsContainer)==null||e.getChildren().forEach((e=>{e.hasState(G.selected)&&t.push(e.data)})),t}_appendDataToShape(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};e.name=t,e.data=n,e.delegate=r,e.states=N({},RS,i)}_dispatchLegendEvent(e,t,n){let r=this._getSelectedLegends();r.sort(((e,t)=>e.index-t.index));let i=r.map((e=>e.label));this._dispatchEvent(e,{item:t,data:t.data,selected:t.hasState(G.selected),currentSelectedItems:r,currentSelected:i,event:n})}_handleStyle(e,t,n,r,i){let a={};return e.style&&(d(e.style)?a.style=e.style(t,n,r,i):a.style=e.style),e.state&&(a.state={},Object.keys(e.state).forEach((o=>{e.state[o]&&(d(e.state[o])?a.state[o]=e.state[o](t,n,r,i):a.state[o]=e.state[o])}))),a}release(){super.release(),this.removeAllEventListeners()}};zS.defaultAttributes={layout:\`horizontal\`,title:{align:\`start\`,space:12,textStyle:{fontSize:12,fontWeight:\`bold\`,fill:\`#2C3542\`}},item:{spaceCol:16,spaceRow:8,shape:{space:8,style:{size:10,cursor:\`pointer\`},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:8,style:{fontSize:12,fill:\`#2C3542\`,cursor:\`pointer\`},state:{selectedHover:{opacity:.85},unSelected:{fill:\`#D8D8D8\`}}},value:{alignRight:!1,style:{fontSize:12,fill:\`#ccc\`,cursor:\`pointer\`},state:{selectedHover:{opacity:.85},unSelected:{fill:\`#D8D8D8\`}}},background:{style:{cursor:\`pointer\`}},focus:!1,focusIconStyle:{size:10,symbolType:\`M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z\`,fill:\`#333\`,cursor:\`pointer\`}},autoPage:!0,pager:{space:12,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:\`multiple\`,allowAllCanceled:!0};let BS=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let i=[e.shape,...n.map((e=>e?.shape))],a=[e.key,...n.map((e=>e?.key))],o=[e.value,...n.map((e=>e?.value))];return N(e,...n,{shape:i.every(f)?void 0:N({},...i),key:a.every(f)?void 0:N({},...a),value:o.every(f)?void 0:N({},...o)})},VS=e=>{let{width:t,height:n,wordBreak:r=\`break-word\`,textAlign:i,textBaseline:a,text:o}=e;return Array.isArray(o)?{width:t,height:n,wordBreak:r,textAlign:i,textBaseline:a,singleLine:!1,textConfig:P(o).map((t=>Object.assign(Object.assign({},e),{text:t})))}:{width:t,height:n,wordBreak:r,textAlign:i,textBaseline:a,singleLine:!1,textConfig:o?.text}},HS={panel:{visible:!0,cornerRadius:[3,3,3,3],fill:\`white\`,shadow:!0,shadowBlur:12,shadowColor:\`rgba(0, 0, 0, 0.1)\`,shadowOffsetX:0,shadowOffsetY:4,shadowSpread:0,stroke:\`white\`},titleStyle:{value:{fill:\`#4E5969\`,fontFamily:wy,fontSize:14,lineHeight:18,textAlign:\`left\`,textBaseline:\`middle\`},spaceRow:6},contentStyle:{shape:{fill:\`black\`,size:8,symbolType:\`circle\`,spacing:6},key:{fill:\`#4E5969\`,fontFamily:wy,fontSize:12,lineHeight:18,textAlign:\`left\`,textBaseline:\`middle\`,spacing:26},value:{fill:\`#4E5969\`,fontFamily:wy,fontSize:12,lineHeight:18,textAlign:\`right\`,textBaseline:\`middle\`,spacing:0},spaceRow:6},padding:10,positionX:\`right\`,positionY:\`bottom\`,offsetX:10,offsetY:10,parentBounds:new St().setValue(-1/0,-1/0,1/0,1/0),autoCalculatePosition:!0,autoMeasure:!0,pickable:!1,childrenPickable:!1,zIndex:500},US=[\`pointerX\`,\`pointerY\`,\`offsetX\`,\`offsetY\`,\`positionX\`,\`positionY\`,\`parentBounds\`];iy(),fy(),vy(),by(),my();let WS=class e extends Km{constructor(t,n){super(n?.skipDefault?t:N({},e.defaultAttributes,t),n),this.name=\`tooltip\`}render(){let{visible:t,content:n,panel:r,keyWidth:i,valueWidth:a,hasContentShape:o,autoCalculatePosition:s,autoMeasure:c,align:l}=this.attribute;if(!t)return void this.hideAll();c&&e.measureTooltip(this.attribute),s&&e.calculateTooltipPosition(this.attribute);let u=Bt(this.attribute.padding);this._tooltipPanel=this.createOrUpdateChild(\`tooltip-background\`,Object.assign({visible:!0},r),\`rect\`),this._tooltipTitleContainer=this.createOrUpdateChild(\`tooltip-title\`,{visible:!0,x:u[3],y:u[0]},\`group\`);let d=e.getTitleAttr(this.attribute);this._tooltipTitleSymbol=this._tooltipTitleContainer.createOrUpdateChild(\`tooltip-title-shape\`,N({symbolType:\`circle\`},d.shape,{visible:jy(d)&&jy(d.shape)}),\`symbol\`),typeof d.value.text!=\`object\`||d.value.text===null||d.value.text.type!==\`rich\`&&d.value.text.type!==\`html\`?d.value.multiLine?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild(\`tooltip-title-value\`,Object.assign({visible:jy(d)&&jy(d.value)},VS(d.value)),\`richtext\`):this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild(\`tooltip-title-value\`,Object.assign({text:d.value.text??\`\`,visible:jy(d)&&jy(d.value)},d.value),\`text\`):d.value.text.type===\`rich\`?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild(\`tooltip-title-value\`,Object.assign({visible:jy(d)&&jy(d.value)},VS(d.value)),\`richtext\`):d.value.text.type===\`html\`&&(this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild(\`tooltip-title-value\`,Object.assign({html:Object.assign(Object.assign({dom:d.value.text.text},Dy),d.value),visible:jy(d)&&jy(d.value),width:d.value.width,height:d.value.height,wordBreak:d.value.wordBreak,textAlign:d.value.textAlign,textBaseline:d.value.textBaseline,singleLine:!1,textConfig:[]},d.value),\`richtext\`));let f=jy(d.shape)?d.shape.size+d.shape.spacing:0,{textAlign:m,textBaseline:h}=d.value,g=r.width-u[3]-u[0]-f;m===\`center\`?this._tooltipTitle.setAttribute(\`x\`,f+g/2):m===\`right\`||m===\`end\`?this._tooltipTitle.setAttribute(\`x\`,f+g):this._tooltipTitle.setAttribute(\`x\`,f),h===\`bottom\`?this._tooltipTitle.setAttribute(\`y\`,d.height):h===\`middle\`?this._tooltipTitle.setAttribute(\`y\`,d.height/2):this._tooltipTitle.setAttribute(\`y\`,0);let _=jy(d)?d.height+d.spaceRow:0;if(this._tooltipContent=this.createOrUpdateChild(\`tooltip-content\`,{visible:!0},\`group\`),this._tooltipContent.removeAllChild(!0),n&&n.length){this._tooltipContent.setAttribute(\`x\`,u[3]),this._tooltipContent.setAttribute(\`y\`,u[0]+_);let t=0;n.forEach(((n,r)=>{let s=e.getContentAttr(this.attribute,r);if(!jy(s))return;let c=\`tooltip-content-\${r}\`,u=this._tooltipContent.createOrUpdateChild(c,{visible:!0,x:0,y:t},\`group\`),d=s.shape.size+s.shape.spacing,f=l===\`right\`?(o?d:0)+(jy(s.key)?i+s.key.spacing:0)+(jy(s.value)?a:0):0;this._createShape(l===\`right\`?f-s.shape.size/2:f+s.shape.size/2,s,u,c),o&&(l===\`right\`?f-=d:f+=d);let m=this._createKey(s,u,c);m&&(Gy(l,m,s.key.textAlign,f,i),m.setAttribute(\`y\`,0),l===\`right\`?f-=i+s.key.spacing:f+=i+s.key.spacing);let h=this._createValue(s,u,c);if(h){let e=\`right\`;p(s.value.textAlign)?e=s.value.textAlign:jy(s.key)||l===\`right\`||(e=\`left\`),h.setAttribute(\`textAlign\`,e),Gy(l,h,e,f,a),h.setAttribute(\`y\`,0)}t+=s.height+s.spaceRow}))}}_createShape(e,t,n,r){if(jy(t.shape))return n.createOrUpdateChild(\`\${r}-shape\`,Object.assign({visible:!0,x:e,y:t.shape.size/2+((Io(t.key.lineHeight,t.key.fontSize)??t.key.fontSize)-t.shape.size)/2},t.shape),\`symbol\`)}_createKey(e,t,n){if(jy(e.key)){let r;return r=e.key.multiLine?t.createOrUpdateChild(\`\${n}-key\`,Object.assign(Object.assign({visible:!0},VS(e.key)),{textBaseline:\`top\`}),\`richtext\`):typeof e.key.text!=\`object\`||e.key.text===null||e.key.text.type!==\`rich\`&&e.key.text.type!==\`html\`?t.createOrUpdateChild(\`\${n}-key\`,Object.assign(Object.assign({visible:!0,text:e.key.text??\`\`},e.key),{textBaseline:\`top\`}),\`text\`):e.key.text.type===\`rich\`?t.createOrUpdateChild(\`\${n}-value\`,Object.assign(Object.assign({visible:!0},VS(e.key)),{textBaseline:\`top\`}),\`richtext\`):t.createOrUpdateChild(\`\${n}-value\`,{html:Object.assign(Object.assign({dom:e.key.text.text},Dy),e.key)},\`richtext\`),r}}_createValue(e,t,n){if(jy(e.value)){let r;return r=e.value.multiLine?t.createOrUpdateChild(\`\${n}-value\`,Object.assign(Object.assign({visible:!0},VS(e.value)),{textBaseline:\`top\`}),\`richtext\`):typeof e.value.text!=\`object\`||e.value.text===null||e.value.text.type!==\`rich\`&&e.value.text.type!==\`html\`?t.createOrUpdateChild(\`\${n}-value\`,Object.assign(Object.assign({visible:!0,text:e.value.text??\`\`},e.value),{textBaseline:\`top\`}),\`text\`):e.value.text.type===\`rich\`?t.createOrUpdateChild(\`\${n}-value\`,Object.assign(Object.assign({visible:!0},VS(e.value)),{textBaseline:\`top\`}),\`richtext\`):t.createOrUpdateChild(\`\${n}-value\`,{html:Object.assign({dom:e.value.text.text,container:\`\`,width:30,height:30,style:{}},e.value)},\`richtext\`),r}}setAttributes(t,n){let r=Object.keys(t);this.attribute.autoCalculatePosition&&r.every((e=>US.includes(e)))?(this._mergeAttributes(t,r),f(this.attribute.panel.width)&&this.attribute.autoMeasure&&e.measureTooltip(this.attribute),e.calculateTooltipPosition(this.attribute),super.setAttributes({x:this.attribute.x,y:this.attribute.y},n)):super.setAttributes(t,n)}static calculateTooltipPosition(e){let{width:t=0,height:n=0}=e.panel,{offsetX:r,offsetY:i,pointerX:a,pointerY:o,positionX:s,positionY:c,parentBounds:l}=e,u=a,d=o;return s===\`left\`?u-=t+r:s===\`center\`?u-=t/2:u+=r,c===\`top\`?d-=n+i:c===\`middle\`?d-=n/2:d+=i,u+t>l.x2&&(u-=t+r),d+n>l.y2&&(d-=n+i),u<l.x1&&(u=l.x1),d<l.y1&&(d=l.y1),e.x=u,e.y=d,e}static measureTooltip(t){let{content:n,contentStyle:r}=t,i=Bt(t.padding),a=e.getTitleAttr(t),o=0,s=i[0]+i[2],c=0,{value:l,shape:u}=a,{visible:d=!1,symbolType:f=\`\`}=u??{};if(p(l)&&typeof a.value.text!=\`object\`){let{width:e,height:t}=By(l).quickMeasure(l.text);o=e,c=t}if(d&&rc[f]&&(o+=u.size+u.spacing,c=Math.max(u.size,c)),t.title&&(t.title.width=o,t.title.height=c),jy(a)&&(s+=c+a.spaceRow),n&&n.length){let i=[];if(n.forEach(((n,r)=>{let a=e.getContentAttr(t,r);(n.key||n.value)&&jy(a)&&i.push([n,a])})),i.length){let e=!1,a=[],c=[],l=[];i.forEach(((t,n)=>{let[o,u]=t,{key:d,value:f,shape:p,spaceRow:m}=u,h=jy(p),g=p?.symbolType??\`\`,_=By(d),v=By(f),y=0;if(jy(d)){let{width:e,height:t}=_.quickMeasure(d.text);c.push(e),y=Math.max(y,t)}if(jy(f)){let{width:e,height:t}=v.quickMeasure(f.text);l.push(e),y=Math.max(y,t)}h&&rc[g]&&(e=!0,a.push(p.size),y=Math.max(p.size,y)),o.height=y,s+=y,n<i.length-1&&(s+=m??r.spaceRow)}));let u=a.length?Math.max(...a):0,d=c.length?Math.max(...c):0,f=l.length?Math.max(...l):0;o=Math.max(d+f+r.key.spacing+r.value.spacing+(e?u+r.shape.spacing:0),o),n.forEach((e=>{e.width=o})),t.hasContentShape=e,t.keyWidth=d,t.valueWidth=f}}return t.panel.width=o+i[1]+i[3],t.panel.height=s,t}static getTitleAttr(t){return BS({},e.defaultAttributes.titleStyle,e.defaultAttributes.title,t.titleStyle,t.title)}static getContentAttr(t,n){return BS({},e.defaultAttributes.contentStyle,t.contentStyle,t.content[n])}};function GS(e,t){let n=KS(e),r=KS(t),i=Math.asin((e.x*t.y-t.x*e.y)/n/r),a=Math.acos((e.x*t.x+e.y*t.y)/n/r);return i<0?-a:a}function KS(e,t={x:0,y:0}){return et.distancePP(e,t)}function qS(e,t,n){let r=!1;if(t&&d(t)){for(let i of e)for(let e of i.getSeries(n))if(r=!!t.call(null,e),r)return r}return r}WS.defaultAttributes=HS;function JS(e){return function(t){let n;return n=y(e)?e.reduce(((e,t)=>e?.[t]),t):t?.[e],n}}var YS,XS,ZS;function QS(e){let{type:t}=e;return t===XS.sankey?e.direction??\`horizontal\`:e.direction??\`vertical\`}(function(e){e.area_horizontal=\`area_horizontal\`,e.area_vertical=\`area_vertical\`,e.area_stack=\`area_stack\`,e.line_horizontal=\`line_horizontal\`,e.line_vertical=\`line_vertical\`,e.line_stack=\`line_stack\`,e.bar_horizontal=\`bar_horizontal\`,e.bar_vertical=\`bar_vertical\`,e.bar_stack=\`bar_stack\`,e.bar3d_horizontal=\`bar3d_horizontal\`,e.bar3d_vertical=\`bar3d_vertical\`,e.bar3d_stack=\`bar3d_stack\`,e.rangeColumn_horizontal=\`rangeColumn_horizontal\`,e.rangeColumn_vertical=\`rangeColumn_vertical\`,e.rangeColumn3d_horizontal=\`rangeColumn3d_horizontal\`,e.rangeColumn3d_vertical=\`rangeColumn3d_vertical\`,e.rangeArea_horizontal=\`rangeArea_horizontal\`,e.rangeArea_vertical=\`rangeArea_vertical\`,e.linearProgress_horizontal=\`linearProgress_horizontal\`,e.linearProgress_vertical=\`linearProgress_vertical\`,e.linearProgress_stack=\`linearProgress_stack\`,e.boxPlot_horizontal=\`boxPlot_horizontal\`,e.boxPlot_vertical=\`boxPlot_vertical\`,e.sankey_horizontal=\`sankey_horizontal\`,e.sankey_vertical=\`sankey_vertical\`,e.waterfall_horizontal=\`waterfall_horizontal\`,e.waterfall_vertical=\`waterfall_vertical\`,e.circularProgress_stack=\`circularProgress_stack\`,e.radar_stack=\`radar_stack\`,e.rose_stack=\`rose_stack\`})(YS||={}),function(e){e.area=\`area\`,e.line=\`line\`,e.bar=\`bar\`,e.bar3d=\`bar3d\`,e.rangeColumn=\`rangeColumn\`,e.rangeColumn3d=\`rangeColumn3d\`,e.rangeArea=\`rangeArea\`,e.dot=\`dot\`,e.geo=\`geo\`,e.link=\`link\`,e.map=\`map\`,e.pie=\`pie\`,e.pie3d=\`pie3d\`,e.radar=\`radar\`,e.rose=\`rose\`,e.scatter=\`scatter\`,e.circularProgress=\`circularProgress\`,e.wordCloud=\`wordCloud\`,e.wordCloud3d=\`wordCloud3d\`,e.funnel=\`funnel\`,e.funnel3d=\`funnel3d\`,e.linearProgress=\`linearProgress\`,e.boxPlot=\`boxPlot\`,e.sankey=\`sankey\`,e.gaugePointer=\`gaugePointer\`,e.gauge=\`gauge\`,e.treemap=\`treemap\`,e.sunburst=\`sunburst\`,e.circlePacking=\`circlePacking\`,e.waterfall=\`waterfall\`,e.heatmap=\`heatmap\`,e.correlation=\`correlation\`,e.liquid=\`liquid\`,e.venn=\`venn\`,e.mosaic=\`mosaic\`,e.pictogram=\`pictogram\`}(XS||={}),function(e){e.label=\`label\`,e.point=\`point\`,e.line=\`line\`,e.area=\`area\`,e.bar=\`bar\`,e.bar3d=\`bar3d\`,e.boxPlot=\`boxPlot\`,e.outlier=\`outlier\`,e.circlePacking=\`circlePacking\`,e.group=\`group\`,e.gridBackground=\`gridBackground\`,e.grid=\`grid\`,e.dot=\`dot\`,e.title=\`title\`,e.subTitle=\`subTitle\`,e.symbol=\`symbol\`,e.funnel=\`funnel\`,e.funnel3d=\`funnel3d\`,e.transform=\`transform\`,e.transform3d=\`transform3d\`,e.transformLabel=\`transformLabel\`,e.outerLabel=\`outerLabel\`,e.outerLabelLine=\`outerLabelLine\`,e.pin=\`pin\`,e.pinBackground=\`pinBackground\`,e.pointer=\`pointer\`,e.segment=\`segment\`,e.track=\`track\`,e.cell=\`cell\`,e.cellBackground=\`cellBackground\`,e.link=\`link\`,e.arrow=\`arrow\`,e.pie=\`pie\`,e.pie3d=\`pie3d\`,e.labelLine=\`labelLine\`,e.progress=\`progress\`,e.minLabel=\`minLabel\`,e.maxLabel=\`maxLabel\`,e.rose=\`rose\`,e.node=\`node\`,e.sunburst=\`sunburst\`,e.nonLeaf=\`nonLeaf\`,e.leaf=\`leaf\`,e.nonLeafLabel=\`nonLeafLabel\`,e.leaderLine=\`leaderLine\`,e.stackLabel=\`stackLabel\`,e.word=\`word\`,e.fillingWord=\`fillingWord\`,e.wordMask=\`wordMask\`,e.nodePoint=\`nodePoint\`,e.ripplePoint=\`ripplePoint\`,e.centerPoint=\`centerPoint\`,e.centerLabel=\`centerLabel\`,e.barBackground=\`barBackground\`,e.lineLabel=\`lineLabel\`,e.areaLabel=\`areaLabel\`,e.liquidGroup=\`liquidGroup\`,e.liquid=\`liquid\`,e.liquidBackground=\`liquidBackground\`,e.liquidOutline=\`liquidOutline\`,e.circle=\`circle\`,e.overlap=\`overlap\`,e.overlapLabel=\`overlapLabel\`,e.pictogram=\`pictogram\`}(ZS||={});let $S={primaryFontColor:\`titleFontColor\`,tertiaryFontColor:\`labelFontColor\`,axisLabelFontColor:\`axisFontColor\`,axisMarkerFontColor:\`labelReverseFontColor\`,dataZoomHandleStrokeColor:\`dataZoomHandlerStrokeColor\`,sliderHandleColor:\`dataZoomHandlerFillColor\`,sliderRailColor:\`dataZoomBackgroundColor\`,sliderTrackColor:\`dataZoomSelectedColor\`,playerControllerColor:\`dataZoomSelectedColor\`,popupBackgroundColor:\`tooltipBackgroundColor\`,hoverBackgroundColor:\`axisGridColor\`},eC={titleFontColor:\`primaryFontColor\`,labelFontColor:\`tertiaryFontColor\`,axisFontColor:\`axisLabelFontColor\`,labelReverseFontColor:\`axisMarkerFontColor\`,dataZoomHandlerStrokeColor:\`dataZoomHandleStrokeColor\`,dataZoomHandlerFillColor:\`sliderHandleColor\`,dataZoomBackgroundColor:\`sliderRailColor\`,dataZoomSelectedColor:\`sliderTrackColor\`,tooltipBackgroundColor:\`popupBackgroundColor\`};function tC(e,t){if(!e)return[];let n=cC(e,t);if(!n||y(n))return n??[];if(m(n)){let{dataScheme:r}=n;return r?oC(r)?r.map((n=>Object.assign(Object.assign({},n),{scheme:n.scheme.map((n=>aC(n)?rC(e,n,t):n)).filter(p)}))):r.map((n=>aC(n)?rC(e,n,t):n)).filter(p):[]}return[]}function nC(e,t){return oC(e)?e.find((e=>p(e.isAvailable)?d(e.isAvailable)?e.isAvailable(t):!!e.isAvailable:!p(e.maxDomainLength)||t?.length<=e.maxDomainLength))?.scheme??e[e.length-1].scheme:e}function rC(e,t,n){let r=cC(e,n);if(!r)return;let i,{palette:a}=r;if(m(a)&&(i=function(e,t){let n=$S[t];if(n&&e[n])return e[n];if(e[t])return e[t];let r=eC[t];return r?e[r]:void 0}(a,t.key)??t.default),!i)return;if(f(t.a)&&f(t.l)||!v(i))return i;let o=new It(i);if(p(t.l)){let{r:e,g:n,b:r}=o.color,{h:i,s:a}=Dt(e,n,r),s=Et(i,a,t.l),c=new It(\`rgb(\${s.r}, \${s.g}, \${s.b})\`);c.setOpacity(o.color.opacity),o=c}return p(t.a)&&o.setOpacity(t.a),o.toRGBA()}let iC=(e,t,n)=>{if(t&&aC(e)){let r=rC(t,e,n);if(r)return r}return e};function aC(e){return e&&e.type===\`palette\`&&!!e.key}function oC(e){return!(!y(e)||e.length===0)&&e.every((e=>p(e.scheme)))}function sC(e){return y(e)?{dataScheme:e}:e}function cC(e,t){let{type:n}=t??{},r;if(!t||f(n))r=e?.default;else{let i=QS(t);r=e?.[\`\${n}_\${i}\`]??e?.[n]??e?.default}return r}class lC extends ex{range(e){return e?(this._range=e,this._resetRange(),this):super.range()}domain(e){return e?(super.domain(e),this._resetRange(),this):super.domain()}_resetRange(){if(!oC(this._range))return void super.range(this._range);let e=nC(this._range,this._domain);super.range(e)}}let uC={linear:Tx,band:rx,point:class extends rx{constructor(e){super(!1),this.type=Mb.Point,this._padding=0,this.paddingInner(1,e),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}},ordinal:ex,threshold:jx,colorOrdinal:lC};function dC(e){let t=uC[e];return t?new t:null}function fC(e,t,n){if(!t)return e;let r=t.range(),i=n&&t._calculateWholeRange?t._calculateWholeRange(r):t.range(),a=Math.min(i[0],i[i.length-1]),o=Math.max(i[0],i[i.length-1]);return Math.min(Math.max(a,e),o)}function pC(e){return p(e?.field)&&p(e?.scale)}function mC(e){switch(e){case\`left\`:case\`right\`:case\`top\`:case\`bottom\`:return!0;default:return!1}}function hC(e){return!!v(e)&&!!e.endsWith(\`%\`)&&Rm(e.substring(0,e.length-1))}function gC(e,t,n,r=0){return S(e)?e:hC(e)?Number(e.substring(0,e.length-1))*t/100:d(e)?e(n):m(e)?t*(e.percent??0)+(e.offset??0):r}function _C(e,t,n){let r={top:0,bottom:0,left:0,right:0};return Object.values(e).every((e=>S(e)))?(r.top=e.top??0,r.right=e.right??0,r.bottom=e.bottom??0,r.left=e.left??0,r):([{orients:[\`left\`,\`right\`],size:t.width},{orients:[\`top\`,\`bottom\`],size:t.height}].forEach((t=>{t.orients.forEach((i=>{r[i]=gC(e[i],t.size,n)}))})),r)}function vC(e){let t={};return y(e)?(f(e[0])||(t.top=t.left=t.bottom=t.right=e[0]),f(e[1])||(t.left=t.right=e[1]),f(e[2])||(t.bottom=e[2]),f(e[3])||(t.left=e[3]),t):S(e)||hC(e)||d(e)||m(n=e)&&(\`percent\`in n||\`offset\`in n)?(t.top=t.left=t.bottom=t.right=e,t):(m(e)&&(t=Object.assign({},e)),t);var n}function yC(e,t,n){return n?{x:e.x+t.x,y:e.y+t.y}:e}let bC=(e,t)=>{let n=Number(e),r=e.toString();return isNaN(n)&&r[r.length-1]===\`%\`?t*(Number(r.slice(0,r.length-1))/100):n},xC=[{maxDomainLength:10,scheme:[\`#1664FF\`,\`#1AC6FF\`,\`#FF8A00\`,\`#3CC780\`,\`#7442D4\`,\`#FFC400\`,\`#304D77\`,\`#B48DEB\`,\`#009488\`,\`#FF7DDA\`]},{scheme:[\`#1664FF\`,\`#B2CFFF\`,\`#1AC6FF\`,\`#94EFFF\`,\`#FF8A00\`,\`#FFCE7A\`,\`#3CC780\`,\`#B9EDCD\`,\`#7442D4\`,\`#DDC5FA\`,\`#FFC400\`,\`#FAE878\`,\`#304D77\`,\`#8B959E\`,\`#B48DEB\`,\`#EFE3FF\`,\`#009488\`,\`#59BAA8\`,\`#FF7DDA\`,\`#FFCFEE\`]}],SC={default:{dataScheme:xC,palette:{backgroundColor:\`#ffffff\`,borderColor:\`#e3e5e8\`,shadowColor:\`rgba(33,37,44,0.1)\`,hoverBackgroundColor:\`#f1f2f5\`,sliderRailColor:\`#f1f3f4\`,sliderHandleColor:\`#ffffff\`,sliderTrackColor:\`#0040ff\`,popupBackgroundColor:\`#ffffff\`,primaryFontColor:\`#21252c\`,secondaryFontColor:\`#606773\`,tertiaryFontColor:\`#89909d\`,axisLabelFontColor:\`#89909d\`,disableFontColor:\`#bcc1cb\`,axisMarkerFontColor:\`#ffffff\`,axisGridColor:\`#f1f2f5\`,axisDomainColor:\`#d9dde4\`,dataZoomHandleStrokeColor:\`#aeb5be\`,dataZoomChartColor:\`#c9ced8\`,playerControllerColor:\`#0040ff\`,scrollBarSliderColor:\`rgba(0,0,0,0.3)\`,axisMarkerBackgroundColor:\`#21252c\`,markLabelBackgroundColor:\`#f1f2f5\`,markLineStrokeColor:\`#606773\`,dangerColor:\`#e33232\`,warningColor:\`#ffc528\`,successColor:\`#07a35a\`,infoColor:\`#3073f2\`,discreteLegendPagerTextColor:\`rgb(51, 51, 51)\`,discreteLegendPagerHandlerColor:\`rgb(47, 69, 84)\`,discreteLegendPagerHandlerDisableColor:\`rgb(170, 170, 170)\`,emptyCircleColor:\`#e3e5e8\`,linearProgressTrackColor:\`#E7EBED\`}}},CC=e=>{let t={label:{style:{fill:\`white\`,textBaseline:\`middle\`,lineWidth:2}},outerLabel:{style:{fontSize:{type:\`token\`,key:\`l4FontSize\`},fill:{type:\`palette\`,key:\`secondaryFontColor\`}},line:{style:{stroke:{type:\`palette\`,key:\`axisDomainColor\`}}}},transformLabel:{style:{fontSize:{type:\`token\`,key:\`l4FontSize\`},fill:{type:\`palette\`,key:\`secondaryFontColor\`},textBaseline:\`middle\`}}};return t[e?\`transform3d\`:\`transform\`]={style:{fill:{type:\`palette\`,key:\`axisGridColor\`}}},t},wC=CC(),TC=CC(!0),EC=\`M1 0 C1 0.55228 0.55228 1 0 1 C-0.552285 1 -1 0.55228 -1 0 C-1 -0.552285 -0.552285 -1 0 -1 C0.55228 -1 1 -0.552285 1 0Z\`,DC={pointer:{type:\`path\`,width:.4,height:.4,style:{path:\`M-0.020059 -0.978425 C-0.018029 -0.9888053 -0.013378 -1 0 -1 C0.01342 -1 0.01812 -0.989146 0.0201 -0.978425 C0.02161 -0.9702819 0.0692 -0.459505 0.09486 -0.184807 C0.10298 -0.097849 0.1089 -0.034548 0.11047 -0.018339 C0.11698 0.04908 0.07373 0.11111 0.00002 0.11111 C-0.07369 0.11111 -0.117184 0.04991 -0.110423 -0.018339 C-0.103662 -0.086591 -0.022089 -0.9680447 -0.020059 -0.978425Z\`}},pin:{width:.025,height:.025,style:{path:EC,fill:\`#888\`}},pinBackground:{width:.06,height:.06,style:{path:EC,fill:\`#ddd\`}}},OC={word:{padding:1,style:{textAlign:\`center\`,textBaseline:\`alphabetic\`}}},kC={word:{padding:1,style:{textAlign:\`center\`,textBaseline:\`alphabetic\`}}},K=\`__VCHART\`,AC=\`\${K}_ARC_TRANSFORM_VALUE\`,jC=\`\${K}_ARC_RATIO\`,MC=\`\${K}_ARC_START_ANGLE\`,NC=\`\${K}_ARC_END_ANGLE\`,PC=\`\${K}_ARC_K\`,FC=\`\${K}_ARC_MIDDLE_ANGLE\`,IC=\`\${K}_ARC_QUADRANT\`,LC=\`\${K}_ARC_RADIAN\`,RC=-Math.PI/2,zC=3*Math.PI/2,BC={scatter:{point:{style:{size:8,symbolType:\`circle\`,lineWidth:0,fillOpacity:.8}},label:{visible:!1,offset:5,position:\`top\`,style:{lineWidth:2,stroke:{type:\`palette\`,key:\`backgroundColor\`}}}},line:{label:{visible:!1,position:\`top\`,offset:5,style:{lineWidth:2,stroke:{type:\`palette\`,key:\`backgroundColor\`}}},point:{style:{symbolType:\`circle\`}}},area:{label:{visible:!1,offset:5,position:\`top\`,style:{stroke:{type:\`palette\`,key:\`backgroundColor\`},lineWidth:2}},point:{style:{symbolType:\`circle\`}},seriesMark:\`area\`},bar:{label:{visible:!1,position:\`outside\`,offset:5,style:{lineWidth:2,stroke:{type:\`palette\`,key:\`backgroundColor\`}}}},bar3d:{bar3d:{style:{length:3}},label:{visible:!1,style:{offset:12,position:\`outside\`}}},pie:{outerRadius:.6,pie:{style:{fillOpacity:1}},label:{visible:!1,interactive:!0,position:\`outside\`,style:{fontWeight:\`normal\`,stroke:{type:\`palette\`,key:\`backgroundColor\`},fillOpacity:1}},innerLabel:{style:{lineWidth:2}},emptyCircle:{style:{fill:{type:\`palette\`,key:\`emptyCircleColor\`},fillOpacity:1}}},pie3d:{outerRadius:.6,pie3d:{style:{height:10,fillOpacity:1}},label:{visible:!1,interactive:!0,position:\`outside\`}},map:{defaultFillColor:\`#f3f3f3\`,area:{style:{lineWidth:.5,strokeOpacity:1,stroke:\`black\`,fillOpacity:1}},label:{interactive:!1,style:{fontSize:{type:\`token\`,key:\`l6FontSize\`},lineHeight:{type:\`token\`,key:\`l6LineHeight\`},textBaseline:\`middle\`,fill:{type:\`palette\`,key:\`secondaryFontColor\`,default:\`#89909d\`},stroke:{type:\`palette\`,key:\`backgroundColor\`}}}},radar:{label:{visible:!1,offset:5,style:{lineWidth:2,stroke:{type:\`palette\`,key:\`backgroundColor\`}}},point:{style:{symbolType:\`circle\`}}},dot:{dot:{style:{size:10,fillOpacity:1}},symbol:{style:{size:10}},title:{style:{textAlign:\`left\`,textBaseline:\`middle\`,fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`}}},subTitle:{style:{textAlign:\`left\`,textBaseline:\`top\`,fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`}}}},link:{arrow:{style:{size:10}}},wordCloud:OC,wordCloud3d:kC,funnel:wC,funnel3d:TC,linearProgress:{bandWidth:30,progress:{style:{fillOpacity:1}},track:{style:{fill:{type:\`palette\`,key:\`linearProgressTrackColor\`},fillOpacity:1}}},circularProgress:{outerRadius:.8,innerRadius:.6,progress:{style:{fillOpacity:1}},track:{style:{fillOpacity:.2}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},waterfall:{seriesFieldName:{total:\`total\`,increase:\`increase\`,decrease:\`decrease\`},leaderLine:{style:{stroke:\`black\`,lineWidth:1,lineDash:[4,4]}},stackLabel:{visible:!0,offset:12,position:\`withChange\`,style:{fill:\`black\`,fontSize:{type:\`token\`,key:\`l4FontSize\`}}},label:{visible:!1,offset:12,position:\`inside\`,style:{lineWidth:2}}},gauge:{outerRadius:.8,innerRadius:.6,padAngle:1.146,segment:{style:{fillOpacity:1}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},gaugePointer:DC,treemap:{gapWidth:1,nodePadding:[5],nonLeaf:{visible:!1,style:{fillOpacity:.5}},label:{style:{fill:\`white\`,textBaseline:\`middle\`,textAlign:\`center\`,fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`}}},nonLeafLabel:{padding:24,style:{fill:\`black\`,stroke:{type:\`palette\`,key:\`backgroundColor\`},lineWidth:2,fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},textBaseline:\`middle\`,textAlign:\`center\`}}},sunburst:{innerRadius:0,outerRadius:1,startAngle:-90,endAngle:270,gap:0,labelLayout:{align:\`center\`,offset:0,rotate:\`radial\`},sunburst:{style:{stroke:{type:\`palette\`,key:\`backgroundColor\`},fillOpacity:1,cursor:\`pointer\`}},label:{visible:!0,style:{cursor:\`pointer\`,fill:{type:\`palette\`,key:\`primaryFontColor\`},fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`}}}},rangeColumn:{label:{visible:!1,offset:5,position:\`inside\`,style:{lineWidth:2,fill:{type:\`palette\`,key:\`axisMarkerFontColor\`}},minLabel:{position:\`end\`},maxLabel:{position:\`start\`}}},circlePacking:{layoutPadding:5,circlePacking:{visible:!0,style:{cursor:\`pointer\`,stroke:{type:\`palette\`,key:\`backgroundColor\`}}},label:{visible:!0,style:{cursor:\`pointer\`,fill:\`black\`,stroke:{type:\`palette\`,key:\`backgroundColor\`},lineWidth:2,fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`}}}},heatmap:{cell:{style:{shape:\`square\`,fillOpacity:1}},cellBackground:{visible:!1}},sankey:{link:{style:{fillOpacity:.15,round:!0}}},rose:{rose:{style:{fillOpacity:1}},label:{style:{lineWidth:2,stroke:{type:\`palette\`,key:\`backgroundColor\`},textAlign:\`center\`,textBaseline:\`middle\`}}},boxPlot:{boxPlot:{style:{lineWidth:1}},label:{style:{lineWidth:2}}},correlation:{centerLabel:{visible:!0,position:\`center\`,style:{fill:\`#fff\`,text:\`\`}},label:{visible:!0,position:\`bottom\`,style:{fill:\`#000\`}}},liquid:{outlinePadding:10,liquidBackground:{style:{lineWidth:0,fillOpacity:.2}},liquidOutline:{style:{lineWidth:2}}},venn:{circle:{style:{opacity:.8},state:{hover:{opacity:1}}},overlap:{style:{opacity:.8},state:{hover:{opacity:1,stroke:\`white\`,lineWidth:2}}},label:{visible:!0,style:{fill:\`white\`,textBaseline:\`middle\`,textAlign:\`center\`,fontSize:{type:\`token\`,key:\`l4FontSize\`},lineHeight:{type:\`token\`,key:\`l4LineHeight\`}}},overlapLabel:{visible:!0,style:{textBaseline:\`middle\`,textAlign:\`center\`,fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`}}}},mosaic:{label:{visible:!1,position:\`center\`,style:{lineWidth:2,stroke:{type:\`palette\`,key:\`backgroundColor\`}}},bar:{style:{lineWidth:1,stroke:{type:\`palette\`,key:\`backgroundColor\`}}}}},VC={label:{space:8},title:{space:8},maxHeight:\`30%\`,unit:{visible:!1,style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},fill:{type:\`palette\`,key:\`axisLabelFontColor\`},fontWeight:\`normal\`,fillOpacity:1}}},HC={label:{space:12,autoLimit:!0},title:{space:12,autoRotate:!0},maxWidth:\`30%\`,unit:{visible:!1,style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},fill:{type:\`palette\`,key:\`axisLabelFontColor\`},fontWeight:\`normal\`,fillOpacity:1}}},UC=Object.assign(Object.assign({},VC),{label:{space:0}}),WC={trigger:\`hover\`,bandField:{visible:!1,line:{type:\`rect\`,visible:!0,style:{fill:{type:\`palette\`,key:\`axisGridColor\`},opacity:.7,lineWidth:0,stroke:{type:\`palette\`,key:\`markLineStrokeColor\`},lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:\`normal\`,fill:{type:\`palette\`,key:\`axisMarkerFontColor\`},fontSize:{type:\`token\`,key:\`l5FontSize\`}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:\`palette\`,key:\`axisMarkerBackgroundColor\`},cornerRadius:1}}}},linearField:{visible:!1,line:{type:\`line\`,visible:!0,style:{stroke:{type:\`palette\`,key:\`markLineStrokeColor\`},fill:\`transparent\`,opacity:.7,lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:\`normal\`,fill:{type:\`palette\`,key:\`axisMarkerFontColor\`},fontSize:{type:\`token\`,key:\`l5FontSize\`}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:\`palette\`,key:\`axisMarkerBackgroundColor\`},cornerRadius:1}}}}},GC=e=>({area:{style:{visible:e,stroke:!1,fill:{type:\`palette\`,key:\`dataZoomChartColor\`}}},line:{style:{visible:e,stroke:{type:\`palette\`,key:\`dataZoomChartColor\`},lineWidth:1}}}),KC={padding:[12,0],showDetail:\`auto\`,brushSelect:!1,middleHandler:{visible:!1,background:{size:6,style:{stroke:{type:\`palette\`,key:\`dataZoomHandleStrokeColor\`},cornerRadius:2}},icon:{style:{size:4,fill:{type:\`palette\`,key:\`sliderHandleColor\`},stroke:{type:\`palette\`,key:\`dataZoomHandleStrokeColor\`},symbolType:\`M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z\`,lineWidth:.5}}},background:{size:20,style:{fill:{type:\`palette\`,key:\`sliderRailColor\`},lineWidth:0}},selectedBackground:{style:{fill:{type:\`palette\`,key:\`sliderTrackColor\`},fillOpacity:.1,outerBorder:{stroke:{type:\`palette\`,key:\`sliderTrackColor\`},strokeOpacity:.2,distance:-.5,lineWidth:1}}},selectedBackgroundChart:GC(!1),startHandler:{style:{symbolType:\`M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3
C-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C0.3-1.4,0.3-1.4,0.3-1.4z;\`,fill:{type:\`palette\`,key:\`sliderHandleColor\`},scaleX:1.2,scaleY:1.2,stroke:{type:\`palette\`,key:\`dataZoomHandleStrokeColor\`},lineWidth:1}},endHandler:{style:{symbolType:\`M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3
C-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C0.3-1.4,0.3-1.4,0.3-1.4z;\`,fill:{type:\`palette\`,key:\`sliderHandleColor\`},scaleX:1.2,scaleY:1.2,stroke:{type:\`palette\`,key:\`dataZoomHandleStrokeColor\`},lineWidth:1}},startText:{padding:8,style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fill:{type:\`palette\`,key:\`secondaryFontColor\`,default:\`#89909d\`}}},endText:{padding:8,style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fill:{type:\`palette\`,key:\`secondaryFontColor\`,default:\`#89909d\`}}},backgroundChart:GC(!0)},qC=(e,t)=>({fontSize:{type:\`token\`,key:e},fill:{type:\`palette\`,key:t},fontWeight:\`normal\`,fillOpacity:1,textBaseline:\`top\`,textAlign:\`center\`}),JC={title:{visible:!0,autoLimit:!1,autoFit:!1,style:qC(\`l1FontSize\`,\`primaryFontColor\`)},content:{visible:!0,style:qC(\`l2FontSize\`,\`tertiaryFontColor\`)}},YC={orient:\`right\`,position:\`middle\`,padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fontWeight:\`normal\`,fill:{type:\`palette\`,key:\`primaryFontColor\`}},space:12},handler:{visible:!0},startText:{style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fontWeight:\`normal\`,fill:{type:\`palette\`,key:\`secondaryFontColor\`,default:\`#89909d\`}},space:6},endText:{style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fontWeight:\`normal\`,fill:{type:\`palette\`,key:\`secondaryFontColor\`,default:\`#89909d\`}},space:6},handlerText:{style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fontWeight:\`normal\`,fill:{type:\`palette\`,key:\`secondaryFontColor\`,default:\`#89909d\`}},space:6}},XC=e=>{let t={width:200,height:8,style:{fill:{type:\`palette\`,key:\`sliderRailColor\`}}};return e?(t.width=200,t.height=8):(t.width=8,t.height=200),Object.assign(Object.assign({},YC),{rail:t,handler:{style:{symbolType:\`circle\`,lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:\`#ffffff\`},shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:\`palette\`,key:\`shadowColor\`}}}})},ZC={horizontal:XC(!0),vertical:XC(!1)},QC=e=>{let t={style:{fill:{type:\`palette\`,key:\`sliderRailColor\`}}};return e?(t.width=200,t.height=4):(t.height=200,t.width=4),Object.assign(Object.assign({},YC),{sizeBackground:{fill:{type:\`palette\`,key:\`dataZoomChartColor\`}},track:{style:{fill:{type:\`palette\`,key:\`sliderTrackColor\`,a:.8}}},rail:t,handler:{style:{symbolType:\`circle\`,lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:{type:\`palette\`,key:\`sliderTrackColor\`}},fill:{type:\`palette\`,key:\`sliderHandleColor\`}}}})},$C={horizontal:QC(!0),vertical:QC(!1)},ew={visible:!0,offset:12,position:\`top\`,space:10,nameLabel:{visible:!0,style:{textBaseline:\`middle\`,textAlign:\`left\`,fill:\`black\`,fontSize:{type:\`token\`,key:\`l6FontSize\`}}},valueLabel:{visible:!0,style:{textBaseline:\`middle\`,textAlign:\`left\`,fill:\`black\`,fontSize:{type:\`token\`,key:\`l6FontSize\`}}},background:{visible:!0,padding:{top:4,bottom:4,left:6,right:6},style:{cornerRadius:2,lineWidth:1,fill:\`white\`,stroke:\`grey\`}},leader:{visible:!1,style:{lineWidth:1,stroke:\`red\`}}},tw={area:{style:{fill:{type:\`palette\`,key:\`axisDomainColor\`,a:.25}}},label:{style:{fontSize:{type:\`token\`,key:\`l4FontSize\`},fontWeight:\`normal\`,fontStyle:\`normal\`,fill:{type:\`palette\`,key:\`primaryFontColor\`}},labelBackground:{padding:{top:2,bottom:2,right:4,left:4},style:{cornerRadius:3,fill:{type:\`palette\`,key:\`markLabelBackgroundColor\`}}}}},nw=e=>({visible:e,symbolType:\`triangle\`,size:10,style:{fill:{type:\`palette\`,key:\`markLineStrokeColor\`},stroke:null,lineWidth:0}}),rw={line:{style:{lineDash:[3,3],stroke:{type:\`palette\`,key:\`markLineStrokeColor\`}}},startSymbol:nw(!1),endSymbol:nw(!0),label:{style:{fontSize:{type:\`token\`,key:\`l4FontSize\`},fontWeight:\`normal\`,fontStyle:\`normal\`,fill:{type:\`palette\`,key:\`primaryFontColor\`}},labelBackground:{padding:{top:2,bottom:2,right:4,left:4},style:{cornerRadius:3,fill:{type:\`palette\`,key:\`markLabelBackgroundColor\`}}},refY:5}},iw={itemLine:{decorativeLine:{visible:!1},startSymbol:{size:5,visible:!0,style:{fill:{type:\`palette\`,key:\`markLineStrokeColor\`},stroke:null,lineWidth:0}},endSymbol:{style:{fill:{type:\`palette\`,key:\`markLineStrokeColor\`},stroke:null,lineWidth:0}},line:{style:{stroke:{type:\`palette\`,key:\`markLineStrokeColor\`}}}},itemContent:{offsetY:-50}};function aw(e,t){return e&&t.key in e?e[t.key]:t.default}function ow(e){return e&&e.type===\`token\`&&!!e.key}let sw={fontFamily:\`PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol\`,fontSize:14,l1FontSize:32,l1LineHeight:\`150%\`,l2FontSize:20,l2LineHeight:\`140%\`,l3FontSize:16,l3LineHeight:\`150%\`,l4FontSize:14,l4LineHeight:\`150%\`,l5FontSize:12,l5LineHeight:\`130%\`,l6FontSize:10,l6LineHeight:\`120%\`},cw={name:\`light\`,background:{type:\`palette\`,key:\`backgroundColor\`},padding:20,fontFamily:{type:\`token\`,key:\`fontFamily\`},colorScheme:SC,token:sw,mark:{text:{style:{fontSize:{type:\`token\`,key:\`l4FontSize\`},fontWeight:\`normal\`,fillOpacity:1}}},markByName:{label:{style:{fontSize:{type:\`token\`,key:\`l4FontSize\`},fontWeight:\`normal\`,fillOpacity:1,lineJoin:\`bevel\`}},area:{style:{fillOpacity:.2}},line:{style:{lineWidth:2,lineCap:\`round\`,lineJoin:\`round\`}},point:{style:{size:8,stroke:{type:\`palette\`,key:\`backgroundColor\`},lineWidth:1,fillOpacity:1}},word:{style:{fontWeight:null,fontSize:null}},fillingWord:{style:{fontWeight:null,fontSize:null}},sunburst:{style:{lineWidth:1,stroke:{type:\`palette\`,key:\`backgroundColor\`}}},circlePacking:{style:{lineWidth:1,stroke:{type:\`palette\`,key:\`backgroundColor\`}}},funnel3d:{style:{stroke:!1}},barBackground:{visible:!1,style:{fill:{type:\`palette\`,key:\`primaryFontColor\`,a:.06},stroke:\`transparent\`}}},series:BC,component:{discreteLegend:{orient:\`bottom\`,position:\`middle\`,padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fill:{type:\`palette\`,key:\`primaryFontColor\`},fontWeight:\`normal\`},space:12},pager:{textStyle:{fill:{type:\`palette\`,key:\`discreteLegendPagerTextColor\`}},handler:{style:{fill:{type:\`palette\`,key:\`discreteLegendPagerHandlerColor\`}},state:{disable:{fill:{type:\`palette\`,key:\`discreteLegendPagerHandlerDisableColor\`}}}}},item:{visible:!0,spaceCol:10,spaceRow:6,padding:2,background:{state:{selectedHover:{fill:{type:\`palette\`,key:\`hoverBackgroundColor\`}},unSelectedHover:{fill:{type:\`palette\`,key:\`hoverBackgroundColor\`}}}},shape:{space:6,style:{lineWidth:0,fillOpacity:1,opacity:1},state:{unSelected:{fillOpacity:.2,opacity:1}}},label:{space:6,style:{fill:{type:\`palette\`,key:\`secondaryFontColor\`,default:\`#89909d\`},fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},opacity:1},state:{unSelected:{fill:{type:\`palette\`,key:\`disableFontColor\`},opacity:1}}}},allowAllCanceled:!1},colorLegend:ZC,sizeLegend:$C,axis:{domainLine:{visible:!0,style:{lineWidth:1,stroke:{type:\`palette\`,key:\`axisDomainColor\`},strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:{type:\`palette\`,key:\`axisGridColor\`},strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:{type:\`palette\`,key:\`axisGridColor\`},strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,inside:!1,tickSize:4,alignWithLabel:!0,style:{lineWidth:1,stroke:{type:\`palette\`,key:\`axisDomainColor\`},strokeOpacity:1}},subTick:{visible:!1,tickSize:2,style:{lineWidth:1,stroke:{type:\`palette\`,key:\`axisDomainColor\`},strokeOpacity:1}},label:{visible:!0,inside:!1,space:10,style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},fill:{type:\`palette\`,key:\`axisLabelFontColor\`},fontWeight:\`normal\`,fillOpacity:1}},title:{space:10,padding:0,style:{fontSize:{type:\`token\`,key:\`l5FontSize\`},lineHeight:{type:\`token\`,key:\`l5LineHeight\`},fill:{type:\`palette\`,key:\`secondaryFontColor\`},fontWeight:\`normal\`,fillOpacity:1}}},axisBand:{domainLine:{visible:!0},grid:{visible:!1},subGrid:{visible:!1},tick:{visible:!0},subTick:{visible:!1}},axisLinear:{domainLine:{visible:!1},grid:{visible:!0},subGrid:{visible:!1},tick:{visible:!1},subTick:{visible:!1}},axisX:VC,axisY:HC,axisZ:UC,axisAngle:{grid:{visible:!0,style:{lineDash:[6,6]}},label:{space:5}},axisRadius:{grid:{smooth:!0,visible:!0},subGrid:{smooth:!0,visible:!1}},markLine:rw,markArea:tw,markPoint:iw,polarMarkLine:rw,polarMarkArea:tw,polarMarkPoint:iw,geoMarkPoint:iw,tooltip:{offset:{x:10,y:10},panel:{padding:{top:10,left:10,right:10,bottom:10},backgroundColor:{type:\`palette\`,key:\`popupBackgroundColor\`},border:{color:{type:\`palette\`,key:\`popupBackgroundColor\`},width:0,radius:3},shadow:{x:0,y:4,blur:12,spread:0,color:{type:\`palette\`,key:\`shadowColor\`}}},spaceRow:6,titleLabel:{fontSize:{type:\`token\`,key:\`l4FontSize\`},lineHeight:{type:\`token\`,key:\`l4LineHeight\`},fontColor:{type:\`palette\`,key:\`primaryFontColor\`},fontWeight:\`bold\`,textBaseline:\`middle\`,spacing:0},shape:{size:8,spacing:6},keyLabel:{fontSize:{type:\`token\`,key:\`l4FontSize\`},lineHeight:{type:\`token\`,key:\`l4LineHeight\`},fontColor:{type:\`palette\`,key:\`secondaryFontColor\`},textBaseline:\`middle\`,spacing:26},valueLabel:{fontSize:{type:\`token\`,key:\`l4FontSize\`},lineHeight:{type:\`token\`,key:\`l4LineHeight\`},fontColor:{type:\`palette\`,key:\`primaryFontColor\`},fontWeight:\`bold\`,textBaseline:\`middle\`,spacing:0}},dataZoom:KC,crosshair:WC,player:{visible:!0,position:\`start\`,padding:{top:20,bottom:20},slider:{space:10,trackStyle:{fill:{type:\`palette\`,key:\`sliderTrackColor\`},fillOpacity:.8},railStyle:{fill:{type:\`palette\`,key:\`sliderRailColor\`}},handlerStyle:{size:15,stroke:{type:\`palette\`,key:\`backgroundColor\`},lineWidth:2,fill:{type:\`palette\`,key:\`playerControllerColor\`}}},controller:{start:{order:0,space:10,position:\`start\`,style:{size:12,fill:{type:\`palette\`,key:\`playerControllerColor\`},fillOpacity:.8}},pause:{order:0,space:10,position:\`start\`,style:{size:12,fill:{type:\`palette\`,key:\`playerControllerColor\`},fillOpacity:.8}},backward:{order:0,space:10,position:\`start\`,style:{size:12,fill:{type:\`palette\`,key:\`playerControllerColor\`},fillOpacity:.8}},forward:{order:0,space:10,position:\`start\`,style:{size:12,fill:{type:\`palette\`,key:\`playerControllerColor\`},fillOpacity:.8}}}},brush:{style:{fill:\`#B0C8F9\`,fillOpacity:.2,stroke:\`#B0C8F9\`,lineWidth:2},brushMode:\`single\`,brushType:\`rect\`,brushMoved:!0,removeOnClick:!0,delayType:\`throttle\`,delayTime:0},indicator:JC,title:{padding:{top:4,bottom:20},textStyle:{fontSize:{type:\`token\`,key:\`l3FontSize\`},lineHeight:{type:\`token\`,key:\`l3LineHeight\`},fill:{type:\`palette\`,key:\`primaryFontColor\`}},subtextStyle:{fontSize:{type:\`token\`,key:\`l4FontSize\`},lineHeight:{type:\`token\`,key:\`l4LineHeight\`},fill:{type:\`palette\`,key:\`tertiaryFontColor\`}}},mapLabel:ew,poptip:{visible:!0,position:\`auto\`,padding:8,titleStyle:{fontSize:{type:\`token\`,key:\`l5FontSize\`},fontWeight:\`bold\`,fill:{type:\`palette\`,key:\`primaryFontColor\`}},contentStyle:{fontSize:{type:\`token\`,key:\`l5FontSize\`},fill:{type:\`palette\`,key:\`primaryFontColor\`}},panel:{visible:!0,fill:{type:\`palette\`,key:\`popupBackgroundColor\`},cornerRadius:3,lineWidth:0,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:\`palette\`,key:\`shadowColor\`},size:0,space:12}},totalLabel:{visible:!1,offset:5,overlap:{clampForce:!0,strategy:[]},smartInvert:!1,animation:!1,style:{fontSize:{type:\`token\`,key:\`l4FontSize\`},fill:{type:\`palette\`,key:\`primaryFontColor\`}}},scrollBar:{horizontal:{height:10,slider:{style:{fill:{type:\`palette\`,key:\`scrollBarSliderColor\`}}}},vertical:{width:10,slider:{style:{fill:{type:\`palette\`,key:\`scrollBarSliderColor\`}}}}}},animationThreshold:2e3},lw={name:\`dark\`,colorScheme:{default:{dataScheme:xC,palette:{backgroundColor:\`#202226\`,borderColor:\`#404349\`,shadowColor:\`rgba(0,0,0,0.1)\`,hoverBackgroundColor:\`#404349\`,sliderRailColor:\`#404349\`,sliderHandleColor:\`#202226\`,sliderTrackColor:\`#4284FF\`,popupBackgroundColor:\`#404349\`,primaryFontColor:\`#fdfdfd\`,secondaryFontColor:\`#bbbdc3\`,tertiaryFontColor:\`#888c93\`,axisLabelFontColor:\`#888c93\`,disableFontColor:\`#55595f\`,axisMarkerFontColor:\`#202226\`,axisGridColor:\`#404349\`,axisDomainColor:\`#4b4f54\`,dataZoomHandleStrokeColor:\`#bbbdc3\`,dataZoomChartColor:\`#55595F\`,playerControllerColor:\`#4284FF\`,scrollBarSliderColor:\`rgba(255,255,255,0.3)\`,axisMarkerBackgroundColor:\`#fdfdfd\`,markLabelBackgroundColor:\`#404349\`,markLineStrokeColor:\`#bbbdc3\`,dangerColor:\`#eb4b4b\`,warningColor:\`#f0bd30\`,successColor:\`#14b267\`,infoColor:\`#4284ff\`,discreteLegendPagerTextColor:\`#BBBDC3\`,discreteLegendPagerHandlerColor:\`#BBBDC3\`,discreteLegendPagerHandlerDisableColor:\`#55595F\`,emptyCircleColor:\`#bbbdc3\`,linearProgressTrackColor:\`#404349\`}}},component:{dataZoom:{selectedBackground:{style:{fillOpacity:.4,outerBorder:{strokeOpacity:.4}}}}}},uw=(e,t,n)=>{if(f(t))return e;let r=t[0];return f(r)?e:t.length===1?(e[r]=n,e):(f(e[r])&&(typeof t[1]==\`number\`?e[r]=[]:e[r]={}),uw(e[r],t.slice(1),n))};function q(e){let t=-1,n=arguments.length<=1?0:arguments.length-1;for(;++t<n;)ne(e,t+1<1||arguments.length<=t+1?void 0:arguments[t+1],!0,!0);return e}let J=class e{static registerChart(t,n){e._charts[t]=n}static registerSeries(t,n){e._series[t]=n}static registerComponent(t,n,r){e._components[t]={cmp:n,alwaysCheck:r}}static registerMark(t,n){e._marks[t]=n}static registerRegion(t,n){e._regions[t]=n}static registerTransform(t,n){e.transforms[t]=n}static registerLayout(t,n){e._layout[t]=n}static registerAnimation(t,n){e._animations[t]=n}static registerImplement(t,n){e._implements[t]=n}static registerChartPlugin(t,n){e._chartPlugin[t]=n}static registerComponentPlugin(t,n){e._componentPlugin[t]=n}static createChart(t,n,r){return e._charts[t]?new e._charts[t](n,r):null}static createChartSpecTransformer(t,n){if(!e._charts[t])return null;let r=e._charts[t];return new r.transformerConstructor(Object.assign({seriesType:r.seriesType},n))}static createRegion(t,n,r){return e._regions[t]?new e._regions[t](n,r):null}static createRegionSpecTransformer(t,n){return e._regions[t]?new e._regions[t].transformerConstructor(n):null}static createSeries(t,n,r){return e._series[t]?new e._series[t](n,r):null}static createSeriesSpecTransformer(t,n){return e._series[t]?new e._series[t].transformerConstructor(n):null}static createMark(t,n,r){if(!e._marks[t])return null;let i=new e._marks[t](n,r);return i.type===\`group\`&&i.setMarkConfig({interactive:!1}),i}static getComponents(){return Object.values(e._components)}static getComponentInKey(t){return e._components[t].cmp}static getLayout(){return Object.values(e._layout)}static getLayoutInKey(t){return e._layout[t]}static getSeries(){return Object.values(e._series)}static getSeriesInType(t){return e._series[t]}static getRegionInType(t){return e._regions[t]}static getAnimationInKey(t){return e._animations[t]}static getImplementInKey(t){return e._implements[t]}static getSeriesMarkMap(t){return e._series[t]?e._series[t].mark:{}}static getChartPlugins(){return Object.values(e._chartPlugin)}static getComponentPlugins(){return Object.values(e._componentPlugin)}static getComponentPluginInType(t){return e._componentPlugin[t]}static registerFormatter(e){this._formatter=e}static getFormatter(){return this._formatter}};function dw(e,...t){return q(fw(e),...t.map(fw))}function fw(e){if(!e)return e;let t=function(e){return e&&=Object.keys(e).reduce(((t,n)=>{let r=e[n];return t[n]=sC(r),t}),{}),e}(e.colorScheme);return Object.assign({},e,{colorScheme:t,token:e.token??{},series:Object.assign({},e.series)})}J._charts={},J._series={},J._components={},J._marks={},J._regions={},J._animations={},J._implements={},J._chartPlugin={},J._componentPlugin={},J.transforms={fields:nn,filter:(e,t)=>{let{callback:n}=t;return n&&(e=e.filter(n)),e},fold:(e,t)=>{let{fields:n,key:r,value:i,retains:a}=t,o=[];for(let t=0;t<e.length;t++)n.forEach((s=>{let c={};if(c[r]=s,c[i]=e[t][s],a)a.forEach((n=>{c[n]=e[t][n]}));else for(let r in e[t])n.indexOf(r)===-1&&(c[r]=e[t][r]);o.push(c)}));return o}},J.dataParser={csv:hn,dsv:mn,tsv:gn},J._layout={};let pw=[\`animationThreshold\`,\`colorScheme\`,\`name\`,\`padding\`];function mw(e,t,n,r){if(!e)return e;t||=e.colorScheme,n||=e.token;let i={};return Object.keys(e).forEach((a=>{let o=e[a];pw.includes(a)?i[a]=o:g(o)?aC(o)?i[a]=iC(o,t,r):ow(o)?i[a]=aw(n,o):i[a]=mw(o,t,n,r):i[a]=o})),i}let hw={[cw.name]:cw},gw=cw.name,_w=new Map(Object.keys(hw).map((e=>[e,hw[e]]))),vw=new Map(Object.keys(hw).map((e=>[e,mw(hw[e])]))),yw=new Map(Object.keys(hw).map((e=>[e,e===gw]))),bw=(e,t)=>{if(!e)return;let n=ww(t);_w.set(e,n),vw.set(e,mw(n)),yw.set(e,!0)},xw=(e=gw,t=!1)=>(yw.has(e)&&!yw.get(e)&&bw(e,_w.get(e)),t?vw.get(e):_w.get(e)),Sw=e=>_w.delete(e)&&vw.delete(e)&&yw.delete(e),Cw=e=>!!v(e)&&_w.has(e),ww=e=>{let t=e.type??gw;return dw({},xw(t),e)};class Tw{static registerInstance(e){Tw.instances.set(e.id,e)}static unregisterInstance(e){Tw.instances.delete(e.id)}static getInstance(e){return Tw.instances.get(e)}static instanceExist(e){return Tw.instances.has(e)}static forEach(e,t=[],n){let r=P(t);return Tw.instances.forEach(((t,n,i)=>{r.includes(n)||e(t,n,i)}),n)}}Tw.instances=new Map;let Ew=class e{static registerTheme(e,t){bw(e,t)}static getTheme(e,t=!1){return xw(e,t)}static removeTheme(e){return Sw(e)}static themeExist(e){return Cw(e)}static getDefaultTheme(){return e.themes.get(gw)}static setCurrentTheme(t){e.themeExist(t)&&(e._currentThemeName=t,Tw.forEach((e=>e?.setCurrentTheme(t))))}static getCurrentTheme(t=!1){return e.getTheme(e._currentThemeName,t)}static getCurrentThemeName(){return e._currentThemeName}};function Dw(e,t){return v(e)?Ew.themeExist(e)?Ew.getTheme(e,t):{}:m(e)?e:{}}function Ow(e,t={data:e=>e}){if(!e)return e;if(e.constructor===Object){let n={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t[r]){n[r]=t[r](e[r]);continue}n[r]=Ow(e[r],t)}return n}return y(e)?e.map((e=>Ow(e,t))):e}function kw(e,t){if(!e)return e;if(g(e)){let n={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(v(e[r])&&t.getFunction(e[r])){n[r]=t.getFunction(e[r]);continue}n[r]=kw(e[r],t)}return n}return y(e)?e.map((e=>kw(e,t))):e}Ew.themes=_w,Ew._currentThemeName=gw;let Aw=\`\${K}_MEASURE_CANVAS_ID\`,jw=\`\${K}_DEFAULT_DATA_INDEX\`,Mw=\`\${K}_DEFAULT_DATA_KEY\`,Nw=\`\${K}_DEFAULT_DATA_SERIES_FIELD\`,Pw=\`\${K}_DEFAULT_SERIES_STYLE_NAME\`,Fw=\`\${K}_STACK_KEY\`,Iw=\`\${K}_STACK_START\`,Lw=\`\${K}_STACK_END\`,Rw=\`\${K}_STACK_START_PERCENT\`,zw=\`\${K}_STACK_END_PERCENT\`,Bw=\`\${K}_STACK_START_OffsetSilhouette\`,Vw=\`\${K}_STACK_END_OffsetSilhouette\`,Hw=\`\${K}_STACK_TOTAL\`,Uw=\`\${K}_STACK_TOTAL_PERCENT\`,Ww=\`\${K}_STACK_TOTAL_TOP\`,Gw=\`\${K}_STACK_TOTAL_BOTTOM\`,Kw=\`\${K}_MOSAIC_VALUE_START_PERCENT\`,qw=\`\${K}_MOSAIC_VALUE_END_PERCENT\`,Jw=\`\${K}_MOSAIC_CAT_START_PERCENT\`,Yw=\`\${K}_MOSAIC_CAT_END_PERCENT\`,Xw=\`\${K}_SEGMENT_START\`,Zw=\`\${K}_SEGMENT_END\`;function Qw(e,t){for(let n=0;n<t.length;n++){let r=t[n],i=$w(e,r.key);i?i.operations=[...new Set(i.operations.concat(r.operations))]:e.push(r)}return e}function $w(e,t){return e.find((e=>e.key===t))}function eT(e,t){if(!e)return t??null;let n=e.getFields();return n&&n[t]?n[t].alias??t:t??null}function tT(e,t,n){let r=e.getStackSort(),i={},a=null;return r&&(a={},e.getSeries().forEach((e=>{let t=e.getSeriesField();if(t){let n=e.getRawDataStatisticsByField(t);n.values&&(a[t]||(a[t]={lastIndex:0,sort:{}}),n.values.forEach(((e,n)=>{e in a[t].sort||(a[t].sort[e]=a[t].lastIndex,a[t].lastIndex++)})))}}))),e.getSeries().forEach((e=>{let r=e.getStackData(),o=e.getStackValue(),s=e.getStackValueField(),c=!n||n(e);r&&s&&c&&(i[o]=i[o]??{groupField:r.groupField,nodes:{}},oT(e,r,i[o],s,t,a))})),r?nT(i):i}function nT(e,t){for(let t in e)e[t].sortDatums?.length?(e[t].sortDatums.sort(((e,t)=>e.index-t.index)),e[t].values=e[t].sortDatums.map((e=>e.datum))):nT(e[t].nodes);return e}function rT(e,t){if(\`values\`in e&&e.values.length){let n=function(e,t){return e.reduce(((e,n)=>{let r=t?+n[t]:+n;return C(r)&&(e+=r),e}),0)}(e.values,t),r=function(e,t){let n=[];return e.forEach((e=>{let r=+e[t];C(r)&&n.push(r)})),n.length===0?null:fe(n)}(e.values,zw);e.values.forEach((e=>{e[Hw]=n,e[Uw]=r}))}else for(let n in e.nodes)rT(e.nodes[n],t)}function iT(e){if(!e.values.length)return;let t=e.values[e.values.length-1][Lw]/2;for(let n=0;n<e.values.length;n++)e.values[n][Bw]=e.values[n][Iw]-t,e.values[n][Vw]=e.values[n][Lw]-t}function aT(e,t,n,r,i={key:Fw,start:Iw,end:Lw,startPercent:Rw,endPercent:zw,max:Ww,min:Gw}){let a=r&&p(i.min),o=r&&p(i.max);if(e.values.length>0){let r=0,s=0,c=1,l=0,u=null,d=null,f=e.values.length;for(let n=0;n<f;n++){let c=e.values[t?f-1-n:n];l=c[i.end],l>=0?(c[i.start]=r,r+=c[i.end],c[i.end]=r):(c[i.start]=s,s+=c[i.end],c[i.end]=s),c[i.key]=e.key,o&&(delete c[i.max],(!d||c[i.end]>d[i.end])&&(d=c)),a&&(delete c[i.min],(!u||c[i.start]<u[i.start])&&(u=c))}if(o&&d&&(d[i.max]=!0),a&&u&&(u[i.min]=!0),n)for(let n=0;n<f;n++){let a=e.values[t?f-1-n:n];l=a[i.end];let o=l>=0?r:s;c=l>=0?1:-1,a[i.startPercent]=o===0?0:Math.min(1,a[i.start]/o)*c,a[i.endPercent]=o===0?0:Math.min(1,a[i.end]/o)*c}}for(let a in e.nodes)aT(e.nodes[a],t,n,r,i)}function oT(e,t,n,r,i,a,o){if(\`values\`in t)if(i&&t.values.forEach((e=>e[Lw]=function(e){if(C(e))return e;let t=+e;return C(t)?t:0}(e[r]))),n.series.push({s:e,values:t.values}),a){let r=e.getSeriesField();t.values.forEach((t=>{n.sortDatums.push({series:e,datum:t,index:r?a[r].sort[t[r]]:0})}))}else n.values.push(...t.values);else for(let s in t.nodes){let c=o?\`\${o}_\${s}\`:s;n.nodes[s]||(n.nodes[s]={values:[],series:[],nodes:{},sortDatums:[],key:c},p(t.nodes[s]?.groupField)&&(n.nodes[s].groupField=t.nodes[s].groupField)),oT(e,t.nodes[s],n.nodes[s],r,i,a,c)}}function sT(e={}){let t=Object.assign({},e);if(d(e.style)?t.style=(t,n,r,i)=>lT(e.style(t,n,r,i)):A(e.style)||(t.style=lT(e.style)),!A(e.state)){let n={};Object.keys(e.state).forEach((t=>{d(e.state[t])?n[t]=(n,r,i,a)=>lT(e.state[t](n,r,i,a)):A(e.state[t])||(n[t]=lT(e.state[t]))})),t.state=n}return t}function cT(e){if(A(e))return null;let t={};return Object.keys(e).forEach((n=>{d(e[n])?t[n]=(t,r,i,a)=>lT(e[n](t,r,i,a)):A(e[n])||(t[n]=lT(e[n]))})),t}function lT(e){return e!=null&&e.angle&&(e.angle=tt(e.angle)),e}var uT,dT,Y,fT,pT,mT,hT,gT,_T,vT,yT,bT,X,xT,ST;(function(e){e.enter=\`enter\`,e.update=\`update\`,e.exit=\`exit\`,e.group=\`group\`,e.connectNulls=\`connectNulls\`})(uT||={}),function(e){e.enter=\`enter\`,e.update=\`update\`,e.exit=\`exit\`,e.unChange=\`unChange\`}(dT||={}),function(e){e.arc=\`arc\`,e.arc3d=\`arc3d\`,e.area=\`area\`,e.image=\`image\`,e.line=\`line\`,e.path=\`path\`,e.rect=\`rect\`,e.rect3d=\`rect3d\`,e.rule=\`rule\`,e.shape=\`shape\`,e.symbol=\`symbol\`,e.text=\`text\`,e.richtext=\`richtext\`,e.polygon=\`polygon\`,e.pyramid3d=\`pyramid3d\`,e.circle=\`circle\`,e.cell=\`cell\`,e.interval=\`interval\`,e.group=\`group\`,e.glyph=\`glyph\`,e.component=\`component\`,e.largeRects=\`largeRects\`,e.largeSymbols=\`largeSymbols\`}(Y||={}),function(e){e.axis=\`axis\`,e.grid=\`grid\`,e.legend=\`legend\`,e.slider=\`slider\`,e.label=\`label\`,e.datazoom=\`datazoom\`,e.player=\`player\`,e.title=\`title\`,e.scrollbar=\`scrollbar\`}(fT||={}),function(e){e[e.player=1]=\`player\`,e[e.rollUp=2]=\`rollUp\`,e[e.drillDown=3]=\`drillDown\`,e[e.slider=4]=\`slider\`,e[e.datazoom=5]=\`datazoom\`,e[e.legend=6]=\`legend\`,e[e.scrollbar=7]=\`scrollbar\`,e[e.brush=8]=\`brush\`,e[e.normal=9]=\`normal\`}(pT||={}),function(e){e.lineAxis=\`lineAxis\`,e.circleAxis=\`circleAxis\`}(mT||={}),function(e){e.lineAxisGrid=\`lineAxisGrid\`,e.circleAxisGrid=\`circleAxisGrid\`}(hT||={}),function(e){e.discreteLegend=\`discreteLegend\`,e.colorLegend=\`colorLegend\`,e.sizeLegend=\`sizeLegend\`}(gT||={}),function(e){e.lineCrosshair=\`lineCrosshair\`,e.rectCrosshair=\`rectCrosshair\`,e.sectorCrosshair=\`sectorCrosshair\`,e.circleCrosshair=\`circleCrosshair\`,e.polygonCrosshair=\`polygonCrosshair\`,e.ringCrosshair=\`ringCrosshair\`}(_T||={}),function(e){e.symbolLabel=\`symbolLabel\`,e.rectLabel=\`rectLabel\`,e.lineLabel=\`lineLabel\`,e.dataLabel=\`dataLabel\`}(vT||={}),function(e){e.continuousPlayer=\`continuousPlayer\`,e.discretePlayer=\`discretePlayer\`}(yT||={}),function(e){e.before=\`before\`,e.layouting=\`layouting\`,e.reevaluate=\`reevaluate\`,e.after=\`after\`}(bT||={}),function(e){e.BEFORE_EVALUATE_DATA=\`beforeEvaluateData\`,e.AFTER_EVALUATE_DATA=\`afterEvaluateData\`,e.BEFORE_EVALUATE_SCALE=\`beforeEvaluateScale\`,e.AFTER_EVALUATE_SCALE=\`afterEvaluateScale\`,e.BEFORE_PARSE_VIEW=\`beforeParseView\`,e.AFTER_PARSE_VIEW=\`afterParseView\`,e.BEFORE_TRANSFORM=\`beforeTransform\`,e.AFTER_TRANSFORM=\`afterTransform\`,e.BEFORE_CREATE_VRENDER_STAGE=\`beforeCreateVRenderStage\`,e.AFTER_CREATE_VRENDER_STAGE=\`afterCreateVRenderStage\`,e.BEFORE_CREATE_VRENDER_LAYER=\`beforeCreateVRenderLayer\`,e.AFTER_CREATE_VRENDER_LAYER=\`afterCreateVRenderLayer\`,e.BEFORE_STAGE_RESIZE=\`beforeStageResize\`,e.AFTER_STAGE_RESIZE=\`afterStageResize\`,e.BEFORE_VRENDER_DRAW=\`beforeVRenderDraw\`,e.AFTER_VRENDER_DRAW=\`afterVRenderDraw\`,e.BEFORE_MARK_JOIN=\`beforeMarkJoin\`,e.AFTER_MARK_JOIN=\`afterMarkJoin\`,e.BEFORE_MARK_UPDATE=\`beforeMarkUpdate\`,e.AFTER_MARK_UPDATE=\`afterMarkUpdate\`,e.BEFORE_MARK_STATE=\`beforeMarkState\`,e.AFTER_MARK_STATE=\`afterMarkState\`,e.BEFORE_MARK_ENCODE=\`beforeMarkEncode\`,e.AFTER_MARK_ENCODE=\`afterMarkEncode\`,e.BEFORE_DO_LAYOUT=\`beforeDoLayout\`,e.AFTER_DO_LAYOUT=\`afterDoLayout\`,e.BEFORE_MARK_LAYOUT_END=\`beforeMarkLayoutEnd\`,e.AFTER_MARK_LAYOUT_END=\`afterMarkLayoutEnd\`,e.BEFORE_DO_RENDER=\`beforeDoRender\`,e.AFTER_DO_RENDER=\`afterDoRender\`,e.BEFORE_MARK_RENDER_END=\`beforeMarkRenderEnd\`,e.AFTER_MARK_RENDER_END=\`afterMarkRenderEnd\`,e.BEFORE_CREATE_VRENDER_MARK=\`beforeCreateVRenderMark\`,e.AFTER_CREATE_VRENDER_MARK=\`afterCreateVRenderMark\`,e.BEFORE_ADD_VRENDER_MARK=\`beforeAddVRenderMark\`,e.AFTER_ADD_VRENDER_MARK=\`afterAddVRenderMark\`,e.AFTER_VRENDER_NEXT_RENDER=\`afterVRenderNextRender\`,e.BEFORE_ELEMENT_UPDATE_DATA=\`beforeElementUpdateData\`,e.AFTER_ELEMENT_UPDATE_DATA=\`afterElementUpdateData\`,e.BEFORE_ELEMENT_STATE=\`beforeElementState\`,e.AFTER_ELEMENT_STATE=\`afterElementState\`,e.BEFORE_ELEMENT_ENCODE=\`beforeElementEncode\`,e.AFTER_ELEMENT_ENCODE=\`afterElementEncode\`,e.ANIMATION_START=\`animationStart\`,e.ANIMATION_END=\`animationEnd\`,e.ELEMENT_ANIMATION_START=\`elementAnimationStart\`,e.ELEMENT_ANIMATION_END=\`elementAnimationEnd\`,e.ALL_ANIMATION_START=\`allAnimationStart\`,e.ALL_ANIMATION_END=\`allAnimationEnd\`}(X||={}),function(e){e.signal=\`signal\`,e.data=\`data\`,e.scale=\`scale\`,e.coordinate=\`coordinate\`,e.mark=\`mark\`}(xT||={}),function(e){e.active=\`active\`,e.selected=\`selected\`,e.highlight=\`highlight\`,e.blur=\`blur\`}(ST||={});let CT=\`__vgrammar_scene_item__\`,wT=[Y.line,Y.area],TT=[Y.arc3d,Y.rect3d,Y.pyramid3d],ET=[{}],DT=[\`key\`],OT=\`_mo_hide_\`;function kT(e,t){return P(e).reduce(((e,n)=>{let r=v(n)?t.getGrammarById(n):n;return r&&e.push(r),e}),[])}function AT(e,t){if(f(e))return[];if(!d(n=e)&&n?.signal){let n=e.signal;if(v(n))return P(t.getGrammarById(n));if(n?.grammarType===\`signal\`)return[n]}else if(function(e){return!d(e)&&!!e?.callback}(e))return kT(e.dependency,t);var n;return[]}function jT(e){return d(e)||e?.signal||!!e?.callback}function MT(e,t,n,r){if(f(e))return e;if(d(e))return r?e.call(null,n,r,t):e.call(null,n,t);if(e.signal){let n=e.signal;return v(n)?t?.[n]:n.output()}return e.callback?r?e.callback.call(null,n,r,t):e.callback.call(null,n,t):e}function NT(e,t){return PT(e)?e.output():t[e]}let PT=e=>e&&!f(e.grammarType),FT=e=>d(e)?e:t=>t[e];function IT(e){return!!e?.scale}function LT(e){return!!e?.field}function RT(e,t){if(!e)return[];let n=[];return e.scale&&(n=PT(e.scale)?[e.scale]:P(t.getScaleById(e.scale))),n.concat(AT(e,t))}function zT(e,t){switch(t){case\`line\`:return e.some((e=>[\`x\`,\`y\`,\`defined\`].includes(e)));case\`area\`:return e.some((e=>[\`x\`,\`y\`,\`x1\`,\`y1\`,\`defined\`].includes(e)));case\`largeRects\`:return e.some((e=>[\`x\`,\`y\`,\`width\`,\`y1\`].includes(e)));case\`largeSymbols\`:return e.some((e=>[\`x\`,\`y\`].includes(e)))}return!1}function BT(e,t,n,r,i){n&&(jT(n)?t.forEach((t=>{let i=MT(n,r,t.datum,e);Object.assign(t.nextAttrs,i)})):Object.keys(n).forEach((a=>{let o=n[a],s=i&&!function(e,t){if([\`x\`,\`y\`,\`dx\`,\`dy\`].includes(t))return!0;switch(e){case Y.arc:return[\`innerRadius\`,\`outerRadius\`,\`startAngle\`,\`endAngle\`].includes(t);case Y.group:case Y.rect:case Y.image:return[\`width\`,\`height\`,\`y1\`].includes(t);case Y.path:case Y.shape:return[\`path\`,\`customPath\`].includes(t);case Y.line:return t===\`defined\`;case Y.area:return[\`x1\`,\`y1\`,\`defined\`].includes(t);case Y.rule:return[\`x1\`,\`y1\`].includes(t);case Y.symbol:return t===\`size\`;case Y.polygon:return t===\`points\`;case Y.text:return t===\`text\`}return!1}(e.mark.markType,a)?[t[0]]:t;if(IT(o)){let e=NT(o.scale,r),t=o?.offset??0,n=!f(o.band)&&e.bandwidth?e.bandwidth()*o.band:null,i=v(o?.field),c=i?Wm(o.field):null,l=i?null:f(o?.value)?0:e.scale?.call(e,o.value);s.forEach((r=>{i&&(l=e.scale?.call(e,c(r.datum))),r.nextAttrs[a]=S(l)||S(n)?l+t+n:l}))}else if(LT(o)){let e=Wm(o.field);s.forEach((t=>{t.nextAttrs[a]=e(t.datum)}))}else s.forEach((t=>{t.nextAttrs[a]=MT(o,r,t.datum,e)}))})))}function VT(e,t,n,r){if(!e)return null;if(jT(e))return MT(e,r,t,n);let i={};return Object.keys(e).forEach((a=>{let o=e[a];if(IT(o)){let e=NT(o.scale,r),n=o?.offset??0,s=!f(o.band)&&e.bandwidth?e.bandwidth()*o.band:null,c=v(o?.field),l=c?Wm(o.field):null,u=c?e.scale?.call(e,l(t)):f(o?.value)?0:e.scale?.call(e,o.value);i[a]=S(u)||S(s)?u+n+s:u}else LT(o)?i[a]=Wm(o.field)(t):i[a]=MT(o,r,t,n)})),i}class HT{constructor(e,t,n,r){this.channelEncoder={},this.marks=e,t&&this.registerChannelEncoder(t),n&&this.registerDefaultEncoder(n),this.progressiveChannels&&this.registerProgressiveChannels(r)}getMarks(){return this.marks}registerChannelEncoder(e,t){return v(e)?this.channelEncoder[e]=t:Object.assign(this.channelEncoder,e),this}registerFunctionEncoder(e){return this.functionEncoder=e,this}registerDefaultEncoder(e){return this.defaultEncoder=e,this}registerProgressiveChannels(e){return this.progressiveChannels=P(e),this}getChannelEncoder(){return this.channelEncoder}getFunctionEncoder(){return this.functionEncoder}getDefaultEncoder(){return this.defaultEncoder}getProgressiveChannels(){return this.progressiveChannels}}class Z{static registerPlotMarks(e,t){Z._plotMarks[e]=t}static createPlotMark(e,t){return Z._plotMarks[e]?new Z._plotMarks[e](t):null}static registerMark(e,t){Z._marks[e]=t}static createMark(e,t,n){return Z._marks[e]?new Z._marks[e](t,e,n):null}static hasMark(e){return!!Z._marks[e]}static getMark(e){return Z._marks[e]}static registerComponent(e,t){Z._components[e]=t}static createComponent(e,t,n,r){let i=Z._components[e];return i?new i(t,n,r):null}static hasComponent(e){return!!Z._components[e]}static registerGraphicComponent(e,t){Z._graphicComponents[e]=t}static createGraphicComponent(e,t,n){let r=Z._graphicComponents[e];return r?r(t,n):null}static registerTransform(e,t,n){Z._transforms[e]=Object.assign(t,{type:e,isBuiltIn:!!n})}static getTransform(e){return Z._transforms[e]}static unregisterRuntimeTransforms(){Object.keys(Z._transforms).forEach((e=>{Z._transforms[e]&&!Z._transforms[e].isBuiltIn&&(Z._transforms[e]=null)}))}static registerGrammar(e,t,n){Z._grammars[e]={grammarClass:t,specKey:n??e}}static createGrammar(e,t,n){let r=Z._grammars[e]?.grammarClass;return r?new r(t,n):null}static getGrammars(){return this._grammars}static getGlyph(e){return Z._glyphs[e]}static createInteraction(e,t,n){let r=Z._interactions[e];return r?new r(t,n):null}static hasInteraction(e){return!!Z._interactions[e]}}Z._plotMarks={},Z._marks={},Z._components={},Z._graphicComponents={},Z._transforms={},Z._grammars={},Z._glyphs={},Z._animations={},Z._interactions={},Z._graphics={},Z._stageEventPlugins={},Z.registerGlyph=(e,t,n,r,i)=>(Z._glyphs[e]=new HT(t,n,r,i),Z._glyphs[e]),Z.registerAnimationType=(e,t)=>{Z._animations[e]=t},Z.getAnimationType=e=>Z._animations[e],Z.registerInteraction=(e,t)=>{Z._interactions[e]=t},Z.registerGraphic=(e,t)=>{Z._graphics[e]=t},Z.getGraphicType=e=>Z._graphics[e],Z.createGraphic=(e,t)=>{let n=Z._graphics[e];return n?n(t):null},Z.registerDefaultLayout=e=>{Z.defaultLayout=e},Z.getDefaultLayout=()=>Z.defaultLayout,Z.registerStageEventPlugin=(e,t)=>{Z._stageEventPlugins[e]=t},Z.getStageEventPlugin=e=>Z._stageEventPlugins[e];function UT(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=Z.getGraphicType(t)?Z.createGraphic(t,n):Z.createGraphicComponent(t,n,{skipDefault:e?.spec?.skipTheme});return r||xe.getInstance().error(\`create \${t} graphic failed!\`),r}let WT=e=>{e&&(e[CT]=null,e.release(),e.parent&&e.parent.removeChild(e))},GT=[\`fillOpacity\`],KT=(e,t,n)=>t===\`fillOpacity\`?(e.fillOpacity=n.fillOpacity??1,[\`fillOpacity\`]):[],qT={rect3d:[{channels:[\`x\`,\`y\`,\`z\`,\`x1\`,\`y1\`,\`width\`,\`height\`,\`length\`],transform:(e,t,n)=>{C(t.width)||!C(t.x1)&&C(n.width)?(e.x=Math.min(n.x??0,n.x1??1/0),e.width=n.width):C(t.x1)||!C(t.width)&&C(n.x1)?(e.x=Math.min(n.x,n.x1),e.width=Math.abs(n.x1-n.x)):(e.x=Math.min(n.x??0,n.x1??1/0),e.width=n.width),C(t.height)||!C(t.y1)&&C(n.height)?(e.y=Math.min(n.y??0,n.y1??1/0),e.height=n.height):C(t.y1)||!C(t.height)&&C(n.y1)?(e.y=Math.min(n.y,n.y1),e.height=Math.abs(n.y1-n.y)):(e.y=Math.min(n.y??0,n.y1??1/0),e.height=n.height),C(t.length)||!C(t.z1)&&C(n.length)?(e.z=Math.min(n.z??0,n.z1??1/0),e.length=n.length):C(t.z1)||!C(t.length)&&C(n.z1)?(e.z=Math.min(n.z,n.z1),e.length=Math.abs(n.z1-n.z)):(e.z=Math.min(n.z??0,n.z1??1/0),e.length=n.length)},storedAttrs:\`sizeAttrs\`}],[Y.text]:[{channels:[\`text\`,\`limit\`,\`autoLimit\`,\`maxLineWidth\`,\`textType\`,\`_originText\`],transform:(e,t,n)=>{let r=n.limit??1/0,i=n.autoLimit??1/0,a=Math.min(r,i),o=g(n.text)&&!f(n.text.text),s=o?n.text.text:n.text;e.maxLineWidth=a===1/0?n.maxLineWidth:a,o||n.textType?n.text.type===\`rich\`||n.textType===\`rich\`?e.textConfig=s:n.text.type===\`html\`?(e.html=s,e.text=n._originText??\`\`,e.renderable=!1):n.text.type===\`react\`?(e.react=s,e.text=n._originText??\`\`,e.renderable=!1):e.text=s:e.text=s},storedAttrs:\`limitAttrs\`}],[Y.rule]:[{channels:[\`x\`,\`y\`,\`x1\`,\`y1\`],transform:(e,t,n)=>{e.points=function(e){let{x:t,y:n,x1:r,y1:i}=e;return C(t)&&C(n)&&C(r)&&C(i)?[{x:t,y:n},{x:r,y:i}]:[]}(n),e.x=0,e.y=0},storedAttrs:\`pointAttrs\`}],[Y.symbol]:[{channels:[\`shape\`,\`symbolType\`],transform:(e,t,n)=>{e.symbolType=t.shape??t.symbolType}},{channels:[\`image\`,\`fill\`,\`background\`],transform:(e,t,n)=>{t.image?(e.background=t.image,e.fill=!1):n.image?(e.background=n.image,e.fill=!1):(e.fill=n.fill,e.background=n.background)},storedAttrs:\`imageAttrs\`}]},JT=(e,t,n,r)=>{let i={},a=t?Object.keys(t):[],o=v(e)?qT[e]:e;if(o&&o.length){let e=[];a.forEach((a=>{let s=!1;o.forEach(((o,c)=>{if(o.channels.includes(a)){if(!e[c])if(o.storedAttrs){let e=function(e,t,n,r,i,a){let o=i.getGraphicAttribute(e,!1,a);if(o)return t.forEach((e=>{e in r&&(o[e]=r[e])})),o;let s={};return t.forEach((e=>{s[e]=r[e]})),n[e]=s,s}(o.storedAttrs,o.channels,i,t,n,r);o.transform(i,t,e)}else o.transform(i,t,null);e[c]=!0,s=!0}})),s||(GT.includes(a)?KT(i,a,t):i[a]=t[a])}))}else a.forEach((e=>{GT.includes(e)?KT(i,e,t):i[e]=t[e]}));return i},YT=(e,t,n)=>!(!f(e)||!f(t))||!f(e)&&!f(t)&&(n===\`lineDash\`?((e,t)=>e.length===t.length&&e.join(\`-\`)===t.join(\`-\`))(e,t):n===\`stroke\`||n===\`fill\`?((e,t)=>{if(e===t)return!0;if(typeof e!=typeof t||v(e)||e.gradient!==t.gradient)return!1;let n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every((n=>n===\`stops\`?((e,t)=>{if(e===t)return!0;let n=(e&&e.length)??0;return n===((t&&t.length)??0)&&n!==0&&e.every(((e,n)=>!e&&!t[n]||e&&t[n]&&e.color===t[n].color&&e.offset===t[n].offset))})(e[n],t[n]):e[n]===t[n]))})(e,t):e===t),XT=[\`stroke\`,\`strokeOpacity\`,\`lineDash\`,\`lineDashOffset\`,\`lineCap\`,\`lineJoin\`,\`lineWidth\`,\`miterLimit\`],ZT=[\`fill\`,\`fillOpacity\`,\`background\`,\`texture\`,\`texturePadding\`,\`textureSize\`,\`textureColor\`].concat(XT);function QT(e,t,n){if(!e||e.length<=1)return null;let r=n?.mark?.markType===\`area\`?ZT:XT,i=[],a=null;return e.forEach(((e,t)=>{a&&r.every((t=>YT(a[t],e[t],t)))||(i.length&&(i[i.length-1].endIndex=t),a=e,i.push({attrs:a,startIndex:t}))})),i.length>=2?i.map((e=>{let n=$T(e.attrs);return n.points=t.slice(e.startIndex,f(e.endIndex)?t.length:e.endIndex),n})):null}function $T(e){let t={};if(!e)return t;let n=[\`x\`,\`y\`,\`x1\`,\`y1\`,\`defined\`,\`size\`,\`width\`,\`height\`,\`context\`];return Object.keys(e).forEach((r=>{n.includes(r)||(t[r]=e[r])})),t}class eE{constructor(e){this.data=null,this.states=[],this.diffState=dT.enter,this.isReserved=!1,this.runtimeStatesEncoder=null,this.items=[],this.getStateAttrs=(e,t)=>{let n=!f(this.runtimeStatesEncoder?.[e]),r=n?Object.assign(Object.assign({},this.mark.getSpec().encode?.[e]),this.runtimeStatesEncoder[e]):this.mark.getSpec().encode?.[e];if(!r)return{};if(d(r))return r(this.getDatum(),this,e,t);if(!n&&this.graphicItem.states?.[e])return this.graphicItem.states[e];let i=this.items.map((e=>Object.assign({},e,{nextAttrs:{}})));BT(this,i,r,this.mark.parameters());let a=this.transformElementItems(i,this.mark.markType);return this.graphicItem.states?this.graphicItem.states[e]||(this.graphicItem.states[e]=a):this.graphicItem.states={[e]:a},a},this.mark=e}initGraphicItem(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.graphicItem)return;let t=this.mark.getAttributeTransforms();if(this.graphicItem=this.mark.addGraphicItem(t?JT(t,e,this):e,this.groupKey),!this.graphicItem)return;let{graphicName:n}=this.mark.getSpec();v(n)?this.graphicItem.name=n:d(n)&&(this.graphicItem.name=n(this)),this.graphicItem[CT]=this,t&&(this.graphicItem.onBeforeAttributeUpdate=e=>this.mark?JT(t,e,this):e),this.clearGraphicAttributes(),this.mark.needAnimate()&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(Object.assign({},e)),this.setFinalGraphicAttributes(Object.assign({},e)))}updateGraphicItem(){if(!this.graphicItem)return;this.diffState===dT.exit?this.graphicItem.releaseStatus=\`willRelease\`:this.graphicItem.releaseStatus=void 0;let e=this.mark.animate?.getAnimationConfigs(\`state\`);e&&e.length!==0&&(this.graphicItem.stateAnimateConfig=e[0].originConfig)}getGraphicItem(){return this.graphicItem}removeGraphicItem(){var e,t;this.graphicItem&&((t=(e=this.graphicItem.animates)?.forEach)==null||t.call(e,(e=>e.stop()))),this.graphicItem&&=(WT(this.graphicItem),this.graphicItem[CT]=null,null)}resetGraphicItem(){this.graphicItem&&=null}getBounds(){return this.graphicItem?.AABBBounds}getStates(){return this.states}updateData(e,t,n){this.mark.emit(X.BEFORE_ELEMENT_UPDATE_DATA,{groupKey:e,data:t,key:n},this),this.data=t;let r=FT(n);return this.items=t.map((e=>({datum:e,key:r(e),view:this.mark.view,nextAttrs:{}}))),this.groupKey=e,this.key=this.mark.isCollectionMark()?e:this.items?.[0].key,this.mark.emit(X.AFTER_ELEMENT_UPDATE_DATA,{groupKey:e,data:t,key:n},this),this.items}state(e,t){let n=this.mark.isCollectionMark(),r=this.states,i=P(MT(e,t,this.getDatum(),this)),a=this.mark.getSpec()?.stateSort;a&&i.length&&i.sort(a);let o=i.length!==r.length||i.some(((e,t)=>e!==r[t]));this.states=i,!n&&o&&this.diffState===dT.unChange&&(this.diffState=dT.update)}encodeGraphic(e){this.coordinateTransformEncode(this.items);let t=this.transformElementItems(this.items,this.mark.markType);e&&Object.assign(t,e),this.graphicItem?(this.graphicItem.clearStates(),this.graphicItem.states={},this.graphicItem.stateProxy=null,OT in this.graphicItem.attribute&&\`visible\`in t&&delete this.graphicItem.attribute[OT],this.applyGraphicAttributes(t)):this.initGraphicItem(t),this.diffState!==dT.enter&&this.diffState!==dT.update||!this.states.length||this.useStates(this.states),this.mark.markType===Y.shape&&(this.graphicItem.datum=this.items[0].datum),this.items.forEach((e=>{e.nextAttrs={}})),this._setCustomizedShape()}_setCustomizedShape(){if(!this.graphicItem)return;let e=this.mark.getSpec()?.setCustomizedShape;e&&(this.graphicItem.pathProxy=t=>e(this.data,t,new pi))}encodeItems(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=this.mark.isCollectionMark(),a=t[uT.update],o=t[uT.enter],s=t[uT.exit],c=this.mark.isLargeMode()||i&&!this.mark.getSpec().enableSegments;this.diffState===dT.enter?(o&&BT(this,e,o,r,c),a&&BT(this,e,a,r,c)):this.diffState===dT.update?((i&&o||n)&&BT(this,e,o,r,c),a&&BT(this,e,a,r,c)):this.diffState===dT.exit&&s&&(n&&BT(this,e,o,r,c),BT(this,e,s,r,c))}coordinateTransformEncode(e){if(!this.mark.coord||this.mark.markType===\`arc\`||!0===this.mark.disableCoordinateTransform)return;let t=this.mark.coord.output();e.forEach((e=>{let n=e.nextAttrs,r=t.convert(n);Object.assign(n,r)}))}hasStateAnimation(){let e=this.mark.animate?.getAnimationConfigs(\`state\`);return e&&e.length>0}clearStates(e){let t=u(e)?e:this.hasStateAnimation();this.states=[],this.graphicItem&&this.graphicItem.clearStates(t),this.runtimeStatesEncoder&&={}}_updateRuntimeStates(e,t){this.runtimeStatesEncoder||={},this.runtimeStatesEncoder[e]=t}hasState(e){return this.states&&e&&this.states.includes(e)}updateStates(e){if(!this.graphicItem)return!1;let t=this.states.slice(),n=this.mark.getSpec().encode,r=!1,i=!1;return Object.keys(e).forEach((a=>{if(!a)return;let o=e[a];if(m(o)&&!ce(o,this.runtimeStatesEncoder?.[a]))t.includes(a)?r=!0:t.push(a),this._updateRuntimeStates(a,o),i=!0;else if(o)!t.includes(a)&&n!=null&&n[a]&&(t.push(a),i=!0);else if(t.length){let e=t.filter((e=>e!==a));e.length!==t.length&&(i=!0,t=e),this.runtimeStatesEncoder&&this.runtimeStatesEncoder[a]&&(this.runtimeStatesEncoder[a]=null)}})),r&&this.graphicItem.clearStates(),!!i&&(this.useStates(t),!0)}addState(e,t){if(!this.graphicItem)return!1;if(t&&v(e)&&!ce(t,this.runtimeStatesEncoder?.[e])){let n=this.states.slice();return n.includes(e)?this.graphicItem.clearStates():n.push(e),this._updateRuntimeStates(e,t),this.useStates(n),!0}let n=this.mark.getSpec().encode,r=P(e).reduce(((e,t)=>(t&&!e.includes(t)&&n!=null&&n[t]&&e.push(t),e)),this.states.slice());return r.length!==this.states.length&&(this.useStates(r),!0)}removeState(e){if(!this.graphicItem)return!1;let t=P(e);if(!t.length)return!1;let n=this.states.filter((e=>!t.includes(e)));return n.length!==this.states.length&&(this.runtimeStatesEncoder&&t.forEach((e=>{this.runtimeStatesEncoder[e]=null})),this.useStates(n),!0)}useStates(e,t){if(!this.graphicItem)return!1;this.mark.emit(X.BEFORE_ELEMENT_STATE,{states:e},this);let n=this.mark.getSpec()?.stateSort;n&&e.sort(n),this.states=e;let r=u(t)?t:this.hasStateAnimation();return this.graphicItem.stateProxy=this.getStateAttrs,this.graphicItem.useStates(this.states,r),this.mark.emit(X.AFTER_ELEMENT_STATE,{states:e},this),!0}diffAttributes(e){let t={},n=this.getFinalGraphicAttributes();for(let r in e)te(n,r)&&ce(n[r],e[r])||(t[r]=e[r]);return t}transformElementItems(e,t,n){let r=e[0];if(!r.nextAttrs||Object.keys(r.nextAttrs).length===0)return{};let i=r.nextAttrs;if(function(e){return[Y.line,Y.area,Y.largeRects,Y.largeSymbols].includes(e)}(t)&&e&&e.length&&f(r.nextAttrs?.points)&&(!0===n||zT(Object.keys(r.nextAttrs),this.mark.markType))){let n=this.mark.getSpec(),r=this.getGraphicAttribute(\`points\`,!1),a=this.getGraphicAttribute(\`segments\`,!1),o=n.enableSegments,s=this.mark.getSpec().encode?.[uT.connectNulls],c=e.map((e=>e.nextAttrs)),l=this.mark.isProgressive();if(i=$T(i),t===Y.line||t===Y.area){let n=function(e,t,n,r){return e&&e.length&&(e.length!==1||t)?e.some((e=>zT(Object.keys(e.nextAttrs),\`line\`)))?e.map(((e,t)=>{let i=e.nextAttrs,{x:a,y:o,x1:s,y1:c,defined:l}=n?.[t]??{};return f(i.x)&&(i.x=a),f(i.y)&&(i.y=o),f(i.defined)&&!1===l&&(i.defined=!1),i.context=e.key,r&&(f(i.x1)&&(i.x1=s),f(i.y1)&&(i.y1=c)),i})):n??[]:[]}(e,!0,r,t===Y.area);if(l)i.segments=(this.graphicItem?.attribute?.segments??[]).concat([{points:n}]);else if(s){if(i.segments=function(e,t,n){if(!e||e.length<=1)return null;let r=!!n&&n.mark.getSpec().enableSegments,i,a,o=[],s=null;if(e.forEach(((e,n)=>{s=t[n],s&&!1!==s.defined?(i||(a={items:[],points:[]},o.push(a)),a.points.push(s),a.items.push(e),!1===i&&(a.isConnect=!0,a={items:[],points:[]},o.push(a)),i=!0):i=!1})),o=o.filter((e=>e.points.length>0)),o.length>=2){let e=[];return o.forEach((t=>{if(t.isConnect)return void e.push({points:t.points,isConnect:!0});if(r){let r=QT(t.items,t.points,n);if(r)return void r.forEach((t=>{e.push(t)}))}let i=$T(t.items[0]);i.points=t.points,e.push(i)})),e}return r?QT(e,t,n):null}(c,n,this),i.segments&&i.segments.some((e=>e.isConnect))){let e=VT(s,this.getDatum(),this,this.mark.parameters());e&&i.segments.forEach((t=>{t.isConnect&&Object.assign(t,e)}))}i.points=n}else if(o){let e=n&&n.length!==0?n:function(e){return e?e.reduce(((e,t)=>e.concat(t.points)),[]):null}(a),t=QT(c,e,this);t?(i.segments=t,i.points=null):(i.segments=null,i.points=e),i=function(e,t){if(!e||!e.segments||!e.segments.length)return e;let n=t?.mark?.markType===\`area\`?[\`fillOpacity\`,\`strokeOpacity\`]:[\`strokeOpacity\`],r={};return Object.keys(e).forEach((t=>{n.includes(t)||(r[t]=e[t])})),r}(i,this)}else i.points=n,i.segments=null}else t===Y.largeRects?i.points=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(!e||!e.length||e.length===1&&!t)return[];let r=new Float32Array(4*e.length);return e.forEach(((e,t)=>{let i=e.nextAttrs,a=i.x??n[4*t],o=i.y??n[4*t+1],s=i.width??n[4*t+2],c=i.y1??n[4*t+3];r[4*t]=a,r[4*t+1]=o,r[4*t+2]=s,r[4*t+3]=c-o})),r}(e,!0,r):t===Y.largeSymbols&&(i.points=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(!e||!e.length||e.length===1&&!t)return[];let r=new Float32Array(2*e.length);return e.forEach(((e,t)=>{let i=e.nextAttrs,a=i.x??n[2*t],o=i.y??n[2*t+1];r[2*t]=a,r[2*t+1]=o})),r}(e,!0,r))}return i}applyGraphicAttributes(e){if(!A(e))if(this.mark.needAnimate()){let t=this.diffAttributes(e),n=this.getPrevGraphicAttributes()??{},r=this.getFinalGraphicAttributes()??{};Object.keys(t).forEach((e=>{n[e]=this.getGraphicAttribute(e),r[e]=t[e]})),this.setNextGraphicAttributes(t),this.setPrevGraphicAttributes(n),this.setFinalGraphicAttributes(r);let i=(this.mark.animate?.getElementAnimators(this).filter((e=>!e.animationOptions.timeline.controlOptions?.ignoreLoopFinalAttributes||!e.animationOptions.timeline.loop))||[]).reduce(((e,t)=>Object.assign(e,t.getEndAttributes())),{}),a=Object.assign({},i,r);this.graphicItem.setAttributes(a)}else this.graphicItem.setAttributes(e)}getGraphicAttribute(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.graphicItem)return;if(t){let t,n=this.getPrevGraphicAttributes();if(!f(t=j(n,e)))return t}let n=this.mark.getAttributeTransforms(),r=[e];if(n&&n.length){let t=n.find((t=>t.storedAttrs&&t.channels.includes(e)));t&&(r=[t.storedAttrs,e])}return j(this.graphicItem?.attribute,r)}setGraphicAttribute(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(!this.graphicItem)return;let r=this.getFinalGraphicAttributes(),i=this.getPrevGraphicAttributes();n&&r&&(r[e]=t),i&&!te(i,e)&&(i[e]=this.graphicItem.attribute[e]),this.graphicItem.setAttribute(e,t)}setGraphicAttributes(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this.graphicItem)return;let n=this.getFinalGraphicAttributes(),r=this.getPrevGraphicAttributes();Object.keys(e).forEach((i=>{n&&t&&(n[i]=e[i]),r&&!te(r,i)&&(r[i]=this.graphicItem.attribute[i])})),this.graphicItem.setAttributes(e)}getFinalGraphicAttributes(){return this.graphicItem.finalAttrs}setFinalGraphicAttributes(e){this.graphicItem.finalAttrs=e}getPrevGraphicAttributes(){return this.graphicItem.prevAttrs}setPrevGraphicAttributes(e){this.graphicItem.prevAttrs=e}getNextGraphicAttributes(){return this.graphicItem.nextAttrs}getFinalAnimationAttribute(e){return this.getFinalGraphicAttributes()?.[e]??this.getGraphicAttribute(e)}getFinalAnimationAttributes(){return this.getFinalGraphicAttributes()??this.graphicItem.attribute}setNextGraphicAttributes(e){this.graphicItem.nextAttrs=e}clearChangedGraphicAttributes(){this.graphicItem&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null))}clearGraphicAttributes(){this.graphicItem&&(this.graphicItem.prevAttrs&&this.setPrevGraphicAttributes(null),this.graphicItem.nextAttrs&&this.setNextGraphicAttributes(null),this.graphicItem.finalAttrs&&this.setFinalGraphicAttributes(null))}remove(){this.graphicItem&&=(WT(this.graphicItem),null)}release(){this.removeGraphicItem(),this.mark=null,this.data=null,this.items=null}getItemAttribute(e){if(this.items?.length)return this.mark.isCollectionMark()?f(e)?this.items.map((e=>e.nextAttrs)):this.items.map((t=>t.nextAttrs?.[e])):f(e)?this.items[0].nextAttrs:this.items[0].nextAttrs?.[e]}setItemAttributes(e){var t;(t=this.items)!=null&&t.length&&(this.mark.isCollectionMark()?y(e)&&this.items.forEach(((t,n)=>{Object.assign(t.nextAttrs,e[n])})):Object.assign(this.items[0].nextAttrs,e))}getItem(){return this.mark&&this.mark.isCollectionMark()?this.items??[]:this.items?.[0]}getDatum(){return this.mark&&this.mark.isCollectionMark()?this.data??[]:this.data?.[0]}}class tE{constructor(e,t){this.references=new Map,this.view=e,this.depend(t?.dependency)}getStartState(){return null}depend(e){this.references.clear(),P(e).map((e=>v(e)?this.view.getGrammarById(e):e)).filter((e=>!f(e))).forEach((e=>{this.references.set(e,(this.references.get(e)??0)+1)}))}parameters(){let e={};return this.references.forEach(((t,n)=>{p(n.id())&&(e[n.id()]=n.output())})),e}bind(){(this.getEvents()??[]).forEach((e=>{e.type&&e.handler&&(y(e.type)?e.type.forEach((t=>{t&&t!==\`none\`&&this.view.addEventListener(t,e.handler)})):e.type!==\`none\`&&this.view.addEventListener(e.type,e.handler))}))}unbind(){(this.getEvents()??[]).forEach((e=>{e.type&&e.handler&&(y(e.type)?e.type.forEach((t=>{t&&t!==\`none\`&&this.view.removeEventListener(t,e.handler)})):e.type!==\`none\`&&this.view.removeEventListener(e.type,e.handler))}))}start(e){}reset(e){}dispatchEvent(e,t){this.view.emit(\`\${this.type}:\${e}\`,t),e===\`start\`&&this.options.onStart?this.options.onStart(t):e===\`reset\`&&this.options.onReset?this.options.onReset(t):e===\`update\`&&this.options.onUpdate?this.options.onUpdate(t):e===\`end\`&&this.options.onEnd&&this.options.onEnd(t)}}let nE=(e,t)=>{if(!t||!e)return null;let n={};return e.forEach((e=>{let r=e&&e.getSpec(),i=r&&r.encode;i&&t.forEach((t=>{t&&i[t]&&(n[t]||(n[t]=[]),n[t].push(e))}))})),n};class rE extends tE{constructor(e,t){super(e,t),this.type=rE.type,this._resetType=[],this.resetAll=()=>{let{state:e,reverseState:t}=this.options;this._statedElements&&this._statedElements.length&&(this.clearAllStates(e,t),this.dispatchEvent(\`reset\`,{elements:this._statedElements,options:this.options}),this._statedElements=[])},this.handleStart=e=>{this.start(e.element)},this.handleReset=e=>{if(!this._statedElements||!this._statedElements.length)return;let t=e.element,n=t&&this._marks&&this._marks.includes(t.mark);(this._resetType.includes(\`view\`)&&!n||this._resetType.includes(\`self\`)&&n)&&this.resetAll()},this.options=Object.assign({},rE.defaultOptions,t),this._marks=e.getMarksBySelector(this.options.selector),this._stateMarks=nE(this._marks,[this.options.state,this.options.reverseState])}getStartState(){return this.options.state}getEvents(){let e=this.options.triggerOff,t=this.options.trigger,n=[{type:t,handler:this.handleStart}],{eventNames:r,resetType:i}=(e=>{let t=P(e),n=[],r=[];return t.forEach((e=>{e===\`empty\`?n.push(\`view\`):v(e)&&e!==\`none\`?e.includes(\`view:\`)?(r.push(e.replace(\`view:\`,\`\`)),n.push(\`view\`)):(r.push(e),n.push(\`self\`)):S(e)&&n.push(\`timeout\`)})),{eventNames:r,resetType:n}})(e);return r.forEach((e=>{e&&(y(t)?!t.includes(e):e!==t)&&n.push({type:e,handler:this.handleReset})})),this._resetType=i,n}start(e){let{state:t,reverseState:n,isMultiple:r}=this.options;if(e&&this._marks&&this._marks.includes(e.mark))if(e.hasState(t)){if(this._resetType.includes(\`self\`)){let r=this._statedElements&&this._statedElements.filter((t=>t!==e));r&&r.length?this._statedElements=this.updateStates(r,this._statedElements,t,n):this.resetAll()}}else this._timer&&clearTimeout(this._timer),e.addState(t),this._statedElements=this.updateStates(r&&this._statedElements?[...this._statedElements,e]:[e],this._statedElements,t,n),this.dispatchEvent(\`start\`,{elements:this._statedElements,options:this.options}),this._resetType.includes(\`timeout\`)&&(this._timer=setTimeout((()=>{this.resetAll()}),this.options.triggerOff));else this._resetType.includes(\`view\`)&&this._statedElements&&this._statedElements.length&&this.resetAll()}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.state,this.options.reverseState]):this.resetAll()}}rE.type=\`element-select\`,rE.defaultOptions={state:ST.selected,trigger:\`click\`};class iE extends tE{constructor(e,t){super(e,t),this.type=iE.type,this.handleStart=e=>{this.start(e.element)},this.handleReset=e=>{if(!this._statedElements||!this._statedElements.length)return;let t=e.element;if(t){let e=this._marks&&this._marks.includes(t.mark);this._resetType!==\`view\`||e?this._resetType===\`self\`&&e&&this.resetAll():this.resetAll()}},this.options=Object.assign({},iE.defaultOptions,t),this._marks=e.getMarksBySelector(this.options.selector),this._stateMarks=nE(this._marks,[this.options.highlightState,this.options.blurState])}getStartState(){return this.options.highlightState}getEvents(){let e=this.options.triggerOff,t=[{type:this.options.trigger,handler:this.handleStart}],n=e;return v(e)&&e.includes(\`view:\`)?(n=e.replace(\`view:\`,\`\`),this._resetType=\`view\`):this._resetType=\`self\`,t.push({type:n,handler:this.handleReset}),t}resetAll(){let{highlightState:e,blurState:t}=this.options;this._lastElement&&(this.clearAllStates(e,t),this.dispatchEvent(\`reset\`,{elements:[this._lastElement],options:this.options}),this._lastElement=null,this._statedElements=null)}start(e){if(e&&this._marks&&this._marks.includes(e.mark)){let{highlightState:t,blurState:n}=this.options;if(this._lastElement===e)return;this._statedElements=this.updateStates([e],this._statedElements,t,n),this._lastElement=e,this.dispatchEvent(\`start\`,{elements:[e],options:this.options})}else this._lastElement&&this._resetType===\`view\`&&this.resetAll()}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}iE.type=\`element-highlight\`,iE.defaultOptions={highlightState:ST.highlight,blurState:ST.blur,trigger:\`pointerover\`,triggerOff:\`pointerout\`};class aE{updateStates(e,t,n,r){return e&&e.length?(n&&r?t&&t.length?(this.toggleReverseStateOfElements(e,t,r),this.toggleStateOfElements(e,t,n)):this.addBothStateOfElements(e,n,r):n&&(t&&t.length?this.toggleStateOfElements(e,t,n):this.addStateOfElements(e,n)),e):null}toggleReverseStateOfElements(e,t,n){t.forEach((e=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(e.mark)&&e.addState(n)})),e.forEach((e=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(e.mark)&&e.removeState(n)}))}toggleStateOfElements(e,t,n){t.forEach((e=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(e.mark)&&e.removeState(n)})),e.forEach((e=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(e.mark)&&e.addState(n)}))}addBothStateOfElements(e,t,n){this._marks.forEach((r=>{var i;let a=n&&this._stateMarks[n]&&this._stateMarks[n].includes(r),o=t&&this._stateMarks[t]&&this._stateMarks[t].includes(r);(a||o)&&((i=r.elements)==null||i.forEach((r=>{e&&e.includes(r)?o&&r.addState(t):a&&r.addState(n)})))}))}addStateOfElements(e,t){this._marks.forEach((n=>{var r;let i=t&&this._stateMarks[t]&&this._stateMarks[t].includes(n);i&&((r=n.elements)==null||r.forEach((n=>{e&&e.includes(n)&&i&&n.addState(t)})))}))}clearAllStates(e,t){this._statedElements&&this._statedElements.length&&this._marks.forEach((n=>{n&&n.elements&&(t&&this._stateMarks[t]&&this._stateMarks[t].includes(n)&&n.elements.forEach((e=>{e.removeState(t)})),e&&this._stateMarks[e]&&this._stateMarks[e].includes(n)&&n.elements.forEach((t=>{this._statedElements.includes(t)&&t.removeState(e)})))}))}}let oE=()=>{ue(rE,aE),Z.registerInteraction(rE.type,rE)},sE=()=>{ue(iE,aE),Z.registerInteraction(iE.type,iE)},cE=(e,t)=>PT(e)?e.output():e&&m(e)?d(e.callback)?n=>e.callback(n,t):d(e.value)?e.value(t):e:e,lE=(e,t)=>e&&(m(e)?Object.keys(e).reduce(((n,r)=>{let i=e[r];return n[r]=cE(i,t),n}),{}):e.map((e=>cE(e,t)))),uE=-1;class dE extends c{constructor(e){super(),this.spec={},this.references=new Map,this.targets=[],this.transforms=[],this.view=e,this.uid=++uE}parse(e){return this.id(e.id),this.name(e.name),this.depend(e.dependency),this}depend(e){if(this.spec?.dependency){let e=P(this.spec.dependency).map((e=>v(e)?this.view.getGrammarById(e):e));this.detach(e)}this.spec.dependency=e;let t=P(e).map((e=>v(e)?this.view.getGrammarById(e):e));return this.attach(t),this.commit(),this}addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=t,r.raw=t),n&&n.target&&(r.target=n.target),this.on(e,r),this}removeEventListener(e,t){return t?this.off(e,t):this.off(e),this}emit(e){for(var t,n,r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(n=(t=this.view)?.emit)==null||n.call(t,e,...i),super.emit(e,...i)}emitGrammarEvent(e){var t=[...arguments].slice(1);return super.emit(e,...t)}evaluateTransform(e,t,n){if(!e||!e.length)return t;let r=t,i=0,a=e.length;for(;i<a;){let t=e[i];this.emit(X.BEFORE_TRANSFORM,t.type),r=t.transform(t.isRawOptions?t.options:lE(t.options,n),r,n,this.view),i++,this.emit(X.AFTER_TRANSFORM,t.type)}return r}set(e){return!1}id(e){return arguments.length?(this.view.grammars.unrecord(this),this._id=e,this.view.grammars.record(this),this):this._id}name(e){return arguments.length?(this._name=e,this):this._name}attach(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return P(e).filter((e=>!f(e))).forEach((n=>{f(e)||(n.targets.includes(this)||n.targets.push(this),this.references.set(n,(this.references.get(n)??0)+t))})),this}detach(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return P(e).filter((e=>!f(e))).forEach((e=>{let n=this.references.get(e)-t;n>0?this.references.set(e,n-1):(this.references.delete(e),e.targets.includes(this)&&(e.targets=e.targets.filter((e=>e!==this))))})),this}detachAll(){this.references.forEach(((e,t)=>{this.detach(t,e)}))}link(e){this.grammarSource=e}run(){let e=this.grammarSource?.output(),t=this.parameters();return this.evaluate(e,t)}commit(){this.view.commit(this)}parameters(){let e={};return this.references.forEach(((t,n)=>{p(n.id())&&(e[n.id()]=n.output())})),e}getSpec(){return this.spec}reuse(e){return this}clear(){this.spec=null,this.view=null}release(){this.clear()}setFunctionSpec(e,t){return f(this.spec[t])||this.detach(AT(this.spec[t],this.view)),this.spec[t]=e,this.attach(AT(e,this.view)),this.commit(),this}}let fE=(e,t,n)=>{var r;if(e===\`callback\`&&d(t))return{references:[],value:{callback:t,dependency:[]}};if(!f(t.data)){let e=n.getDataById(t.data);return{references:[e],value:e}}if(!f(t.customized)){let e=n.getCustomizedById(t.customized);return{references:[e],value:e}}if(!f(t.scale)){let e=n.getScaleById(t.scale);return{references:[e],value:e}}if((r=t)&&(r.signal||r.callback)){let e=AT(t,n);return{references:e,value:t.callback?{value:t.callback,dependency:e}:e?.[0]??t}}return{value:t}},pE=(e,t)=>{let n=Z.getTransform(e.type);if(!n)return;let r={},i=[];return Object.keys(e).forEach((n=>{var a;if(n===\`type\`)return;let o=e[n];if(n===\`dependency\`)return void(o?.length&&(i=i.concat(kT(o,t))));let s=((e,t,n)=>{if(f(t))return{value:t};if(y(t)){let r=t.map((t=>fE(e,t,n)));return{references:r.reduce(((e,t)=>(t.references&&e.concat(t.references),e)),[]),value:r.map((e=>e.value))}}return fE(e,t,n)})(n,o,t);s&&((a=s.references)!=null&&a.length&&(i=i.concat(s.references)),r[n]=s.value)})),{markPhase:n.markPhase,transform:n.transform,canProgressive:n.canProgressive,type:n.type,options:r,references:i}},mE=(e,t)=>{if(e?.length){let n=[],r=[];return e.forEach((e=>{var i;let a=pE(e,t);a&&((i=a.references)!=null&&i.length&&(r=r.concat(a.references)),n.push(a))})),{transforms:n,refs:r}}return null},hE={csv:hn,dsv:mn,tsv:gn,json:function(e){if(!v(e))return P(e);try{return P(JSON.parse(e))}catch{return[]}}};class gE extends dE{constructor(e,t,n){super(e),this.grammarType=\`data\`,this.spec={},this._dataIDKey=\`VGRAMMAR_DATA_ID_KEY_\${this.uid}\`,this._loadTasks=[],this._postFilters=[],this.ingest=e=>{let t=function(e,t){if(f(e))return e;if(d(e))return e.call(null,t);if(e.signal){let n=e.signal;return v(n)?t?.[n]:n.output()}return e.callback?e.callback.call(null,t):e}(e.format,this.parameters());return this._input=((e,t)=>{if(!t||!hE[t.type])return P(e);let n=t.type===\`dsv\`?{delimiter:t.delimiter}:{};return hE[t.type](e,n,new Sn(new bn))})(e.values,t),this._input},this.load=e=>{if(e.values)return this.ingest(e)},this.relay=e=>e[0],this._loadTasks=[],f(t)||this.values(t,n)}parse(e){return super.parse(e),this._isLoaded=!1,this.source(e.source,e.format,!1),this.url(e.url,e.format,!1),this.values(e.values,e.format,!1),this.transform(e.transform),this.parseLoad(e),this.commit(),this}parseDataSource(e){let t=[],n=[],r=e.format?AT(e.format,this.view)[0]:null;if(r&&t.push(r),e.values){let r=AT(e.values,this.view)[0];r&&t.push(r),n.push({type:\`ingest\`,transform:this.ingest,isRawOptions:!0,options:{values:e.values,format:e.format}})}else if(e.url){let i=AT(e.url,this.view)[0];i&&t.push(i),n.push({type:\`load\`,transform:this.load,options:{url:i??e.url,format:r??e.format}})}else if(e.source){let r=[];P(e.source).forEach((e=>{let n=PT(e)?e:this.view.getDataById(e);n&&(t.push(n),r.push(n))})),r.length&&(n.push({type:\`relay\`,transform:this.relay,options:r}),this.grammarSource=r[0])}return{transforms:n,refs:t}}evaluate(e,t){this.view.emit(X.BEFORE_EVALUATE_DATA);let n=this._isLoaded?this.transforms:this._loadTasks.concat(this.transforms);this.grammarSource&&(this._input=e);let r=this.evaluateTransform(n,this._input,t),i=this._evaluateFilter(r,t);return this.setValues(i),this._isLoaded=!0,this.view.emit(X.AFTER_EVALUATE_DATA),this}output(){return this._values}getDataIDKey(){return this._dataIDKey}values(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],r=Object.assign({},this.spec,{values:e,format:t});return f(e)||(r.url=void 0,r.source=void 0),n?this.parseLoad(r):this}url(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],r=Object.assign({},this.spec,{url:e,format:t});return f(e)||(r.values=void 0,r.source=void 0),n?this.parseLoad(r):this}source(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],r=Object.assign({},this.spec,{source:e,format:t});return f(e)||(r.values=void 0,r.url=void 0),n?this.parseLoad(r):this}parseLoad(e){this.detach(this.parseDataSource(this.spec).refs),this.spec=e;let t=this.parseDataSource(this.spec);return this.attach(t.refs),this._loadTasks=t.transforms,this._isLoaded=!1,this.commit(),this}setValues(e){this._values=P(e).map(((e,t)=>{let n=e===Object(e)?e:{data:e};return n[this._dataIDKey]=t,n}))}field(e){return this._values.map((t=>t[e]))}transform(e){let t=mE(this.spec.transform,this.view);t&&(this.detach(t.refs),this.transforms=[]),this.spec.transform=e;let n=mE(this.spec.transform,this.view);return n&&(this.attach(n.refs),this.transforms=n.transforms),this.commit(),this}getValue(){return this._values}getInput(){return this._input}addDataFilter(e){return this._postFilters=this._postFilters.concat(P(e)),this._postFilters.sort(((e,t)=>(e.rank??0)-(t.rank??0))),this}removeDataFilter(e){let t=P(e);return this._postFilters=this._postFilters.filter((e=>!t.includes(e))),this}_evaluateFilter(e,t){return this._postFilters.reduce(((e,n)=>n.filter(e,t)),e)}reuse(e){return e.grammarType!==this.grammarType||(this._isLoaded=!1,this._values=e.output()),this}clear(){super.clear(),this._input=null,this._values=null}}function _E(e,t,n,r){let i,a,o=e[t];for(;t>n&&(a=Math.floor((t-1)/2),i=e[a],o&&i&&r(o,i)<0);)e[t]=i,t=a;return e[t]=o}function vE(e,t,n,r){let i=t,a=n??e.length,o=e[t],s,c=2*t+1;for(;c<a;)s=c+1,s<a&&r(e[c],e[s])>=0&&(c=s),e[t]=e[c],c=2*(t=c)+1;return e[t]=o,_E(e,t,i,r)}class yE{constructor(e){this.compare=e,this.nodes=[]}size(){return this.nodes.length}last(){return this.nodes[0]}validate(){for(let e=this.nodes.length-1;e>0;--e){let t=Math.floor((e-1)/2);if(this.compare(this.nodes[t],this.nodes[e])>0)return!1}return!0}push(e){if(this.nodes.includes(e)){let t=this.nodes.indexOf(e);return _E(this.nodes,t,0,this.compare),vE(this.nodes,t,null,this.compare)}return this.nodes.push(e),_E(this.nodes,this.nodes.length-1,0,this.compare)}remove(e){if(this.nodes.includes(e)){let t=this.nodes.indexOf(e);this.nodes=this.nodes.slice(0,t).concat(this.nodes.slice(t+1)),_E(this.nodes,t,0,this.compare),vE(this.nodes,t,null,this.compare)}}pop(){let e=this.nodes.pop(),t;return this.nodes.length?(t=this.nodes[0],this.nodes[0]=e,vE(this.nodes,0,null,this.compare)):t=e,t}clear(){this.nodes=[]}}class bE{constructor(e){this.list=[],this.ids={},this.idFunc=e||Vm}add(e){let t=this.idFunc(e);return this.ids[t]||(this.ids[t]=1,this.list.push(e)),this}remove(e){let t=this.idFunc(e);return this.ids[t]&&(this.ids[t]=0,this.list=this.list.filter((t=>t!==e))),this}forEach(e,t){t?this.list.slice().reverse().forEach(e):this.list.forEach(e)}filter(e){return this.list.filter(e)}get length(){return this.list.length}getElementByIndex(e){return this.list[e]}}class xE{constructor(){this.grammars=[],this.logger=xe.getInstance(),this._curRank=0,this._committed=new bE((e=>e.uid)),this._heap=new yE(((e,t)=>e?.qrank-t?.qrank)),this._beforeRunner=null,this._afterRunner=null,this._updateCounter=0,this._finishFirstRender=!1}add(e){if(e)return this._setRankOfGrammar(e),this.commit(e),!this.grammars.includes(e)&&(this.grammars.push(e),!0)}remove(e){e&&(this._committed.remove(e),this._heap.remove(e),this.grammars=this.grammars.filter((t=>t!==e)))}_setRankOfGrammar(e){e&&(e.rank=++this._curRank)}_reRank(e){let t=[e];for(;t.length;){let n=t.pop();this._setRankOfGrammar(n);let r=n.targets;r&&r.forEach((n=>{t.push(n),n===e&&this.logger.error(\`Cycle detected in dataflow graph.\`)}))}}_enqueue(e){e&&(e.qrank=e.rank,this._heap.push(e))}_logGrammarRunInfo(e){if(this.logger.canLogError()){let t=[{key:\`id\`,value:e.id()},{key:\`name\`,value:e.name()}].reduce(((e,t,n)=>f(t.value)?e:\`\${e}\${n?\` , \`:\`\`}\${t.key}: \${t.value}\`),\`\`);this.logger.debug(\`Run Operator: \`,e,t)}}hasCommitted(){return!!this._committed.length}commit(e){return this._committed.add(e),this}_beforeEvaluate(){this.grammars.forEach((e=>{e.targets.some((t=>t?.rank<e?.rank))&&this._reRank(e)})),this._committed.forEach((e=>this._enqueue(e))),this._committed=new bE((e=>e.uid))}_enqueueTargets(e){e.targets&&e.targets.length&&this._finishFirstRender&&e.targets.forEach((e=>this._enqueue(e)))}evaluate(){if(this._beforeRunner&&this._beforeRunner(this),!this._committed.length)return this.logger.info(\`Dataflow invoked, but nothing to do.\`),!1;this._updateCounter+=1;let e,t,n=0;for(this.logger.canLogInfo()&&(t=Date.now(),this.logger.debug(\`-- START PROPAGATION (\${this._updateCounter}) -----\`)),this._beforeEvaluate();this._heap.size()>0;)e=this._heap.pop(),e&&(e.rank===e.qrank?(e.run(),this._logGrammarRunInfo(e),this._enqueueTargets(e),n+=1):this._enqueue(e));return this.logger.canLogInfo()&&(t=Date.now()-t,this.logger.info(\`> \${n} grammars updated; \${t} ms\`)),this._afterRunner&&this._afterRunner(this),this._finishFirstRender=!0,!0}runBefore(e){this._beforeRunner=e}runAfter(e){this._afterRunner=e}release(){this._heap&&=(this._heap.clear(),null),this.logger=null,this._committed=null}}let SE=(e,t,n,r,i)=>{let a=e=>{if(i||!e||r&&!r(e)||n.call(null,e),e.markType===Y.group){let n=e[t];n&&n.forEach((e=>{a(e)}))}i&&(!e||r&&!r(e)||n.call(null,e))};a(e)};class CE{constructor(e){this.handleAfterNextRender=()=>{this._stage&&!this._viewOptions.disableDirtyBounds&&this._stage.enableDirtyBounds(),this._view.emit(X.AFTER_VRENDER_DRAW),this._view.emit(X.AFTER_VRENDER_NEXT_RENDER)},this._view=e}initialize(e,t,n,r){return this._width=e,this._height=t,this._viewOptions=n,this._eventConfig=r,this.initStage(),this}stage(){return this._stage??null}gestureController(){return this._gestureController??null}canvas(){return this._stage?this._stage.window.getNativeHandler().nativeCanvas:null}context(){return this._stage?this._stage.window.getContext().nativeContext:null}combineIncrementalLayers(){return this._stage&&function(e){return hc(this,void 0,void 0,(function*(){let t=[],n=e.getChildren();yield new Promise((e=>{B.global.getRequestAnimationFrame()((()=>{e(null)}))})),n.forEach((e=>{e.subLayers.size&&e.subLayers.forEach((e=>{e.drawContribution&&e.drawContribution.hooks&&e.drawContribution.rendering&&t.push(new Promise((t=>{e.drawContribution.hooks.completeDraw.tap(\`outWait\`,(()=>{e.drawContribution.hooks.completeDraw.taps=e.drawContribution.hooks.completeDraw.taps.filter((e=>e.name!==\`outWait\`)),t(null)}))})))}))})),yield Promise.all(t)}))}(this._stage).then((()=>{this._stage&&this._stage.defaultLayer.combineSubLayer()})),this}background(e){if(this._stage)return this._stage.background=e,this}setDpr(e,t){var n,r;return(r=(n=this._stage)?.setDpr)==null||r.call(n,e),t&&this.renderNextFrame(),this}shouldResize(e,t){return e!==this._width||t!==this._height}resize(e,t){return this._view.emit(X.BEFORE_STAGE_RESIZE),this.shouldResize(e,t)&&(this._width=e,this._height=t,this._stage&&this._stage.resize(e,t)),this._view.emit(X.AFTER_STAGE_RESIZE),this}setViewBox(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return this._stage&&(!e||this._viewBox&&e.x1===this._viewBox.x1&&e.x2===this._viewBox.x2&&e.y1===this._viewBox.y1&&e.y2===this._viewBox.y2||(this._viewBox=e,this._stage.setViewBox(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,t))),this}render(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return this._view.emit(X.BEFORE_VRENDER_DRAW),this.initStage(),this._stage.disableDirtyBounds(),this._stage.afterNextRender(this.handleAfterNextRender),e&&(this._stage.render(),this._view.emit(X.AFTER_VRENDER_DRAW)),this}renderNextFrame(){return this.initStage(),this._stage.renderNextFrame(),this}toCanvas(){return this._stage?this._stage.toCanvas():null}preventRender(e){this._stage&&this._stage.preventRender(e)}release(){this._view.traverseMarkTree((e=>{e.release()})),this._dragController&&this._dragController.release(),this._gestureController&&this._gestureController.release(),this._stage!==this._viewOptions?.stage&&this._stage.release(),this._stage=null,this._layer=null,this._dragController=null,this._gestureController=null}createStage(){var e,t;this._view.emit(X.BEFORE_CREATE_VRENDER_STAGE);let n=this._viewOptions,r=n.stage??(i={width:this._width,height:this._height,renderStyle:n.renderStyle,viewBox:n.viewBox,dpr:n.dpr,canvas:n.renderCanvas,canvasControled:n.canvasControled,container:n.container,title:n.rendererTitle,beforeRender:n.beforeRender,afterRender:n.afterRender,disableDirtyBounds:!0,autoRender:!0,pluginList:n.pluginList,enableHtmlAttribute:n.enableHtmlAttribute,optimize:n.optimize,ticker:n.ticker,supportsTouchEvents:n.supportsTouchEvents,supportsPointerEvents:n.supportsPointerEvents,event:{clickInterval:this._eventConfig.clickInterval,autoPreventDefault:!!this._eventConfig.autoPreventDefault},ReactDOM:n.ReactDOM,autoRefresh:n.autoRefresh},new Hp(i));var i;(e=n.options3d)!=null&&e.enable&&r.set3dOptions(n.options3d),r.enableIncrementalAutoRender(),this._viewBox=n.viewBox,this._view.emit(X.AFTER_CREATE_VRENDER_STAGE),this._view.emit(X.BEFORE_CREATE_VRENDER_LAYER);let a=n.layer??r.defaultLayer;if(this._view.emit(X.AFTER_CREATE_VRENDER_LAYER),(t=this._eventConfig)!=null&&t.drag&&Z.getStageEventPlugin(\`drag\`)&&(this._dragController=new(Z.getStageEventPlugin(\`drag\`))(r)),this._eventConfig?.gesture&&Z.getStageEventPlugin(\`gesture\`)){let e=m(this._eventConfig.gesture)?this._eventConfig.gesture:{};this._gestureController=new(Z.getStageEventPlugin(\`gesture\`))(r,e)}return{stage:r,layer:a}}initStage(){if(!this._stage){let{stage:e,layer:t}=this.createStage();this._stage=e,this._layer=t;let n=this._view.background();this.background(n)}}}function wE(e){return f(e.offsetX)?f(e.x)?e.changedTouches&&e.changedTouches.length?function(e){let t=e.changedTouches[0];return{canvasX:t.x,canvasY:t.y}}(e):{canvasX:0,canvasY:0}:function(e){return{canvasX:e.x,canvasY:e.y}}(e):function(e){return{canvasX:e.offsetX,canvasY:e.offsetY}}(e)}function TE(e,t){let n=[\`canvasX\`,\`canvasY\`];return(!(arguments.length>2&&arguments[2]!==void 0)||arguments[2])&&(n.push(\`clientX\`),n.push(\`clientY\`)),n.forEach((n=>{C(t[n])&&Object.defineProperty(e,n,{value:t[n],writable:!0})})),[t.canvasX,t.canvasY]}let EE=\`window\`,DE=\`view\`,OE=\`width\`,kE=\`height\`,AE=\`viewWidth\`,jE=\`viewHeight\`,ME=\`padding\`,NE=\`viewBox\`,PE=\`autoFit\`;function FE(e,t,n,r){r===EE&&(function(e){[\`touches\`,\`changedTouches\`,\`targetTouches\`].forEach((t=>{e[t]&&e[t].length&&Array.from(e[t]).forEach((e=>{TE(e,wE(e),!1)}))}));let t=wE(e);TE(e,t)})(t.changedTouches?t.changedTouches[0]:t);let i=t.target?.[CT];if(!i&&r===DE){let n=t.target,r=e.rootMark?.graphicItem;for(;n?.parent&&n.parent!==r;)if(n=n.parent,n[CT]){i=n[CT];break}}return t.element=i,t}class IE extends dE{constructor(){super(...arguments),this.grammarType=\`signal\`,this.spec={value:null,update:null}}parse(e){return super.parse(e),this.value(e.value),this.update(e.update),this.commit(),this}evaluate(e,t){return this._signal=this.spec.update?MT(this.spec.update,t,this._signal):this.spec.value,this.spec.value=this._signal,this}output(){return this._signal}getValue(){return this.output()}set(e){if(y(e)&&y(this.value)&&e.length===this.value.length){for(let t=0;t<e.length;t++)if(this.value[t]!==e[t])return this._signal=e,this.spec.value=e,!0;return!1}return this._signal!==e&&(this._signal=e,this.spec.value=e,!0)}update(e){return f(e)||this.value(void 0),this.setFunctionSpec(e,\`update\`)}value(e){return f(e)||this.update(void 0),this.spec.value=e,this.commit(),this}reuse(e){return e.grammarType!==this.grammarType||(this._signal=e.output()),this}clear(){super.clear(),this._signal=null}}let LE=-1,RE=[OE,kE,ME,AE,jE,NE,PE],zE=e=>S(e)?{top:e,bottom:e,left:e,right:e}:{top:e?.top??0,bottom:e?.bottom??0,left:e?.left??0,right:e?.right??0};function BE(e,t,n){let r=new Map;if(!e||e.length===0)return{keys:[],data:r};if(!t)return r.set(\`key\`,n?e.slice().sort(n):e.slice()),{keys:DT,data:r};let i=FT(t);if(e.length===1){let t=i(e[0]);return r.set(t,[e[0]]),{keys:[t],data:r}}let a=new Set;return e.forEach((e=>{let t=i(e),n=r.get(t)??[];n.push(e),r.set(t,n),a.add(t)})),n&&a.forEach((e=>{r.get(e).sort(n)})),{keys:Array.from(a),data:r}}class VE{constructor(e,t,n){this.prevData=e?.length?BE(e,t??null,n):null}setCurrentData(e){this.currentData=e}getCurrentData(){return this.currentData}doDiff(){if(this.callback)if(this.currentData&&this.prevData){let e=new Map(this.prevData.data);this.currentData.keys.forEach((t=>{this.callback(t,this.currentData.data.get(t),e.get(t)),e.delete(t)})),this.prevData.keys.forEach((t=>{e.has(t)&&this.callback(t,null,e.get(t))}))}else this.currentData?this.currentData.keys.forEach((e=>{this.callback(e,this.currentData.data.get(e),null)})):this.prevData&&this.prevData.keys.forEach((e=>{this.callback(e,null,this.prevData.data.get(e))}))}setCallback(e){this.callback=e}updateToCurrent(){this.prevData=this.currentData,this.currentData=null}reset(){this.prevData=null}}class HE extends dE{constructor(e,t,n){super(e),this.grammarType=\`mark\`,this.elements=[],this.elementMap=new Map,this.isUpdated=!0,this._isReentered=!1,this.differ=new VE([]),this.markType=t,this.spec.type=t,this.spec.encode={update:{}},this.spec.group=n,n&&(this.group=n,this.attach(n),n.appendChild(this))}parse(e){if(super.parse(e),this.spec.group){let e=v(this.spec.group)?this.view.getMarkById(this.spec.group):this.spec.group;this.detach(e)}let t=v(e.group)?this.view.getMarkById(e.group):e.group;return this.attach(t),this.join(e.from?.data,e.key,e.sort,e.groupBy,e.groupSort),this.coordinate(e.coordinate),this.state(e.state,this.spec.stateSort),Object.keys(this.spec.encode??{}).forEach((e=>{this.encodeState(e,{},!0)})),Object.keys(e.encode??{}).forEach((t=>{this.encodeState(t,e.encode[t])})),this.animation(e.animation),this.animationState(e.animationState),this.morph(e.morph,e.morphKey,e.morphElementKey),this.layout(e.layout),this.configure(e),this.transform(e.transform),this.parseAddition(e),this.spec=e,this.markType=e.type,this.commit(),this}parameters(){return this._finalParameters??super.parameters()}parseAddition(e){return this}reuse(e){var t;if(e.grammarType!==this.grammarType)return this;let n=e;return this.markType=n.markType,this.coord=n.coord,this.elementMap=n.elementMap,this.elements=n.elements,this.elementMap.forEach((e=>e.mark=this)),this.differ=n.differ,(t=this.reuseAnimate)==null||t.call(this,n),this._context=n._context,this.graphicItem=n.graphicItem,this.graphicIndex=n.graphicIndex,this.graphicParent=n.graphicParent,this.needClear=n.needClear,this.isUpdated=n.isUpdated,this}needLayout(){return!f(this.spec.layout)}handleLayoutEnd(){}handleRenderEnd(){this.needClear&&=(this.cleanExitElements(),this.elementMap.forEach((e=>{e.diffState===dT.exit?e.clearGraphicAttributes():e.clearChangedGraphicAttributes()})),this.differ.updateToCurrent(),!1)}evaluateMainTasks(e,t){if(this.needSkipBeforeLayout()&&this.view.getLayoutState()===bT.before)return this;let n=this.view.renderer?.stage();this.init(n,t);let r=this.evaluateTransform(this._getTransformsBeforeJoin(),e??ET,t),i=r?.progressive;if(i?this.renderContext={large:!1}:(this.evaluateGroup(r),this.renderContext=this.parseRenderContext(r,t)),this.renderContext?.progressive)this.differ.reset(),this.elementMap.clear(),this.evaluateProgressive();else{let e=null;if(i){if(this.renderContext.parameters=t,this.renderContext.beforeTransformProgressive=r.progressive,e=r.progressive.output(),r.progressive.canAnimate&&r.progressive.unfinished())return this.update(this.spec),this}else e=r;this.emit(X.BEFORE_MARK_JOIN),this.evaluateJoin(e),this.emit(X.AFTER_MARK_JOIN),this.emit(X.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,t),this.emit(X.AFTER_MARK_STATE),this.emit(X.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),t),this.emit(X.AFTER_MARK_ENCODE)}return this.update(this.spec),this}evaluateGroup(e){if(this.markType===Y.group)return;let t=BE(e??ET,this.spec.groupBy,this.spec.groupSort);this._groupEncodeResult=null,this._groupedData=t}_getTransformsAfterEncodeItems(){return this.transforms&&this.transforms.filter((e=>e.markPhase===\`afterEncodeItems\`))}_getTransformsAfterEncode(){return this.transforms&&this.transforms.filter((e=>f(e.markPhase)||e.markPhase===\`afterEncode\`))}_getTransformsBeforeJoin(){return this.transforms?this.transforms.filter((e=>e.markPhase===\`beforeJoin\`)):[]}evaluate(e,t){var n;return this.evaluateMainTasks(e,t),(n=this.renderContext)!=null&&n.progressive||this.evaluateTransform(this._getTransformsAfterEncode(),this.elements,t),this}output(){return this}join(e,t,n,r,i){return this.grammarSource&&=(this.detach(this.grammarSource),null),this.spec.from=null,f(e)||(v(e)?this.grammarSource=this.view.getDataById(e):this.grammarSource=e,this.spec.from={data:e},this.attach(this.grammarSource)),this.spec.key=t,this.spec.sort=n,this.spec.groupBy=r,this.spec.groupSort=i,this.commit(),this}coordinate(e){return v(e)?this.coord=this.view.getCoordinateById(e):this.coord=e,this.attach(this.coord),this.commit(),this}state(e,t){return this.spec.stateSort=t,this.setFunctionSpec(e,\`state\`)}encode(e,t,n){return this.encodeState(dT.update,e,t,n)}encodeState(e,t,n,r){if(e===dT.enter&&(this._isReentered=!0),this.spec.encode[e]){let i=this.spec.encode[e];if(jT(i))this.detach(RT(i,this.view));else{let a=v(t);a&&r||!a&&n?(Object.keys(i).forEach((e=>{this.detach(RT(i[e],this.view))})),this.spec.encode[e]={}):a?this.detach(RT(i[t],this.view)):Object.keys(t).forEach((e=>{this.detach(RT(i[e],this.view))}))}}return t&&(this.spec.encode[e]||(this.spec.encode[e]={}),v(t)?(this.spec.encode[e][t]=n,this.attach(RT(n,this.view))):jT(t)?(this.spec.encode[e]=t,this.attach(RT(t,this.view))):t&&(Object.assign(this.spec.encode[e],t),Object.values(t).forEach((e=>{this.attach(RT(e,this.view))})))),this.commit(),this}_getEncoders(){return this.spec.encode??{}}animation(e){return this.spec.animation=e,this}animationState(e){return this.setFunctionSpec(e,\`animationState\`)}layout(e){return this.spec.layout=e,this.commit(),this}morph(e,t,n){return this.spec.morph=e,this.spec.morphKey=t,this.spec.morphElementKey=n,this}transform(e){let t=mE(this.spec.transform,this.view);t&&(this.detach(t.refs),this.transforms=[]);let n=mE(e,this.view);return n&&(this.attach(n.refs),this.transforms=n.transforms),this.spec.transform=e,this.commit(),this}configure(e){let t=[\`clip\`,\`clipPath\`,\`zIndex\`,\`interactive\`,\`context\`,\`setCustomizedShape\`,\`large\`,\`largeThreshold\`,\`progressiveStep\`,\`progressiveThreshold\`,\`support3d\`,\`morph\`,\`morphKey\`,\`morphElementKey\`,\`attributeTransforms\`,\`skipTheme\`,\`enableSegments\`,\`stateSort\`,\`graphicName\`,\`overflow\`];return e===null?(t.forEach((e=>{f(this.spec[e])||(this.spec[e]=void 0)})),this):(t.forEach((t=>{f(e[t])||(this.spec[t]=e[t])})),this)}context(e){return this.spec.context=e,this._context=e,this}isCollectionMark(){return wT.includes(this.markType)}needAnimate(){return!this.renderContext?.progressive&&!f(this.spec.animation)}getAllElements(){let e=this.elements.slice();return this.elementMap.forEach((t=>{t.diffState!==dT.exit||e.includes(t)||e.push(t)})),this.spec.sort&&e.sort(((e,t)=>this.spec.sort(e.getDatum(),t.getDatum()))),e}getScales(){let e={};return this.references.forEach(((t,n)=>{n.grammarType===xT.scale&&(e[n.id()]=n.output())})),e}getScalesByChannel(){let e=this.spec.encode;if(!e)return{};let t={},n=this.parameters();return Object.keys(e).forEach((r=>{let i=e[r];i&&!jT(i)&&Object.keys(i).forEach((e=>{IT(i[e])&&(t[e]=NT(i[e].scale,n))}))})),t}getFieldsByChannel(){let e=this.spec.encode;if(!e)return{};let t={};return Object.keys(e).forEach((n=>{let r=e[n];jT(r)||Object.keys(r).forEach((e=>{LT(r[e])&&(t[e]=r[e].field)}))})),t}init(e,t){var n;if(this._delegateEvent||(this._delegateEvent=(e,t)=>{let n=FE(this.view,e,0,DE),r=e.element;r?.mark===this&&this.emitGrammarEvent(t,n,r)},this.initEvent()),(n=this.initAnimate)==null||n.call(this,this.spec),!this.group){let e=NT(this.spec.group,t);this.group=e,e&&e.appendChild(this)}let r=this.group?this.group.getGroupGraphicItem():e.defaultLayer,i=(this.group?.children)?.indexOf(this)??0;if(this.markType!==Y.group){if(!this.graphicItem){let e=UT(this,Y.group,{pickable:!1,zIndex:this.spec.zIndex??0,overflow:this.spec.overflow});(this.spec.support3d||TT.includes(this.markType))&&e.setMode(\`3d\`),e.name=\`\${this.id()||this.markType}\`,this.graphicItem=e}this.graphicParent=this.graphicItem,!r||this.graphicIndex===i&&this.graphicItem.parent===r||r.insertIntoKeepIdx(this.graphicItem,i)}else this.graphicParent=r,this.graphicParent.setAttributes({overflow:this.spec.overflow});this.graphicIndex=i}update(e){var t;if(this.emit(X.BEFORE_MARK_UPDATE),this._context=this.spec.context,this.isUpdated=!0,this.renderContext.progressive||(t=this.updateAnimate)==null||t.call(this,e),this.markType!==Y.group){if(f(e.zIndex)||this.graphicItem.setAttribute(\`zIndex\`,e.zIndex),f(e.clip)||this.graphicItem.setAttribute(\`clip\`,e.clip),!f(e.clipPath)){let t=y(e.clipPath)?e.clipPath:e.clipPath(this.elements);t&&t.length?this.graphicItem.setAttribute(\`path\`,t):this.graphicItem.setAttributes({path:t,clip:!1})}f(e.overflow)||this.graphicItem.setAttribute(\`overflow\`,e.overflow),this.elementMap.forEach((e=>{e.updateGraphicItem()}))}else this.elementMap.forEach((e=>{e.updateGraphicItem()}));this.emit(X.AFTER_MARK_UPDATE)}createElement(){return new eE(this)}evaluateJoin(e){this.needClear=!0;let t=FT(this.spec.key??this.grammarSource?.getDataIDKey()??(()=>\`key\`)),n=FT(this.spec.groupBy??(()=>\`key\`)),r=this.spec.sort,i=this.isCollectionMark(),a=new Set(this.elements.filter((e=>e.diffState===dT.enter))),o=[];this.differ.setCallback(((e,r,s)=>{let c=e,l;if(f(r))l=this.elementMap.get(c),l&&(l.diffState=dT.exit);else if(f(s)){if(l=this.elementMap.has(c)?this.elementMap.get(c):this.createElement(),l.diffState===dT.exit){l.diffState=dT.enter;let e=this.animate?.getElementAnimators(l,dT.exit);e&&e.forEach((e=>e.stop(\`start\`)))}l.diffState=dT.enter;let a=i?e:n(r[0]);l.updateData(a,r,t),this.elementMap.set(c,l),o.push(l)}else if(l=this.elementMap.get(c),l){l.diffState=dT.update;let a=i?e:n(r[0]);l.updateData(a,r,t),o.push(l)}a.delete(l)}));let s=e??ET;i?this.differ.setCurrentData(this._groupedData):this.differ.setCurrentData(BE(s,(e=>\`\${n(e)}-\${t(e)}\`),void 0)),this.differ.doDiff(),a.forEach((e=>{this.elementMap.delete(i?e.groupKey:\`\${e.groupKey}-\${e.key}\`),e.remove(),e.release()})),this.elements=o,r&&this.elements.length>=2&&this.elements.sort(((e,t)=>r(e.getDatum(),t.getDatum())))}evaluateState(e,t,n){t&&e.forEach((e=>{e.state(t,n)}))}evaluateGroupEncode(e,t,n){if(!this._groupedData||!t)return;let r={};return this._groupedData.keys.forEach((i=>{let a=e.find((e=>e.groupKey===i));a&&(r[i]=VT(t,a.items&&a.items[0]&&a.items[0].datum,a,n))})),this._groupEncodeResult=r,r}getChannelsFromConfig(e){let t=this.spec;return f(t.interactive)?null:{pickable:t.interactive}}evaluateEncode(e,t,n,r){let i=this.getChannelsFromConfig();if(t){this.emit(X.BEFORE_ELEMENT_ENCODE,{encoders:t,parameters:n},this);let a=r?null:this.evaluateGroupEncode(e,t[uT.group],n);e.forEach((e=>{this.markType===Y.glyph&&this._groupEncodeResult?e.items.forEach((t=>{t.nextAttrs=Object.assign(t.nextAttrs,i,this._groupEncodeResult[e.groupKey])})):a?.[e.groupKey]&&!this.isCollectionMark()?e.items.forEach((t=>{t.nextAttrs=Object.assign(t.nextAttrs,i,a[e.groupKey])})):i&&e.items.forEach((e=>{e.nextAttrs=Object.assign(e.nextAttrs,i)})),e.encodeItems(e.items,t,this._isReentered,n),this.isCollectionMark()&&a!=null&&a[e.groupKey]&&p(a[e.groupKey].defined)&&(e.items.forEach((t=>{t.nextAttrs.defined=a[e.groupKey].defined})),delete a[e.groupKey].defined)})),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),e,n),e.forEach((e=>{e.encodeGraphic(this.isCollectionMark()?a?.[e.groupKey]:null)})),this.emit(X.AFTER_ELEMENT_ENCODE,{encoders:t,parameters:n},this)}else e.forEach((e=>{e.initGraphicItem(i)}))}addGraphicItem(e,t,n){let r=n??UT(this,this.markType,e);if(r){if(this.renderContext?.progressive){let e;if(this._groupedData){let n=this._groupedData.keys.indexOf(t);n>=0&&(e=this.graphicParent.getChildAt(n))}else e=this.graphicParent.at(0);this.isCollectionMark()?(r.incremental=1,e.appendChild(r)):e.incrementalAppendChild(r)}else this.graphicParent.appendChild(r);return r}}parseRenderContext(e,t){let n=this.markType!==Y.group&&this.spec.progressiveStep>0&&this.spec.progressiveThreshold>0&&this.spec.progressiveStep<this.spec.progressiveThreshold,r=this.spec.large&&this.spec.largeThreshold>0&&e.length>=this.spec.largeThreshold;if(n){let n=this._groupedData;return n&&n.keys&&n.keys.some((e=>n.data.get(e).length>this.spec.progressiveThreshold))?{large:r,parameters:t,progressive:{data:e,step:this.spec.progressiveStep,currentIndex:0,totalStep:n.keys.reduce(((e,t)=>Math.max(Math.ceil(n.data.get(t).length/this.spec.progressiveStep),e)),1),groupedData:n.data}}:{large:r}}return{large:r}}isProgressive(){return this.renderContext&&(!!this.renderContext.progressive||!!this.renderContext.beforeTransformProgressive)}canAnimateAfterProgressive(){return this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.canAnimate()}isDoingProgressive(){return this.renderContext&&(this.renderContext.progressive&&this.renderContext.progressive.currentIndex<this.renderContext.progressive.totalStep||this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.unfinished())}clearProgressive(){this.renderContext&&this.renderContext.progressive&&(this.elements=[],this.graphicParent.children.forEach((e=>{e.incrementalClearChild()})),this.graphicParent.removeAllChild()),this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.release(),this.renderContext=null}restartProgressive(){this.renderContext&&this.renderContext.progressive&&(this.renderContext.progressive.currentIndex=0)}evaluateJoinProgressive(){let e=this.renderContext.progressive.currentIndex,t=FT(this.spec.key??this.grammarSource?.getDataIDKey()??(()=>\`key\`)),n=[];if(this.isCollectionMark())return this._groupedData.keys.forEach(((r,i)=>{let a=this.renderContext.progressive.groupedData.get(r),o=this.renderContext.progressive.step,s=a.slice(e*o,(e+1)*o);if(e===0){let e=this.createElement();e.diffState=dT.enter,e.updateData(r,s,t),n.push(e)}else{let e=this.elements[i];e.updateData(r,s,t),n.push(e)}})),n;let r={};return this._groupedData.keys.forEach((i=>{let a=this.renderContext.progressive.groupedData.get(i),o=this.renderContext.progressive.step,s=a.slice(e*o,(e+1)*o),c=[];s.forEach((e=>{let r=this.createElement();r.diffState=dT.enter,r.updateData(i,[e],t),c.push(r),n.push(r)})),r[i]=c})),{groupElements:r,elements:n}}evaluateEncodeProgressive(e,t,n){let r=this.renderContext.progressive.currentIndex;if(r===0){if(this.evaluateEncode(e,t,n),r===0&&this._groupEncodeResult&&!this.isCollectionMark()&&this.markType!==Y.glyph){let t=e[0],n=t.getGraphicItem()?.parent;n&&this._groupEncodeResult[t.groupKey]&&n.setTheme({common:this._groupEncodeResult[t.groupKey]})}}else this.evaluateEncode(e,t,n,!0)}evaluateProgressive(){if(this.renderContext?.beforeTransformProgressive){let e=this.renderContext.beforeTransformProgressive;e.progressiveRun();let t=e.output();if(e.canAnimate){if(e.unfinished())return;this.evaluateGroup(t)}this.emit(X.BEFORE_MARK_JOIN),this.evaluateJoin(t),this.emit(X.AFTER_MARK_JOIN),this.emit(X.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,this.renderContext.parameters),this.emit(X.AFTER_MARK_STATE),this.emit(X.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),this.renderContext.parameters),this.emit(X.AFTER_MARK_ENCODE);return}if(!this.renderContext?.progressive)return;let e=this.renderContext.parameters;this.emit(X.BEFORE_MARK_JOIN);let t=this.evaluateJoinProgressive(),n=Array.isArray(t)?t:t.elements;if(this.emit(X.AFTER_MARK_JOIN),this.renderContext.progressive.currentIndex===0?(this.graphicParent.removeAllChild(),this._groupedData.keys.forEach((e=>{let t=UT(this,Y.group,{pickable:!1,zIndex:this.spec.zIndex});t.incremental=this.renderContext.progressive.step,this.graphicParent.appendChild(t)})),this.elements=n):this.elements=this.elements.concat(n),this.emit(X.BEFORE_MARK_STATE),this.evaluateState(n,this.spec.state,e),this.emit(X.AFTER_MARK_STATE),this.emit(X.BEFORE_MARK_ENCODE),Array.isArray(t))this.evaluateEncodeProgressive(n,this._getEncoders(),e);else{let n=t.groupElements;Object.keys(n).forEach((t=>{this.evaluateEncodeProgressive(n[t],this._getEncoders(),e)}))}this.emit(X.AFTER_MARK_ENCODE);let r=this._getTransformsAfterEncode()?.filter((e=>!0===e.canProgressive));r!=null&&r.length&&this.evaluateTransform(r,this.elements,e),this.renderContext.progressive.currentIndex+=1}isLargeMode(){return this.renderContext&&this.renderContext.large}cleanExitElements(){this.elementMap.forEach(((e,t)=>{e.diffState!==dT.exit||e.isReserved||(this.elementMap.delete(t),e.remove(),e.release())}))}getGroupGraphicItem(){if(this.elements&&this.elements[0]&&this.elements[0].getGraphicItem)return this.elements[0].getGraphicItem()}getBounds(){return this.graphicItem?this.graphicItem.AABBBounds:this.getGroupGraphicItem()?.AABBBounds}getMorphConfig(){var e;return{morph:(e=this.spec.morph)!=null&&e,morphKey:this.spec.morphKey,morphElementKey:this.spec.morphElementKey}}getAttributeTransforms(){return this.spec.attributeTransforms??qT[this.markType]}getContext(){return this._context}needSkipBeforeLayout(){if(!0===this.spec.layout?.skipBeforeLayouted)return!0;let e=this.group;for(;e;){if(!0===e.getSpec().layout?.skipBeforeLayouted)return!0;e=e.group}return!1}initEvent(){if(this._delegateEvent){let e=this.view.renderer.stage();e&&e.on(\`*\`,this._delegateEvent)}}releaseEvent(){if(this._delegateEvent){let e=this.view.renderer.stage();e&&e.off(\`*\`,this._delegateEvent)}}clear(){var e;this.releaseEvent(),this.transforms=null,this.elementMap=null,this.elements=null,this.graphicItem=null,this.animate=null,(e=this.group)==null||e.removeChild(this),this.group=null,super.clear()}prepareRelease(){var e;this.differ.setCurrentData(null),(e=this.animate)==null||e.stop(),this.elementMap.forEach((e=>e.diffState=dT.exit)),this._finalParameters=this.parameters()}release(){this.releaseEvent(),this.elements.forEach((e=>e.release())),this.differ=null,this.elements=[],this.elementMap.clear(),this._finalParameters=null,this.animate&&this.animate.release(),this.graphicItem&&WT(this.graphicItem),this.detachAll(),super.release()}}let UE=class extends HE{constructor(e,t){super(e,Y.group,t),this.children=[]}parseRenderContext(){return{large:!1}}appendChild(e){return this.children.push(e),this}removeChild(e){return this.children=this.children.filter((t=>t!==e)),this}includesChild(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return!!this.children.includes(e)||!!t&&this.children.some((t=>t.markType===Y.group&&t.includesChild(e,!0)))}updateLayoutChildren(){return this.children.length?(this.layoutChildren||=[],this.layoutChildren=this.children.filter((e=>e.needLayout())),this):this}getAttributeTransforms(){return qT.rect}evaluateJoin(e){if(!this.elements.length){let e=this.createElement();e.updateData(\`key\`,ET,(()=>\`\`)),this.elements=[e],this.elementMap.set(\`key\`,e)}}getChannelsFromConfig(e){let t=this.spec,n={};if(f(t.clip)||(n.clip=t.clip),f(t.zIndex)||(n.zIndex=t.zIndex),!f(t.clipPath)){let r=d(t.clipPath)?t.clipPath([e]):t.clipPath;r&&r.length?n.path=r:(n.path=null,n.clip=!1)}return f(t.interactive)||(n.pickable=t.interactive),n}evaluateGroupEncode(e,t,n){let r=this.elements[0],i={};return BT(r,[Object.assign({},r.items?.[0],{nextAttrs:i})],t,n),this._groupEncodeResult=i,i}evaluateEncode(e,t,n,r){let i=this.getChannelsFromConfig();if(t){this.emit(X.BEFORE_ELEMENT_ENCODE,{encoders:t,parameters:n},this);let a=r?null:this.evaluateGroupEncode(e,t[uT.group],n);e.forEach((e=>{e.items.forEach((e=>{e.nextAttrs=Object.assign(e.nextAttrs,i,a)})),e.encodeItems(e.items,t,this._isReentered,n)})),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),e,n),e.forEach((e=>{e.encodeGraphic()})),this.emit(X.AFTER_ELEMENT_ENCODE,{encoders:t,parameters:n},this)}else e.forEach((e=>{e.initGraphicItem(i)}))}addGraphicItem(e,t,n){let r=n??UT(this,this.markType,e);if(r)return this.emit(X.BEFORE_ADD_VRENDER_MARK,{graphicItem:r}),r.name=\`\${this.id()||this.markType}\`,this.graphicParent.insertIntoKeepIdx(r,this.graphicIndex),this.emit(X.AFTER_ADD_VRENDER_MARK,{graphicItem:r}),r}};class WE{constructor(e,t){this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}},this._size=0,this._mapKey=v(e)?t=>t[e]:e,this._warning=t}record(e){var t,n;let r=e.grammarType,i=this._mapKey(e);return this._grammarMap[r]?(this._grammars[r].push(e),f(i)||(this._grammarMap[r][i]?(t=this._warning)==null||t.call(this,i,e):this._grammarMap[r][i]=e)):(this._grammars.customized.push(e),f(i)||(this._grammarMap.customized[i]?(n=this._warning)==null||n.call(this,i,e):this._grammarMap.customized[i]=e)),this._size+=1,this}unrecord(e){let t=e.grammarType,n=this._mapKey(e);return this._grammarMap[t]?(this._grammars[t]=this._grammars[t].filter((t=>t!==e)),f(n)||this._grammarMap[t][n]!==e||delete this._grammarMap[t][n]):(this._grammars.customized=this._grammars.customized.filter((t=>t!==e)),f(n)||this._grammarMap.customized[n]!==e||delete this._grammarMap.customized[n]),--this._size,this}size(){return this._size}getSignal(e){return this._grammarMap.signal[e]??null}getData(e){return this._grammarMap.data[e]??null}getScale(e){return this._grammarMap.scale[e]??null}getCoordinate(e){return this._grammarMap.coordinate[e]??null}getMark(e){return this._grammarMap.mark[e]??null}getCustomized(e){return this._grammarMap.customized[e]??null}getGrammar(e){return this._grammarMap.data[e]?this._grammarMap.data[e]:this._grammarMap.signal[e]?this._grammarMap.signal[e]:this._grammarMap.scale[e]?this._grammarMap.scale[e]:this._grammarMap.coordinate[e]?this._grammarMap.coordinate[e]:this._grammarMap.mark[e]?this._grammarMap.mark[e]:this._grammarMap.customized[e]?this._grammarMap.customized[e]:null}getAllSignals(){return this._grammars.signal}getAllData(){return this._grammars.data}getAllScales(){return this._grammars.scale}getAllCoordinates(){return this._grammars.coordinate}getAllMarks(){return this._grammars.mark}getAllCustomized(){return this._grammars.customized}traverse(e){Object.values(this._grammars??{}).forEach((t=>(t??[]).forEach((t=>{e.call(null,t)}))))}find(e){let t=null;return this.traverse((n=>!0===e.call(null,n)&&(t=n,!0))),t}filter(e){let t=[];return this.traverse((n=>{!0===e.call(null,n)&&t.push(n)})),t}clear(){this._size=0,this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}}}release(){this._size=0,this._grammars=null,this._grammarMap=null}}class GE extends WE{constructor(){super(...arguments),this._markNodes=[]}record(e){if(super.record(e),e.grammarType===\`mark\`){let t=e,n={mark:t,parent:null,children:[]};this._markNodes.forEach((e=>{let r=e.mark;r.markType===Y.group&&r.includesChild(t,!1)?(e.children.push(n),n.parent=e):t.markType===Y.group&&t.includesChild(r,!1)&&(n.children.push(e),e.parent=n)})),this._markNodes.push(n)}return this}unrecord(e){if(super.unrecord(e),e.grammarType===\`mark\`){let t=e,n=this._markNodes.find((e=>e.mark===t));this._markNodes.forEach((e=>{e.mark.markType===Y.group&&e.children.includes(n)?(e.children=e.children.filter((e=>e!==n)),n.parent=null):t.markType===Y.group&&n.children.includes(e)&&(n.children=n.children.filter((t=>t!==e)),e.parent=null)})),this._markNodes=this._markNodes.filter((e=>e!==n))}return this}getAllMarkNodes(){return this._markNodes}clear(){super.clear(),this._markNodes=[]}release(){super.release(),this._markNodes=null}}class KE extends HE{addGraphicItem(e,t){let n=e&&e.limitAttrs,r=UT(this,n&&(n.textType===\`rich\`||n.text&&n.text.type===\`rich\`)?Y.richtext:Y.text,e);return super.addGraphicItem(e,t,r)}release(){super.release()}}KE.markType=Y.text;let qE={axis:{label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:\`#89909d\`,fontWeight:\`normal\`,fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:\`#D9DDE4\`,strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:\`#D9DDE4\`,strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:\`#D9DDE4\`,strokeOpacity:1}},items:[],start:{x:0,y:0},end:{x:100,y:0},x:0,y:0},circleAxis:{title:{space:4,padding:[0,0,0,0],textStyle:{fontSize:12,fill:\`#333333\`,fontWeight:\`normal\`,fillOpacity:1},text:\`theta\`},label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:\`#6F6F6F\`,fontWeight:\`normal\`,fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:\`#D9DDE4\`,strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:\`#D9DDE4\`,strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:\`#D9DDE4\`,strokeOpacity:1}},items:[],startAngle:0,endAngle:2*Math.PI,radius:100,innerRadius:0,center:{x:0,y:0},x:0,y:0},grid:{style:{stroke:\`#f1f2f5\`}},circleGrid:{style:{stroke:\`#f1f2f5\`}},discreteLegend:{layout:\`vertical\`,title:{align:\`start\`,space:12,textStyle:{fontSize:12,fontWeight:\`bold\`,fill:\`#2C3542\`}},item:{spaceCol:10,spaceRow:10,shape:{space:4,style:{size:10,cursor:\`pointer\`},state:{selectedHover:{opacity:.85},unSelected:{fill:\`#D8D8D8\`,stroke:\`#D8D8D8\`,fillOpacity:.5}}},label:{space:4,style:{fontSize:12,fill:\`black\`,cursor:\`pointer\`},state:{selectedHover:{opacity:.85},unSelected:{fill:\`#D8D8D8\`,fillOpacity:.5}}},value:{alignRight:!1,style:{fontSize:12,fill:\`#ccc\`,cursor:\`pointer\`},state:{selectedHover:{opacity:.85},unSelected:{fill:\`#D8D8D8\`}}},background:{style:{cursor:\`pointer\`},state:{selectedHover:{fillOpacity:.7,fill:\`gray\`},unSelectedHover:{fillOpacity:.2,fill:\`gray\`}}},focus:!1,focusIconStyle:{size:10,fill:\`#333\`,cursor:\`pointer\`},visible:!0,padding:{top:2,bottom:2,left:2,right:2}},autoPage:!0,pager:{space:12,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:\`multiple\`,allowAllCanceled:!1,items:[{index:0,id:\`\`,label:\`\`,shape:{fill:\`#6690F2\`,stroke:\`#6690F2\`,symbolType:\`circle\`}}]},colorLegend:{title:{visible:!1,text:\`\`},colors:[],layout:\`horizontal\`,railWidth:200,railHeight:8,railStyle:{cornerRadius:5}},sizeLegend:{title:{visible:!1,text:\`\`},trackStyle:{fill:\`#ccc\`},layout:\`horizontal\`,align:\`bottom\`,railWidth:200,railHeight:6,min:0,max:1,value:[0,1]},lineCrosshair:{start:{x:0,y:0},end:{x:0,y:0}},rectCrosshair:{start:{x:0,y:0},end:{x:0,y:0},rectStyle:{width:10,height:10}},sectorCrosshair:{center:{x:0,y:0},radius:100,startAngle:0,endAngle:Math.PI/6},circleCrosshair:{center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI},polygonCrosshair:{center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI,sides:6},slider:{layout:\`horizontal\`,railWidth:200,railHeight:10,railStyle:{cornerRadius:5},range:{draggableTrack:!0},startText:{visible:!0,text:\`\`,space:8},endText:{visible:!0,text:\`\`,space:8},min:0,max:1,value:[0,1]},dataLabel:{size:{width:400,height:400},dataLabels:[]},pointLabel:{data:[{text:\`\`,fill:\`#606773\`,data:{}}],overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},lineLabel:{type:\`line\`,data:[{text:\`\`,data:{}}],position:\`start\`,overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},areaLabel:{type:\`area\`,data:[{text:\`\`,data:{}}],position:\`end\`,overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},rectLabel:{type:\`rect\`,data:[{text:\`\`,fill:\`#606773\`,data:{}}],position:\`top\`,overlap:{size:{width:1e3,height:1e3},strategy:[{type:\`position\`}]},smartInvert:!1},symbolLabel:{type:\`symbol\`,data:[{text:\`\`,fill:\`#606773\`,data:{}}],position:\`top\`,overlap:{avoidBaseMark:!0,size:{width:1e3,height:1e3},strategy:[{type:\`position\`}]},smartInvert:!1},arcLabel:{type:\`arc\`,data:[{text:\`\`,fill:\`#606773\`,data:{}}],width:800,height:600,position:\`outside\`,zIndex:302},lineDataLabel:{type:\`line-data\`,data:[{text:\`\`}],position:\`top\`,overlap:{avoidBaseMark:!1,clampForce:!1},smartInvert:!1},datazoom:{orient:\`bottom\`,showDetail:\`auto\`,brushSelect:!0,start:0,end:1,position:{x:0,y:0},size:{width:500,height:40},previewData:[]},continuousPlayer:{},discretePlayer:{},tooltip:{},title:{textStyle:{fill:\`#21252c\`},subtextStyle:{fill:\`#606773\`}},scrollbar:{width:12,height:12,padding:[2,2],railStyle:{fill:\`rgba(0, 0, 0, .1)\`}}},JE={symbol:{shape:\`circle\`,size:8},text:{fontSize:14,fill:\`#000000\`}},YE=Object.assign({},qE);YE.axis=Object.assign({},YE.axis,{label:{style:{fill:\`#bbbdc3\`}},line:{style:{stroke:\`#4b4f54\`}},tick:{style:{stroke:\`#4b4f54\`}},subTick:{style:{stroke:\`#4b4f54\`}}}),YE.circleAxis=Object.assign({},YE.circleAxis,{label:{style:{fill:\`#bbbdc3\`}},line:{style:{stroke:\`#4b4f54\`}},tick:{style:{stroke:\`#4b4f54\`}},subTick:{style:{stroke:\`#4b4f54\`}}}),YE.grid=Object.assign({},YE.grid,{style:{stroke:\`#404349\`}}),YE.circleGrid=Object.assign({},YE.circleGrid,{style:{stroke:\`#404349\`}}),YE.rectLabel=Object.assign({},YE.rectLabel,{data:[{text:\`\`,fill:\`#888c93\`,data:{}}]}),YE.lineLabel=Object.assign({},YE.lineLabel,{data:[{text:\`\`,fill:\`#888c93\`,data:{}}]}),YE.symbolLabel=Object.assign({},YE.symbolLabel,{data:[{text:\`\`,fill:\`#888c93\`,data:{}}]}),YE.title=Object.assign({},YE.title,{textStyle:{fill:\`#fdfdfd\`},subtextStyle:{fill:\`#888c93\`}});let XE={name:\`dark\`,padding:5,background:\`#202226\`,palette:{default:[\`#5383F4\`,\`#7BCF8E\`,\`#FF9D2C\`,\`#FFDB26\`,\`#7568D9\`,\`#80D8FB\`,\`#1857A3\`,\`#CAB0E8\`,\`#FF8867\`,\`#B9E493\`,\`#2CB4A8\`,\`#B9E4E3\`]},marks:JE,components:YE},ZE={name:\`default\`,padding:5,palette:{default:[\`#6690F2\`,\`#70D6A3\`,\`#B4E6E2\`,\`#63B5FC\`,\`#FF8F62\`,\`#FFDC83\`,\`#BCC5FD\`,\`#A29BFE\`,\`#63C4C7\`,\`#F68484\`]},marks:JE,components:qE};class QE{static registerTheme(e,t){e&&QE._themes.set(e,t)}static unregisterTheme(e){QE._themes.delete(e)}static getTheme(e){return QE._themes.get(e)}static getDefaultTheme(){return QE.getTheme(\`default\`)}}QE._themes=new Map,QE.registerTheme(\`default\`,ZE),QE.registerTheme(\`dark\`,XE);class $E extends HE{constructor(e,t,n,r){super(e,Y.component,n),this._componentDatum={key:0},this.componentType=t,this.spec.type=\`component\`,this.spec.componentType=t,this.mode=r,this._updateComponentEncoders()}configureComponent(e){return this.spec.componentConfig=e,this.commit(),this}addGraphicItem(e,t,n){let r=n??Z.createGraphicComponent(this.componentType,e,{mode:this.mode,skipDefault:this.spec.skipTheme});return r&&(this.emit(X.BEFORE_ADD_VRENDER_MARK,{graphicItem:r}),this.graphicParent.appendChild(r),this.emit(X.AFTER_ADD_VRENDER_MARK,{graphicItem:r})),r}join(e){return super.join(e,\`key\`)}encodeState(e,t,n){return super.encodeState(e,t,n),this._updateComponentEncoders(),this}parseRenderContext(){return{large:!1}}_prepareRejoin(){this._componentDatum.key+=1}evaluateJoin(e){return this.spec.key=\`key\`,e?(e.key=this._componentDatum.key,this._componentDatum=e):this._componentDatum={key:this._componentDatum.key},super.evaluateJoin([this._componentDatum])}_updateComponentEncoders(){this._encoders=this.spec.encode}_getEncoders(){return this._encoders??{}}}let eD=Symbol.for(\`key\`);class tD{diffGrammar(e,t){return function(e,t,n){let r={enter:[],exit:[],update:[]},i=new VE(e,n);return i.setCallback(((e,t,n)=>{f(t)?r.exit.push({prev:n[0]}):f(n)?r.enter.push({next:t[0]}):r.update.push({next:t[0],prev:n[0]})})),i.setCurrentData(BE(t,n)),i.doDiff(),r}(e,t,(e=>e.id()??Symbol()))}diffMark(e,t,n){let r={enter:[],exit:[],update:[]},i=[],a=[];e.forEach((e=>{e.markType!==Y.group&&(n.morph&&e.getMorphConfig().morph||n.morphAll||n.reuse)?i.push(e):r.exit.push({prev:[e]})})),t.forEach((e=>{e.markType!==Y.group&&(n.morph&&e.getMorphConfig().morph||n.morphAll||n.reuse)?a.push(e):r.enter.push({next:[e]})}));let o=this.diffUpdateByGroup(i,a,(e=>e.getMorphConfig().morphKey),(e=>e.getMorphConfig().morphKey));i=o.prev,a=o.next,r.update=r.update.concat(o.update);let s=this.diffUpdateByGroup(i,a,(e=>e.id()),(e=>e.id()));i=s.prev,a=s.next,r.update=r.update.concat(s.update);let c=BE(i,(e=>{var t;return((t=e.group)?.id)?.call(t)})),l=BE(a,(e=>{var t;return((t=e.group)?.id)?.call(t)}));return Object.keys(l).forEach((e=>{let t=c.data.get(e),n=l.data.get(e);if(t&&n){for(let e=0;e<Math.max(t.length,n.length);e+=1){let i=t[e],a=n[e];i&&a?r.update.push({prev:[i],next:[a]}):i?r.exit.push({prev:[i]}):a&&r.enter.push({next:[a]})}i=i.filter((e=>!t.includes(e))),a=a.filter((e=>!n.includes(e)))}})),i.forEach((e=>r.exit.push({prev:[e]}))),a.forEach((e=>r.enter.push({next:[e]}))),r}diffUpdateByGroup(e,t,n,r){let i=BE(e,(e=>n(e)??eD)),a=BE(t,(e=>r(e)??eD)),o=e,s=t,c=[];return a.keys.forEach((e=>{if(e!==eD){let t=i.data.get(e),n=a.data.get(e);t&&n&&(c.push({prev:t,next:n}),o=o.filter((e=>!t.includes(e))),s=s.filter((e=>!n.includes(e))))}})),{prev:o,next:s,update:c}}}class nD extends c{static useRegisters(e){e.forEach((e=>{e()}))}constructor(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),e=this,this._observer=null,this._onResize=je((function(){let t=e._getContainerSize();t&&e.resize(t.width,t.height)}),100),this.delegateEvent=(e,t)=>{let n=FE(this,e,0,DE);this.emit(t,n,e.element)},this.handleProgressiveFrame=()=>{this._progressiveMarks.length&&this._progressiveMarks.forEach((e=>{e.isDoingProgressive()&&e.evaluateProgressive()})),this.doPreProgressive()},this._config=n,this._options=Object.assign({mode:\`browser\`},t),this.initialize()}getGrammarById(e){return this.grammars.getGrammar(e)}getSignalById(e){return this.grammars.getSignal(e)}getDataById(e){return this.grammars.getData(e)}getScaleById(e){return this.grammars.getScale(e)}getCoordinateById(e){return this.grammars.getCoordinate(e)}getMarkById(e){return this.grammars.getMark(e)}getCustomizedById(e){return this.grammars.getCustomized(e)}getGrammarsByName(e){return this.grammars.filter((t=>t.name()===e))}getGrammarsByType(e){return this.grammars.filter((t=>t.grammarType===e))}getMarksByType(e){return this.grammars.getAllMarks().filter((t=>t.markType===e))}getMarksByName(e){return this.grammars.getAllMarks().filter((t=>t.name()===e))}getMarksBySelector(e){if(!e)return null;let t=P(e),n=[];return t.forEach((e=>{if(PT(e))return void n.push(e);if(e[0]===\`#\`){let t=this.getMarkById(e.slice(1));t&&n.push(t);return}let t=e[0]===\`@\`?this.getMarksByName(e.slice(1)):Y[e]?this.getMarksByType(e):null;t&&t.length&&t.forEach((e=>{n.push(e)}))})),n}updateSignal(e,t){v(e)&&(e=this.getSignalById(e)),e.set(t),this.commit(e)}signal(e,t){let n=new IE(this);return arguments.length>=1&&n.value(e),arguments.length>=2&&n.update(t),this.grammars.record(n),this._dataflow.add(n),n}data(e){let t=new gE(this,e);return this.grammars.record(t),this._dataflow.add(t),t}scale(e){let t=Z.createGrammar(\`scale\`,this,e);return t&&(this.grammars.record(t),this._dataflow.add(t)),t}coordinate(e){let t=Z.createGrammar(\`coordinate\`,this,e);return t&&(this.grammars.record(t),this._dataflow.add(t)),t}mark(e,t,n){let r=v(t)?this.getMarkById(t):t,i;switch(e){case Y.group:i=new UE(this,r);break;case Y.glyph:let t=Z.getMark(Y.glyph);t&&(i=new t(this,n?.glyphType,r));break;case Y.component:i=Z.hasComponent(n?.componentType)?Z.createComponent(n?.componentType,this,r,n?.mode):new $E(this,n?.componentType,r,n?.mode);break;case Y.text:i=new KE(this,e,r);break;default:i=Z.hasMark(e)?Z.createMark(e,this,r):new HE(this,e,r)}return this.grammars.record(i),this._dataflow.add(i),i}group(e){return this.mark(Y.group,e)}glyph(e,t){return this.mark(Y.glyph,t,{glyphType:e})}component(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:\`2d\`;return this.mark(Y.component,t,{componentType:e,mode:n})}axis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:\`2d\`;return this.mark(Y.component,e,{componentType:fT.axis,mode:t})}grid(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:\`2d\`;return this.mark(Y.component,e,{componentType:fT.grid,mode:t})}legend(e){return this.mark(Y.component,e,{componentType:fT.legend})}slider(e){return this.mark(Y.component,e,{componentType:fT.slider})}label(e){return this.mark(Y.component,e,{componentType:fT.label})}datazoom(e){return this.mark(Y.component,e,{componentType:fT.datazoom})}player(e){return this.mark(Y.component,e,{componentType:fT.player})}title(e){return this.mark(Y.component,e,{componentType:fT.title})}scrollbar(e){return this.mark(Y.component,e,{componentType:fT.scrollbar})}customized(e,t){let n=Z.createGrammar(e,this,t?.type);if(n)return n.parse(t),this.grammars.record(n),this._dataflow.add(n),n}addGrammar(e){return this.grammars.find((t=>t.uid===e.uid))||(this.grammars.record(e),this._dataflow.add(e),e.parse(e.getSpec()),this._needBuildLayoutTree=!0),this}removeGrammar(e){let t=v(e)?this.getGrammarById(e):e;return t&&this.grammars.find((e=>e.uid===t.uid))?(t.grammarType===\`mark\`&&t.prepareRelease(),this._cachedGrammars.record(t),this._dataflow.remove(t),this.grammars.unrecord(t),this._needBuildLayoutTree=!0,this):this}removeAllGrammars(){return this.grammars.traverse((e=>{e.grammarType===\`signal\`&&RE.includes(e.id())||e.grammarType===\`mark\`&&e.id()===\`root\`||this.removeGrammar(e)})),this}removeAllGraphicItems(){return this.traverseMarkTree((e=>{e.graphicItem&&=(WT(e.graphicItem),e.elementMap.forEach((e=>{e.resetGraphicItem()})),null)})),this}parseSpec(e){var t,n,r,i,a,o;if(this.emit(X.BEFORE_PARSE_VIEW),this._spec=e,(e=>{let t=(e,n)=>{e.group=n;let r=e.id??\`VGRAMMAR_MARK_\`+ ++LE;e.id=r,(e.marks??[]).forEach((e=>t(e,r)))};(e.marks??[]).forEach((e=>t(e,\`root\`)))})(e),e.theme?this.theme(e.theme):this.theme(QE.getDefaultTheme()),e.width&&this.width(e.width),e.height&&this.height(e.height),this.padding(e.padding??this._options.padding??this._theme.padding),!this.width()||!this.height()){let e=this._getContainerSize();e&&(this.updateSignal(OE,e.width),this.updateSignal(kE,e.height))}(t=e.signals)!=null&&t.length&&e.signals.forEach((e=>{this.signal().parse(e)})),(n=e.data)!=null&&n.length&&e.data.forEach((e=>{this.data(null).parse(e)})),(r=e.coordinates)!=null&&r.length&&e.coordinates.forEach((e=>{var t;(t=this.coordinate(e.type))==null||t.parse(e)})),(i=e.scales)!=null&&i.length&&e.scales.forEach((e=>{var t;(t=this.scale(e.type))==null||t.parse(e)}));let s=Z.getGrammars();return Object.keys(s).forEach((t=>{let{specKey:n}=s[t];e[n]&&e[n].length&&e[n].forEach((e=>{this.customized(t,e)}))})),e.marks&&e.marks.length&&e.marks.forEach((e=>{this.parseMarkSpec(e)})),e.events&&e.events.length&&e.events.forEach((e=>{var t;(t=this.event)==null||t.call(this,e)})),e.interactions&&e.interactions.length&&e.interactions.forEach((e=>{this.interaction(e.type,e)})),!1===e.animation?(a=this.animate)==null||a.disable():(o=this.animate)==null||o.enable(),this.emit(X.AFTER_PARSE_VIEW),this._needBuildLayoutTree=!0,this._layoutState=bT.before,this}updateSpec(e){return this.removeAllInteractions(),this.removeAllGrammars(),this.parseSpec(e)}parseBuiltIn(){((e,t,n)=>[{id:OE,value:e[OE]??0},{id:kE,value:e[kE]??0},{id:ME,value:zE(e[ME]??t[ME]??n?.padding)},{id:AE,update:{callback:(e,t)=>{let n=zE(t[ME]);return t[OE]-n.left-n.right},dependency:[OE,ME]}},{id:jE,update:{callback:(e,t)=>{let n=zE(t[ME]);return t[kE]-n.top-n.bottom},dependency:[kE,ME]}},{id:NE,update:{callback:(e,t)=>{let n=zE(t[ME]);return(e||new xt).setValue(n.left,n.top,n.left+t[AE],n.top+t[jE])},dependency:[AE,jE,ME]}},{id:PE,value:e[PE]??t[PE]}])(this._options,this._config,this.getCurrentTheme()).forEach((e=>{let t=this.signal().parse(e);e.value&&t.set(e.value)})),this.parseMarkSpec({id:\`root\`,type:\`group\`,encode:{enter:{x:0,y:0},update:{width:{signal:\`width\`},height:{signal:\`height\`}}}}),this.rootMark=this.getMarkById(\`root\`)}parseMarkSpec(e){var t;let n=e.type===Y.glyph?{glyphType:e.glyphType}:e.type===Y.component?{componentType:e.componentType,mode:e.mode}:null;this.mark(e.type,e.group,n).parse(e),(t=e.marks)==null||t.forEach((e=>{this.parseMarkSpec(e)}))}theme(e){var t,n;v(e)?this._theme=QE.getTheme(e)??QE.getDefaultTheme():this._theme=e;let{background:r,padding:i}=this._spec??{};return this._theme?(this.background(r??this._options.background??this._theme.background),this.padding(i??this._options.padding??this._theme.padding),(n=(t=this.renderer.stage())?.setTheme)==null||n.call(t,Object.assign({},this._theme.marks))):(this.background(r??this._options.background),this.padding(i??this._options.padding)),this}getCurrentTheme(){return this._theme}setCurrentTheme(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return this.theme(e),this.grammars.getAllMarks().forEach((e=>{e.commit()})),t?(this.evaluate(),this.renderer.render(!0)):this._dataflow.evaluate(),this}background(e){return arguments.length?(this._background=e,this.renderer.background(e),e):this._background}width(e){let t=this.getSignalById(OE);return arguments.length?(this._options.width=e,this.updateSignal(t,e),e):t.output()}height(e){let t=this.getSignalById(kE);return arguments.length?(this._options.height=e,this.updateSignal(t,e),e):t.output()}viewWidth(e){let t=this.getSignalById(AE);if(arguments.length){let t=this.padding();return this.width(e+t.left+t.right),e}return t.output()}viewHeight(e){let t=this.getSignalById(jE);if(arguments.length){let t=this.padding();return this.height(e+t.top+t.bottom),e}return t.output()}padding(e){let t=this.getSignalById(ME);if(arguments.length){let n=zE(e);return this.updateSignal(t,n),n}return zE(t.output())}autoFit(e){let t=this.getSignalById(PE);return arguments.length?(this.updateSignal(t,e),e):t.output()}getViewBox(){return this.getSignalById(NE)?.output()}updateLayoutTag(){return this._layoutState=bT.before,this}getLayoutState(){return this._layoutState}buildLayoutTree(){let e={},t=[];this.traverseMarkTree((n=>{e[n.id()]=!0,n.group&&e[n.group.id()]||t.push(n),n.markType===Y.group&&n.updateLayoutChildren()}),(e=>e.needLayout())),this._layoutMarks=t}doLayout(){var e;let t=this._options.doLayout||Z.getDefaultLayout();t&&(e=this._layoutMarks)!=null&&e.length&&(this.emit(X.BEFORE_DO_LAYOUT),t(this._layoutMarks,this._options,this),this.emit(X.AFTER_DO_LAYOUT))}handleLayoutEnd(){this.emit(X.BEFORE_MARK_LAYOUT_END),this._layoutMarks.forEach((e=>{SE(e,\`layoutChildren\`,(e=>{e.handleLayoutEnd()}),(t=>t!==e))})),this.emit(X.AFTER_MARK_LAYOUT_END)}handleRenderEnd(){this.emit(X.BEFORE_MARK_RENDER_END),SE(this.rootMark,\`children\`,(e=>{e.handleRenderEnd()})),this.emit(X.AFTER_MARK_RENDER_END)}commit(e){return this._dataflow.commit(e),this}run(e){return this.evaluate(e),this}doRender(e){this.emit(X.BEFORE_DO_RENDER),this.renderer&&(!this._progressiveMarks&&this.animate?this.animate.animate():this.traverseMarkTree((e=>{e.cleanExitElements()}),null,!0),this.renderer.render(e),this.handleRenderEnd()),this.emit(X.AFTER_DO_RENDER)}evaluate(e){var t,n;let r=(e=>{var t;let{reuse:n=!0,morph:r=!0,morphAll:i=!1,animation:a={},enableExitAnimation:o=!0}=e??{};return{reuse:n,morph:r,morphAll:i,animation:{easing:a.easing??\`quintInOut\`,delay:a.delay??0,duration:a.duration??1e3,oneByOne:(t=a.oneByOne)!=null&&t,splitPath:a.splitPath??null},enableExitAnimation:o}})(e),i=this._cachedGrammars.size()>0;i&&(this.reuseCachedGrammars(r),this.detachCachedGrammar());let a=this._resizeRenderer(),o=this._dataflow.hasCommitted();return i||o||this._layoutState||a?(this.clearProgressive(),this._dataflow.evaluate(),this._needBuildLayoutTree&&=(this.buildLayoutTree(),!1),this._layoutState&&(this._layoutState=bT.layouting,this.doLayout(),this._dataflow.hasCommitted()&&(this._layoutState=bT.reevaluate,this._dataflow.evaluate()),this._layoutState=bT.after,(t=this._layoutMarks)!=null&&t.length&&this.handleLayoutEnd()),this._layoutState=null,this.findProgressiveMarks(),this._resizeRenderer(),(n=this.morph)==null||n.call(this,r),this.releaseCachedGrammars(r),this.doRender(!0),this.doPreProgressive(),this):this}reuseCachedGrammars(e){if(e.reuse){let e=e=>{e.next.reuse(e.prev),e.prev.detachAll(),e.prev.clear(),this._cachedGrammars.unrecord(e.prev)};this._differ.diffGrammar(this._cachedGrammars.getAllSignals(),this.grammars.getAllSignals().filter((e=>!RE.includes(e.id())))).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllData(),this.grammars.getAllData()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllScales(),this.grammars.getAllScales()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllCoordinates(),this.grammars.getAllCoordinates()).update.forEach(e)}this._differ.diffMark(this._cachedGrammars.getAllMarks(),this.grammars.getAllMarks().filter((e=>e.id()!==\`root\`)),e).update.forEach((t=>{var n;let r=t.prev.length===1&&t.next.length===1&&t.prev[0].markType===t.next[0].markType,i=t.prev.every((e=>e.getMorphConfig().morph))&&t.next.every((e=>e.getMorphConfig().morph));this.morph&&(e.morph&&i||e.morphAll)?(n=this.addMorphMarks)==null||n.call(this,{prev:t.prev,next:t.next}):r&&e.reuse&&(t.next[0].reuse(t.prev[0]),t.prev[0].detachAll(),t.prev[0].clear(),this._cachedGrammars.unrecord(t.prev[0]))}))}detachCachedGrammar(){this._cachedGrammars.traverse((e=>{var t,n;if(e.detachAll(),e.grammarType===\`mark\`){let r=e;(n=(t=r.group)?.removeChild)==null||n.call(t,r)}}))}releaseCachedGrammars(e){this._cachedGrammars.traverse((e=>{e.grammarType!==\`mark\`&&e.release()}));let t=this._cachedGrammars.getAllMarkNodes();t.forEach((t=>{var n;(n=t.mark.animate)==null||n.stop(),e.enableExitAnimation&&this.animate&&this.animate.animateAddition(t.mark)}));let n=e=>{if(e.mark.view&&(!e.mark.animate||e.mark.animate.getAnimatorCount()===0)&&(!e.children||e.children.length===0)){e.mark.release();let t=e.parent;t&&(e.parent.children=e.parent.children.filter((t=>t!==e)),e.parent=null,n(t))}};t.forEach((e=>{let t=e.mark;t.animate&&t.animate.getAnimatorCount()!==0?t.addEventListener(\`animationEnd\`,(()=>{t.animate&&t.animate.getAnimatorCount()===0&&n(e)})):n(e)})),this._cachedGrammars.clear()}runAfter(e){return this._dataflow.runAfter((()=>{e.call(null,this)})),this}runBefore(e){return this._dataflow.runBefore((()=>{e.call(null,this)})),this}getImageBuffer(){var e;if(this._options.mode!==\`node\`)return void this.logger.error(TypeError(\`getImageBuffer() now only support node environment.\`));let t=((e=this.renderer)?.stage)?.call(e);return t?(t.render(),t.window.getImageBuffer()):(this.logger.error(ReferenceError(\`render is not defined\`)),null)}traverseMarkTree(e,t,n){return SE(this.rootMark,\`children\`,e,t,n),this}_bindResizeEvent(){var e,t,n;if(this.autoFit()){let r=((t=((e=this.renderer)?.stage)?.call(e)?.window)?.getContainer)?.call(t);if(r){let e=window.ResizeObserver;this._observer=new e(this._onResize),(n=this._observer)==null||n.observe(r)}window.addEventListener(\`resize\`,this._onResize)}}_unBindResizeEvent(){this.autoFit()&&(window.removeEventListener(\`resize\`,this._onResize),this._observer&&=(this._observer.disconnect(),null))}_getContainerSize(){var e,t;let n=((t=((e=this.renderer)?.stage)?.call(e)?.window)?.getContainer)?.call(t);if(n){let{width:e,height:t}=Vt(n);return{width:this._spec?.width??this._options.width??e,height:this._spec?.height??this._options.height??t}}return null}resize(e,t){let n=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],r=!1;return e!==this.width()&&(r=!0,this.updateSignal(OE,e)),t!==this.height()&&(r=!0,this.updateSignal(kE,t)),r&&(n?this.evaluate({morph:!1}):this._dataflow.evaluate()),this}_resizeRenderer(){let e=this.width(),t=this.height();return!!this.renderer.shouldResize(e,t)&&(this.renderer.resize(e,t),this.emit(\`resize\`,{},{width:e,height:t}),!0)}interaction(e,t){let n=Z.createInteraction(e,this,t);return n&&(n.bind(),this._boundInteractions||=[],this._boundInteractions.push(n)),n}removeInteraction(e,t){if(this._boundInteractions){let n=this._boundInteractions.filter((n=>f(t)?v(e)?n.type===e:e?n===e:void 0:n.options?.id===t));n.length&&n.forEach((e=>{e.unbind()}))}return this}removeAllInteractions(){return this._boundInteractions&&=(this._boundInteractions.forEach((e=>{e.unbind()})),null),this}initializeEventConfig(e){let t=Object.assign({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{y(e[t])&&(e[t]=e[t].reduce(((e,t)=>(e[t]=!0,e)),{}))}))};return n(t.defaults,[\`prevent\`,\`allow\`]),n(t,[DE,EE]),t}initEvent(){let e=this.renderer.stage();e&&e.on(\`*\`,this.delegateEvent)}releaseStageEvent(){let e=this.renderer.stage();e&&e.off(\`*\`,this.delegateEvent)}addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=t,r.raw=t),n&&n.target&&(r.target=n.target),this.on(e,r),this}removeEventListener(e,t){return t?this.off(e,t):this.off(e),this}initializeRenderer(){let e=this._options.width,t=this._options.height;this.renderer=new CE(this),this.renderer.initialize(e,t,this._options,this._eventConfig).background(this._background)}initialize(){var e;this.grammars=new WE((e=>e.id()),((e,t)=>this.logger.warn(\`Grammar id '\${e}' has been occupied\`,t))),this._cachedGrammars=new GE((e=>e.id())),this._options.logger&&xe.setInstance(this._options.logger),this.logger=xe.getInstance(this._options.logLevel??0),this._dataflow=new xE,this.animate=this.initAnimate?.call(this,this),this._differ=new tD,this._options.hooks&&(Object.keys(this._options.hooks).forEach((e=>{this.on(e,this._options.hooks[e])})),this.hooks=this._options.hooks),this.container=null,this.renderer=null,this._eventListeners=[],this._eventConfig=this.initializeEventConfig(this._options.eventConfig),this._theme=this._options.disableTheme?null:QE.getDefaultTheme(),this.parseBuiltIn(),(e=this._options).mode&&jp.setEnv(e.mode,e.modeParams||{}),this.initializeRenderer(),this._eventConfig.disable||this.initEvent(),this._bindResizeEvent(),this._needBuildLayoutTree=!0,this._layoutState=bT.before,this.theme(this._theme)}pauseProgressive(){return!1}resumeProgressive(){return!1}restartProgressive(){return!1}findProgressiveMarks(){let e=[];return this.traverseMarkTree((t=>{e.push(t)}),(e=>e.markType!==Y.group&&e.isProgressive())),e.length?(this._progressiveMarks=e,this.renderer&&this.renderer.combineIncrementalLayers(),e):(this._progressiveMarks=null,null)}doPreProgressive(){this._progressiveMarks&&this._progressiveMarks.some((e=>e.isDoingProgressive()))?this._progressiveRafId=jp.getRequestAnimationFrame()(this.handleProgressiveFrame):this._progressiveMarks&&this.animate&&this._progressiveMarks.every((e=>e.canAnimateAfterProgressive()))?this.animate.animate():this._progressiveMarks&&=null}clearProgressive(){this._progressiveRafId&&jp.getCancelAnimationFrame()(this._progressiveRafId),this._progressiveMarks&&this._progressiveMarks.length&&(this._progressiveMarks.forEach((e=>{e.clearProgressive()})),this._progressiveMarks=null)}release(){var e,t,n,r;this.removeAllInteractions(),this.releaseStageEvent(),this._unBindResizeEvent(),this.clearProgressive(),Z.unregisterRuntimeTransforms(),xe.setInstance(null),(e=this.animate)==null||e.stop(),this.grammars.release(),this._cachedGrammars.release(),this._dataflow.release(),this._dataflow=null,(n=(t=this.renderer)?.release)==null||n.call(t),this.renderer=null,this._boundInteractions=null,this.removeAllListeners(),(r=this._eventListeners)==null||r.forEach((e=>{e.source.removeEventListener(e.type,e.handler)})),this._eventListeners=null}}let rD=()=>{gy(),ey(),Z.registerGraphic(Y.arc,Ou),pS(\`arc\`,wS)},iD=()=>{gy(),fy(),pS(\`rect\`,vS),Z.registerGraphic(Y.rect,su)};class aD extends $E{parseAddition(e){return super.parseAddition(e),this.scale(e.scale),this}scale(e){if(this.spec.scale){let e=v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this.detach(e),this.spec.scale=void 0}let t=v(e)?this.view.getScaleById(e):e;return this.spec.scale=t,this.attach(t),this._updateComponentEncoders(),this.commit(),this}getScale(){return v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale}}let oD=(e,t,n,r,i,a)=>{let o=e.getCoordinateAxisPosition();i&&i.position===\`auto\`&&(i.position=n?\`content\`:o);let s=e.getCoordinateAxisPoints(r);if(s){let r={start:s[0],end:s[1],verticalFactor:(o===\`top\`||o===\`left\`?-1:1)*(n?-1:1)*(e.getSpec().range?.reversed?-1:1)};if(a&&t.type===\`polar\`){let e=t.angle();r.center=t.origin(),r.startAngle=e[0],r.endAngle=e[1]}return r}let c=t.radius(),l=t.angle();return{center:t.origin(),radius:c[1],innerRadius:c[0],inside:n,startAngle:l[0],endAngle:l[1]}};class sD extends aD{constructor(e,t,n){super(e,fT.axis,t),this.spec.componentType=fT.axis,this.mode=n}parseAddition(e){return super.parseAddition(e),this.axisType(e.axisType),this.tickCount(e.tickCount),this.inside(e.inside),this.baseValue(e.baseValue),this}scale(e){return super.scale(e),this._axisComponentType=null,this}axisType(e){return this.spec.axisType=e,this._axisComponentType=null,this._prepareRejoin(),this.commit(),this}addGraphicItem(e,t){let n=N({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},e),r=Z.createGraphicComponent(this._getAxisComponentType(),n,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(n,t,r)}tickCount(e){let t=v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return t&&t.tickCount(e),this.setFunctionSpec(e,\`tickCount\`)}inside(e){return this.setFunctionSpec(e,\`inside\`)}baseValue(e){return this.setFunctionSpec(e,\`baseValue\`)}getAxisComponentType(){return this._axisComponentType}_updateComponentEncoders(){let e=v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale,t=Object.assign({update:{}},this.spec.encode);this._encoders=Object.keys(t).reduce(((n,r)=>{let i=t[r];return i&&(n[r]={callback:(t,n,r)=>{let a=this.spec.skipTheme?null:this.view.getCurrentTheme(),o=VT(i,t,n,r),s=MT(this.spec.inside,r,t,n),c=MT(this.spec.baseValue,r,t,n),l=(e?.getCoordinate)?.call(e);l&&(o=Object.assign(oD(e,l,s,c,this.spec.layout),o));let u=(e?.getScale)?.call(e),d=MT(this.spec.tickCount,r,t,n);switch(this._getAxisComponentType()){case mT.lineAxis:return((e,t,n,r)=>{let i=t?.components?.axis??{};return e?N({},i,{items:[(e.tickData?.call(e,r)??[]).map((e=>({id:e.index,label:e.tick,value:e.value,rawValue:e.tick})))]},n??{}):N({},i,n??{})})(u,a,o,d);case mT.circleAxis:return((e,t,n,r)=>{let i=t?.components?.circleAxis??{};return e?N({},i,{items:[(e.tickData?.call(e,r)??[]).map((e=>({id:e.index,label:e.tick,value:e.value,rawValue:e.tick})))]},n??{}):N({},i,n??{})})(u,a,o,d)}return o}}),n}),{})}_getAxisComponentType(){if(this._axisComponentType)return this._axisComponentType;let e=this.spec.axisType;if(f(e)){let t=v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;e=(t?.getCoordinate)?.call(t)?t.getCoordinateAxisPoints()?\`line\`:\`circle\`:\`line\`}return this._axisComponentType=e===\`circle\`?mT.circleAxis:mT.lineAxis,this._axisComponentType}}sD.componentType=fT.axis;let cD=()=>{Z.registerGraphicComponent(mT.lineAxis,((e,t)=>new Db(e,t))),Z.registerComponent(fT.axis,sD)};var lD=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==\`function\`){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};let uD=class extends $E{constructor(e,t){super(e,fT.label,t),this.spec.componentType=fT.label}parseAddition(e){return super.parseAddition(e),this.labelStyle(e.labelStyle),this.size(e.size),this.target(e.target),this}labelStyle(e){return this.setFunctionSpec(e,\`labelStyle\`)}size(e){return this.setFunctionSpec(e,\`size\`)}target(e){if(this.spec.target){let e=P(this.spec.target).map((e=>v(e)?this.view.getMarkById(e):e));this.detach(e)}if(this.spec.target=e,e){let t=P(e).map((e=>v(e)?this.view.getMarkById(e):e));this.attach(t)}return this.commit(),this}_updateComponentEncoders(){let e=Object.assign({update:{}},this.spec.encode);this._encoders=Object.keys(e).reduce(((t,n)=>{let r=e[n];return r&&(t[n]={callback:(e,t,n)=>{var i;let a=P(this.spec.target).map((e=>v(e)?this.view.getMarkById(e):e)),o=((i=this.group)?.getGroupGraphicItem)?.call(i),s=MT(this.spec.size,n);s||=o?{width:o.attribute.width??o.AABBBounds.width(),height:o.attribute.height??o.AABBBounds.height()}:{width:1/0,height:1/0};let c=this.spec.skipTheme?null:this.view.getCurrentTheme();return function(e,t,n,r,i){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=a.components?.dataLabel,s=e.map(((e,t)=>{let o=Object.assign(Object.assign({},i),{labelIndex:t}),s=MT(r,o,e)??{},{components:c={}}=a,l={};switch(e.markType){case Y.line:case Y.area:l=s.type===\`line\`?c.lineLabel:s.type===\`area\`?c.areaLabel:c.lineDataLabel;break;case Y.rect:case Y.rect3d:case Y.interval:l=c.rectLabel;break;case Y.symbol:case Y.circle:case Y.cell:l=c.symbolLabel;break;case Y.arc:case Y.arc3d:l=c.arcLabel;break;case Y.polygon:case Y.path:default:l=c.pointLabel}let u=s.data??[],d=l?.data?.[0]??{};if(u&&u.length>0)u.forEach(((t,r)=>{if(e.elements[r]){let i=VT(n,t,e.elements[r],o);N(t,d,i)}}));else{let t=(e,t)=>{let{data:n}=e,r=lD(e,[\`data\`]);return Object.assign(Object.assign({},N({},t,r)),{data:n})};e.elements.forEach((r=>{if(r.getGraphicItem().releaseStatus!==\`willRelease\`)if(e.isCollectionMark())r.getDatum().forEach((e=>{let i=VT(n,e,r,o);u.push(t(i,d))}));else{let e=VT(n,r.getDatum(),r,o);u.push(t(e,d))}}))}let f=N({},l,{baseMarkGroupName:e.graphicItem?.name,getBaseMarks:()=>e.elements.map((e=>e.getGraphicItem()))},s??{});return f.data=u??l.data,f})).filter((e=>!f(e))),c=N({},o,{size:t});return c.dataLabels=s,c}(a,s,r,this.spec.labelStyle,n,c)}}),t}),{})}};uD.componentType=fT.label;class dD extends aD{constructor(e,t,n){super(e,fT.grid,t),this.spec.componentType=fT.grid,this.mode=n}parseAddition(e){return super.parseAddition(e),this.target(e.target),this.gridType(e.gridType),this.gridShape(e.gridShape),this}scale(e){return super.scale(e),this._gridComponentType=null,this}gridType(e){return this.spec.gridType=e,this._gridComponentType=null,this._prepareRejoin(),this.commit(),this}gridShape(e){return this.spec.gridShape=e,this.commit(),this}target(e){if(this.spec.target){let e=v(this.spec.target)?this.view.getMarkById(this.spec.target):this.spec.target;this.detach(e)}this.spec.target=e;let t=v(e)?this.view.getMarkById(e):e;return this.attach(t),this._targetAxis=t,this._gridComponentType=null,this._updateComponentEncoders(),this.commit(),this}tickCount(e){let t=v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return t&&t.tickCount(e),this.setFunctionSpec(e,\`tickCount\`)}inside(e){return this.setFunctionSpec(e,\`inside\`)}baseValue(e){return this.setFunctionSpec(e,\`baseValue\`)}addGraphicItem(e,t){let n=N({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},e),r=Z.createGraphicComponent(this._getGridComponentType(),n,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(n,t,r)}_updateComponentEncoders(){let e=Object.assign({update:{}},this.spec.encode);this._encoders=Object.keys(e).reduce(((t,n)=>{let r=e[n];return r&&(t[n]={callback:(e,t,n)=>{let i=this.spec.skipTheme?null:this.view.getCurrentTheme(),a,o=VT(r,e,t,n),s=MT(this.spec.baseValue,n,e,t);if(this._targetAxis){let e=this._targetAxis.getSpec()?.scale;a=v(e)?this.view.getScaleById(e):e;let t=this._targetAxis.elements[0];if(t)switch(this._getGridComponentType()){case hT.lineAxisGrid:o=Object.assign({x:t.getGraphicAttribute(\`x\`),y:t.getGraphicAttribute(\`y\`),start:t.getGraphicAttribute(\`start\`),end:t.getGraphicAttribute(\`end\`),verticalFactor:t.getGraphicAttribute(\`verticalFactor\`)??1},o);break;case hT.circleAxisGrid:o=Object.assign({x:t.getGraphicAttribute(\`x\`),y:t.getGraphicAttribute(\`y\`),center:t.getGraphicAttribute(\`center\`),radius:t.getGraphicAttribute(\`radius\`),innerRadius:t.getGraphicAttribute(\`innerRadius\`),inside:t.getGraphicAttribute(\`inside\`),startAngle:t.getGraphicAttribute(\`startAngle\`),endAngle:t.getGraphicAttribute(\`endAngle\`)},o)}}else{a=v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;let r=MT(this.spec.inside,n,e,t),i=(a?.getCoordinate)?.call(a);i&&(o=Object.assign(oD(a,i,r,s,this.spec.layout,!0),o))}this._getGridComponentType()===hT.lineAxisGrid&&(o=this.spec.gridShape!==\`line\`&&this.spec.gridShape?Object.assign({center:o.start,closed:!0},o,{type:this.spec.gridShape}):Object.assign({},o,{type:\`line\`}));let c=(a?.getScale)?.call(a),l=MT(this.spec.tickCount,n,e,t);switch(this._getGridComponentType()){case hT.lineAxisGrid:return((e,t,n,r)=>{let i=t?.components?.grid??{};return e?N({},i,{items:(e.tickData?.call(e,r)??[]).map((e=>({id:e.index,label:e.tick,value:e.value,rawValue:e.tick})))},n??{}):N({},i,n??{})})(c,i,o,l);case hT.circleAxisGrid:return((e,t,n,r)=>{let i=t?.components?.circleGrid??{};return e?N({},i,{items:(e.tickData?.call(e,r)??[]).map((e=>({id:e.index,label:e.tick,value:e.value,rawValue:e.tick})))},n??{}):N({},i,n??{})})(c,i,o,l)}return o}}),t}),{})}_getGridComponentType(){if(this._gridComponentType)return this._gridComponentType;if(this.spec.gridType)this.spec.gridType===\`circle\`?this._gridComponentType=hT.circleAxisGrid:this._gridComponentType=hT.lineAxisGrid;else if(this._targetAxis)switch(this._targetAxis.getAxisComponentType()){case mT.circleAxis:this._gridComponentType=hT.circleAxisGrid;break;case mT.lineAxis:default:this._gridComponentType=hT.lineAxisGrid}else if(this.spec.scale){let e=v(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this._gridComponentType=(e?.getCoordinate)?.call(e)?e.getCoordinateAxisPoints()?hT.lineAxisGrid:hT.circleAxisGrid:hT.lineAxisGrid}else this._gridComponentType=hT.lineAxisGrid;return this._gridComponentType}}dD.componentType=fT.grid;let fD=()=>{Z.registerGraphicComponent(hT.lineAxisGrid,((e,t)=>new AS(e,t))),Z.registerComponent(fT.grid,dD)};function pD(e){return e.reduce(((e,t)=>e+t),0)}let mD={min:pe,max:fe,average:function(e){return e.length===0?0:pD(e)/e.length},sum:pD};function hD(e,t,n,r){let i=Math.floor(t.length/e),a=[],o=t.length,s,c,l,u=0,d=0;a[d++]=u;for(let e=1;e<o-1;e+=i){let n=Math.min(e+i,o-1),f=Math.min(e+2*i,o),p=(f+n)/2,m=0;for(let e=n;e<f;e++){let n=t[e][r];Number.isNaN(n)||(m+=n)}m/=f-n;let h=e,g=Math.min(e+i,o),_=e-1,v=t[u][r];s=-1,l=h;for(let e=h;e<g;e++){let n=t[e][r];Number.isNaN(r)||(c=Math.abs((_-p)*(n-v)-(_-e)*(m-v)),c>s&&(s=c,l=e))}a[d++]=l,u=l}return a[d-1]!==o-1&&(a[d++]=o-1),a.map((e=>n?t[e].i:e))}function gD(e,t,n,r,i){let a=Math.floor(t.length/e),o=[],s=t.length,c=0,l=[];o.push(c),t[c][i]=t[c][i];for(let e=1;e<s-1;e+=a){a>s-e&&(a=s-e,l.length=a),l=[];for(let n=0;n<a;n++)l.push(t[e+n][i]);let n=mD[r](l);c=Math.min(Math.round(e+l.length/2)||0,s-1),t[c][i]=n,o.push(c)}return o.map((e=>n?t[e].i:e))}function _D(e,t,n,r){return gD(e,t,n,\`min\`,r)}function vD(e,t,n,r){return gD(e,t,n,\`max\`,r)}function yD(e,t,n,r){return gD(e,t,n,\`average\`,r)}function bD(e,t,n,r){return gD(e,t,n,\`sum\`,r)}let xD=(e,t)=>{let n=e.size,r=e.factor||1;if(Array.isArray(n)&&(n=Math.floor(n[1]-n[0])),n*=r,n<=0)return[];if(t.length<=n)return t;if(e.skipfirst)return t.slice(0,1);let{mode:i,yfield:a,groupBy:o}=e,s=a??\`y\`,c=hD;if(i===\`min\`?c=_D:i===\`max\`?c=vD:i===\`average\`?c=yD:i===\`sum\`&&(c=bD),t.length){let e={};if(o){for(let n=0,r=t.length;n<r;n++){let r=t[n],i=r[o];e[i]||(e[i]=[]),e[i].push({[s]:r[s],i:n})}let r=[];return Object.keys(e).forEach((i=>{let a=e[i];if(a.length<=n){let e=a.map((e=>e.i));r=r.concat(e)}else{let e=c(n,a,!0,s);r=r.concat(e),a.forEach((e=>t[e.i][s]=e[s]))}})),r.sort(((e,t)=>e-t)),r.map((e=>t[e]))}return c(n,t,!1,s).map((e=>t[e]))}return[]},SD=(e,t)=>{if(!t||t.length===0)return;let{radius:n}=e;f(n)&&t[0].mark.markType===\`symbol\`&&(n=!0);let{direction:r,delta:i,deltaMul:a=1,groupBy:o}=e,s=t=>{(function(e){e.forEach((e=>{e.getGraphicAttribute(OT)&&(e.setGraphicAttribute(\`visible\`,!0),e.setGraphicAttribute(OT,!1))}))})(t);let o=e.sort?t.slice().sort(((e,t)=>e.getGraphicAttribute(\`x\`)-t.getGraphicAttribute(\`x\`))):t;r===0?function(e,t,n,r){if(r){let r=-1/0,i=0,a=0,o=f(t),s=t;e.forEach((e=>{if(!1===e.getGraphicAttribute(\`visible\`))return;let t=e.getGraphicAttribute(\`size\`)/2,c=e.getGraphicAttribute(\`x\`),l=e.getGraphicAttribute(\`y\`);o&&(s=(t+i)*n),a=(-1/0-c)**2+(r-l)**2,a<(s+i+t)**2?e.getGraphicAttribute(\`forceShow\`)||(e.setGraphicAttribute(OT,!0),e.setGraphicAttribute(\`visible\`,!1)):r=l,i=t}))}}(o,i,a,n):r===1?function(e,t,n,r){if(r){let r=-1/0,i=0,a=f(t),o=t;e.forEach((e=>{if(!1===e.getGraphicAttribute(\`visible\`))return;let t=e.getGraphicAttribute(\`size\`)/2,s=e.getGraphicAttribute(\`x\`);a&&(o=(t+i)*n),Math.abs(s-r)<o+i+t?e.getGraphicAttribute(\`forceShow\`)||(e.setGraphicAttribute(OT,!0),e.setGraphicAttribute(\`visible\`,!1)):r=s,i=t}))}}(o,i,a,n):function(e,t,n,r){if(r){let r=-1/0,i=0,a=f(t),o=t;e.forEach((e=>{if(!1===e.getGraphicAttribute(\`visible\`))return;let t=e.getGraphicAttribute(\`size\`)/2,s=e.getGraphicAttribute(\`y\`);a&&(o=(t+i)*n),Math.abs(s-r)<o+i+t?e.getGraphicAttribute(\`forceShow\`)||(e.setGraphicAttribute(OT,!0),e.setGraphicAttribute(\`visible\`,!1)):r=s,i=t}))}}(o,i,a,n)};if(o){let e=t.reduce(((e,t)=>{let n=t.getDatum()[o];return e[n]?e[n].push(t):e[n]=[t],e}),{});Object.keys(e).forEach((t=>{s(e[t])}))}else s(t);return t},CD=()=>{Z.registerTransform(\`sampling\`,{transform:xD,markPhase:\`afterEncode\`},!0)},wD=()=>{Z.registerTransform(\`markoverlap\`,{transform:SD,markPhase:\`afterEncode\`},!0)},TD=(e,t,n)=>{let r=e.getGraphicAttribute(\`clipRangeByDimension\`,!1),i=e.getGraphicAttribute(\`clipRange\`,!1)??1;return t&&t.clipDimension?{from:{clipRange:0,clipRangeByDimension:t.clipDimension},to:{clipRange:i,clipRangeByDimension:r}}:{from:{clipRange:0},to:{clipRange:i}}},ED=(e,t,n)=>{let r=e.getGraphicAttribute(\`clipRangeByDimension\`,!0),i=e.getGraphicAttribute(\`clipRange\`,!0)??1;return t&&t.clipDimension?{from:{clipRange:i,clipRangeByDimension:t.clipDimension},to:{clipRange:0,clipRangeByDimension:r}}:{from:{clipRange:i},to:{clipRange:0}}},DD=(e,t,n)=>{switch(t?.direction){case\`x\`:{let t=e.getFinalAnimationAttribute(\`x\`),n=e.getFinalAnimationAttribute(\`x1\`),r=e.getFinalAnimationAttribute(\`width\`);return{from:p(r)?{x:t+r/2,x1:void 0,width:0}:{x:(t+n)/2,x1:(t+n)/2,width:void 0},to:{x:t,x1:n,width:r}}}case\`y\`:{let t=e.getFinalAnimationAttribute(\`y\`),n=e.getFinalAnimationAttribute(\`y1\`),r=e.getFinalAnimationAttribute(\`height\`);return{from:p(r)?{y:t+r/2,y1:void 0,height:0}:{y:(t+n)/2,y1:(t+n)/2,height:void 0},to:{y:t,y1:n,height:r}}}default:{let t=e.getFinalAnimationAttribute(\`x\`),n=e.getFinalAnimationAttribute(\`x1\`),r=e.getFinalAnimationAttribute(\`width\`),i=e.getFinalAnimationAttribute(\`y\`),a=e.getFinalAnimationAttribute(\`y1\`),o=e.getFinalAnimationAttribute(\`height\`),s={};return p(r)?(s.x=t+r/2,s.width=0,s.x1=void 0):(s.x=(t+n)/2,s.x1=(t+n)/2,s.width=void 0),p(o)?(s.y=i+o/2,s.height=0,s.y1=void 0):(s.y=(i+a)/2,s.y1=(i+a)/2,s.height=void 0),{from:s,to:{x:t,y:i,x1:n,y1:a,width:r,height:o}}}}},OD=(e,t,n)=>{switch(t?.direction){case\`x\`:{let t=e.getFinalAnimationAttribute(\`x\`),n=e.getFinalAnimationAttribute(\`x1\`),r=e.getFinalAnimationAttribute(\`width\`);return{to:p(r)?{x:t+r/2,x1:void 0,width:0}:{x:(t+n)/2,x1:(t+n)/2,width:void 0}}}case\`y\`:{let t=e.getFinalAnimationAttribute(\`y\`),n=e.getFinalAnimationAttribute(\`y1\`),r=e.getFinalAnimationAttribute(\`height\`);return{to:p(r)?{y:t+r/2,y1:void 0,height:0}:{y:(t+n)/2,y1:(t+n)/2,height:void 0}}}default:{let t=e.getFinalAnimationAttribute(\`x\`),n=e.getFinalAnimationAttribute(\`y\`),r=e.getFinalAnimationAttribute(\`x1\`),i=e.getFinalAnimationAttribute(\`y1\`),a=e.getFinalAnimationAttribute(\`width\`),o=e.getFinalAnimationAttribute(\`height\`),s={};return p(a)?(s.x=t+a/2,s.width=0,s.x1=void 0):(s.x=(t+r)/2,s.x1=(t+r)/2,s.width=void 0),p(o)?(s.y=n+o/2,s.height=0,s.y1=void 0):(s.y=(n+i)/2,s.y1=(n+i)/2,s.height=void 0),{to:s}}}},kD=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?function(e,t,n){let r=e.getFinalAnimationAttribute(\`x\`),i=e.getFinalAnimationAttribute(\`x1\`),a=e.getFinalAnimationAttribute(\`width\`);if(t&&t.orient===\`negative\`){let e=p(a)?Math.max(r,r+a):Math.max(r,i);return{from:{x:e,x1:f(i)?void 0:e,width:f(a)?void 0:0},to:{x:r,x1:i,width:a}}}let o=p(a)?Math.min(r,r+a):Math.min(r,i);return{from:{x:o,x1:f(i)?void 0:o,width:f(a)?void 0:0},to:{x:r,x1:i,width:a}}}(e,t):function(e,t,n){let r=e.getFinalAnimationAttribute(\`x\`),i=e.getFinalAnimationAttribute(\`x1\`),a=e.getFinalAnimationAttribute(\`width\`),o;return t&&t.orient===\`negative\`?S(t.overall)?o=t.overall:n.group?(o=n.groupWidth??n.group.getBounds().width(),n.groupWidth=o):o=n.width:o=S(t?.overall)?t?.overall:0,{from:{x:o,x1:f(i)?void 0:o,width:f(a)?void 0:0},to:{x:r,x1:i,width:a}}}(e,t,n)},AD=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?function(e,t,n){let r=e.getFinalAnimationAttribute(\`x\`),i=e.getFinalAnimationAttribute(\`x1\`),a=e.getFinalAnimationAttribute(\`width\`);if(t&&t.orient===\`negative\`){let e=p(a)?Math.max(r,r+a):Math.max(r,i);return{to:{x:e,x1:f(i)?void 0:e,width:f(a)?void 0:0}}}let o=p(a)?Math.min(r,r+a):Math.min(r,i);return{to:{x:o,x1:f(i)?void 0:o,width:f(a)?void 0:0}}}(e,t):function(e,t,n){let r=e.getFinalAnimationAttribute(\`x1\`),i=e.getFinalAnimationAttribute(\`width\`),a;return t&&t.orient===\`negative\`?S(t.overall)?a=t.overall:n.group?(a=n.groupWidth??n.group.getBounds().width(),n.groupWidth=a):a=n.width:a=S(t?.overall)?t.overall:0,{to:{x:a,x1:f(r)?void 0:a,width:f(i)?void 0:0}}}(e,t,n)},jD=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?function(e,t,n){let r=e.getFinalAnimationAttribute(\`y\`),i=e.getFinalAnimationAttribute(\`y1\`),a=e.getFinalAnimationAttribute(\`height\`);if(t&&t.orient===\`negative\`){let e=p(a)?Math.max(r,r+a):Math.max(r,i);return{from:{y:e,y1:f(i)?void 0:e,height:f(a)?void 0:0},to:{y:r,y1:i,height:a}}}let o=p(a)?Math.min(r,r+a):Math.min(r,i);return{from:{y:o,y1:f(i)?void 0:o,height:f(a)?void 0:0},to:{y:r,y1:i,height:a}}}(e,t):function(e,t,n){let r=e.getFinalAnimationAttribute(\`y\`),i=e.getFinalAnimationAttribute(\`y1\`),a=e.getFinalAnimationAttribute(\`height\`),o;return t&&t.orient===\`negative\`?S(t.overall)?o=t.overall:n.group?(o=n.groupHeight??n.group.getBounds().height(),n.groupHeight=o):o=n.height:o=S(t?.overall)?t.overall:0,{from:{y:o,y1:f(i)?void 0:o,height:f(a)?void 0:0},to:{y:r,y1:i,height:a}}}(e,t,n)},MD=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?function(e,t,n){let r=e.getFinalAnimationAttribute(\`y\`),i=e.getFinalAnimationAttribute(\`y1\`),a=e.getFinalAnimationAttribute(\`height\`);if(t&&t.orient===\`negative\`){let e=p(a)?Math.max(r,r+a):Math.max(r,i);return{to:{y:e,y1:f(i)?void 0:e,height:f(a)?void 0:0}}}let o=p(a)?Math.min(r,r+a):Math.min(r,i);return{to:{y:o,y1:f(i)?void 0:o,height:f(a)?void 0:0}}}(e,t):function(e,t,n){let r=e.getFinalAnimationAttribute(\`y1\`),i=e.getFinalAnimationAttribute(\`height\`),a;return t&&t.orient===\`negative\`?S(t.overall)?a=t.overall:n.group?(a=n.groupHeight??n.group.getBounds().height(),n.groupHeight=a):a=n.height:a=S(t?.overall)?t.overall:0,{to:{y:a,y1:f(r)?void 0:a,height:f(i)?void 0:0}}}(e,t,n)},ND=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?((e,t,n)=>{let r=e.getFinalAnimationAttributes();return t&&t.orient===\`anticlockwise\`?{from:{startAngle:r?.endAngle},to:{startAngle:r?.startAngle}}:{from:{endAngle:r?.startAngle},to:{endAngle:r?.endAngle}}})(e,t):((e,t,n)=>{let r=e.getFinalAnimationAttributes();if(t&&t.orient===\`anticlockwise\`){let e=S(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:e,endAngle:e},to:{startAngle:r?.startAngle,endAngle:r?.endAngle}}}let i=S(t?.overall)?t.overall:0;return{from:{startAngle:i,endAngle:i},to:{startAngle:r?.startAngle,endAngle:r?.endAngle}}})(e,t)},PD=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?((e,t,n)=>{let r=e.getFinalAnimationAttributes();return t&&t.orient===\`anticlockwise\`?{from:{startAngle:e.getGraphicAttribute(\`startAngle\`,!0)},to:{startAngle:r?.endAngle}}:{from:{endAngle:e.getGraphicAttribute(\`endAngle\`,!0)},to:{endAngle:r?.startAngle}}})(e,t):((e,t,n)=>{if(t&&t.orient===\`anticlockwise\`){let n=S(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:e.getGraphicAttribute(\`startAngle\`,!0),endAngle:e.getGraphicAttribute(\`endAngle\`,!0)},to:{startAngle:n,endAngle:n}}}let r=S(t?.overall)?t.overall:0;return{from:{startAngle:e.getGraphicAttribute(\`startAngle\`,!0),endAngle:e.getGraphicAttribute(\`endAngle\`,!0)},to:{startAngle:r,endAngle:r}}})(e,t)},FD=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?((e,t,n)=>{let r=e.getFinalAnimationAttributes();return t&&t.orient===\`inside\`?{from:{innerRadius:r?.outerRadius},to:{innerRadius:r?.innerRadius}}:{from:{outerRadius:r?.innerRadius},to:{outerRadius:r?.outerRadius}}})(e,t):((e,t,n)=>{let r=e.getFinalAnimationAttributes(),i=S(t?.overall)?t.overall:0;return{from:{innerRadius:i,outerRadius:i},to:{innerRadius:r?.innerRadius,outerRadius:r?.outerRadius}}})(e,t)},ID=(e,t,n)=>{var r;return!1===((r=t?.overall)!=null&&r)?((e,t,n)=>{let r=e.getFinalAnimationAttributes();return t&&t.orient===\`inside\`?{from:{innerRadius:e.getGraphicAttribute(\`innerRadius\`,!0)},to:{innerRadius:r?.outerRadius}}:{from:{outerRadius:e.getGraphicAttribute(\`outerRadius\`,!0)},to:{outerRadius:r?.innerRadius}}})(e,t):((e,t,n)=>{let r=S(t?.overall)?t.overall:0;return{from:{innerRadius:e.getGraphicAttribute(\`innerRadius\`,!0),outerRadius:e.getGraphicAttribute(\`outerRadius\`,!0)},to:{innerRadius:r,outerRadius:r}}})(e,t)},LD=(e,t,n)=>{let r=e.getGraphicAttribute(\`points\`,!1),i={x:0,y:0};return r.forEach((e=>{i.x+=e.x,i.y+=e.y})),i.x/=r.length,i.y/=r.length,t&&t.center&&(C(t.center.x)&&(i.x=t.center.x),C(t.center.y)&&(i.y=t.center.y)),e.mark.markType===\`area\`&&(i.x1=i.x,i.y1=i.y),r.map((e=>Object.assign({},e,i)))},RD=(e,t,n)=>({from:{points:LD(e,t)},to:{points:e.getGraphicAttribute(\`points\`,!1)}}),zD=(e,t,n)=>({from:{points:e.getGraphicAttribute(\`points\`,!0)},to:{points:LD(e,t)}}),BD=(e,t,n)=>e.getGraphicAttribute(\`points\`,!1).map((e=>{if(t&&t.orient===\`negative\`){let t=n.width;return n.group&&(t=n.groupWidth??n.group.getBounds().width(),n.groupWidth=t),Object.assign(Object.assign({},e),{x:t,y:e.y,x1:t,y1:e.y1,defined:!1!==e.defined})}return Object.assign(Object.assign({},e),{x:0,y:e.y,x1:0,y1:e.y1,defined:!1!==e.defined})})),VD=(e,t,n)=>({from:{points:BD(e,t,n)},to:{points:e.getGraphicAttribute(\`points\`,!1)}}),HD=(e,t,n)=>({from:{points:e.getGraphicAttribute(\`points\`,!0)},to:{points:BD(e,t,n)}}),UD=(e,t,n)=>e.getGraphicAttribute(\`points\`,!1).map((e=>{if(t&&t.orient===\`negative\`){let t=n.height;return n.group&&(t=n.groupHeight??n.group.getBounds().height(),n.groupHeight=t),Object.assign(Object.assign({},e),{x:e.x,y:t,x1:e.x1,y1:t,defined:!1!==e.defined})}return Object.assign(Object.assign({},e),{x:e.x,y:0,x1:e.x1,y1:0,defined:!1!==e.defined})})),WD=(e,t,n)=>({from:{points:UD(e,t,n)},to:{points:e.getGraphicAttribute(\`points\`,!1)}}),GD=(e,t,n)=>({from:{points:e.getGraphicAttribute(\`points\`,!0)},to:{points:UD(e,t,n)}}),KD=()=>{Z.registerAnimationType(\`clipIn\`,TD)},qD=()=>{Z.registerAnimationType(\`clipOut\`,ED)},JD=()=>{Z.registerAnimationType(\`growCenterIn\`,DD)},YD=()=>{Z.registerAnimationType(\`growCenterOut\`,OD)},XD=()=>{Z.registerAnimationType(\`growHeightIn\`,jD)},ZD=()=>{Z.registerAnimationType(\`growHeightOut\`,MD)},QD=()=>{Z.registerAnimationType(\`growWidthIn\`,kD)},$D=()=>{Z.registerAnimationType(\`growWidthOut\`,AD)},eO=()=>{Z.registerAnimationType(\`growPointsIn\`,RD)},tO=()=>{Z.registerAnimationType(\`growPointsOut\`,zD)},nO=()=>{Z.registerAnimationType(\`growPointsXIn\`,VD)},rO=()=>{Z.registerAnimationType(\`growPointsXOut\`,HD)},iO=()=>{Z.registerAnimationType(\`growPointsYIn\`,WD)},aO=()=>{Z.registerAnimationType(\`growPointsYOut\`,GD)},oO=()=>{Z.registerAnimationType(\`growAngleIn\`,ND)},sO=()=>{Z.registerAnimationType(\`growAngleOut\`,PD)},cO=()=>{Z.registerAnimationType(\`growRadiusIn\`,FD)},lO=()=>{Z.registerAnimationType(\`growRadiusOut\`,ID)},uO=()=>{Z.registerStageEventPlugin(\`gesture\`,vh)},dO=\`pointerdown.pointerup.pointerupoutside.pointertap.pointerover.pointermove.pointerenter.pointerleave.pointerout.mousedown.mouseup.mouseupoutside.rightdown.rightup.rightupoutside.click.dblclick.mousemove.mouseover.mouseout.mouseenter.mouseleave.wheel.touchstart.touchend.touchendoutside.touchmove.touchcancel.tap.dragstart.drag.dragenter.dragleave.dragover.dragend.drop.pan.panstart.panend.press.pressup.pressend.pinch.pinchstart.pinchend.swipe\`.split(\`.\`);var Q,fO,pO;(function(e){e.initialized=\`initialized\`,e.rendered=\`rendered\`,e.renderFinished=\`renderFinished\`,e.animationFinished=\`animationFinished\`,e.regionSeriesDataFilterOver=\`regionSeriesDataFilterOver\`,e.afterInitData=\`afterInitData\`,e.afterInitEvent=\`afterInitEvent\`,e.afterInitMark=\`afterInitMark\`,e.rawDataUpdate=\`rawDataUpdate\`,e.viewDataFilterOver=\`viewDataFilterOver\`,e.viewDataUpdate=\`viewDataUpdate\`,e.viewDataStatisticsUpdate=\`viewDataStatisticsUpdate\`,e.markDeltaYUpdate=\`markDeltaYUpdate\`,e.viewDataLabelUpdate=\`viewDataLabelUpdate\`,e.scaleDomainUpdate=\`scaleDomainUpdate\`,e.scaleUpdate=\`scaleUpdate\`,e.dataZoomChange=\`dataZoomChange\`,e.drill=\`drill\`,e.layoutStart=\`layoutStart\`,e.layoutEnd=\`layoutEnd\`,e.layoutRectUpdate=\`layoutRectUpdate\`,e.playerPlay=\`playerPlay\`,e.playerPause=\`playerPause\`,e.playerEnd=\`playerEnd\`,e.playerChange=\`playerChange\`,e.playerForward=\`playerForward\`,e.playerBackward=\`playerBackward\`,e.scrollBarChange=\`scrollBarChange\`,e.brushStart=\`brushStart\`,e.brushChange=\`brushChange\`,e.brushEnd=\`brushEnd\`,e.brushClear=\`brushClear\`,e.legendSelectedDataChange=\`legendSelectedDataChange\`,e.legendFilter=\`legendFilter\`,e.legendItemClick=\`legendItemClick\`,e.legendItemHover=\`legendItemHover\`,e.legendItemUnHover=\`legendItemUnHover\`,e.tooltipShow=\`tooltipShow\`,e.tooltipHide=\`tooltipHide\`,e.tooltipRelease=\`tooltipRelease\`,e.afterResize=\`afterResize\`,e.afterRender=\`afterRender\`,e.afterLayout=\`afterLayout\`})(Q||={}),function(e){e.chart=\`chart\`,e.window=\`window\`,e.canvas=\`canvas\`}(fO||={}),function(e){e.vchart=\`vchart\`,e.chart=\`chart\`,e.model=\`model\`,e.mark=\`mark\`}(pO||={});let mO=[pO.mark,pO.model,pO.chart,pO.vchart],hO=(e,t)=>e===t||!f(e)&&!f(t)&&e.value===t.value&&e.axis?.id===t.axis?.id,gO=(e,t)=>{let n=e.tooltipFilterRange,r=typeof n==\`function\`?n({scale:t}):n;return C(r)?[-r,r]:r},_O=(e,t,n,r)=>{let i=t.getScale(),a=Ib(i.type),o=[],s=t.getOption().getChart().getSeriesInIndex(t.getSpecInfo().seriesIndexes);for(let c of s)if(c.coordinate===n){let n=P(r(c)),s=c.getViewData()?.latestData;if(n&&s)if(a){let t=[],r=[];s.forEach(((i,a)=>{i[n[0]]?.toString()===e?.toString()&&(t.push(i),r.push(a))})),o.push({series:c,datum:t,key:vO(c,r)})}else if(p(n[1])){let t=[],r=[];s.forEach(((i,a)=>{(i[n[0]]?.toString()===e?.toString()||p(i[n[0]])&&p(i[n[1]])&&e>=i[n[0]]&&e<i[n[1]])&&(t.push(i),r.push(a))})),o.push({series:c,datum:t,key:vO(c,r)})}else{let r=t.getSpec(),a=gO(r,i),l=[],u=[];if(a)s.forEach(((t,r)=>{if(p(t[n[0]])){let i=t[n[0]]-e;i>=a[0]&&i<=a[1]&&(l.push(t),u.push(r))}}));else{let t=1/0,r=0;s.forEach(((i,a)=>{if(p(i[n[0]])){let o=Math.abs(i[n[0]]-e),s=Math.sign(i[n[0]]-e);o<t?(t=o,l=[i],u=[a],r=s):o===t&&s===r&&(l.push(i),u.push(a))}}))}o.push({series:c,datum:l,key:vO(c,u)})}}return o},vO=(e,t)=>\`\${e.id}_\${t.join(\`_\`)}\`,yO=(e,t,n)=>{let r=e.getAllComponents().filter((r=>r.specKey===\`axes\`&&t(r)&&((e,t,n)=>e.getRegionsInIds(P(t.layout.layoutBindRegionID))?.some((e=>{let t=e.getLayoutRect(),r=e.getLayoutStartPoint();return((e,t,n)=>e.x>=t.x&&e.x<=n.x&&e.y>=t.y&&e.y<=n.y)(n,{x:r.x,y:r.y},{x:t.width+r.x,y:t.height+r.y})})))(e,r,n)));return r.length?r:null},bO=(e,t)=>{if(!e)return null;let n=yO(e,(e=>e.getOrient()===\`angle\`),t),r=yO(e,(e=>e.getOrient()===\`radius\`),t);if(!(n&&n.length||r&&r.length))return null;let i=[],a=e=>e.getDimensionField()[0],{x:o,y:s}=t;return n&&n.forEach((e=>{let t=e.getScale();if(t&&Ib(t.type)){let n=t.domain(),c=t.range(),l=e.getCenter(),u={x:o-e.getLayoutStartPoint().x-l.x,y:s-e.getLayoutStartPoint().y-l.y},d=GS({x:1,y:0},u);d=((e,t)=>{let n=2*Math.PI,r=pe(t),i=fe(t);return e<r?e+=Math.ceil((r-e)/n)*n:e>i&&(e-=Math.ceil((e-i)/n)*n),e})(d,c);let p=KS(u),m=(r[0]?.getScale())?.range();if((d-c?.[0])*(d-c?.[1])>0||(p-m?.[0])*(p-m?.[1])>0)return;let h=e.invert(d);if(f(h))return;let g=n.findIndex((e=>e?.toString()===h.toString()));g<0&&(g=void 0);let _=_O(h,e,\`polar\`,a);i.push({index:g,value:h,position:t.scale(h),axis:e,data:_})}})),r&&r.forEach((e=>{let t=e.getScale(),r=t?.range();if(t&&Ib(t.type)){let c=e.getCenter(),l={x:o-e.getLayoutStartPoint().x-c.x,y:s-e.getLayoutStartPoint().y-c.y},u=GS({x:1,y:0},l);u<-Math.PI/2&&(u=2*Math.PI+u);let d=KS(l),p=(n[0]?.getScale())?.range();if((u-p?.[0])*(u-p?.[1])>0||(d-r?.[0])*(d-r?.[1])>0)return;let m=t.invert(d);if(f(m))return;let h=t.domain().findIndex((e=>e?.toString()===m.toString()));h<0&&(h=void 0);let g=_O(m,e,\`polar\`,a);i.push({index:h,value:m,position:t.scale(m),axis:e,data:g})}})),i.length?i:null};function xO(e){return e===\`bottom\`||e===\`top\`}function SO(e){return e===\`left\`||e===\`right\`}function CO(e){return e===\`z\`}function wO(e,t){return mC(e.orient)||t&&t.includes(e.orient)?e.orient:\`left\`}function TO(e,t){let n=e.type??function(e,t){return t?xO(e)?\`linear\`:\`band\`:xO(e)?\`band\`:\`linear\`}(e.orient,t);return{axisType:n,componentName:\`\${a.cartesianAxis}-\${n}\`}}let EO=e=>e.fieldX[0],DO=e=>e.fieldY[0],OO=e=>[e.fieldX[0],e.fieldX2??e.fieldX[1]],kO=e=>[e.fieldY[0],e.fieldY2??e.fieldY[1]],AO=(e,t)=>e?t?EO:OO:t?DO:kO,jO=(e,t,n)=>{if(!e)return null;let{x:r,y:i}=t,a=yO(e,(e=>xO(e.getOrient())),t)??[],o=yO(e,(e=>SO(e.getOrient())),t)??[];if(!a.length&&!o.length)return null;let s=new Set,c=new Set,l=new Set;[a,o].forEach((e=>e.forEach((e=>{Ib(e.getScale().type)?s.add(e):c.add(e),n&&e.getSpec().hasDimensionTooltip&&l.add(e)}))));let u=[],d=e=>{let t=e===\`x\`,n=t?r:i;(t?a:o).forEach((e=>{if(l.size>0){if(l.has(e)){let r=MO(e,n,AO(t,Ib(e.getScale().type)));r&&u.push(r)}}else{let r=s.size>0;if((r?s:c).has(e)){let i=MO(e,n,AO(t,r));i&&u.push(i)}}}))};return e.getSpec().direction===\`horizontal\`?(d(\`y\`),u.length===0&&d(\`x\`)):(d(\`x\`),u.length===0&&d(\`y\`)),u.length?u:null},MO=(e,t,n)=>{let r=e.positionToData(t,!0);return f(r)?null:NO(e,r,n)},NO=(e,t,n)=>{let r=e.getScale();if(f(t))return null;let i=r.domain().findIndex((e=>e?.toString()===t.toString()));i<0&&(i=void 0);let a=_O(t,e,\`cartesian\`,n??(xO(e.getOrient())?EO:DO));return{index:i,value:t,position:r.scale(t),axis:e,data:a}};class PO{constructor(e,t){this._eventDispatcher=e,this._mode=t}get chart(){var e;return this._chart||=(e=this._eventDispatcher.globalInstance).getChart?.call(e),this._chart}register(e,t){(this.chart?.getOption().onError??km)(\`Method not implemented.\`)}unregister(){(this.chart?.getOption().onError??km)(\`Method not implemented.\`)}getTargetDimensionInfo(e,t){let n=jO(this.chart,{x:e,y:t})??[],r=bO(this.chart,{x:e,y:t})??[],i=[].concat(n,r);return i.length===0?null:i}dispatch(e,t){let n=this.chart?.getAllComponents().filter((e=>e.specKey===\`axes\`&&(!t?.filter||t.filter(e)))),r=n.filter((e=>Ib(e.getScale().type))),i=r.length?r:n.filter((e=>{let t=e.getOrient();return xO(t)||t===\`angle\`})),a=[];return i.forEach((t=>{let n=NO(t,e);n&&a.push(n)})),this._callback.call(null,{action:\`enter\`,dimensionInfo:a}),a}}var FO;(function(e){e.dimensionHover=\`dimensionHover\`,e.dimensionClick=\`dimensionClick\`})(FO||={});let IO={[FO.dimensionHover]:class extends PO{constructor(){super(...arguments),this._cacheDimensionInfo=null,this.onMouseMove=e=>{if(!e)return;let t=e.event.viewX,n=e.event.viewY,r=this.getTargetDimensionInfo(t,n);r===null&&this._cacheDimensionInfo!==null?(this._callback.call(null,Object.assign(Object.assign({},e),{action:\`leave\`,dimensionInfo:this._cacheDimensionInfo.slice()})),this._cacheDimensionInfo=r):r===null||this._cacheDimensionInfo!==null&&r.length===this._cacheDimensionInfo.length&&!r.some(((e,t)=>!hO(e,this._cacheDimensionInfo[t])))?r!==null&&this._callback.call(null,Object.assign(Object.assign({},e),{action:\`move\`,dimensionInfo:r.slice()})):(this._callback.call(null,Object.assign(Object.assign({},e),{action:\`enter\`,dimensionInfo:r.slice()})),this._cacheDimensionInfo=r)},this.onMouseOut=e=>{e&&(this._callback.call(null,Object.assign(Object.assign({},e),{action:\`leave\`,dimensionInfo:this._cacheDimensionInfo?this._cacheDimensionInfo.slice():[]})),this._cacheDimensionInfo=null)}}register(e,t){this._callback=t.callback,this._eventDispatcher.register(\`pointermove\`,{query:Object.assign(Object.assign({},t.query),{source:fO.chart}),callback:this.onMouseMove}),this._eventDispatcher.register(\`pointerout\`,{query:Object.assign(Object.assign({},t.query),{source:fO.canvas}),callback:this.onMouseOut}),Pm(this._mode)&&this._eventDispatcher.register(\`pointerdown\`,{query:Object.assign(Object.assign({},t.query),{source:fO.chart}),callback:this.onMouseMove})}unregister(){this._eventDispatcher.unregister(\`pointermove\`,{query:null,callback:this.onMouseMove}),Pm(this._mode)&&this._eventDispatcher.unregister(\`pointerdown\`,{query:null,callback:this.onMouseMove})}},[FO.dimensionClick]:class extends PO{constructor(){super(...arguments),this.onClick=e=>{if(!e)return;let t=e.event.viewX,n=e.event.viewY,r=this.getTargetDimensionInfo(t,n);r&&this._callback.call(null,Object.assign(Object.assign({},e),{action:\`click\`,dimensionInfo:r.slice()}))}}register(e,t){this._callback=t.callback,this._eventDispatcher.register(\`pointertap\`,{query:Object.assign(Object.assign({},t.query),{source:fO.chart}),callback:this.onClick})}unregister(){this._eventDispatcher.unregister(\`pointertap\`,{query:null,callback:this.onClick})}}},LO=class{getComposedEventMap(){return this._composedEventMap}constructor(e,t){this._composedEventMap=new Map,this._eventDispatcher=e,this._mode=t}on(e,t,n){let r=typeof t==\`function\`?{query:null,callback:t}:{query:t,callback:n};if(IO[e]){let t=new IO[e](this._eventDispatcher,this._mode);t.register(e,r),this._composedEventMap.set(n,{eventType:e,event:t})}else this._eventDispatcher.register(e,r);return this}off(e,t,n){var r,i;let a=n??t;if(IO[e])if(a)(r=this._composedEventMap.get(a))==null||r.event.unregister(),this._composedEventMap.delete(a);else for(let t of this._composedEventMap.entries())t[1].eventType===e&&((i=this._composedEventMap.get(t[0]))==null||i.event.unregister(),this._composedEventMap.delete(t[0]));else if(a){let n={callback:a,query:null,filter:{nodeName:null,type:e,level:null,source:t.source,markName:null,filter:null,userId:null}};this._eventDispatcher.unregister(e,n)}else this._eventDispatcher.unregister(e);return this}emit(e,t,n){return this._eventDispatcher.dispatch(e,t,n),this}prevent(e,t){return this._eventDispatcher.prevent(e,t),this}allow(e){return this._eventDispatcher.allow(e),this}release(){this._eventDispatcher.clear(),this._composedEventMap.clear()}};class RO{constructor(){this._map=new Map,this._levelNodes=new Map,this._levelNodes.set(pO.vchart,[]),this._levelNodes.set(pO.chart,[]),this._levelNodes.set(pO.model,[]),this._levelNodes.set(pO.mark,[])}addHandler(e,t){var n;let r={level:t,handler:e};return(n=this._levelNodes.get(t))==null||n.push(r),this._map.set(e.callback,r),this}removeHandler(e){let t=this._map.get(e.callback);if(!t)return this;this._map.delete(e.callback);let n=this._levelNodes.get(t.level),r=n?.findIndex((t=>t.handler.callback===e.callback));return r!==void 0&&r>=0&&n?.splice(r,1),this}preventHandler(e){return e&&(e.prevented=!0),this}allowHandler(e){return e&&(e.prevented=!1),this}getHandlers(e){return this._levelNodes.get(e)?.map((e=>e.handler))||[]}getAllHandlers(){return Array.from(this._map.values()).map((e=>e.handler))||[]}getCount(){return this._map.size}release(){this._map.clear(),this._levelNodes.clear()}}let zO={cartesianAxis:\`axis\`,"cartesianAxis-band":\`axis\`,"cartesianAxis-linear":\`axis\`,"cartesianAxis-time":\`axis\`,polarAxis:\`axis\`,"polarAxis-band":\`axis\`,"polarAxis-linear":\`axis\`,discreteLegend:\`legend\`,continuousLegend:\`legend\`,colorLegend:\`legend\`,sizeLegend:\`legend\`};class BO{constructor(e,t){this._viewBubbles=new Map,this._windowBubbles=new Map,this._canvasBubbles=new Map,this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this._onDelegate=e=>{let t=this.globalInstance.getChart(),n=p(e.modelId)&&t?.getModelById(e.modelId)||void 0,r=p(e.markId)&&t?.getMarkById(e.markId)||null,i=new Map,a=e.item?.mark;for(a&&p(a.id())&&i.set(a.id(),e.item);a?.elements;){let e=a.id();p(e)&&!i.has(e)&&i.set(e,a.elements[0]),a=a.group}let o=j(e.event,\`target\`),s=e.datum;n&&n.modelType===\`component\`&&(s=n.getDatum(o)??s);let c={event:e.event,item:e.item,source:e.source,datum:s,itemMap:i,chart:t,model:n,mark:r??void 0,node:j(e.event,\`target\`)};this.dispatch(e.type,c)},this._onDelegateInteractionEvent=e=>{let t=this.globalInstance.getChart(),n=e.event,r=null;n.elements&&(r=n.elements);let i={event:e.event,chart:t,items:r,datums:r&&r.map((e=>e.getDatum()))};this.dispatch(e.type,i)},this.globalInstance=e,this._compiler=t}register(e,t){this._parseQuery(t);let n=this.getEventBubble(t.filter?.source||fO.chart),r=this.getEventListeners(t.filter?.source||fO.chart);if(n.get(e)||n.set(e,new RO),n.get(e).addHandler(t,t.filter?.level),this._isValidEvent(e)&&!r.has(e)){let n=this._onDelegate.bind(this);this._compiler.addEventListener(t.filter?.source,e,n),r.set(e,n)}else if(this._isInteractionEvent(e)&&!r.has(e)){let n=this._onDelegateInteractionEvent.bind(this);this._compiler.addEventListener(t.filter?.source,e,n),r.set(e,n)}return this}unregister(e,t){var n;let r=!1,i=this.getEventBubble(t?.filter?.source||fO.chart),a=this.getEventListeners(t?.filter?.source||fO.chart);if(t){let a=i.get(e);a?.removeHandler(t),a?.getCount()===0&&(a?.release(),i.delete(e),r=!0),(n=t?.wrappedCallback)!=null&&n.cancel&&t.wrappedCallback.cancel()}else i.get(e)?.release(),i.delete(e),r=!0;if(r&&this._isValidEvent(e)){let n=a.get(e);this._compiler.removeEventListener(t?.filter?.source||fO.chart,e,n),a.delete(e)}return this}dispatch(e,t,n){let r=this.getEventBubble(t.source||fO.chart).get(e);if(!r)return this;let i=!1;if(n){let a=r.getHandlers(n);i=this._invoke(a,e,t)}else{let n=0;for(;!i&&n<mO.length;)i=this._invoke(r.getHandlers(mO[n]),e,t),n++}return this}prevent(e,t){return[\`canvas\`,\`chart\`,\`window\`].forEach((n=>{let r=this.getEventBubble(n).get(e);r&&r.getAllHandlers().forEach((e=>{t?mO.indexOf(e.filter.level)<mO.indexOf(t.level)&&e.callback!==t.handler&&r.preventHandler(e):r.preventHandler(e)}))})),this}allow(e){return[\`canvas\`,\`chart\`,\`window\`].forEach((t=>{let n=this.getEventBubble(t).get(e);n&&n.getAllHandlers().forEach((e=>n.allowHandler(e)))})),this}clear(){[fO.chart,fO.window,fO.canvas].forEach((e=>{let t=this.getEventListeners(e);for(let n of t.entries())this._compiler.removeEventListener(e,n[0],n[1]);t.clear()})),[this._viewBubbles,this._windowBubbles,this._canvasBubbles].forEach((e=>{for(let t of e.values())t.release();e.clear()}))}release(){this.clear(),this.globalInstance=null,this._compiler=null}_filter(e,t,n){if(d(e.filter)&&!e.filter(n)||e.nodeName&&j(n,\`node.name\`)!==e.nodeName||e.markName&&n?.mark?.name!==e.markName)return!1;let r=n.model?.type;return zO[r]&&(r=zO[r]),(!e.type||r===e.type)&&!(e.level===\`mark\`&&!e.type&&!n?.mark)&&!(e.level===\`model\`&&!e.type&&!n?.model)&&(!p(e.userId)||n.model?.userId===e.userId)}_prepareParams(e,t){if(e.markName&&t.mark&&t.itemMap){let e=t.mark.getProductId(),n=t.itemMap.get(e),r=n?.getDatum();return Object.assign(Object.assign({},t),{item:n,datum:r})}return Object.assign({},t)}_invoke(e,t,n){return e.map((e=>{var r,i;let a=e.filter;if(!e.prevented&&(!e.query||this._filter(a,t,n))){let t=(e.wrappedCallback||e.callback).call(null,this._prepareParams(a,n))??e.query?.consume;return t&&((r=n.event)==null||r.stopPropagation(),(i=n.event)==null||i.preventDefault()),!!t}})).some((e=>!0===e))}_getQueryLevel(e){return e?e.level?e.level:p(e.id)?pO.model:pO.vchart:pO.vchart}_parseQuery(e){let t=e.query;t?.throttle?e.wrappedCallback=Me(e.callback,t.throttle):t!=null&&t.debounce&&(e.wrappedCallback=je(e.callback,t.debounce));let n=this._getQueryLevel(t),r=null,i=fO.chart,a=null,o=null,s=null;return t!=null&&t.nodeName&&(a=t.nodeName),t!=null&&t.markName&&(o=t.markName),!t?.type||n!==pO.model&&n!==pO.mark||(r=t.type),t!=null&&t.source&&(i=t.source),p(t?.id)&&(s=t?.id,n=pO.model),e.filter={level:n,markName:o,type:r,source:i,nodeName:a,userId:s,filter:t?.filter??null},e}getEventBubble(e){switch(e){case fO.chart:return this._viewBubbles;case fO.window:return this._windowBubbles;case fO.canvas:return this._canvasBubbles;default:return this._viewBubbles}}getEventListeners(e){switch(e){case fO.chart:return this._viewListeners;case fO.window:return this._windowListeners;case fO.canvas:return this._canvasListeners;default:return this._viewListeners}}_isValidEvent(e){return dO.includes(e)||Object.values(X).includes(e)}_isInteractionEvent(e){let t;return e&&(t=e.split(\`:\`)[0],t)&&Z.hasInteraction(t)}}function VO(e,t,n){e.getTransform(t)||e.registerTransform(t,n)}function HO(e,t,n){e.getParser(t)||e.registerParser(t,n)}let UO=new Map;function WO(e,t=!1){let n=t;return e.latestData instanceof Sn&&(n=!1),n?M(e.latestData):e.latestData&&e.latestData.slice()}let GO=(e,t)=>e.length===0?[]:e.length===1?WO(e[0],t?.deep):e.map((e=>WO(e,t?.deep)));function KO(e,t,n){VO(t=t instanceof bn?t:e.dataSet,\`copyDataView\`,GO);let r=new Sn(t,n);return r.parse([e],{type:\`dataview\`}),r.transform({type:\`copyDataView\`,level:YO.copyDataView}),r}function qO(e,t,n=[]){if(e instanceof Sn)return e;let{id:r,values:i=[],fromDataIndex:a,fromDataId:o,transforms:s=[]}=e,c=e.parser?M(e.parser):{clone:!0},l=M(e.fields),u;c.clone=!1!==c.clone;let d=n.find((e=>e.name===r));if(d)u=d;else{let e={name:r};if(l&&(e.fields=l),u=new Sn(t,e),typeof o==\`string\`){let e=n.find((e=>e.name===o));if(!e)return Om(\`no data matches fromDataId \${o}\`),null;u.parse([e],{type:\`dataview\`}),u.transform({type:\`copyDataView\`})}else if(typeof a==\`number\`){let e=n[a];if(!e)return Om(\`no data matches fromDataIndex \${a}\`),null;u.parse([e],{type:\`dataview\`}),u.transform({type:\`copyDataView\`})}else Array.isArray(i)?u.parse(i,c):!v(i)||c&&![\`csv\`,\`dsv\`,\`tsv\`].includes(c.type)?(u.parse([]),Om(\`values should be array\`)):u.parse(i,c??{type:\`csv\`});s&&s.length&&s.forEach((e=>{t.getTransform(e.type)&&u.transform(e)}))}return u}function JO(e,t,n){e&&(t.fields&&e.setFields(t.fields,n),e.parseNewData(t.values,t.parser))}var YO,XO,ZO,QO,$O;function ek(t){switch(t){case e.RenderModeEnum[\`desktop-browser\`]:case e.RenderModeEnum[\`mobile-browser\`]:return\`browser\`;case e.RenderModeEnum.node:case e.RenderModeEnum.worker:return\`node\`;case e.RenderModeEnum.miniApp:case e.RenderModeEnum[\`desktop-miniApp\`]:return\`feishu\`;case e.RenderModeEnum.lynx:return\`lynx\`;case e.RenderModeEnum.wx:return\`wx\`;case e.RenderModeEnum.tt:return\`tt\`;case e.RenderModeEnum.harmony:return\`harmony\`}return\`browser\`}(function(e){e[e.copyDataView=-10]=\`copyDataView\`,e[e.treemapFilter=-8]=\`treemapFilter\`,e[e.treemapFlatten=-7]=\`treemapFlatten\`,e[e.dotObjFlat=-7]=\`dotObjFlat\`,e[e.linkDotInfo=-7]=\`linkDotInfo\`,e[e.sankeyLayout=-7]=\`sankeyLayout\`,e[e.dataZoomFilter=-6]=\`dataZoomFilter\`,e[e.legendFilter=-5]=\`legendFilter\`})(YO||={}),function(e){e.appear=\`appear\`,e.disappear=\`disappear\`,e.enter=\`enter\`,e.update=\`update\`,e.state=\`state\`,e.exit=\`exit\`,e.normal=\`normal\`,e.none=\`none\`}(XO||={}),function(e){e.data=\`data\`,e.signal=\`signal\`,e.mark=\`mark\`}(ZO||={});class tk{getVGrammarView(){return this._view}getModel(){return this._model}constructor(e,t){this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this.isInited=!1,this._released=!1,this._model={[ZO.signal]:{},[ZO.data]:{},[ZO.mark]:{}},this._compileChart=null,this.handleStageRender=()=>{var e;(e=this._compileChart?.getEvent())==null||e.emit(Q.afterRender,{chart:this._compileChart})},this._container=e,this._option=t}getRenderer(){return this._view?.renderer}getCanvas(){return this._view?.renderer.canvas()}getStage(){return this._view?.renderer.stage()}initView(){var e;if(this._released||(this.isInited=!0,this._view))return;let n=new xe(this._option.logLevel??be.Error);(e=this._option)!=null&&e.onError&&n.addErrorHandler(((...e)=>{var t,n;(n=(t=this._option)?.onError)==null||n.call(t,...e)}));let r=this._option,{performanceHook:i,autoRefreshDpr:a,dpr:o,mode:s,gestureConfig:c,interactive:l,clickInterval:u,autoPreventDefault:d}=r,f=t(r,[\`performanceHook\`,\`autoRefreshDpr\`,\`dpr\`,\`mode\`,\`gestureConfig\`,\`interactive\`,\`clickInterval\`,\`autoPreventDefault\`]);this._view=new nD(Object.assign(Object.assign({width:this._width,height:this._height,container:this._container.dom??null,renderCanvas:this._container.canvas??null,hooks:i},f),{dpr:o,autoRefresh:p(a)?a:!p(o),mode:ek(s),autoFit:!1,eventConfig:{gesture:p(c)?c:Pm(s),disable:!1===l,clickInterval:u,autoPreventDefault:d},doLayout:()=>{var e;(e=this._compileChart)==null||e.onLayout(this._view)},logger:n,logLevel:n.level()})),this._setCanvasStyle(),this.getStage().hooks.afterRender.tap(\`chart-event\`,this.handleStageRender),!1!==l&&this._viewListeners.forEach((e=>{var t;(t=this._view)==null||t.addEventListener(e.type,e.callback)}))}_setCanvasStyle(){if(this._view&&this._container.dom&&!v(this._container.dom)){this._container.dom.style.display=\`block\`,this._container.dom.style.position=\`relative\`;let e=this.getCanvas();e&&(e.style.display=\`block\`)}}compileInteractions(){if(this._view.removeAllInteractions(),this._interactions?.length){let e={};this._interactions.forEach((t=>{if(t.regionId){let n=\`\${t.regionId}-\${t.type}-\${t.id??\`\`}\`,r=e[n];e[n]=r?Object.assign(Object.assign(Object.assign({},r),t),{selector:[...r.selector,...t.selector]}):t}else this._view.interaction(t.type,t)})),Object.keys(e).forEach((t=>{let n=this._view.interaction(e[t].type,e[t]);if(this._compileChart){let r=this._compileChart.getRegionsInIds([e[t].regionId])[0];r&&r.interaction.addVgrammarInteraction(n.getStartState(),n)}}))}}compile(e,t){if(this._released)return;let{chart:n}=e;this._compileChart=n,this.initView(),this._view&&(n.compile(),n.afterCompile(),this.updateDepend(),this.compileInteractions())}clearNextRender(){return!!this._nextRafId&&(jp.getCancelAnimationFrame()(this._nextRafId),this._nextRafId=null,!0)}clear(e,t=!1){let{chart:n}=e;this.clearNextRender(),n.clear(),this.releaseGrammar(t)}renderNextTick(e){this._released||this._nextRafId||(this._nextRafId=jp.getRequestAnimationFrame()((()=>{this._nextRafId=null,this.render(e)})))}render(e){var t,n;this._released||(this.initView(),this._view&&((t=this._view)==null||t.run(e),this.clearNextRender()&&((n=this._view)==null||n.run(e))))}updateViewBox(e,t=!0){this._view&&this._view.renderer.setViewBox(e,t)}resize(e,t,n=!0){this._view&&(this._width=e,this._height=t,this._view.resize(e,t),n&&this.render({morph:!1}))}setBackground(e){var t;(t=this._view)==null||t.background(e)}setSize(e,t){this._width=e,this._height=t,this._view&&(this._view.width(e),this._view.height(t))}setViewBox(e,t=!0){this._view&&this._view.renderer.setViewBox(e,t)}addEventListener(e,t,n){var r;if(!1!==this._option.interactive){if(e===fO.chart){let i=function(r,i){let a=(i?.mark)?.getContext()??{},o=p(a.modelId)?a.modelId:null,s=p(a.markId)?a.markId:null,c=p(a.modelUserId)?a.modelUserId:null,l=p(a.markUserId)?a.markUserId:null,u={event:r,type:t,source:e,item:i,datum:(i?.getDatum)?.call(i)||null,markId:s,modelId:o,markUserId:l,modelUserId:c};n.call(null,u)}.bind(this);this._viewListeners.set(n,{type:t,callback:i}),(r=this._view)==null||r.addEventListener(t,i)}else if(e===fO.window){let r=function(r){let i={event:r,type:t,source:e,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};n.call(null,i)}.bind(this);this._windowListeners.set(n,{type:t,callback:r}),this._getGlobalThis()?.addEventListener(t,r)}else if(e===fO.canvas){let r=function(r){let i={event:r,type:t,source:e,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};n.call(null,i)}.bind(this);this._canvasListeners.set(n,{type:t,callback:r}),(this.getStage()?.window)?.addEventListener(t,r)}}}removeEventListener(e,t,n){var r;if(!1!==this._option.interactive){if(e===fO.chart){let e=this._viewListeners.get(n)?.callback;e&&((r=this._view)==null||r.removeEventListener(t,e)),this._viewListeners.delete(n)}else if(e===fO.window){let e=this._getGlobalThis(),r=this._windowListeners.get(n)?.callback;r&&e?.removeEventListener(t,r),this._windowListeners.delete(n)}else if(e===fO.canvas){let e=this.getStage()?.window,r=this._canvasListeners.get(n)?.callback;e&&r&&e?.removeEventListener(t,r),this._canvasListeners.delete(n)}}}releaseEvent(){let e=this.getStage();e&&e.hooks.afterRender.unTap(\`chart-event\`,this.handleStageRender),this._viewListeners.clear(),this._windowListeners.clear(),this._canvasListeners.clear()}release(){var e;this.clearNextRender(),this.releaseEvent(),this._option=this._container=null,this._releaseModel(),(e=this._view)==null||e.release(),this._view=null,this.isInited=!1,this._compileChart=null,this._released=!0}releaseGrammar(e=!1){var t,n;this._releaseModel(),e&&((t=this._view)==null||t.removeAllGraphicItems()),(n=this._view)==null||n.removeAllGrammars()}_releaseModel(){Object.keys(this._model).forEach((e=>{Object.values(this._model[e]).forEach((e=>{Object.values(e).forEach((e=>{e.removeProduct(!0)}))})),this._model[e]={}}))}addGrammarItem(e){let t=e.getProduct();if(f(t))return;let n=t.id(),r=e.grammarType;f(this._model[r][n])&&(this._model[r][n]={}),this._model[r][n][e.id]=e}removeGrammarItem(e,t){var n;let r=e.getProduct();if(f(r))return;let i=r.id(),a=e.grammarType,o=this._model[a][i];p(o)&&(delete o[e.id],Object.keys(o).length===0&&delete this._model[a][i]),t||(n=this._view)==null||n.removeGrammar(r)}addInteraction(e){this._interactions||=[],this._interactions.push(e)}removeInteraction(e){this._interactions&&=this._interactions.filter((t=>t.seriesId!==e))}updateDepend(e){return p(e)&&e.length>0?e.every((e=>e.updateDepend())):(Object.values(this._model).forEach((e=>{Object.values(e).forEach((e=>{let t=Object.values(e),n=t[0].getProduct(),r=t.reduce(((e,t)=>t.getDepend().length>0?e.concat(t.getDepend()):e),[]).filter((e=>!!e)).map((e=>e.getProduct()));n.depend(r)}))})),!0)}_getGlobalThis(){return Nm(this._option.mode)?globalThis:this.getStage()?.window}}function nk(e,t){return n(this,void 0,void 0,(function*(){if(!e)return\`\`;try{if(OffscreenCanvas!==void 0&&e instanceof OffscreenCanvas)return function(e){return new Promise((t=>{e.convertToBlob().then((e=>{let n=new FileReader;n.readAsDataURL(e),n.onload=()=>{t(n.result)}}))}))}(e)}catch(e){(t?.onError??km)(\`getCanvasDataURL error : \${e.toString()}\`)}return e.toDataURL()}))}function rk(e){e.crosshair=P(e.crosshair||{}).map((t=>q({[e.direction===\`horizontal\`?\`yField\`:\`xField\`]:{visible:!0,line:{visible:!0,type:\`rect\`}}},t)))}function ik(e,t,n){let{width:r,height:i}=e;if(p(r)&&p(i))return{width:r,height:i};let a=n.width,o=n.height,s=t.container,c=t.canvas;if(s){let{width:e,height:t}=Vt(s,n.width,n.height);a=e,o=t}else if(c&&Nm(t.mode)){let e;e=v(c)?jp.getElementById(c):c;let{width:t,height:r}=Vt(e,n.width,n.height);a=t,o=r}else if(Fm(t.mode)&&t.modeParams?.domref){let e=t.modeParams.domref;a=e.width,o=e.height}return a=r??a,o=i??o,{width:a,height:o}}function ak(e,...t){let n=n=>t.reduce(((e,t)=>e||t?.[n]),e[n]);return Object.assign(e,{change:n(\`change\`),reCompile:n(\`reCompile\`),reMake:n(\`reMake\`),reRender:n(\`reRender\`),reSize:n(\`reSize\`),reTransformSpec:n(\`reTransformSpec\`),changeTheme:n(\`changeTheme\`),changeBackground:n(\`changeBackground\`)}),e}function ok(e,t){return e===\`line\`||e===\`area\`||e===\`common\`&&t.series.every((e=>e.type===\`area\`||e.type===\`line\`))?{paddingInner:1,paddingOuter:0}:{paddingOuter:0}}(function(e){e.STATE_NORMAL=\`normal\`,e.STATE_HOVER=\`hover\`,e.STATE_HOVER_REVERSE=\`hover_reverse\`,e.STATE_DIMENSION_HOVER=\`dimension_hover\`,e.STATE_DIMENSION_HOVER_REVERSE=\`dimension_hover_reverse\`,e.STATE_SELECTED=\`selected\`,e.STATE_SELECTED_REVERSE=\`selected_reverse\`,e.STATE_SANKEY_EMPHASIS=\`selected\`,e.STATE_SANKEY_EMPHASIS_REVERSE=\`blur\`})(QO||={}),function(e){e.STATE_HOVER_REVERSE=\`hover_reverse\`,e.STATE_DIMENSION_HOVER_REVERSE=\`dimension_hover_reverse\`,e.STATE_SELECTED_REVERSE=\`selected_reverse\`}($O||={});class sk{constructor(){this._children=[],this._markNameMap={},this._infoMap=new Map}getMarkNameMap(){return this._markNameMap}addMark(e,t){f(e)||(this._children.push(e),this._markNameMap[e.name]=e,this._infoMap.set(e,N({},sk.defaultMarkInfo,t)))}removeMark(e){let t=this._children.findIndex((t=>t.name===e));t>=0&&(this._infoMap.delete(this._children[t]),delete this._markNameMap[e],this._children.splice(t,1))}clear(){this._children=[],this._markNameMap={},this._infoMap.clear()}forEach(e){this._children.forEach(e)}includes(e,t){return this._children.includes(e,t)}get(e){return isNaN(Number(e))?this._markNameMap[e]:this._children[e]}getMarks(){return this._children.slice()}getMarksInType(e){let t=P(e);return this._children.filter((e=>t.includes(e.type)))}getMarkInId(e){return this._children.find((t=>t.id===e))}getMarkWithInfo(e){return this._children.find((t=>Object.keys(e).every((n=>e[n]===this._infoMap.get(t)[n]))))}}sk.defaultMarkInfo={};class ck{get hover(){return this._hover}get select(){return this._select}constructor(e){this._marks=new sk,this._markReverse=new sk,this.onHover=e=>{switch(e.action){case\`enter\`:this.interaction.getEventElement(QO.STATE_DIMENSION_HOVER).forEach((e=>this.interaction.addEventElement(QO.STATE_DIMENSION_HOVER_REVERSE,e))),this.interaction.clearEventElement(QO.STATE_DIMENSION_HOVER,!1),this.getEventElement(e).forEach((e=>this.interaction.addEventElement(QO.STATE_DIMENSION_HOVER,e))),this.interaction.reverseEventElement(QO.STATE_DIMENSION_HOVER);break;case\`leave\`:this.interaction.clearEventElement(QO.STATE_DIMENSION_HOVER,!0),e=null}},this._option=e,this.event=this._option.model.getOption().getChart().getEvent(),this.interaction=e.interaction,this.initConfig(e.mode)}setStateKeys(e){}registerMark(e){A(e.stateStyle[QO.STATE_DIMENSION_HOVER])||this._marks.addMark(e),A(e.stateStyle[QO.STATE_DIMENSION_HOVER_REVERSE])||this._markReverse.addMark(e)}init(){this.initEvent()}release(){this.releaseEvent()}initEvent(){this.event.on(FO.dimensionHover,this.onHover)}releaseEvent(){this.event.release()}initConfig(e){}getEventElement(e,t=!1){let n=[];return e.dimensionInfo.forEach((e=>{e.data.forEach((e=>{(t?this._markReverse:this._marks).getMarks().filter((t=>t.model===e.series&&t.getVisible())).forEach((r=>{let i=r.getProduct();if(!i||!i.elements)return;let a=i.elements.filter((n=>{let r=n.getDatum(),i;return i=y(r)?r.every(((t,n)=>t===e.datum[n])):e.datum.some((e=>e===r)),t?!i:i}));n.push(...a)}))}))})),n}}let lk={};Object.values(QO).forEach((e=>{lk[e]=!0}));let uk={[QO.STATE_HOVER]:QO.STATE_HOVER_REVERSE,[QO.STATE_SELECTED]:QO.STATE_SELECTED_REVERSE,[QO.STATE_DIMENSION_HOVER]:QO.STATE_DIMENSION_HOVER_REVERSE};function dk(e){return uk[e]}class fk{constructor(){this._stateMarks=new Map,this._stateElements=new Map,this._vgrammarInteractions=new Map,this._disableTriggerEvent=!1}addVgrammarInteraction(e,t){e&&(this._vgrammarInteractions.get(e)?this._vgrammarInteractions.get(e).push(t):this._vgrammarInteractions.set(e,[t]))}static markStateEnable(e,t){return!A(e.stateStyle[t])}setDisableActiveEffect(e){this._disableTriggerEvent=e}registerMark(e,t){var n;this._stateMarks.has(e)||this._stateMarks.set(e,[]),(n=this._stateMarks.get(e))==null||n.push(t)}getStateMark(e){return this._stateMarks.get(e)}filterEventMark(e,t){return!(!e.mark||!this._stateMarks.get(t)?.includes(e.mark))}getEventElement(e){return this._stateElements.get(e)??[]}getEventElementData(e){return this.getEventElement(e).map((e=>e.getDatum()))}exchangeEventElement(e,t){var n;if(this._disableTriggerEvent)return;let r=dk(e);(n=this._stateElements.get(e))==null||n.forEach((t=>{t.removeState(e),r&&this.addEventElement(r,t)})),t.getStates().includes(e)||(t.addState(e),r&&t.removeState(r)),this._stateElements.set(e,[t])}removeEventElement(e,t){if(this._disableTriggerEvent)return;t.removeState(e);let n=this._stateElements.get(e)?.filter((e=>e!==t))??[];this._stateElements.set(e,n);let r=dk(e);r&&(n.length===0?this.clearEventElement(r,!1):this.addEventElement(r,t))}addEventElement(e,t){if(this._disableTriggerEvent)return;t.getStates().includes(e)||t.addState(e);let n=this._stateElements.get(e)??[];n.push(t),this._stateElements.set(e,n)}clearEventElement(e,t){var n;if(!this._disableTriggerEvent&&((n=this._stateElements.get(e))==null||n.forEach((t=>{t.removeState(e)})),this._stateElements.set(e,[]),t)){let t=dk(e);t&&this.clearEventElement(t,!1)}}clearAllEventElement(){if(!this._disableTriggerEvent)for(let[e,t]of this._stateElements)t.forEach((e=>{e.clearStates()})),this._stateElements.set(e,[])}reverseEventElement(e){if(this._disableTriggerEvent)return;let t=dk(e);if(!t)return;let n=this.getStateMark(t);if(!n)return;let r=this.getEventElement(e);r.length&&(this.getEventElement(t).length||(r.length===1?n.forEach((e=>{e.getProduct().elements.filter((e=>e!==r[0])).forEach((e=>{this.addEventElement(t,e)}))})):n.forEach((e=>{e.getProduct().elements.filter((e=>!r.includes(e))).forEach((e=>{this.addEventElement(t,e)}))}))))}startInteraction(e,t){let n=this._vgrammarInteractions.get(e);n&&n.forEach((e=>{e.start(t)}))}resetInteraction(e,t){let n=this._vgrammarInteractions.get(e);n&&n.forEach((e=>{e.reset(t)}))}resetAllInteraction(){for(let[e,t]of this._vgrammarInteractions)t&&t.forEach((e=>{e.reset(null)}))}}var pk,mk,$;(function(e){e[e.SeriesGroup=0]=\`SeriesGroup\`,e[e.Axis_Grid=50]=\`Axis_Grid\`,e[e.CrossHair_Grid=100]=\`CrossHair_Grid\`,e[e.Region=450]=\`Region\`,e[e.Mark=300]=\`Mark\`,e[e.Node=400]=\`Node\`,e[e.Axis=100]=\`Axis\`,e[e.MarkLine=500]=\`MarkLine\`,e[e.MarkArea=100]=\`MarkArea\`,e[e.MarkPoint=500]=\`MarkPoint\`,e[e.DataZoom=500]=\`DataZoom\`,e[e.ScrollBar=500]=\`ScrollBar\`,e[e.Player=500]=\`Player\`,e[e.Legend=500]=\`Legend\`,e[e.CrossHair=500]=\`CrossHair\`,e[e.Indicator=500]=\`Indicator\`,e[e.Title=500]=\`Title\`,e[e.Label=500]=\`Label\`,e[e.Brush=500]=\`Brush\`,e[e.CustomMark=500]=\`CustomMark\`,e[e.Interaction=700]=\`Interaction\`})(pk||={}),function(e){e[e.Indicator=10]=\`Indicator\`,e[e.Region=20]=\`Region\`,e[e.Axis=30]=\`Axis\`,e[e.DataZoom=40]=\`DataZoom\`,e[e.Player=40]=\`Player\`,e[e.ScrollBar=40]=\`ScrollBar\`,e[e.Legend=50]=\`Legend\`,e[e.Title=70]=\`Title\`,e[e.CustomMark=70]=\`CustomMark\`}(mk||={}),function(e){e[e.Default=0]=\`Default\`,e[e.Theme=1]=\`Theme\`,e[e.Chart=2]=\`Chart\`,e[e.Base_Series=3]=\`Base_Series\`,e[e.Series=4]=\`Series\`,e[e.Mark=5]=\`Mark\`,e[e.User_Chart=6]=\`User_Chart\`,e[e.User_Series=7]=\`User_Series\`,e[e.User_Mark=8]=\`User_Mark\`,e[e.User_SeriesStyle=9]=\`User_SeriesStyle\`,e[e.Built_In=99]=\`Built_In\`}($||={});class hk{getOption(){return this._option}constructor(e){this._option=e,this.getCompiler=this._option.getCompiler}getVGrammarView(){return this.getCompiler()?.getVGrammarView()}release(){this._option=null,this.getCompiler=null}}class gk extends hk{constructor(){super(...arguments),this.id=Lm(),this._compiledProductId=null,this._depend=[]}getProduct(){if(p(this._product))return this._product;let e=this.getVGrammarView(),t=this.getProductId();return p(t)&&p(e)&&(this._product=this._lookupGrammar(t)),this._product}getProductId(){return this._compiledProductId??this.generateProductId()}getDepend(){return this._depend}setDepend(...e){this._depend=e}compile(e){this._compileProduct(e),this._afterCompile(e)}_afterCompile(e){var t;p(this._product)&&((t=this.getCompiler())==null||t.addGrammarItem(this))}updateDepend(){if(p(this._product)){let e=this.getDepend().map((e=>e.getProduct())).filter(p);return this._product.depend(e),e.length===this.getDepend().length}return!1}release(){this.removeProduct(),super.release(),this._depend=[]}removeProduct(e){this.getCompiler().removeGrammarItem(this,e),this._product=null,this._compiledProductId=null}}class _k extends gk{getValue(){return this._value}getUpdateFunc(){return this._updateFunc}constructor(e,t,n,r){super(e),this.grammarType=ZO.signal,this.name=t,this._value=n,this._updateFunc=r}updateSignal(e,t){this._value=e,this._updateFunc=t,this.compile()}_compileProduct(){let e=this.getVGrammarView();if(e){if(!this.getProduct()){let t=this.getProductId();this._product=e.signal().id(t),this._compiledProductId=t}p(this._value)&&this._product.value(this._value),p(this._updateFunc)&&this._product.update(this._updateFunc)}}generateProductId(){return this.name}_lookupGrammar(e){return this.getCompiler().getVGrammarView()?.getSignalById(e)}}class vk extends hk{constructor(){super(...arguments),this._signalMap={}}getSignalMap(){return this._signalMap}getSignal(e){return this._signalMap[e]}updateSignal(e,t,n){this._signalMap[e]?this._signalMap[e].updateSignal(t,n):(this._signalMap[e]=new _k(this._option,e,t,n),this._signalMap[e].compile())}compile(){Object.values(this._signalMap).forEach((e=>{e.compile()}))}release(){super.release(),Object.values(this._signalMap).forEach((e=>{e.release()})),this._signalMap={}}}class yk extends vk{getStateMap(){return this._stateMap}_getDefaultStateMap(){return{}}constructor(e){super(e),e.stateKeyToSignalName?this.stateKeyToSignalName=e.stateKeyToSignalName:this.stateKeyToSignalName=()=>\`state_signal\`,this.initStateMap()}initStateMap(e){this._stateMap=e??this._getDefaultStateMap()}compile(e){let t=e??this._stateMap;Object.keys(t).forEach((e=>{let n=this.stateKeyToSignalName(e),r=t[e];this.updateSignal(n,r)}))}updateState(e,t){if(e&&(N(this._stateMap,e),this.compile(e),!t))return this.getCompiler().renderNextTick()}}class bk extends yk{constructor(){super(...arguments),this.id=Lm(),this.stateKeyToSignalName=e=>\`\${K}_animate_\${this.id}_\${e}\`}getAnimationStateSignalName(){return this.stateKeyToSignalName(\`animationState\`)}updateAnimateState(e,t){e===XO.update?this.updateState({animationState:{callback:(e,t)=>t.diffState}},t):e===XO.appear?this.updateState({animationState:{callback:(e,t)=>t.diffState===\`exit\`?XO.none:XO.appear}},t):this.updateState({animationState:{callback:(t,n)=>e}},t)}_getDefaultStateMap(){return{animationState:{callback:(e,t)=>t.diffState===\`exit\`?XO.exit:t.diffState===\`update\`?XO.update:XO.appear}}}}class xk{constructor(e){this._option=e,this.type=e.type}_initTheme(e,t){return this._theme=this.getTheme(e,t),this._mergeThemeToSpec(e,t)}getTheme(e,t){}transformSpec(e,t,n){this._transformSpecBeforeMergingTheme(e,t,n);let r=this._initTheme(e,t);return this._transformSpecAfterMergingTheme(r.spec,t,n),r}_transformSpecBeforeMergingTheme(e,t,n){}_transformSpecAfterMergingTheme(e,t,n){}_mergeThemeToSpec(e,t){let n=this._theme;if(this._shouldMergeThemeToSpec()){let r=this._getDefaultSpecFromChart(t),i=e=>q({},n,r,e);return y(e)?{spec:e.map((e=>i(e))),theme:n}:{spec:i(e),theme:n}}return{spec:e,theme:n}}_shouldMergeThemeToSpec(){return!0}_getDefaultSpecFromChart(e){}}class Sk extends hk{getSpec(){return this._spec||{}}getSpecPath(){return this._option?.specPath}getSpecInfoPath(){return this._option?.specInfoPath??this._option?.specPath}getData(){return this._data}get layout(){return this._layout}getOption(){return this._option}getMarks(){return this._marks?.getMarks()??[]}getMarkNameMap(){return this._marks?.getMarkNameMap()}getMarkSet(){return this._marks}getChart(){return this._option.getChart()}get _theme(){return this.getSpecInfo()?.theme}constructor(e,t){var n;super(t),this.transformerConstructor=xk,this.type=\`null\`,this.modelType=\`null\`,this.userId=void 0,this._data=null,this._layout=null,this.specKey=\`\`,this._marks=new sk,this._lastLayoutRect=null,this.id=Lm(),this.userId=e.id,this._spec=e,this.effect={},this.event=new LO(t.eventDispatcher,t.mode),(n=t.map)==null||n.set(this.id,this)}_releaseEvent(){this.event.release()}created(){this.setAttrFromSpec()}init(e){}afterInit(){}getVisible(){return!1!==this._spec?.visible}onLayoutStart(e,t,n){var r;(r=this._layout)==null||r.onLayoutStart(e,t,n)}onLayoutEnd(e){var t;(t=this._layout)==null||t.onLayoutEnd(e),this.getMarks().forEach((e=>e.updateLayoutState(!0,!0)))}onEvaluateEnd(e){}onDataUpdate(){}beforeRelease(){}release(){var e;this._releaseEvent(),this._spec=void 0,this.getMarks().forEach((e=>e.release())),(e=this._data)==null||e.release(),this._data=null,this._marks.clear(),super.release()}updateSpec(e){let t=this._compareSpec(e,this._spec);return this._spec=e,t}_compareSpec(e,t){return{change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1}}reInit(e){e&&(this._spec=e),this.setAttrFromSpec()}updateLayoutAttribute(){}setAttrFromSpec(){var e;(e=this._layout)==null||e.setAttrFromSpec(this._spec,this._option.getChartViewRect())}_convertMarkStyle(e){return Object.assign({},e)}setMarkStyle(e,t,n,r){p(e)&&p(t)&&e.setStyle(this._convertMarkStyle(t),n,r)}initMarkStyleWithSpec(e,t,n){if(!p(e)||!p(t))return;let{style:r,state:i}=t,a=Object.assign({},t);r&&(a.style=this._convertMarkStyle(r)),i&&(a.state={},Object.keys(i).forEach((e=>{a.state[e]=this._convertMarkStyle(i[e])}))),e.initStyleWithSpec(a,n)}stateKeyToSignalName(e,t){let n=\`\${K}_\${this.modelType}_\${this.type}_\${this.id}_\${e}\`;return t&&(n+=\`_\${t}\`),n}compileData(){var e;(e=this._data)==null||e.compile()}compileMarks(e){this.getMarks().forEach((t=>{t.compile({group:e})}))}_createMark(e,t={},n){let{type:r,name:i}=e,a=J.createMark(r,i,Object.assign({model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._option.globalScale},t));return a&&(a.created(),n&&a.setMarkConfig(n)),a}_getDataIdKey(){}getColorScheme(){var e;return(e=this._option).getTheme?.call(e).colorScheme}getSpecInfo(){var e;return((e,t,n)=>{if(!f(t))return j(e,t,n)})((e=this._option).getSpecInfo?.call(e)??{},this.getSpecInfoPath())}getSpecIndex(){let e=this.getSpecPath();if(!e?.length)return 0;let t=Number(e[e.length-1]);return isNaN(t)?0:t}}class Ck{getSpec(){return this._spec||{}}getLayoutStartPoint(){return this._layoutStartPoint}get layoutRectLevelMap(){return this._layoutRectLevelMap}get minWidth(){return this._minWidth}set minWidth(e){this._minWidth=e}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth=e}get minHeight(){return this._minHeight}set minHeight(e){this._minHeight=e}get maxHeight(){return this._maxHeight}set maxHeight(e){this._maxHeight=e}getLastComputeOutBounds(){return this._lastComputeOutBounds}get layoutOrient(){return this._layoutOrient}set layoutOrient(e){this._layoutOrient=e}get model(){return this._model}get type(){return this._model.type}constructor(e,t){this.layoutClip=!1,this.autoIndent=!1,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:0,height:0},this._layoutRectLevelMap={width:0,height:0},this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._lastComputeRect=null,this._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0},this.getLayoutRect=()=>this._layoutRect,this.layoutType=\`normal\`,this._layoutOrient=\`left\`,this.layoutPaddingLeft=0,this.layoutPaddingTop=0,this.layoutPaddingRight=0,this.layoutPaddingBottom=0,this.layoutOffsetX=0,this.layoutOffsetY=0,this.layoutLevel=mk.Region,this._model=e,this._option=t,this.layoutLevel=t.layoutLevel,this.layoutType=t.layoutType,t.layoutOrient&&(this.layoutOrient=t.layoutOrient),this._spec=(e?.getSpec)?.call(e)}_setLayoutAttributeFromSpec(e,t){if(this._spec&&!1!==this._spec.visible){let n=_C(vC(e.padding),t,t);this.layoutPaddingLeft=n.left,this.layoutPaddingRight=n.right,this.layoutPaddingTop=n.top,this.layoutPaddingBottom=n.bottom,this._minHeight=f(e.minHeight)?this._minHeight??null:gC(e.minHeight,t.height,t),this._maxHeight=f(e.maxHeight)?this._maxHeight??null:gC(e.maxHeight,t.height,t),this._minWidth=f(e.minWidth)?this._minWidth??null:gC(e.minWidth,t.width,t),this._maxWidth=f(e.maxWidth)?this._maxWidth??null:gC(e.maxWidth,t.width,t),e.width&&this.setLayoutRect({width:gC(e.width,t.width,t)},{width:9}),e.height&&this.setLayoutRect({height:gC(e.height,t.height,t)},{height:9}),f(e.offsetX)||(this.layoutOffsetX=gC(e.offsetX,t.width,t)),f(e.offsetY)||(this.layoutOffsetY=gC(e.offsetY,t.height,t)),e.alignSelf&&(this.alignSelf=e.alignSelf)}}setAttrFromSpec(e,t){this._spec=e,this.layoutType=e.layoutType??this.layoutType,this.layoutLevel=e.layoutLevel??this.layoutLevel,this.layoutOrient=e.orient??this.layoutOrient,this._setLayoutAttributeFromSpec(e,t),this.layoutClip=e.clip??this.layoutClip}onLayoutStart(e,t,n){this._setLayoutAttributeFromSpec(this._spec,t)}onLayoutEnd(e){}_getAbsoluteSpecValue(e){let t={top:null,bottom:null,left:null,right:null};return[\`top\`,\`bottom\`,\`left\`,\`right\`].forEach((n=>{f(this._spec[n])||(t[n]=gC(this._spec[n],n===\`top\`||n===\`bottom\`?e.height:e.width,e))})),t}absoluteLayoutInRect(e){let{top:t,bottom:n,left:r,right:i}=this._getAbsoluteSpecValue(e),a={width:e.width-this.layoutPaddingLeft-this.layoutPaddingRight,height:e.height-this.layoutPaddingTop-this.layoutPaddingBottom};f(r)||(a.width-=r),f(i)||(a.width-=i),f(t)||(a.height-=t),f(n)||(a.height-=n),this.setLayoutRect(a);let{width:o,height:s}=this.computeBoundsInRect(this.getLayoutRect());this.setLayoutRect({width:o,height:s});let c={x:e.x,y:e.y};!0===this._spec.center?(c.x=e.x+.5*e.width-.5*o,c.y=e.y+.5*e.height-.5*s):(f(r)?f(i)||(c.x=e.x+e.width-this.layoutPaddingRight-i-o):c.x=e.x+r+this.layoutPaddingLeft,f(t)?f(n)||(c.y=e.y+e.height-this.layoutPaddingBottom-n-s):c.y=e.y+t+this.layoutPaddingTop),this.setLayoutStartPosition(c)}setLayoutStartPosition(e){var t,n;this._option.transformLayoutPosition&&(e=this._option.transformLayoutPosition(e)),C(e.x)&&(this._layoutStartPoint.x=e.x),C(e.y)&&(this._layoutStartPoint.y=e.y),(n=(t=this._model).afterSetLayoutStartPoint)==null||n.call(t,this._layoutStartPoint)}setLayoutRect({width:e,height:t},n){C(e)&&(n?.width??0)>=this._layoutRectLevelMap.width&&(this._layoutRect.width=e,this._layoutRectLevelMap.width=n?.width??0),C(t)&&(n?.height??0)>=this._layoutRectLevelMap.height&&(this._layoutRect.height=t,this._layoutRectLevelMap.height=n?.height??0),this.setRectInSpec(this._layoutRect)}getLayout(){return{x:this._layoutStartPoint.x,y:this._layoutStartPoint.y,width:this._layoutRect.width,height:this._layoutRect.height}}mergeLayoutRect({width:e,height:t}){let n={width:e,height:t};return this._layoutRectLevelMap.width>0&&(n.width=this._layoutRect.width),this._layoutRectLevelMap.height>0&&(n.height=this._layoutRect.height),n}getOrientPosAttribute(){return this._layoutOrient===\`bottom\`||this._layoutOrient===\`top\`?\`x\`:\`y\`}getOrientSizeAttribute(){return this._layoutOrient===\`bottom\`||this._layoutOrient===\`top\`?\`width\`:\`height\`}changeBoundsBySetting(e){return this._layoutRectLevelMap.width>0&&(e.x2=e.x1+this._layoutRect.width),this._layoutRectLevelMap.height>0&&(e.y2=e.y1+this._layoutRect.height),e.x1-=this._layoutStartPoint.x,e.x2-=this._layoutStartPoint.x,e.y1-=this._layoutStartPoint.y,e.y2-=this._layoutStartPoint.y,e}setRectInSpec(e){let t=Object.assign({},e);return this._layoutRectLevelMap.width<9?(f(this._minWidth)||(t.width=Math.max(t.width,this._minWidth)),f(this._maxWidth)||(t.width=Math.min(t.width,this._maxWidth))):t.width=this._layoutRect.width,this._layoutRectLevelMap.height<9?(f(this._minHeight)||(t.height=Math.max(t.height,this._minHeight)),f(this._maxHeight)||(t.height=Math.min(t.height,this._maxHeight))):t.height=this._layoutRect.height,t}computeBoundsInRect(e){if(this._lastComputeRect=e,!(this.layoutType!==\`region-relative\`&&this.layoutType!==\`region-relative-overlap\`||(this._layoutRectLevelMap.width!==9||this.layoutOrient!==\`left\`&&this.layoutOrient!==\`right\`)&&(this._layoutRectLevelMap.height!==9||this.layoutOrient!==\`bottom\`&&this.layoutOrient!==\`top\`)))return this._layoutRect;let t=Object.assign({},this._model.getBoundsInRect(this.setRectInSpec(e),e));this.changeBoundsBySetting(t),this.autoIndent&&t.x2-t.x1>0&&t.y2-t.y1>0&&(this._lastComputeOutBounds.x1=Math.ceil(-t.x1),this._lastComputeOutBounds.x2=Math.ceil(t.x2-e.width),this._lastComputeOutBounds.y1=Math.ceil(-t.y1),this._lastComputeOutBounds.y2=Math.ceil(t.y2-e.height));let n=this.setRectInSpec(function(e,t){return e?{width:Math.ceil(Math.min(e.x2-e.x1,t.width)),height:Math.ceil(Math.min(e.y2-e.y1,t.height))}:{width:0,height:0}}(t,e));return this._option.transformLayoutRect&&(n=this._option.transformLayoutRect(n)),n}getModelId(){return this._model.id}getModelVisible(){return this._model.getVisible()}}class wk extends Sk{constructor(){super(...arguments),this.layoutType=\`normal\`,this.layoutLevel=0,this.layoutZIndex=0,this._forceLayoutTag=!1,this._layout=null,this._orient=null,this._layoutRect={width:0,height:0},this._layoutStartPos={x:0,y:0},this._isLayout=!0,this.getGraphicBounds=()=>this._layout?{x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}:{x1:0,x2:0,y1:0,y2:0},this._transformLayoutRect=null,this._transformLayoutPosition=null}get layoutOrient(){return this._orient}set layoutOrient(e){this._orient=e,this._layout&&(this._layout.layoutOrient=e)}initLayout(){this.layoutType!==\`none\`&&(this._layout=new Ck(this,{layoutType:this.layoutType,layoutLevel:this.layoutLevel,layoutOrient:this._orient,transformLayoutRect:this._transformLayoutRect,transformLayoutPosition:this._transformLayoutPosition}),this._orient&&this._orient!==\`radius\`&&this._orient!==\`angle\`&&this._layout&&(this._layout.layoutOrient=this._orient))}onLayoutStart(e,t,n){this._isLayout=!0,super.onLayoutStart(e,t,n)}onLayoutEnd(e){super.onLayoutEnd(e),this.updateLayoutAttribute();let t=this.getLayoutRect();!this._forceLayoutTag&&ce(this._lastLayoutRect,t)||(this._lastLayoutRect=Object.assign({},t)),this._forceLayoutTag=!1,this._isLayout=!1}afterSetLayoutStartPoint(e){}_forceLayout(){var e;this._isLayout||(this._forceLayoutTag=!0,(e=this._option.globalInstance.getChart())==null||e.setLayoutTag(!0))}getLayoutStartPoint(){return this._layout?this._layout.getLayoutStartPoint():this._layoutStartPos}setLayoutStartPosition(e){return this._layout?this._layout.setLayoutStartPosition(e):this._layoutStartPos=N(this._layoutStartPos,e)}getLayoutRect(){return this._layout?this._layout.getLayoutRect():this._layoutRect}setLayoutRect(e,t){return this._layout?this._layout.setLayoutRect(e):this._lastLayoutRect=N(this._layoutRect,e)}getLastComputeOutBounds(){return this._layout?.getLastComputeOutBounds()}setAttrFromSpec(){super.setAttrFromSpec(),this.layoutClip=this._spec.clip??this.layoutClip,this.layoutZIndex=this._spec.zIndex??this.layoutZIndex,this.layoutType=this._spec.layoutType??this.layoutType,this._orient=this._spec.orient??this._orient,this.layoutLevel=this._spec.layoutLevel??this.layoutLevel}}class Tk extends xk{_initTheme(e,t){return{spec:e,theme:this._theme}}}class Ek extends wk{getMaxWidth(){return this._layout.maxWidth}setMaxWidth(e){this._layout.maxWidth=e}getMaxHeight(){return this._layout.maxHeight}setMaxHeight(e){this._layout.maxHeight=e}getGroupMark(){return this._groupMark}getInteractionMark(){return this._interactionMark}getStackInverse(){return!0===this._spec.stackInverse}getStackSort(){return!0===this._spec.stackSort}constructor(e,t){super(e,t),this.transformerConstructor=Tk,this.modelType=\`region\`,this.specKey=\`region\`,this.type=Ek.type,this._series=[],this.layoutType=\`region\`,this.layoutZIndex=pk.Region,this.interaction=new fk,this.seriesDataFilterOver=()=>{this.event.emit(Q.regionSeriesDataFilterOver,{model:this,chart:this.getChart()}),this._series.forEach((e=>{e.getViewDataFilter()&&e.reTransformViewData()}))},this.getBoundsInRect=()=>({x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}),this.userId=e.id,this.coordinate=e.coordinate??\`cartesian\`,this._option.animation&&(this.animate=new bk({getCompiler:t.getCompiler})),this.interaction.setDisableActiveEffect(this._option.disableTriggerEvent)}_getClipDefaultValue(){var e,t;let n=this._option.getChart().getSpec(),r=((e=n.dataZoom)?.some)?.call(e,(e=>(e.filterMode??\`filter\`)===\`axis\`)),i=((t=n.scrollBar)?.some)?.call(t,(e=>(e.filterMode??\`axis\`)===\`axis\`));return!(!r&&!i)||this._layout.layoutClip}created(){this.initLayout(),super.created();let e=this._spec.clip??this._getClipDefaultValue();this._groupMark=this._createGroupMark(\`regionGroup\`,this.userId,this.layoutZIndex),this._spec.roam&&this._groupMark.setMarkConfig({interactive:!0}),this._interactionMark=this._createGroupMark(\`regionInteractionGroup\`,(this.userId??this.type)+\`_interaction\`,pk.Interaction),A(this._spec.style)||(this._backgroundMark=this._createMark({type:\`rect\`,name:\`regionBackground\`}),e&&(this._foregroundMark=this._createMark({type:\`rect\`,name:\`regionForeground\`})),[this._backgroundMark,this._foregroundMark].forEach((e=>{e&&(e.created(),this.setMarkStyle(e,{width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height},\`normal\`,$.Built_In),this._groupMark.addMark(e))})),this._backgroundMark&&this._backgroundMark.setMarkConfig({zIndex:pk.SeriesGroup-1}),this._foregroundMark&&this._foregroundMark.setMarkConfig({zIndex:pk.Mark+1})),this.createTrigger()}_createGroupMark(e,t,n){let r=this._createMark({type:\`group\`,name:e});r.setUserId(t),r.setMarkConfig({zIndex:n});let i=this._spec.clip??this._getClipDefaultValue();return this.setMarkStyle(r,{x:()=>this.getLayoutStartPoint().x,y:()=>this.getLayoutStartPoint().y,width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height,clip:i},\`normal\`,$.Built_In),this.setMarkStyle(r,{cornerRadius:this._spec.style?.cornerRadius},\`normal\`,$.User_Mark),this._marks.addMark(r),r}init(e){super.init(e),this.initMark(),this.initSeriesDataflow(),this.initInteraction(),this.initTrigger()}initMark(){this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}_initBackgroundMarkStyle(){this._backgroundMark&&(this.setMarkStyle(this._backgroundMark,Object.assign({fillOpacity:this._spec.style?.fill?1:0},this._spec.style),\`normal\`,$.User_Mark),(this._spec.clip??this._getClipDefaultValue())&&this.setMarkStyle(this._backgroundMark,{strokeOpacity:0},\`normal\`,$.Built_In))}_initForegroundMarkStyle(){this._foregroundMark&&this.setMarkStyle(this._foregroundMark,Object.assign(Object.assign({},this._spec.style),{fillOpacity:0,pickable:!1}),\`normal\`,$.User_Mark)}_compareSpec(e,t){let n=super._compareSpec(e,t);return ce(t?.style,e?.style)||(n.reMake=!0),n}reInit(e){super.reInit(e),this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}addSeries(e){e&&(this._series.includes(e)||this._series.push(e))}removeSeries(e){if(!e)return;let t=this._series.findIndex((t=>t===e));t>=0&&this._series.splice(t,1)}getSeries(e={}){return this._series.filter((t=>(!e.name||t?.name===e.name)&&(!e.userId||P(e.userId).includes(t.userId))&&(!p(e.specIndex)||P(e.specIndex).includes(t.getSpecIndex()))&&(!e.id||t.id===e.id)&&(!e.type||t.type===e.type)&&(!e.coordinateType||t.coordinate===e.coordinateType)&&(!e.dataName||t.getRawData?.call(t)?.name===e.dataName)))}getSeriesInName(e){return this.getSeries({name:e})[0]}getSeriesInUserId(e){return this.getSeries({userId:e})[0]}getSeriesInId(e){return this.getSeries({id:e})[0]}getSeriesInType(e){return this.getSeries({type:e})}getSeriesInCoordinateType(e){return this.getSeries({coordinateType:e})}getSeriesInDataName(e){return this.getSeries({dataName:e})}onRender(e){}initSeriesDataflow(){let e=this._series.map((e=>e.getViewDataFilter()??e.getViewData())).filter((e=>!!e));this._option.dataSet.multipleDataViewAddListener(e,\`change\`,this.seriesDataFilterOver)}release(){super.release(),this._series=[]}createTrigger(){let e=Object.assign(Object.assign({},this._option),{model:this,interaction:this.interaction});this._trigger=new ck(e)}initTrigger(){this._series.forEach((e=>{e.getMarksWithoutRoot().forEach((e=>{this._trigger.registerMark(e)}))})),this._trigger.init()}initInteraction(){this._option.disableTriggerEvent||this._series.forEach((e=>{e.getMarksWithoutRoot().forEach((e=>{for(let t in $O)A(e.stateStyle[$O[t]])||this.interaction.registerMark($O[t],e)}))}))}compileMarks(e){this.getMarks().forEach((t=>{var n;t.compile({group:e,context:{model:this}}),(n=t.getProduct())==null||n.layout(((e,t,n,r)=>{}))}))}compile(){var e;(e=this.animate)==null||e.compile(),this.compileMarks()}onLayoutEnd(e){this._series.forEach((t=>t.onLayoutEnd(e))),super.onLayoutEnd(e)}}function Dk(e){let t=[],n=[],r=[];return e.forEach((e=>{f(e.getSpec().position)||e.getSpec().position===\`start\`?t.push(e):e.getSpec().position===\`middle\`?n.push(e):e.getSpec().position===\`end\`&&r.push(e)})),{startItems:t,endItems:r,middleItems:n}}function Ok(e,t,n){t?e.forEach((e=>{let t=de(e),r=t.getLayoutStartPoint().y+t.getLayoutRect().height-e[0].getLayoutStartPoint().y,i=(n-r)/2;e.forEach((e=>{e.setLayoutStartPosition({x:e.getLayoutStartPoint().x,y:e.getLayoutStartPoint().y+i})}))})):e.forEach((e=>{let t=de(e),r=t.getLayoutStartPoint().x+t.getLayoutRect().width-e[0].getLayoutStartPoint().x,i=(n-r)/2;e.forEach((e=>{e.setLayoutStartPosition({x:e.getLayoutStartPoint().x+i,y:e.getLayoutStartPoint().y})}))}))}function kk(e,t,n,r){let i;e.forEach(((e,a)=>{e.length>1&&(i=n[a],e.forEach((e=>{if(!e.alignSelf||e.alignSelf===\`start\`)return;let n=e.getLayoutStartPoint(),a=e.alignSelf===\`middle\`?.5:1,o=t?i-(e.getLayoutRect().width+e.layoutPaddingLeft+e.layoutPaddingRight):i-(e.getLayoutRect().height+e.layoutPaddingTop+e.layoutPaddingBottom);t?e.setLayoutStartPosition({x:n.x+r*o*a,y:n.y}):e.setLayoutStartPosition({x:n.x,y:n.y+r*o*a})})))}))}function Ak(e,t,n,r,i){if(e.length){let a=0,o=i===\`right\`,s=o?-1:1,c=o?t.rightCurrent:t.leftCurrent,l=t.topCurrent,u=[],d=[],f=[];e.forEach((e=>{let r=t.getItemComputeLayoutRect(e),i=e.computeBoundsInRect(r);e.setLayoutRect(i);let p=i.height+e.layoutPaddingTop+e.layoutPaddingBottom,m=i.width+e.layoutPaddingLeft+e.layoutPaddingRight,h=o?-i.width-e.layoutPaddingRight:e.layoutPaddingLeft;e.setLayoutStartPosition({x:c+e.layoutOffsetX+h,y:l+e.layoutOffsetY+e.layoutPaddingTop}),l+=p,l>n&&d.length?(f.push(a),c+=s*a,a=m,l=t.topCurrent+p,e.setLayoutStartPosition({x:c+e.layoutOffsetX+h,y:t.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),u.push(d),d=[e]):(a=Math.max(a,m),d.push(e))})),f.push(a),u.push(d),kk(u,!0,f,s),r&&Ok(u,!0,n),o?t.rightCurrent=c+s*a:t.leftCurrent=c+s*a}}function jk(e,t,n,r){if(e.length){let n=0,i=r===\`right\`,a=i?-1:1,o=i?t.rightCurrent:t.leftCurrent,s=t.bottomCurrent,c=[],l=[],u=[];e.forEach((e=>{let r=t.getItemComputeLayoutRect(e),d=e.computeBoundsInRect(r);e.setLayoutRect(d);let f=d.height+e.layoutPaddingTop+e.layoutPaddingBottom,p=d.width+e.layoutPaddingLeft+e.layoutPaddingRight,m=i?-d.width-e.layoutPaddingRight:e.layoutPaddingLeft;s<f&&l.length?(u.push(n),o+=a*n,n=p,s=t.bottomCurrent,e.setLayoutStartPosition({x:o+e.layoutOffsetX+m,y:s+e.layoutOffsetY-d.height-e.layoutPaddingBottom}),c.push(l),l=[e]):(e.setLayoutStartPosition({x:o+e.layoutOffsetX+m,y:s+e.layoutOffsetY-d.height-e.layoutPaddingBottom}),n=Math.max(n,p),s-=f,l.push(e))})),u.push(n),c.push(l),kk(c,!0,u,a),i?t.rightCurrent=o+a*n:t.leftCurrent=o+a*n}}function Mk(e,t,n,r,i){if(e.length){let a=i===\`top\`,o=a?1:-1,s=0,c=t.leftCurrent,l=a?t.topCurrent:t.bottomCurrent,u=[],d=[],f=[];e.forEach((e=>{let r=t.getItemComputeLayoutRect(e),i=e.computeBoundsInRect(r);e.setLayoutRect(i);let p=i.height+e.layoutPaddingTop+e.layoutPaddingBottom,m=i.width+e.layoutPaddingLeft+e.layoutPaddingRight,h=a?e.layoutPaddingTop:-i.height-e.layoutPaddingBottom;e.setLayoutStartPosition({x:c+e.layoutOffsetX+e.layoutPaddingLeft,y:l+e.layoutOffsetY+h}),c+=m,c>n&&d.length?(f.push(s),c=t.leftCurrent+m,l+=o*s,s=p,e.setLayoutStartPosition({x:t.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:l+e.layoutOffsetY+h}),u.push(d),d=[e]):(s=Math.max(s,p),d.push(e))})),f.push(s),u.push(d),kk(u,!1,f,o),r&&Ok(u,!1,n),a?t.topCurrent=l+o*s:t.bottomCurrent=l+o*s}}function Nk(e,t,n,r){if(e.length){let n=r===\`top\`,i=n?1:-1,a=0,o=t.rightCurrent,s=n?t.topCurrent:t.bottomCurrent,c=[],l=[],u=[];e.forEach((e=>{let r=t.getItemComputeLayoutRect(e),u=e.computeBoundsInRect(r);e.setLayoutRect(u);let d=u.height+e.layoutPaddingTop+e.layoutPaddingBottom,f=u.width+e.layoutPaddingLeft+e.layoutPaddingRight,p=n?e.layoutPaddingTop:-u.height-e.layoutPaddingBottom;o<f&&l.length?(o=t.rightCurrent,s+=i*a,a=d,e.setLayoutStartPosition({x:t.rightCurrent+e.layoutOffsetX-u.width-e.layoutPaddingRight,y:s+e.layoutOffsetY+p}),c.push(l),l=[e]):(l.push(e),e.setLayoutStartPosition({x:o+e.layoutOffsetX-u.width-e.layoutPaddingRight,y:s+e.layoutOffsetY+p}),a=Math.max(a,d),o-=f)})),u.push(a),c.push(l),kk(c,!1,u,i),n?t.topCurrent=s+i*a:t.bottomCurrent=s+i*a}}Ek.type=\`region\`,Ek.transformerConstructor=Tk,Ek.specKey=\`region\`;class Pk{constructor(e,t){this.leftCurrent=0,this.topCurrent=0,this.rightCurrent=0,this.bottomCurrent=0,this._onError=t?.onError}_layoutInit(e,t,n,r){this._chartLayoutRect=n,this._chartViewBox=r,this.leftCurrent=n.x,this.topCurrent=n.y,this.rightCurrent=n.x+n.width,this.bottomCurrent=n.height+n.y,t.sort(((e,t)=>t.layoutLevel-e.layoutLevel))}_layoutNormalItems(e){this.layoutNormalInlineItems(e.filter((e=>e.layoutType===\`normal-inline\`))),this.layoutNormalItems(e.filter((e=>e.layoutType===\`normal\`)))}_groupItems(e){let t=e.filter((e=>e.layoutType===\`region\`)),n=e.filter((e=>e.layoutType===\`region-relative\`)),r=e.filter((e=>e.layoutType===\`region-relative-overlap\`)),i=n.concat(r),a={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}};return r.forEach((e=>{a[e.layoutOrient].items.push(e)})),{regionItems:t,relativeItems:n,relativeOverlapItems:r,allRelatives:i,overlapItems:a}}layoutItems(e,t,n,r){this._layoutInit(e,t,n,r),this._layoutNormalItems(t);let i={left:this.leftCurrent,top:this.topCurrent,right:this.rightCurrent,bottom:this.bottomCurrent},{regionItems:a,relativeItems:o,relativeOverlapItems:s,allRelatives:c,overlapItems:l}=this._groupItems(t);this.layoutRegionItems(a,o,s,l),this._processAutoIndent(a,o,s,l,c,i),this.layoutAbsoluteItems(t.filter((e=>e.layoutType===\`absolute\`)))}_processAutoIndent(e,t,n,r={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}},i,a){if(i.some((e=>e.autoIndent))){let{top:o,bottom:s,left:c,right:l}=this._checkAutoIndent(i,a);(o||s||c||l)&&(this.topCurrent=a.top+o,this.bottomCurrent=a.bottom-s,this.leftCurrent=a.left+c,this.rightCurrent=a.right-l,this.layoutRegionItems(e,t,n,r))}}layoutNormalItems(e){e.forEach((e=>{let t=this.getItemComputeLayoutRect(e),n=e.computeBoundsInRect(t);e.setLayoutRect(n),e.layoutOrient===\`left\`?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.leftCurrent+=n.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient===\`top\`?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.topCurrent+=n.height+e.layoutPaddingTop+e.layoutPaddingBottom):e.layoutOrient===\`right\`?(e.setLayoutStartPosition({x:this.rightCurrent+e.layoutOffsetX-n.width-e.layoutPaddingRight,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.rightCurrent-=n.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient===\`bottom\`&&(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingRight,y:this.bottomCurrent+e.layoutOffsetY-n.height-e.layoutPaddingBottom}),this.bottomCurrent-=n.height+e.layoutPaddingTop+e.layoutPaddingBottom)}))}layoutNormalInlineItems(e){let t=e.filter((e=>e.layoutOrient===\`left\`)),n=e.filter((e=>e.layoutOrient===\`right\`)),r=e.filter((e=>e.layoutOrient===\`top\`)),i=e.filter((e=>e.layoutOrient===\`bottom\`)),a=this._chartLayoutRect.width+this._chartLayoutRect.x,o=this._chartLayoutRect.height+this._chartLayoutRect.y;t.length&&function(e,t,n){let{startItems:r,middleItems:i,endItems:a}=Dk(e);r.length&&Ak(r,t,n,!1,\`left\`),i.length&&Ak(i,t,n,!0,\`left\`),a.length&&jk(a,t,0,\`left\`)}(t,this,o),r.length&&function(e,t,n){let{startItems:r,middleItems:i,endItems:a}=Dk(e);r.length&&Mk(r,t,n,!1,\`top\`),i.length&&Mk(i,t,n,!0,\`top\`),a.length&&Nk(a,t,0,\`top\`)}(r,this,a),n.length&&function(e,t,n){let{startItems:r,middleItems:i,endItems:a}=Dk(e);r.length&&Ak(r,t,n,!1,\`right\`),i.length&&Ak(i,t,n,!0,\`right\`),a.length&&jk(a,t,0,\`right\`)}(n,this,o),i.length&&function(e,t,n){let{startItems:r,middleItems:i,endItems:a}=Dk(e);r.length&&Mk(r,t,n,!1,\`bottom\`),i.length&&Mk(i,t,n,!0,\`bottom\`),a.length&&Nk(a,t,0,\`bottom\`)}(i,this,a)}_layoutRelativeOverlap(e,t){t.items.forEach((e=>{let n=this.getItemComputeLayoutRect(e),r=e.computeBoundsInRect(n);t.rect.width=Math.max(r.width+e.layoutPaddingLeft+e.layoutPaddingRight,t.rect.width),t.rect.height=Math.max(r.height+e.layoutPaddingTop+e.layoutPaddingBottom,t.rect.height)})),t.items.forEach((n=>{n.setLayoutRect(t.rect),e===\`left\`?n.setLayoutStartPosition({x:this.leftCurrent+n.layoutOffsetX}):e===\`right\`?n.setLayoutStartPosition({x:this.rightCurrent-t.rect.width+n.layoutOffsetX}):e===\`top\`?n.setLayoutStartPosition({x:this.topCurrent+n.layoutOffsetY}):n.setLayoutStartPosition({x:this.bottomCurrent-t.rect.height+n.layoutOffsetY})})),e===\`left\`?this.leftCurrent+=t.rect.width:e===\`right\`?this.rightCurrent-=t.rect.width:e===\`top\`?this.topCurrent+=t.rect.height:this.bottomCurrent-=t.rect.height}_layoutRelativeItem(e,t){let n=e.computeBoundsInRect(t);e.layoutOrient===\`left\`||e.layoutOrient===\`right\`?e.setLayoutRect({width:n.width}):e.setLayoutRect({height:n.height}),e.layoutOrient===\`left\`?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft}),this.leftCurrent+=n.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient===\`right\`?(this.rightCurrent-=n.width+e.layoutPaddingLeft+e.layoutPaddingRight,e.setLayoutStartPosition({x:this.rightCurrent+e.layoutOffsetX+e.layoutPaddingLeft})):e.layoutOrient===\`top\`?(e.setLayoutStartPosition({y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.topCurrent+=n.height+e.layoutPaddingTop+e.layoutPaddingBottom):e.layoutOrient===\`bottom\`&&(this.bottomCurrent-=n.height+e.layoutPaddingTop+e.layoutPaddingBottom,e.setLayoutStartPosition({y:this.bottomCurrent+e.layoutOffsetY+e.layoutPaddingTop}))}_layoutRegionItem(e,t,n){let r=Math.max(Math.min(t,...e.map((e=>e.maxWidth??Number.MAX_VALUE))),0),i=Math.max(Math.min(n,...e.map((e=>e.maxHeight??Number.MAX_VALUE))),0);return e.forEach((e=>{let t=r-e.layoutPaddingLeft-e.layoutPaddingRight,n=i-e.layoutPaddingTop-e.layoutPaddingBottom;e.setLayoutRect({width:t,height:n}),e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop})})),{regionHeight:i,regionWidth:r}}layoutRegionItems(e,t,n,r={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}}){let i=this.rightCurrent-this.leftCurrent,a=this.bottomCurrent-this.topCurrent;t.filter((e=>e.layoutOrient===\`left\`||e.layoutOrient===\`right\`)).forEach((e=>{this._layoutRelativeItem(e,this.getItemComputeLayoutRect(e))})),this._layoutRelativeOverlap(\`left\`,r.left),this._layoutRelativeOverlap(\`right\`,r.right),i=this.rightCurrent-this.leftCurrent,t.filter((e=>e.layoutOrient===\`top\`||e.layoutOrient===\`bottom\`)).forEach((e=>{this._layoutRelativeItem(e,this.getItemComputeLayoutRect(e))})),this._layoutRelativeOverlap(\`top\`,r.top),this._layoutRelativeOverlap(\`bottom\`,r.bottom),a=this.bottomCurrent-this.topCurrent;let{regionWidth:o,regionHeight:s}=this._layoutRegionItem(e,i,a);t.concat(n).forEach((t=>{if([\`left\`,\`right\`].includes(t.layoutOrient)){let n=this.filterRegionsWithID(e,t.layoutBindRegionID[0]);t.setLayoutRect({height:n.getLayoutRect().height}),t.setLayoutStartPosition({y:n.getLayoutStartPoint().y+t.layoutOffsetY+t.layoutPaddingTop}),t.layoutOrient===\`right\`&&t.setLayoutStartPosition({x:t.getLayoutStartPoint().x+o-i})}else if([\`top\`,\`bottom\`].includes(t.layoutOrient)){let n=this.filterRegionsWithID(e,t.layoutBindRegionID[0]);t.setLayoutRect({width:n.getLayoutRect().width}),t.setLayoutStartPosition({x:n.getLayoutStartPoint().x+t.layoutOffsetX+t.layoutPaddingLeft}),t.layoutOrient===\`bottom\`&&t.setLayoutStartPosition({y:t.getLayoutStartPoint().y+s-a})}}))}layoutAbsoluteItems(e){e.forEach((e=>{e.absoluteLayoutInRect(this._chartLayoutRect)}))}filterRegionsWithID(e,t){let n=e.find((e=>e.getModelId()===t));return n||(this._onError??km)(\`can not find target region item, invalid id\`),n}getItemComputeLayoutRect(e){return{width:this.rightCurrent-this.leftCurrent-e.layoutPaddingLeft-e.layoutPaddingRight,height:this.bottomCurrent-this.topCurrent-e.layoutPaddingTop-e.layoutPaddingBottom}}_checkAutoIndent(e,t){let n={top:0,left:0,bottom:0,right:0};return e.forEach((e=>{if(!e.getModelVisible()||!e.autoIndent)return;let r=e.layoutOrient===\`left\`||e.layoutOrient===\`right\`,i=e.getLastComputeOutBounds(),a=this._getOutInLayout(i,e,t);r?(n.top=Math.max(n.top,a.top),n.bottom=Math.max(n.bottom,a.bottom)):(n.left=Math.max(n.left,a.left),n.right=Math.max(n.right,a.right))})),n}_getOutInLayout(e,t,n){let{x:r,y:i}=t.getLayoutStartPoint(),{width:a,height:o}=t.getLayoutRect();return{left:n.left-(r-e.x1),right:r+a+e.x2-n.right,top:n.top-(i-e.y1),bottom:i+o+e.y2-n.bottom}}}Pk.type=\`base\`;let Fk=[\`linear\`,\`radial\`,\`conical\`],Ik={linear:{x0:0,y0:0,x1:1,y1:1},radial:{x0:0,y0:0,x1:1,y1:1,r0:0,r1:1},conical:{x:.5,y:.5,startAngle:0,endAngle:2*Math.PI}},Lk=[\`line\`,\`area\`,\`trail\`];function Rk(e){return Lk.includes(e)}class zk extends yk{getStateInfoList(){return this._stateInfoList}constructor(e,t){super(e),this._stateInfoList=[],this._mark=t}_getDefaultStateMap(){return{markUpdateRank:1}}getStateInfo(e){return this._stateInfoList.find((t=>t.stateValue===e))}addStateInfo(e){if(this.getStateInfo(e.stateValue))return;e.level=e.level||0;let t=!0;for(let n=0;n<this._stateInfoList.length;n++){let r=this._stateInfoList[n].level;if(r&&r>e.level){this._stateInfoList.splice(n,0,e),t=!1;break}}t&&this._stateInfoList.push(e)}_clearStateBeforeSet(e){e.datums=null,e.items=null,e.fields=null,e.filter=null}changeStateInfo(e){let t=this.getStateInfo(e.stateValue);if(t){if(e.datums!==void 0&&(this._clearStateBeforeSet(t),t.datums=e.datums,t.datumKeys=e.datumKeys),e.items!==void 0&&(this._clearStateBeforeSet(t),t.items=e.items),e.fields!==void 0)if(this._clearStateBeforeSet(t),e.fields===null)t.fields=e.fields;else for(let n in t.fields=t.fields||{},e.fields){let r=e.fields[n];t.fields[n]=t.fields[n]||{};let i=t.fields[n];p(r.domain)&&(i.domain=r.domain),p(r.type)&&(i.type=r.type)}e.filter&&(this._clearStateBeforeSet(t),t.filter=e.filter)}else this.addStateInfo(e)}clearStateInfo(e){e.forEach((e=>{this.getStateInfo(e)&&this.changeStateInfo({stateValue:e,datumKeys:null,datums:null,fields:null,items:null,filter:null,cache:{}})}))}checkOneState(e,t,n,r){var i;r=u(Rk)?r:!e.mark||Rk(e.mark.markType);let a=!1,o=!1;if(p(n.datums)&&n.datums.length>0)a=this.checkDatumState(n,t,r),o=!0;else if(n.items)a=(i=this.checkItemsState(n,e))!=null&&i,o=!0;else if(n.fields)a=this.checkFieldsState(n,t,e,r),o=!0;else if(!a&&n.filter){let r={mark:this._mark,renderNode:e,type:e.mark.markType};a=n.filter(t,r),o=!0}return o?a?\`in\`:\`out\`:\`skip\`}checkState(e,t){let n=e.getStates().filter((e=>!!lk[e])).map((e=>[e,10])),r=!e.mark||Rk(e.mark.markType);for(let i=0;i<this._stateInfoList.length;i++){let a=this._stateInfoList[i],o=this.checkOneState(e,t,a,r);o!==\`skip\`&&o===\`in\`&&n.push([a.stateValue,a.level])}return n.map((e=>e[0]))}checkDatumState(e,t,n){let r=!1,i=n?t[0]:t;if(y(e.datums)){let t=e.datumKeys||Object.keys(e.datums[0]).filter((e=>!e.startsWith(K)));r=e.datums.some((e=>n&&y(e?.items)?t.every((t=>e?.items?.[0]?.[t]===i?.[t])):t.every((t=>e?.[t]===i?.[t]))))}else r=m(e.datums)?(e.datumKeys||Object.keys(e.datums).filter((e=>!e.startsWith(K)))).every((t=>n?e.datums.items?.[0][t]===i[t]:e.datums?.[t]===i[t])):t===e.datums;return r}checkItemsState(e,t){return e.items?.includes(t)}checkFieldsState(e,t,n,r){let i=!0;for(let a in e.fields){let o=e.fields[a],s=o.type,c=o.domain,l=r?t[0]?.[a]:t[a];if(Pb(s)&&c.length>1){if(this.checkLinearFieldState(c,a,t,n,r)){i=!1;break}i=!0}else{if(!c.some((e=>e===l))){i=!1;break}i=!0}}return i}checkLinearFieldState(e,t,n,r,i){let a=i?n[0]?.[t]:n[t];return a<e[0]||a>e[e.length-1]}updateLayoutState(e){return this._stateMap.markUpdateRank++,this.updateState({markUpdateRank:this._stateMap.markUpdateRank},e)}compileState(e,t){e.state({callback:(e,t)=>this.checkState(t,e)},t)}}class Bk extends gk{getDataView(){return this._data}setDataView(e){this._data=e}getLatestData(){return this._data?.latestData}constructor(e,t){super(e),this.grammarType=ZO.data,this._data=null,this._data=t}release(){super.release(),this._data=null}updateData(e){let t=this.getProduct(),n=this.getLatestData();if(t&&n&&(t.values(n),!e))return this.getCompiler().renderNextTick()}_compileProduct(){let e=this.getLatestData();f(e)||(f(this.getProduct())?this._initProduct(e):this._product.values(e))}_initProduct(e){let t=this.getVGrammarView();if(!t||!e)return;let n=this.getProductId();this._product=((t?.data)?.call(t,e))?.id(n),this._compiledProductId=n}generateProductId(){return\`\${this.getDataView()?.name}\`}_lookupGrammar(e){var t;return((t=this.getCompiler().getVGrammarView())?.getDataById)?.call(t,e)}}class Vk extends Bk{constructor(e){super(e),this._mark=e.mark}setCompiledProductId(e){this._compiledProductId=e}generateProductId(){let e=super.generateProductId();return p(e)?e:\`\${K}_markData_\${this._mark.id}\`}_compileProduct(){let e=this._data?.latestData;f(e)||p(this.getProduct())||this._initProduct(e)}}class Hk extends gk{getMarkConfig(){return this._markConfig}setMarkConfig(e){Object.keys(e).forEach((t=>{this._markConfig[t]=e[t]}))}getVisible(){return this._visible}setVisible(e){this._visible=e}getUserId(){return this._userId}setUserId(e){p(e)&&(this._userId=e)}getDataView(){return this._data?.getDataView()}setDataView(e,t){f(this._data)&&this.initMarkData(Object.assign(Object.assign({},this._option),{mark:this})),p(t)&&this._data.setCompiledProductId(t),this._data.setDataView(e)}getData(){return this._data}setData(e){this._data=e}hasState(e){return e in this.state.getStateMap()}getState(e){return this.state.getStateMap()[e]}getAnimationConfig(){return this._animationConfig}setAnimationConfig(e){this._animationConfig=e}setSkipBeforeLayouted(e){this._skipBeforeLayouted=e}getSkipBeforeLayouted(){return this._skipBeforeLayouted}getGroupKey(){return this._groupKey}setGroupKey(e){this._groupKey=e}setStateSortCallback(e){this._stateSort=e}constructor(e,t,n){super(e),this.grammarType=ZO.mark,this.type=void 0,this.name=\`mark\`,this._markConfig={zIndex:pk.Mark,morph:!1},this._visible=!0,this.stateStyle={},this._unCompileChannel={},this._skipBeforeLayouted=!1,this.name=t,this.model=n,this.key=e.key,this.state=new zk(Object.assign(Object.assign({},e),{stateKeyToSignalName:this.stateKeyToSignalName.bind(this)}),this),this._event=new LO(n.getOption().eventDispatcher,n.getOption().mode)}setTransform(e){this._transform=e}initMarkData(e){this._data=new Vk(e)}stateKeyToSignalName(e){return\`\${K}_\${this.type}_\${this.id}_\${e}\`}getAttribute(e,t,n,r){}_compileProduct(e){let t=this.getProduct();if(!this.getVisible())return void(p(t)&&this.removeProduct());p(t)||this.getCompiler().isInited&&(this._initProduct(e?.group),f(this._product)||(this.compileSignal(),this.compileData(),this.compileState(),this.compileEncode(),this.compileAnimation(),this.compileContext(e?.context),this.compileTransform()))}_initProduct(e){let t=this.getVGrammarView(),n=this.getProductId();this._product=t.mark(this.type,e??t.rootMark).id(n),this.name&&this._product&&this._product.name(this.name),this._compiledProductId=n}generateProductId(){return this._userId?\`\${this._userId}\`:\`\${this.name}_\${this.id}\`}compileData(){if(f(this._data))return;this._data.compile();let e=this._data.getProduct();p(this._product)&&p(e)&&this._product.join(e,this.key,void 0,this.getGroupKey())}updateStaticEncode(){if(!this._product)return;let{enterStyles:e,updateStyles:t}=this._separateStyle();this._product.encodeState(\`group\`,e,!0),this._product.encode(t,!0)}_separateStyle(){let e=this.stateStyle,n=QO.STATE_NORMAL,r=e[n];t(e,[typeof n==\`symbol\`?n:n+\`\`]);let i=this._option.noSeparateStyle?null:{},a={};return Object.keys(r).forEach((e=>{this._unCompileChannel[e]||(this._option.noSeparateStyle||function(e,t,n){let r=t[e]?.style;return!!function(e,t){return(e===\`fill\`||e===\`stroke\`)&&t?.gradient&&t?.stops}(e,r)||!!d(r)||!(!r?.scale||r.field===n)}(e,r,this.getGroupKey())?a[e]={callback:this.compileCommonAttributeCallback(e,\`normal\`),dependency:[this.stateKeyToSignalName(\`markUpdateRank\`)]}:i[e]=this.compileCommonAttributeCallback(e,\`normal\`))})),{enterStyles:i,updateStyles:a}}compileEncode(){let e=this.stateStyle,n=QO.STATE_NORMAL;e[n];let r=t(e,[typeof n==\`symbol\`?n:n+\`\`]),{enterStyles:i,updateStyles:a}=this._separateStyle();this._product.encode(a,!0),this._product.encodeState(\`group\`,i,!0),Object.keys(r).forEach((e=>{let t={};Object.keys(r[e]).forEach((n=>{this._unCompileChannel[n]||(t[n]={callback:this.compileCommonAttributeCallback(n,e),dependency:[this.stateKeyToSignalName(\`markUpdateRank\`)]})})),this._product.encodeState(e,t,!0)})),this._skipBeforeLayouted&&this._product.layout({skipBeforeLayouted:this._skipBeforeLayouted})}compileState(){this.state.compileState(this._product,this._stateSort)}compileAnimation(){var e;if(this._animationConfig){let t;t=this.type===\`component\`?this.model.animate?.getAnimationStateSignalName():((e=this.model).getRegion?.call(e)?.animate)?.getAnimationStateSignalName(),this._product.animation(this._animationConfig),this._product.animationState({callback:(e,n,r)=>r[t]?.callback(e,n),dependency:t}),this._animationConfig.normal&&(this._animationConfig.appear?this._event.on(X.ANIMATION_END,(({event:e})=>{e.mark===this.getProduct()&&e.animationState===XO.appear&&this.runAnimationByState(XO.normal)})):this._event.on(X.AFTER_DO_RENDER,(()=>{this.runAnimationByState(XO.normal)})))}}compileContext(e){let t=Object.assign(Object.assign({},this._markConfig),{context:Object.assign({markId:this.id,modelId:this.model.id,markUserId:this._userId,modelUserId:this.model.userId},e)});this._product.configure(t)}compileSignal(){this.state.compile()}_computeAttribute(e,t){return(e,t)=>{}}compileCommonAttributeCallback(e,t){let n=this._computeAttribute(e,t),r={mark:null,parent:null,element:null};return(e,t)=>(r.mark=t.mark,r.parent=t.mark.group,r.element=t,n(e,r))}compileTransform(){var e;(e=this._transform)!=null&&e.length&&this.getProduct().transform(this._transform)}_lookupGrammar(e){return this.getCompiler().getVGrammarView()?.getMarkById(e)}updateState(e,t){return this.state.updateState(e,t)}updateLayoutState(e,t){return t&&this.getMarks().length>0&&this.getMarks().forEach((e=>e.state.updateLayoutState(!0))),this.state.updateLayoutState(e)}updateMarkState(e){if(!this._product)return;let t=this.state.getStateInfo(e);this._product.elements.forEach((n=>{this.state.checkOneState(n,n.getDatum(),t)===\`in\`?n.addState(e):n.removeState(e)}))}getMarks(){return[]}runAnimationByState(e){return(this.getProduct()?.animate)?.runAnimationByState(e)}stopAnimationByState(e){return(this.getProduct()?.animate)?.stopAnimationByState(e)}pauseAnimationByState(e){return(this.getProduct()?.animate)?.pauseAnimationByState(e)}resumeAnimationByState(e){return(this.getProduct()?.animate)?.resumeAnimationByState(e)}getProductElements(){let e=this.getProduct();if(e)return e.elements}release(){super.release(),this.state.release()}}class Uk extends Hk{constructor(e,t){var n;super(t,e,t.model),this._extensionChannel={},this._computeExChannel={},this._attributeContext=t.attributeContext,(n=t.map)==null||n.set(this.id,this)}created(){this._initStyle()}initStyleWithSpec(e,t){e&&(p(e.id)&&(this._userId=e.id),u(e.interactive)&&(this._markConfig.interactive=e.interactive),p(e.zIndex)&&(this._markConfig.zIndex=e.zIndex),u(e.visible)&&this.setVisible(e.visible),this._initSpecStyle(e,this.stateStyle,t))}_transformStyleValue(e,t){if(e.scale){let n=e.scale,r=n.range();return n.range(r.map(t)),e}return typeof e==\`function\`?(...n)=>t(e(...n)):t(e)}convertAngleToRadian(e){return this._transformStyleValue(e,tt)}isUserLevel(e){return[$.User_Mark,$.User_Series,$.User_Chart,$.User_SeriesStyle].includes(e)}setStyle(e,t=\`normal\`,n=0,r=this.stateStyle){if(f(e))return;r[t]===void 0&&(r[t]={});let i=this.isUserLevel(n);Object.keys(e).forEach((a=>{let o=e[a];f(o)||(o=this._filterAttribute(a,o,t,n,i,r),this.setAttribute(a,o,t,n,r))}))}getStyle(e,t=\`normal\`){return this.stateStyle[t][e]?.style}_filterAttribute(e,t,n,r,i,a=this.stateStyle){let o=this._styleConvert(t);if(i)switch(e){case\`angle\`:o=this.convertAngleToRadian(o);break;case\`innerPadding\`:case\`outerPadding\`:o=this._transformStyleValue(o,(e=>-e));break;case\`curveType\`:o=this._transformStyleValue(o,(e=>{return t=e,n=this._option.model.direction,t===\`monotone\`?n===\`horizontal\`?\`monotoneY\`:\`monotoneX\`:t;var t,n}))}return o}setReferer(e,t,n,r=this.stateStyle){if(e)if(t&&n){let i=r[n]??{[t]:{}};r[n][t]=Object.assign(Object.assign({},i[t]),{referer:e})}else Object.entries(r).forEach((([t,n])=>{Object.entries(n).forEach((([n,i])=>{r[t][n].referer=e}))}))}setPostProcess(e,t,n=\`normal\`){var r;(r=this.stateStyle[n])!=null&&r[e]&&(this.stateStyle[n][e].postProcess=t)}getAttribute(e,t,n=\`normal\`,r){return this._computeAttribute(e,n)(t,r)}setAttribute(e,t,n=\`normal\`,r=0,i=this.stateStyle){i[n]===void 0&&(i[n]={}),i[n][e]===void 0&&(i[n][e]={level:r,style:t,referer:void 0});let a=i[n][e]?.level;p(a)&&a<=r&&q(i[n][e],{style:t,level:r}),n!==\`normal\`&&e in this._extensionChannel&&this._extensionChannel[e].forEach((e=>{i[n][e]===void 0&&(i[n][e]=i.normal[e])}))}_getDefaultStyle(){return{visible:!0,x:0,y:0}}_styleConvert(e){if(!e)return e;if(Fb(e.type)||e.scale){let t=function(e,t){if(\`scale\`in e&&e.scale)return v(e.scale)&&t?.globalScale?t.globalScale.registerMarkAttributeScale(e,t.seriesId):e.scale;let n=dC(e.type);return n&&function(e,t){e&&t&&(t.domain&&e.domain(t.domain),t.range&&e.range(t.range),t.specified&&e.specified&&e.specified(t.specified),t.clamp&&e.clamp&&e.clamp(t.clamp))}(n,e),n}(e,{globalScale:this._option.globalScale,seriesId:this._option.seriesId});if(t)return{scale:t,field:e.field,changeDomain:e.changeDomain}}return e}_computeAttribute(e,t){let n=this.stateStyle[t]?.[e];n||=this.stateStyle.normal[e];let r=this._computeStateAttribute(n,e,t),i=d(n?.postProcess),a=e in this._computeExChannel;if(i&&a){let i=this._computeExChannel[e];return(a,o)=>{let s=r(a,o);return s=n.postProcess(s,a,this._attributeContext,o,this.getDataView()),i(e,a,t,o,s)}}if(i)return(e,t)=>n.postProcess(r(e,t),e,this._attributeContext,t,this.getDataView());if(a){let n=this._computeExChannel[e];return(i,a)=>n(e,i,t,a,r(i,a))}return r}_computeStateAttribute(e,t,n){return e?e.referer?e.referer._computeAttribute(t,n):e.style?typeof e.style==\`function\`?(t,n)=>e.style(t,this._attributeContext,n,this.getDataView()):Fk.includes(e.style.gradient)?this._computeGradientAttr(e.style):[\`outerBorder\`,\`innerBorder\`].includes(t)?this._computeBorderAttr(e.style):Fb(e.style.scale?.type)?(t,n)=>{let r=t;return this.model.modelType===\`series\`&&this.model.getMarkData&&(r=this.model.getMarkData(t)),e.style.scale.scale(r[e.style.field])}:(t,n)=>e.style:(t,n)=>e.style:(e,t)=>{}}_initStyle(){let e=this._getDefaultStyle();this.setStyle(e,\`normal\`,0)}_initSpecStyle(e,t,n){e.style&&this.setStyle(e.style,\`normal\`,$.User_Mark,t);let r=e.state;r&&Object.keys(r).forEach((e=>{let n=r[e];if(\`style\`in n){let r=n.style,i={stateValue:e};\`level\`in n&&(i.level=n.level),\`filter\`in n&&(i=d(n.filter)?Object.assign({filter:n.filter},i):Object.assign(Object.assign({},n.filter),i)),this.state.addStateInfo(i),this.setStyle(r,e,$.User_Mark,t)}else this.setStyle(n,e,$.User_Mark,t)}))}_computeGradientAttr(e){var n;let{gradient:r,scale:i,field:a}=e,o=t(e,[\`gradient\`,\`scale\`,\`field\`]),s=i,c=a;if(!(i&&a||this.model.modelType!==\`series\`)){let{scale:e,field:t}=this.model.getColorAttribute();i||(s=e),c||=t}let l=nC(tC(this.model.getColorScheme(),this.model.modelType===\`series\`?(n=this.model).getSpec?.call(n):void 0),this.model.getDefaultColorDomain()),u=Object.assign(Object.assign({},Ik[r]),o);return(e,t)=>{let n={},i=this.getDataView();return Object.keys(u).forEach((r=>{let a=u[r];r===\`stops\`?n.stops=a.map((n=>{let{opacity:r,color:a,offset:o}=n,u=a??s?.scale(e[c]);return d(a)&&(u=a(e,this._attributeContext,t,i)),p(r)&&(u=It.SetOpacity(u,r)),{offset:d(o)?o(e,this._attributeContext,t,i):o,color:u||l[0]}})):d(a)?n[r]=a(e,this._attributeContext,t,i):n[r]=a})),n.gradient=r,n}}_computeBorderAttr(e){let{scale:n,field:r}=e,i=t(e,[\`scale\`,\`field\`]);return(e,t)=>{var a;let o={};if(Object.keys(i).forEach((n=>{let r=i[n];d(r)?o[n]=r(e,this._attributeContext,t,this.getDataView()):o[n]=r})),\`stroke\`in o)Fk.includes(i.stroke?.gradient)&&(o.stroke=this._computeGradientAttr(i.stroke)(e,t));else{let t=nC(tC(this.model.getColorScheme(),this.model.modelType===\`series\`?(a=this.model).getSpec?.call(a):void 0),this.model.getDefaultColorDomain()),i=n,s=r;if(!(n&&r||this.model.modelType!==\`series\`)){let{scale:r,field:a}=this.model.getColorAttribute();n||(i=r),s||=a,o.stroke=i?.scale(e[s])||t[0]}}return o}}}class Wk extends Uk{constructor(){super(...arguments),this.type=Wk.type,this._marks=[]}getMarks(){return this._marks}_getDefaultStyle(){return Object.assign({},super._getDefaultStyle())}isMarkExist(e){return this._marks.find((t=>t.id===e.id))!==void 0}addMark(e){return this.isMarkExist(e)?(Om(\`Mark already exists, add mark failed.\`),!1):(this._marks.push(e),!0)}removeMark(e){let t=this._marks.findIndex((t=>t.id===e.id||t.name===e.name));return t===-1?(Om(\`Mark does not exists, removeMark failed.\`),!1):(this._marks.splice(t,1),!0)}getMarkInType(e){return this._marks.filter((t=>t.type===e))}getMarkInId(e){return this._marks.find((t=>t.id===e))}getMarkInUserId(e){let t;if(this._marks.forEach((n=>{n.getUserId()===e&&(t=n)})),!t)for(let n=0;n<this._marks.length;n++){let r=this._marks[n];if(r.type===\`group\`&&(t=r.getMarkInUserId(e)),t)break}return t}getMarkInName(e){return this._marks.filter((t=>t.name===e))}_compileProduct(e){super._compileProduct(e),this._product.configure({zIndex:this._markConfig.zIndex}),e!=null&&e.ignoreChildren||this.getMarks().forEach((e=>{e.getProduct()&&e.removeProduct(),e.compile({group:this._product})}))}}Wk.type=\`group\`;let Gk=()=>{gy(),iy(),Z.registerGraphic(Y.group,$c),J.registerMark(Wk.type,Wk)},Kk={measureText:(e,t,n,r)=>((e,t,n)=>By(e,t,n,{fontFamily:sw.fontFamily,fontSize:sw.fontSize}))(t,n,r).measure(e)};class qk{static instance(){return qk.instance_||=new qk,qk.instance_}constructor(){this.functions={}}registerFunction(e,t){e&&t&&(this.functions[e]=t)}unregisterFunction(e){e&&delete this.functions[e]}getFunction(e){return this.functions[e]||null}getFunctionNameList(){return Object.keys(this.functions)}}class Jk{constructor(){this.id=Lm(),this._plugins=[]}add(e){if(!e||e.length===0)return null;let t=[];return e.forEach((e=>{this._plugins.find((t=>t.id===e.id))?Om(\`不要重复添加相同的plugin\`):(this._plugins.push(e),t.push(e),e.onAdd&&e.onAdd(this))})),t}load(e){let t=this.add(e);t&&t.length&&this.activate(e)}activate(e){e.length&&e.forEach((e=>{e.init&&e.init()}))}get(e){return this._plugins.find((t=>t.id===e))}getAll(){return this._plugins.slice()}release(e){let t=this.get(e);t&&(t.release(this),this._plugins=this._plugins.filter((e=>e!==t)))}releaseAll(){this._plugins.forEach((e=>{e.release(this)})),this._plugins=[]}clear(e){let t=this.get(e);t&&t.clear(this)}clearAll(){this._plugins.forEach((e=>{var t;(t=e.clear)==null||t.call(e,this)}))}}class Yk extends Jk{constructor(e){super(),this.globalInstance=e}onInit(e){this._plugins.forEach((t=>{t.onInit&&t.onInit(this,e)}))}onBeforeResize(e,t){this._plugins.forEach((n=>{n.onBeforeResize&&n.onBeforeResize(this,e,t)}))}onAfterChartSpecTransform(e,t){this._plugins.forEach((n=>{n.onAfterChartSpecTransform&&n.onAfterChartSpecTransform(this,e,t)}))}onAfterModelSpecTransform(e,t,n){this._plugins.forEach((r=>{r.onAfterModelSpecTransform&&r.onAfterModelSpecTransform(this,e,t,n)}))}onBeforeInitChart(e,t){this._plugins.forEach((n=>{n.onBeforeInitChart&&n.onBeforeInitChart(this,e,t)}))}releaseAll(){super.releaseAll(),this.globalInstance=null}}let Xk=new Map;class Zk{static useRegisters(e){e.forEach((e=>{typeof e==\`function\`?e():console.error(\`Invalid function:\`,e)}))}static useChart(e){e.forEach((e=>J.registerChart(e.type,e)))}static useSeries(e){e.forEach((e=>J.registerSeries(e.type,e)))}static useComponent(e){e.forEach((e=>J.registerComponent(e.type,e)))}static useMark(e){e.forEach((e=>J.registerMark(e.constructorType??e.type,e)))}static useLayout(e){e.forEach((e=>J.registerLayout(e.type,e)))}static registerDataSetTransform(e,t){J.registerTransform(e,t)}static registerFunction(e,t){e&&t&&qk.instance().registerFunction(e,t)}static unregisterFunction(e){e&&qk.instance().unregisterFunction(e)}static getFunction(e){return e?qk.instance().getFunction(e):null}static getFunctionList(){return qk.instance().getFunctionNameList()}static registerMap(e,t,n){let r=J.getImplementInKey(\`registerMap\`);r&&r(e,t,n)}static unregisterMap(e){let t=J.getImplementInKey(\`unregisterMap\`);t&&t(e)}static getMap(e){return t=e,UO.get(t);var t}static registerSVG(e,t,n){let r=J.getImplementInKey(\`registerSVG\`);r&&r(e,t,n)}static unregisterSVG(e){let t=J.getImplementInKey(\`unregisterSVG\`);t&&t(e)}static getSVG(e){return t=e,Xk.get(t);var t}static hideTooltip(e=[]){Tw.forEach((e=>(e?.hideTooltip)?.call(e)),e)}static getLogger(){return xe.getInstance()}getSpec(){return this._spec}getSpecInfo(){return this._specInfo}getDataSet(){return this._dataSet}constructor(n,r){var i,a,o,s;this.id=Lm(),this._userEvents=[],this._autoSize=!0,this._option={mode:e.RenderModeEnum[\`desktop-browser\`],onError:e=>{throw Error(e)},optimize:{disableCheckGraphicWidthOutRange:!0}},this._observer=null,this._context={},this._doResize=()=>{let{width:e,height:t}=this.getCurrentSize();this._currentSize.width===e&&this._currentSize.height===t||(this._currentSize={width:e,height:t},this.resizeSync(e,t))},this._renderSync=(e={})=>{var t;let n=this;return this._beforeRender(e)?((t=this._compiler)==null||t.render(e.morphConfig),this._afterRender(),n):n},this._updateSpec=(e,t=!1,n)=>{var r;let i=this._spec,a={changeBackground:!1,reTransformSpec:!1,change:!1,reMake:!1,reCompile:!1,reSize:!1,changeTheme:!1};if(!this._setNewSpec(e,t))return;if(ce(i.theme,this._spec.theme)?ce(this._spec.background,i.background)||(a.reMake=!0,a.changeBackground=!0):a.changeTheme=!0,a.reSize=this._shouldChartResize(i),this._spec.type!==i.type)return(r=this._compiler?.getVGrammarView())==null||r.updateLayoutTag(),a.reMake=!0,a.reTransformSpec=!0,a.change=!0,a.changeTheme=!0,a;this._initChartSpec(this._spec,\`updateSpec\`);let o=ak(this._chart.updateSpec(this._spec),a);return n?Object.assign(Object.assign({},o),n):o},this._option=Object.assign(Object.assign(Object.assign({},this._option),{animation:!1!==n.animation}),r),r!=null&&r.optimize&&(this._option.optimize=Object.assign(Object.assign({},this._option.optimize),r.optimize)),this._onError=this._option?.onError;let c=this._option,{dom:l,renderCanvas:u,mode:d,stage:f,poptip:p}=c,m=t(c,[\`dom\`,\`renderCanvas\`,\`mode\`,\`stage\`,\`poptip\`]),h=Nm(d);if(h?Jh(V):d===\`node\`&&j_(V),h&&l&&(this._container=v(l)?jp.getElementById(l):l),u&&(this._canvas=u),f&&(this._stage=f),d!==\`node\`&&!this._container&&!this._canvas&&!this._stage)return void((i=this._option)==null||i.onError(\`please specify container or renderCanvas!\`));this._viewBox=this._option.viewBox,this._currentThemeName=Ew.getCurrentThemeName(),this._setNewSpec(n),this._updateCurrentTheme(),this._currentSize=this.getCurrentSize();let g=[];!p!=0&&g.push(\`poptipForText\`),n.type===\`sankey\`&&g.push(\`scrollbar\`);let _=Object.assign({},m.performanceHook||{});Object.keys(_).forEach((e=>{m.performanceHook[e]=(...t)=>{_[e](...t,this)}})),this._compiler=new tk({dom:this._container??\`none\`,canvas:u},Object.assign(Object.assign({mode:this._option.mode,stage:f,pluginList:g},m),{background:this._getBackground(),onError:this._onError})),this._compiler.setSize(this._currentSize.width,this._currentSize.height),this._eventDispatcher=new BO(this,this._compiler),this._event=new LO(this._eventDispatcher,d),this._compiler.initView(),this._setFontFamilyTheme(this._currentTheme?.fontFamily),this._initDataSet(this._option.dataSet),this._autoSize=!!h&&((a=n.autoFit??this._option.autoFit)==null||a),this._bindResizeEvent(),this._bindVGrammarViewEvent(),this._initChartPlugin(),Tw.registerInstance(this),(s=(o=this._option.performanceHook)?.afterCreateVChart)==null||s.call(o,this)}_setNewSpec(e,t){return!!e&&(v(e)&&(e=JSON.parse(e)),t&&this._originalSpec&&(e=q({},this._originalSpec,e)),this._originalSpec=e,this._spec=this._getSpecFromOriginalSpec(),!0)}_getSpecFromOriginalSpec(){let e=Ow(this._originalSpec);return e.data=e.data??[],e}_initChartSpec(e,t){var n;Zk.getFunctionList()&&Zk.getFunctionList().length&&(e=kw(e,Zk)),this._spec=e,this._chartSpecTransformer||=J.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type)),(n=this._chartSpecTransformer)==null||n.transformSpec(this._spec),this._chartPluginApply(\`onAfterChartSpecTransform\`,this._spec,t),this._specInfo=this._chartSpecTransformer?.transformModelSpec(this._spec),this._chartPluginApply(\`onAfterModelSpecTransform\`,this._spec,this._specInfo,t)}_updateSpecInfo(){this._chartSpecTransformer||=J.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type)),this._specInfo=this._chartSpecTransformer?.createSpecInfo(this._spec)}_initChart(e){var t,n,r;if(!this._compiler)return void((t=this._option)==null||t.onError(\`compiler is not initialized\`));if(this._chart)return void((n=this._option)==null||n.onError(\`chart is already initialized\`));let i=J.createChart(e.type,e,this._getChartOption(e.type));i?(this._chart=i,this._chart.setCanvasRect(this._currentSize.width,this._currentSize.height),this._chart.created(this._chartSpecTransformer),this._chart.init(),this._event.emit(Q.initialized,{chart:i,vchart:this})):(r=this._option)==null||r.onError(\`init chart fail\`)}_releaseData(){this._dataSet&&=(this._dataSet.dataViewMap={},null)}_bindVGrammarViewEvent(){if(!this._compiler)return;let e=this._compiler.getVGrammarView();e.addEventListener(X.ALL_ANIMATION_END,(()=>{this._event.emit(Q.animationFinished,{chart:this._chart,vchart:this})})),e.addEventListener(X.AFTER_VRENDER_NEXT_RENDER,(()=>{this._event.emit(Q.renderFinished,{chart:this._chart,vchart:this})}))}_bindResizeEvent(){var e;if(this._autoSize){if(this._onResize=Me(this._doResize,this._option.resizeDelay??100),this._container){let t=window.ResizeObserver;t&&(this._observer=new t(this._onResize),(e=this._observer)==null||e.observe(this._container))}window.addEventListener(\`resize\`,this._onResize)}}_unBindResizeEvent(){this._autoSize&&(window.removeEventListener(\`resize\`,this._onResize),this._observer&&=(this._observer.disconnect(),null))}getCurrentSize(){return ik(this._spec,{container:this._container,canvas:this._canvas,mode:this._getMode(),modeParams:this._option.modeParams},{width:this._currentSize?.width??500,height:this._currentSize?.height??500})}_initDataSet(e){for(let t in this._dataSet=e instanceof bn?e:new bn,HO(this._dataSet,\`dataview\`,_n),HO(this._dataSet,\`array\`,r),VO(this._dataSet,\`copyDataView\`,GO),J.transforms)VO(this._dataSet,t,J.transforms[t]);for(let e in J.dataParser)HO(this._dataSet,e,J.dataParser[e])}updateCustomConfigAndRerender(e,t,n={}){if(!this._isReleased&&e)return d(e)&&(e=e()),e.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._reCompile(e),t?this._renderSync(n):this._renderAsync(n)}_updateCustomConfigAndRecompile(e,t={}){return!!e&&(this._reCompile(e),this._beforeRender(t))}_reCompile(e,t){var n,r,i,a,o;if(e.reMake&&(this._releaseData(),this._initDataSet(),(n=this._chart)==null||n.release(),this._chart=null),e.reTransformSpec&&(this._chartSpecTransformer=null),e.changeTheme?(this._setCurrentTheme(),this._setFontFamilyTheme(this._currentTheme?.fontFamily)):e.changeBackground&&((r=this._compiler)==null||r.setBackground(this._getBackground())),e.reMake)(i=this._compiler)==null||i.releaseGrammar(!1===this._option?.animation||!1===this._spec?.animation),this._userEvents.forEach((e=>this._event?.on(e.eType,e.query,e.handler))),e.reSize&&this._doResize();else if(e.reCompile&&((a=this._compiler)==null||a.clear({chart:this._chart,vChart:this},!1===this._option?.animation||!1===this._spec?.animation),(o=this._compiler)==null||o.compile({chart:this._chart,vChart:this},{})),e.reSize){let{width:e,height:t}=this.getCurrentSize();this._chart.onResize(e,t,!1),this._compiler.resize(e,t,!1)}}_beforeRender(e={}){var t,n,r,i,a,o,s,c;if(this._isReleased)return!1;if(this._chart)return!0;let{transformSpec:l,actionSource:u}=e;return l&&this._initChartSpec(this._spec,\`render\`),this._chartPluginApply(\`onBeforeInitChart\`,this._spec,u),(n=(t=this._option.performanceHook)?.beforeInitializeChart)==null||n.call(t,this),this._initChart(this._spec),(i=(r=this._option.performanceHook)?.afterInitializeChart)==null||i.call(r,this),!(!this._chart||!this._compiler)&&((o=(a=this._option.performanceHook)?.beforeCompileToVGrammar)==null||o.call(a),this._compiler.compile({chart:this._chart,vChart:this},{performanceHook:this._option.performanceHook}),(c=(s=this._option.performanceHook)?.afterCompileToVGrammar)==null||c.call(s),!0)}_afterRender(){return!this._isReleased&&(this._updateAnimateState(),this._event.emit(Q.rendered,{chart:this._chart,vchart:this}),!0)}renderSync(e){return this._renderSync({morphConfig:e,transformSpec:!0,actionSource:\`render\`})}renderAsync(e){return n(this,void 0,void 0,(function*(){return this._renderAsync({morphConfig:e,transformSpec:!0,actionSource:\`render\`})}))}_renderAsync(e={}){return n(this,void 0,void 0,(function*(){return this._renderSync(e)}))}_updateAnimateState(e){var t,n;if(this._option.animation){let r=e?XO.appear:XO.update;(t=this._chart)==null||t.getAllRegions().forEach((e=>{var t;(t=e.animate)==null||t.updateAnimateState(r,!0)})),(n=this._chart)==null||n.getAllComponents().forEach((e=>{var t;(t=e.animate)==null||t.updateAnimateState(r,!0)}))}}release(){var e,t,n,r;(e=this._onResize)!=null&&e.cancel&&this._onResize.cancel(),this._chartPluginApply(\`releaseAll\`),this._chartPlugin=null,this._chartSpecTransformer=null,(t=this._chart)==null||t.release(),(n=this._eventDispatcher)==null||n.release(),(r=this._compiler)==null||r.release(),this._unBindResizeEvent(),this._releaseData(),this._onError=null,this._onResize=null,this._container=null,this._currentTheme=null,this._option=null,this._chart=null,this._compiler=null,this._spec=null,this._specInfo=null,this._originalSpec=null,this._userEvents=null,this._event=null,this._eventDispatcher=null,this._isReleased=!0,Tw.unregisterInstance(this)}updateData(e,t,r,i){return n(this,void 0,void 0,(function*(){return this.updateDataSync(e,t,r,i)}))}_updateDataById(e,t,n){let r=this._spec.data.find((t=>t.name===e||t.id===e));r?r.id===e?r.values=t:r.name===e&&r.parse(t,n):y(t)?this._spec.data.push({id:e,values:t}):this._spec.data.push(t)}updateDataInBatches(e){return n(this,void 0,void 0,(function*(){return this._chart?(this._chart.updateFullData(e.map((({id:e,data:t,options:n})=>({id:e,values:t,parser:n})))),this._chart.updateGlobalScaleDomain(),this._compiler.render(),this):(this._spec.data=P(this._spec.data),e.forEach((({id:e,data:t,options:n})=>{this._updateDataById(e,t,n)})),this)}))}updateDataSync(e,t,n,r){return f(this._dataSet)?this:this._chart?(r!=null&&r.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateData(e,t,!0,n),this._compiler.render(),this):(this._spec.data=P(this._spec.data),this._updateDataById(e,t,n),this)}updateFullDataSync(e,t=!0,n){if(this._chart)return n!=null&&n.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateFullData(e),t&&this._compiler.render(),this;let r=P(this._spec.data);return P(e).forEach((e=>{let{id:t,values:n,parser:i,fields:a}=e,o=r.find((e=>e.name===t));if(o)o instanceof Sn?(o.setFields(M(a)),o.parse(n,M(i))):(o.values=n,p(i)&&(o.parser=i),p(a)&&(o.fields=a));else{let t=qO(e,this._dataSet,r);y(this._spec.data)&&this._spec.data.push(t)}})),this}updateFullData(e,t=!0){return n(this,void 0,void 0,(function*(){return this.updateFullDataSync(e,t)}))}updateSpec(e,t=!1,r,i){return n(this,void 0,void 0,(function*(){let n=this._updateSpec(e,t,i);return n&&(yield this.updateCustomConfigAndRerender(n,!1,{morphConfig:r,transformSpec:n.reTransformSpec,actionSource:\`updateSpec\`})),this}))}updateSpecSync(e,t=!1,n,r){let i=this._updateSpec(e,t,r);return i&&this.updateCustomConfigAndRerender(i,!0,{morphConfig:n,transformSpec:i.reTransformSpec,actionSource:\`updateSpec\`}),this}updateSpecAndRecompile(e,t=!1,n={}){let r=this._updateSpec(e,t);return this._updateCustomConfigAndRecompile(r,Object.assign({actionSource:\`updateSpecAndRecompile\`},n))}updateModelSpec(e,t,r=!1,i){return n(this,void 0,void 0,(function*(){return this.updateModelSpecSync(e,t,r,i)}))}updateModelSpecSync(e,t,n=!1,r){if(!t||!this._spec)return this;if(v(t)&&(t=JSON.parse(t)),d(e)||function(e,t,n,r){Object.keys(e).forEach((i=>{if(m(t))t.type===i&&(y(e[i])?e[i].length>=t.index&&(e[i][t.index]=r?q({},e[i][t.index],n):n):e[i]=r?q({},e[i],n):n);else if(y(e[i])){let a=e[i].findIndex((e=>e.id===t));a>=0&&(e[i][a]=r?q({},e[i][a],n):n)}else e.id===t&&(e[i]=r?q({},e[i],n):n)}))}(this._spec,e,t,n),this._chart){let i=this._chart.getModelInFilter(e);if(i)return this._updateModelSpec(i,t,!0,n,r)}return this}_updateModelSpec(e,t,n=!1,r=!1,i){r&&(t=q({},e.getSpec(),t));let a=e.updateSpec(t);return e.reInit(t),(a.change||a.reCompile||a.reMake||a.reSize||a.reRender)&&this._chart.reDataFlow(),this.updateCustomConfigAndRerender(a,n,{morphConfig:i,transformSpec:!1,actionSource:\`updateModelSpec\`})}resize(e,t){return n(this,void 0,void 0,(function*(){return this.resizeSync(e,t)}))}resizeSync(e,t){var n,r;return this._beforeResize(e,t)?((r=(n=this._compiler).resize)==null||r.call(n,e,t),this._afterResize()):this}_beforeResize(e,t){var n,r,i,a;if(!this._chart||!this._compiler)return!1;let o=this._chart.getCanvasRect();return(!o||o.width!==e||o.height!==t)&&(this._chartPluginApply(\`onBeforeResize\`,e,t),(r=(n=this._option.performanceHook)?.beforeResizeWithUpdate)==null||r.call(n),this._chart.onResize(e,t,!1),(a=(i=this._option.performanceHook)?.afterResizeWithUpdate)==null||a.call(i),!0)}_afterResize(){return this._isReleased||this._event.emit(Q.afterResize,{chart:this._chart}),this}updateViewBox(e,t=!0,n=!0){return this._chart&&this._compiler?(this._viewBox=e,this._chart.updateViewBox(e,n),n&&(this._compiler.render(),this._chart.onEvaluateEnd()),this._compiler.updateViewBox(e,t),this):this}on(e,t,n){var r;this._userEvents&&(this._userEvents.push({eType:e,query:typeof t==\`function\`?null:t,handler:typeof t==\`function\`?t:n}),(r=this._event)==null||r.on(e,t,n))}off(e,t){var n;if(this._userEvents&&this._userEvents.length!==0)if(t){let r=this._userEvents.findIndex((n=>n.eType===e&&n.handler===t));r>=0&&(this._userEvents.splice(r,1),(n=this._event)==null||n.off(e,t))}else this._userEvents.forEach((t=>{var n;t.eType===e&&((n=this._event)==null||n.off(e,t.handler))})),this._userEvents=this._userEvents.filter((t=>t.eType!==e))}updateState(e,t){this._chart&&this._chart.updateState(e,t)}setSelected(e,t,n){this._chart&&this._chart.setSelected(e,t,n)}setHovered(e,t,n){this._chart&&this._chart.setHovered(e,t,n)}clearState(e){this._chart&&this._chart.clearState(e)}clearAllStates(){this._chart&&this._chart.clearAllStates()}clearSelected(){this._chart&&this._chart.clearSelected()}clearHovered(){this._chart&&this._chart.clearHovered()}_updateCurrentTheme(e){var t;let n=this._option.theme,r=this._spec?.theme,i=this._spec?.type;e&&(this._currentThemeName=e);let a=(e,t)=>{var n;return(n=t.chart)!=null&&n[e]&&(t=dw({},t,t.chart[e])),t},o;if(A(n)&&A(r))o=Dw(this._currentThemeName,!0),this._currentTheme=a(i,o);else if(v(n)&&(!r||v(r))||v(r)&&(!n||v(n))){let e=dw({},Dw(this._currentThemeName,!0),Dw(n,!0),Dw(r,!0));this._currentTheme=a(i,e)}else{let e=dw({},Dw(this._currentThemeName),Dw(n),Dw(r));this._currentTheme=mw(a(i,e))}var s=j(this._currentTheme,\`component.poptip\`);N(Xy.poptip,Yy,s),(t=this._compiler)==null||t.setBackground(this._getBackground())}_shouldChartResize(e){var t;let n=!1;f(this._spec.width)?!f(e.width)&&(this._spec.width=e.width):this._spec.width!==e.width&&(n=!0),f(this._spec.height)?!f(e.height)&&(this._spec.height=e.height):this._spec.height!==e.height&&(n=!0);let r=this._autoSize;return this._autoSize=!!Nm(this._option.mode)&&((t=this._spec.autoFit??this._option.autoFit)==null||t),this._autoSize!==r&&(n=!0),n}_getBackground(){return(typeof this._spec.background==\`string\`||m(this._spec.background)&&this._spec.background.gradient?this._spec.background:null)||this._currentTheme.background||this._option.background}getCurrentTheme(){return Dw(this._currentThemeName)}getCurrentThemeName(){return this._currentThemeName}setCurrentTheme(e){return n(this,void 0,void 0,(function*(){return this.setCurrentThemeSync(e)}))}setCurrentThemeSync(e){if(!Ew.themeExist(e))return this;let t=this._setCurrentTheme(e);return this._setFontFamilyTheme(this._currentTheme?.fontFamily),this.updateCustomConfigAndRerender(t,!0,{transformSpec:!1,actionSource:\`setCurrentTheme\`}),this}_setCurrentTheme(e){var t;return this._updateCurrentTheme(e),this._initChartSpec(this._getSpecFromOriginalSpec(),\`setCurrentTheme\`),(t=this._chart)==null||t.setCurrentTheme(),{change:!0,reMake:!1}}_setFontFamilyTheme(e){var t;e&&((t=this.getStage())==null||t.setTheme({text:{fontFamily:e},richtext:{fontFamily:e}}))}_getTooltipComponent(){return this._chart?.getComponentsByType(a.tooltip)[0]}setTooltipHandler(e){var t,n;this._context.tooltipHandler=e;let r=this._getTooltipComponent();r&&((n=(t=r.tooltipHandler)?.release)==null||n.call(t),r.tooltipHandler=e)}getTooltipHandlerByUser(){return this._context?.tooltipHandler}getTooltipHandler(){let e=this._getTooltipComponent();return e?e.tooltipHandler:this._context.tooltipHandler}showTooltip(e,t){var n;let r=this._getTooltipComponent();return(n=p(e)&&r?.showTooltip(e,t)!==\`none\`)!=null&&n}hideTooltip(){var e;return(e=this._getTooltipComponent()?.hideTooltip())!=null&&e}getLegendDataById(e){let t=this._chart?.getComponentByUserId(e);return t?t.getLegendData():[]}getLegendDataByIndex(e=0){let t=this._chart?.getComponentsByType(a.discreteLegend);return t&&t[e]?t[e].getLegendData():[]}getLegendSelectedDataById(e){let t=this._chart?.getComponentByUserId(e);return t?t.getSelectedData():[]}getLegendSelectedDataByIndex(e=0){let t=this._chart?.getComponentsByType(a.discreteLegend);return t&&t[e]?t[e].getSelectedData():[]}setLegendSelectedDataById(e,t){let n=this._chart?.getComponentByUserId(e);n&&n.setSelectedData(t)}setLegendSelectedDataByIndex(e=0,t){let n=this._chart?.getComponentsByType(a.discreteLegend);n&&n[e]&&n[e].setSelectedData(t)}getDataURL(){var e;return n(this,void 0,void 0,(function*(){let t=this.getStage();if(this._chart&&t){t.render();let e=this._chart.getCanvas();return yield nk(e,{onError:this._onError})}return(e=this._option)==null||e.onError(ReferenceError(\`render is not defined\`)),null}))}exportImg(e){var t,r;return n(this,void 0,void 0,(function*(){if(!Nm(this._option.mode))return void((t=this._option)==null||t.onError(TypeError(\`non-browser environment can not export img\`)));let n=yield this.getDataURL();n?function(e=\`vchart\`,t){let n=document.createElement(\`a\`);n.setAttribute(\`href\`,t),n.setAttribute(\`target\`,\`_blank\`),n.setAttribute(\`download\`,\`\${e}.png\`),n.dispatchEvent(new MouseEvent(\`click\`))}(e,n):(r=this._option)==null||r.onError(ReferenceError(\`render is not defined\`))}))}exportCanvas(){var e;let t=this.getStage();if(this._chart&&t)return t.toCanvas();(e=this._option)==null||e.onError(ReferenceError(\`render is not defined\`))}getImageBuffer(){var e,t;if(this._option.mode!==\`node\`)return void((e=this._option)==null||e.onError(TypeError(\`getImageBuffer() now only support node environment.\`)));let n=this.getStage();return n?(n.render(),n.window.getImageBuffer()):((t=this._option)==null||t.onError(ReferenceError(\`render is not defined\`)),null)}setLayout(e){var t;this._option.layout=e,(t=this._chart)==null||t.setLayout(e)}reLayout(){var e;(e=this._chart)==null||e.setLayoutTag(!0)}getCompiler(){return this._compiler}getChart(){return this._chart}getStage(){return this._compiler.getStage()}getCanvas(){return this._compiler?.getCanvas()}getContainer(){if(p(this._container))return this._container;let e;return e=v(this._canvas)?jp.getElementById(this._canvas):this._canvas,p(e)?e.parentElement:this.getCanvas()?.parentElement}getComponents(){return this._chart.getAllComponents()}getScale(e){return(this._chart?.getGlobalScale())?.getScale(e)}setDimensionIndex(e,t={}){return this._chart?.setDimensionIndex(e,t)}stopAnimation(){var e;(e=this._compiler?.getVGrammarView()?.animate)==null||e.stop()}pauseAnimation(){var e;(e=this._compiler?.getVGrammarView()?.animate)==null||e.pause()}resumeAnimation(){var e;(e=this._compiler?.getVGrammarView()?.animate)==null||e.resume()}convertDatumToPosition(e,t={},n=!1,r){if(!this._chart||A(e))return null;let{seriesId:i,seriesIndex:a=0}=t,o;if(p(i)?o=this._chart.getSeriesInUserId(i):p(a)&&(o=this._chart.getSeriesInIndex([a])?.[0]),o){let t=Object.keys(e),i=o.getViewData().latestData.find((n=>t.every((t=>n[t]==e[t])))),a=o.getRegion().getLayoutStartPoint(),s;return s=i?o.dataToPosition(i,r):o.dataToPosition(e,r),s?yC(s,a,n):null}return null}convertValueToPosition(e,t,n=!1){if(!this._chart||f(e)||A(t))return null;if(!y(e)){let{axisId:r,axisIndex:i}=t,a;if(p(r)?a=this._chart.getComponentsByKey(\`axes\`).find((e=>e.userId===r)):p(i)&&(a=this._chart.getComponentsByKey(\`axes\`)?.[i]),!a)return Om("Please check whether the \`axisId\` or \`axisIndex\` is set!"),null;let o=a?.valueToPosition(e);if(n){let e=a.getLayoutStartPoint(),t=a.getOrient();return o+(t===\`bottom\`||t===\`top\`?e.x:e.y)}return o}let{seriesId:r,seriesIndex:i}=t,a;return p(r)?a=this._chart.getSeriesInUserId(r):p(i)&&(a=this._chart.getSeriesInIndex([i])?.[0]),a?yC(a.valueToPosition(e[0],e[1]),a.getRegion().getLayoutStartPoint(),n):(Om("Please check whether the \`seriesId\` or \`seriesIndex\` is set!"),null)}getFunction(e){return qk.instance().getFunction(e)}registerFunction(e,t){e&&t&&qk.instance().registerFunction(e,t)}unregisterFunction(e){e&&qk.instance().unregisterFunction(e)}getFunctionList(){return qk.instance().getFunctionNameList()}setRuntimeSpec(e){this._spec=e,this._updateSpecInfo()}updateIndicatorDataById(e,t){let n=this._chart?.getComponentByUserId(e);n&&n.updateDatum(t)}updateIndicatorDataByIndex(e=0,t){let n=this._chart?.getComponentsByType(a.indicator);n&&n[e]&&n[e].updateDatum(t)}geoZoomByIndex(e=0,t,n){this._geoZoomByQuery({regionIndex:e},t,n)}geoZoomById(e,t,n){this._geoZoomByQuery({regionId:e},t,n)}_geoZoomByQuery(e,t,n){let r=this._chart?.getRegionsInQuerier(e)[0],i=(this._chart?.getComponentsByType(a.geoCoordinate))?.find((e=>e.getRegions()?.includes(r)));i&&i.dispatchZoom(t,n)}_initChartPlugin(){let e=J.getChartPlugins();e.length>0&&(this._chartPlugin=new Yk(this),this._chartPlugin.load(e.map((e=>new e))),this._chartPluginApply(\`onInit\`,this._spec))}_chartPluginApply(e,...t){this._chartPlugin&&this._chartPlugin[e]&&this._chartPlugin[e].apply(this._chartPlugin,t)}_getMode(){return this._option.mode||e.RenderModeEnum[\`desktop-browser\`]}_getChartOption(e){return{type:e,globalInstance:this,eventDispatcher:this._eventDispatcher,dataSet:this._dataSet,container:this._container,canvas:this._canvas,map:new Map,mode:this._getMode(),modeParams:this._option.modeParams,getCompiler:()=>this._compiler,performanceHook:this._option.performanceHook,viewBox:this._viewBox,animation:this._option.animation,getTheme:()=>this._currentTheme??{},getSpecInfo:()=>this._specInfo??{},layout:this._option.layout,onError:this._onError,disableTriggerEvent:!0===this._option.disableTriggerEvent}}}Zk.InstanceManager=Tw,Zk.ThemeManager=Ew,Zk.globalConfig={uniqueTooltip:!0},Zk.Utils=Kk,Zk.vglobal=jp,J.registerRegion(\`region\`,Ek),J.registerLayout(\`base\`,Pk),Gk(),nD.useRegisters([uO]),sE(),oE(),bw(lw.name,lw),xe.getInstance(be.Error);let Qk=(e,t)=>{let n=t.beforeCall();return e&&e.forEach(((e,r)=>t.call(e,r,n))),n.keyMap&&=(n.keyMap.clear(),null),e};function $k(e,t){return j(t,\`component.\${e}\`)}function eA(e,t,n,r){if(e)return{formatFunc:e,args:[n,r]};let i=J.getFormatter();return t&&i?{formatFunc:i,args:[n,r,t]}:{}}let tA=(e,t,n,r)=>{if(f(e[t]))return;let i=y(e[t]),a=i?e[t]:[e[t]],o=[];return a.forEach(((e,a)=>{!e||r&&!r(e)||o.push({spec:e,specPath:i?[t,a]:[t],specInfoPath:[\`component\`,t,a],type:n})})),o},nA=(e,t,n,r)=>{let i;if(i=d(e)?e(t,n):g(e)&&p(e.field)?j(t,e.field):e,r){let{formatFunc:n,args:a}=eA(void 0,r,e,t);n&&a&&(i=n(...a))}return i},rA=(e,t,n)=>f(e)?e:d(e)?e(t,n):e,iA=(e,t)=>!t||!1!==t.visible&&(!t[e]||!1!==t[e].visible)&&!(t.activeType&&!(y(t.activeType)?t.activeType.includes(e):t.activeType===e));function aA(e,n,r,i,a,o){let s=n=>{if(n){let s={datum:a},c=f(n.key)&&f(n.value)&&!A(n)?Object.assign(Object.assign(Object.assign({},i),r),n):Object.assign(Object.assign({},i),n),{key:l,keyFormatter:u,keyTimeFormat:d,keyTimeFormatMode:m,value:h,valueFormatter:g,valueTimeFormat:_,valueTimeFormatMode:v}=c,y=t(c,[\`key\`,\`keyFormatter\`,\`keyTimeFormat\`,\`keyTimeFormatMode\`,\`value\`,\`valueFormatter\`,\`valueTimeFormat\`,\`valueTimeFormatMode\`]);s.key=sA(nA(l,a,o,u),d,m),s.value=sA(nA(h,a,o,g),_,v),Object.keys(y).forEach((e=>{s[e]=nA(c[e],a,o)})),!1!==s.visible&&(p(s.key)||p(s.value))&&e.push(s)}};y(n)?n.forEach((e=>{s(e)})):s(n)}function oA(e,t,n,r,i,a,o){d(t)?aA(e,t(i,o),n,r,a,o):t&&aA(e,t,n,r,a,o)}let sA=(e,t,n)=>{if(!t&&!n)return typeof e==\`object\`?e:e?.toString();let r=Ht.getInstance();return t||=\`%Y%m%d\`,((n||=\`local\`)===\`local\`?r.timeFormat:r.timeUTCFormat)(t,e)};class cA{constructor(e){this.activeTriggerSet={mark:new Set,group:new Set},this.ignoreTriggerSet={mark:new Set},this._getSeriesCacheInfo=()=>{let{series:e}=this,t=e.getSeriesField();return{seriesFields:p(t)?P(t):e.getSeriesKeys()??[],dimensionFields:e.getDimensionField()??[],measureFields:e.getMeasureField()??[],type:e.type}},this._getDimensionData=e=>{let{dimensionFields:t}=this._seriesCacheInfo;return t[0]&&e?.[t[0]]},this._getMeasureData=e=>{let{measureFields:t}=this._seriesCacheInfo;return t[0]&&e?.[t[0]]},this._getSeriesFieldData=e=>{let{dimensionFields:t,seriesFields:n}=this._seriesCacheInfo;if(p(n[0])&&e?.[n[0]])return e?.[n[0]];let r=t[t.length-1];return t.length>1&&(n.length===0||this.series.getSeriesKeys().length),e?.[r]},this._getSeriesStyle=(e,t,n)=>{for(let n of P(t)){let t=this.series.getSeriesStyle(e)?.(n);if(p(t))return t}return n},this.markTooltipKeyCallback=(e,t)=>this._getSeriesFieldData(e),this.markTooltipValueCallback=(e,t)=>this._getMeasureData(e),this.shapeTypeCallback=(e,t)=>this._getSeriesStyle(e,\`shape\`,null)??this._getSeriesStyle(e,\`symbolType\`,this.series.getDefaultShapeType()),this.shapeColorCallback=(e,t)=>this._getSeriesStyle(e,[\`fill\`,\`stroke\`]),this.shapeStrokeCallback=(e,t)=>this._getSeriesStyle(e,[\`stroke\`,\`fill\`]),this.dimensionTooltipTitleCallback=(e,t)=>this._getDimensionData(e),this.groupTooltipTitleCallback=(e,t)=>this._getSeriesFieldData(e),this.groupTooltipKeyCallback=(e,t)=>{let{seriesFields:n}=this._seriesCacheInfo,r=this._seriesCacheInfo.dimensionFields;return n[0]&&(r=r.filter((e=>e!==n[0]))),r.map((t=>e?.[t])).join(\`-\`)},this.getHasShape=e=>!!e,this.series=e,this.updateTooltipSpec()}updateTooltipSpec(){this.spec=this.series.getSpec()?.tooltip,this._seriesCacheInfo=this._getSeriesCacheInfo()}getShapeAttrs(e,t,n){var r;let i=t?\`content\`:\`title\`,a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n?.style?.shape),n?.[e]),n?.[e]?.[i]),this.spec?.[e]),this.spec?.[e]?.[i]);return{shapeType:a.shapeType??this.shapeTypeCallback,shapeFill:a.shapeFill??a.shapeColor??this.shapeColorCallback,shapeStroke:a.shapeStroke??this.shapeStrokeCallback,shapeHollow:(r=a.shapeHollow)!=null&&r,shapeLineWidth:a.shapeLineWidth,shapeSize:a.shapeSize??a.size,hasShape:a.hasShape??this.getHasShape(t)}}enableByType(e){return!0}getDefaultContentList(e){return[this.getDefaultContentPattern(e)]}getContentList(e,t,n,r,i,a){return function(e,t,n,r,i,a){if(i&&i.length){let o=[];return i.forEach((i=>{y(e)?e.forEach((e=>{oA(o,e,t,n,r,i,a)})):d(e)?oA(o,e,t,n,r,i,a):e&&aA(o,e,t,n,i,a)})),o}return null}(t?.content??this.getDefaultContentList(e),this.getDefaultContentPattern(e),n,r,i,a)}getTitleResult(e,t,n,r,i){let a=d(t)?t(r,i):t;if(a?f(a.value)&&(a=Object.assign(Object.assign({},this.getDefaultTitlePattern(e)),a)):a=this.getDefaultTitlePattern(e),a&&!1!==a.visible){let e=function(e){let t=e[0]?.series?[{data:e,value:\`\`}]:e;for(let{data:e}of t)for(let{datum:t}of e)for(let e of t??[])if(e)return e}(r),t={visible:nA(a.visible,e,i),value:sA(nA(a.value,e,i,a.valueFormatter),a.valueTimeFormat,a.valueTimeFormatMode),valueStyle:nA(a.valueStyle,e,i),hasShape:a.hasShape};return Object.keys(n).forEach((r=>{t[r]=nA(n[r],e,i)})),t}return{hasShape:!1,visible:!1}}getTooltipData(e,t,n,r,i){if(!(this.enableByType(e)&&iA(e,this.spec)&&(e!==\`dimension\`||r&&r.length)))return null;let a=this.spec?.[e]??t?.[e],o=this.getShapeAttrs(e,!0,t),s=this.getShapeAttrs(e,!1,t),c;return e===\`dimension\`?(c=[],this.getContentList(e,a,o,n,r,i).forEach((e=>{c.push(e)}))):c=this.getContentList(e,a,o,n,r,i),{visible:!0,activeType:e,data:n,title:this.getTitleResult(e,a?.title,s,n,i),content:c}}getDefaultTitlePattern(e){return{key:void 0,value:e===\`group\`?this.groupTooltipTitleCallback:this.dimensionTooltipTitleCallback}}getDefaultContentPattern(e){return{seriesId:this.series.id,key:e===\`group\`?this.groupTooltipKeyCallback:this.markTooltipKeyCallback,value:this.markTooltipValueCallback}}}let lA={min:e=>e.length?pe(e.map((e=>1*e))):0,max:e=>e.length?fe(e.map((e=>1*e))):0,"array-min":e=>e.length?pe(e.map((e=>1*e))):0,"array-max":e=>e.length?fe(e.map((e=>1*e))):0,values:e=>{let t={},n=[];for(let r of e)t[r]||(n.push(r),t[r]=1);return n}},uA=(e,t)=>{var n;let r=t.fields;if(d(r)&&(r=r()),!r?.length||!e?.length)return{};r=Qw([],r);let i=t.target===\`parser\`?\`parserData\`:\`latestData\`,a=e[0][i]?e[0][i]:e||[],o=(n=e[0]).getFields?.call(n);return dA(a,r,o)},dA=(e,t,n)=>{let r={},i=[],a=[];return t.forEach((t=>{let o=t.key;r[o]={};let s=n?.[o],c=t.operations,l=c.some((e=>e===\`min\`||e===\`max\`||e===\`allValid\`)),u=!0;i.length=0,e&&e.forEach((e=>{e&&i.push(e[o])}));let d=i.length;if(l){a.length=0,i.forEach(((e,t)=>{Rm(e)&&a.push(e)}));let e=i;i=a,a=e,u=i.length===d}else i=c.some((e=>e===\`array-min\`||e===\`array-max\`))?i.reduce(((e,t)=>(t&&t.forEach((t=>{Rm(t)&&e.push(t)})),e)),[]):i.filter((e=>e!==void 0));t.filter&&(i=i.filter(t.filter)),c.forEach((e=>{if(t.customize)r[o][e]=t.customize;else{if(s&&!0===s.lockStatisticsByDomain&&!f(s.domain)){if(e===\`values\`)return void(r[o][e]=s.domain.slice())}else if(e===\`allValid\`)return;r[o][e]=lA[e](i),e===\`array-max\`&&(r[o].max=r[o][e]),e===\`array-min\`&&(r[o].min=r[o][e])}})),l&&(r[o].allValid=u)})),r},fA=(e,t)=>{let{config:n}=t;if(!n)return e;let{invalidType:r,checkField:i}=n();return r!==\`zero\`||i&&i.length&&e.forEach((e=>{i.forEach((t=>{Rm(e[t])||(e[t]=0)}))})),e};class pA extends Bk{_compileProduct(){let e=this._data?.latestData;f(e)||p(this.getProduct())||this._initProduct([])}generateProductId(){return this._data?.name}}function mA(){return{keyMap:new Map,needDefaultSeriesField:!this._seriesField,defaultSeriesField:this._seriesField?null:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey)}}function hA(e,t,n){e&&(n.needDefaultSeriesField&&(e[Nw]=n.defaultSeriesField),e[jw]=t,e[Mw]=n.getKey(e,t,n))}let gA={label:{name:\`label\`,type:\`text\`}},_A=\`\${K}_rect_x\`,vA=\`\${K}_rect_x1\`,yA=\`\${K}_rect_y\`,bA=\`\${K}_rect_y1\`,xA={data:!0},SA={invalidType:!0,animation:!0,animationAppear:!0,animationEnter:!0,animationUpdate:!0,animationExit:!0,animationNormal:!0},CA={type:\`fadeIn\`};function wA(e,t){switch(t){case\`grow\`:return(e=>({type:e.direction===\`horizontal\`?\`growPointsXIn\`:\`growPointsYIn\`,options:{orient:e.direction===\`horizontal\`?\`positive\`:\`negative\`}}))(e);case\`fadeIn\`:return CA;default:return(e=>({type:\`clipIn\`,options:{clipDimension:e.direction===\`horizontal\`?\`y\`:\`x\`}}))(e)}}let TA={appear:{duration:1e3,easing:\`cubicOut\`},update:{type:\`update\`,duration:300,easing:\`linear\`},enter:{duration:300,easing:\`linear\`},exit:{duration:300,easing:\`linear\`},disappear:{duration:500,easing:\`cubicIn\`},state:{duration:300,easing:\`linear\`}},EA={appear:{type:\`scaleIn\`},enter:{type:\`scaleIn\`},exit:{type:\`scaleOut\`},disappear:{type:\`scaleOut\`}},DA=()=>{J.registerAnimation(\`scaleInOut\`,(()=>EA))},OA=(e,t)=>({appear:wA(e,t),enter:{type:\`fadeIn\`},exit:{type:\`fadeOut\`},update:[{type:\`update\`,options:{excludeChannels:[\`points\`,\`defined\`,\`segments\`]}},{channel:[\`points\`,\`segments\`],custom:zo,duration:TA.update.duration,easing:TA.update.easing,customParameters:{clipRangeByDimension:e.direction===\`horizontal\`?\`y\`:\`x\`}}],disappear:{type:\`clipOut\`}}),kA=()=>{J.registerAnimation(\`line\`,OA)},AA=()=>{nD.useRegisters([eO,tO,nO,rO,iO,aO,KD,qD])},jA=[...Object.keys(TA),\`normal\`];function MA(e={},t,n){let r={};for(let i=0;i<jA.length;i++){let a=jA[i],o=t?t[a]:void 0;if(!1===o)continue;if(a===\`normal\`){o&&(r.normal=o);continue}if(a===\`state\`){!1!==o&&(r.state=o??TA.state);continue}if(a!==\`update\`&&!o&&!e[a])continue;let s,c;s=y(e[a])?e[a]:[Object.assign(Object.assign({},TA[a]),e[a])],a===\`exit\`&&s.forEach((e=>{e.controlOptions={stopWhenStateChange:!0}})),o?(c=y(o)?o.map(((e,t)=>{let r=e;return LA(r)&&delete r.type,r.oneByOne&&(r=PA(r,n?.dataIndex??FA,n?.dataCount)),r})):s.map(((e,t)=>{let r=q({},s[t],o);return LA(r)&&delete r.type,r.oneByOne&&(r=PA(r,n?.dataIndex??FA,n?.dataCount)),r})),r[a]=c):r[a]=s}return r}function NA(e,t,n){let r={};return p(t.animationAppear)&&(r.appear=t.animationAppear[e]??t.animationAppear),p(t.animationDisappear)&&(r.disappear=t.animationDisappear[e]??t.animationDisappear),p(t.animationEnter)&&(r.enter=t.animationEnter[e]??t.animationEnter),p(t.animationExit)&&(r.exit=t.animationExit[e]??t.animationExit),p(t.animationUpdate)&&(r.update=t.animationUpdate[e]??t.animationUpdate),p(t.animationState)&&(r.state=t.animationState[e]??t.animationState),t.animationNormal&&t.animationNormal[e]&&(r.normal=t.animationNormal[e]),function(e,t){if(!e)return e;let n=[\`custom\`,\`customParameters\`];return e=M(e,null,n),RA(e,(e=>d(e)&&e.prototype?.constructor!==e?(...n)=>e(...n,t):e),n),e}(r,n)}function PA(e,t,n){let{oneByOne:r,duration:i,delay:a,delayAfter:o}=e;return e.delay=(e,n,o)=>{let s=t(e,o),c=d(i)?i(e,n,o):C(i)?i:0,l=d(a)?a(e,n,o):C(a)?a:0,u=d(r)?r(e,n,o):r;return!1===u?l:(u=!0===u?0:u,l+s*(c+u))},e.delayAfter=(e,a,s)=>{let c=t(e,s),l=d(i)?i(e,a,s):C(i)?i:0,u=d(o)?o(e,a,s):C(o)?o:0,f=d(r)?r(e,a,s):r;return!1===f?u:(f=!0===f?0:f,u+((n?n():a.mark.elements.length)-c)*(l+f))},delete e.oneByOne,e}function FA(e,t){return e?.[jw]??t?.VGRAMMAR_ANIMATION_PARAMETERS?.elementIndex}function IA(e,t){if(!1===e.animation||!1===e.morph?.enable)return!1;let n=!1!==(e.animationAppear?.[t]??e.animationAppear),r=!1!==(e.animationUpdate?.[t]??e.animationUpdate);return!(!n||!r)}function LA(e){return!function(e){return p(e.timeSlices)}(e)&&p(e.channel)}function RA(e,t,n=[]){if(y(e))e.forEach(((r,i)=>{e[i]=t(e[i],i),RA(e[i],t,n)}));else if(m(e))for(let r in e)n.includes(r)||(e[r]=t(e[r],r),RA(e[r],t,n))}function zA(e){var t;let n=e.getSpec();if(!1===n.animation||!p(e.getRegion().animate))return!1;let r=n.animationThreshold??2**53-1;return(t=e.getMarks())==null||t.forEach((e=>{let t=e.getMarkConfig();t&&(t.large&&t.largeThreshold&&(r=Math.min(r,t.largeThreshold)),t.progressiveThreshold&&(r=Math.min(r,t.progressiveThreshold)))})),!(e.getRawData()?.latestData?.length>=r)}class BA extends xk{constructor(){super(...arguments),this.markLabelSpec={}}getLabelSpec(e){return this.markLabelSpec[e]}setLabelSpec(e,t){this.markLabelSpec[e]=P(t)}addLabelSpec(e,t,n=!1){this.markLabelSpec[e]||(this.markLabelSpec[e]=[]),n?this.markLabelSpec[e].unshift(t):this.markLabelSpec[e].push(t)}getTheme(e,t){let n=QS(e),r=this._option?.getTheme(),{markByName:i,mark:a}=r,o=this._option.type,s=J.getSeriesMarkMap(o)?function(e,t,n,r){let i=J.getSeriesMarkMap(t);if(!i)return e;let a={};return Object.values(i).forEach((({type:t,name:i})=>{a[i]=q({},n?.[P(t)[0]],r?.[i],e?.[i])})),Object.assign(Object.assign({},e),a)}(j(r,\`series.\${o}\`),o,a,i):{},c=j(r,\`series.\${o}_\${n}\`);return q({},s,c,this.stack??c?.stack??s?.stack?j(r,\`series.\${o}_stack\`):void 0)}transformSpec(e,t,n){this._transformStack(e);let r=super.transformSpec(e,t,n);return this._transformLabelSpec(r.spec),Object.assign(Object.assign({},r),{markLabelSpec:this.markLabelSpec,stack:this.stack})}_transformLabelSpec(e){}_transformStack(e){u(e.stack)&&(this.stack=e.stack),u(e.percent)&&(this.stack=e.percent||this.stack),f(this.stack)&&this._supportStack&&e.seriesField&&(this.stack=!0)}_addMarkLabelSpec(e,t,n=\`label\`,r=\`initLabelMarkStyle\`,i=!0,a){e&&P(e[n]).forEach((n=>{if(n&&n.visible){let{animation:o=!0,animationUpdate:s=!0,animationEnter:c=!0,animationExit:l=!0}=n,{animationUpdate:u=!0,animationEnter:f=!0,animationExit:p=!0}=e,m=!!(this._option?.animation??e.animation??n.animation)&&!!i;this.addLabelSpec(d(t)?t(n):t,Object.assign(Object.assign({},n),{animation:!!m&&o,animationUpdate:!!(m&&u&&s)&&u,animationEnter:!!(m&&f&&c)&&f,animationExit:!!(m&&f&&l)&&p,getStyleHandler:e=>e[r]?.bind(e)}),a)}}))}_getDefaultSpecFromChart(e){let t=super._getDefaultSpecFromChart(e)??{},{outerRadius:n,innerRadius:r,direction:i}=e;return p(n)&&(t.outerRadius=n),p(r)&&(t.innerRadius=r),p(i)&&(t.direction=i),Object.keys(t).length>0?t:void 0}_mergeThemeToSpec(e,t){let n=this._theme;if(this._shouldMergeThemeToSpec()){let r=this._getDefaultSpecFromChart(t),i=e=>{let t=q({},n,r,e),i=n.label;return i&&m(i)&&y(t.label)&&(t.label=t.label.map((e=>q({},i,e)))),t};return y(e)?{spec:e.map((e=>i(e))),theme:n}:{spec:i(e),theme:n}}return{spec:e,theme:n}}}class VA extends Sk{getRegion(){return this._region}getLayoutStartPoint(){return this._region.getLayoutStartPoint()}getRootMark(){return this._rootMark}getSeriesMark(){return this._seriesMark}getRawData(){return this._rawData}getViewDataFilter(){return this._viewDataFilter}getViewData(){return this._data?.getDataView()}getViewDataProductId(){return this._data?.getProductId()}getViewDataStatistics(){return this._viewDataStatistics}getViewStackData(){return this._viewStackData}getSeriesField(){return this._seriesField}setSeriesField(e){p(e)&&(this._seriesField=e)}getGroups(){return this._groups}getStack(){return this.getSpecInfo()?.stack}getStackValue(){return this._spec.stackValue??\`\${K}_series_\${this.type}\`}getPercent(){return this._spec.percent}getStackOffsetSilhouette(){return this._spec.stackOffsetSilhouette}get tooltipHelper(){return this._tooltipHelper||this.initTooltip(),this._tooltipHelper}getInvalidType(){return this._invalidType}setInvalidType(e){var t;this._invalidType=e,(t=this.getViewData())==null||t.reRunAllTransform()}getMarkAttributeContext(){return this._markAttributeContext}constructor(e,t){var n;super(e,t),this.specKey=\`series\`,this.type=\`series\`,this.layoutType=\`absolute\`,this.modelType=\`series\`,this.name=void 0,this.transformerConstructor=BA,this.coordinate=\`none\`,this._region=null,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:null,height:null},this.getLayoutRect=()=>({width:this._layoutRect.width??this._region.getLayoutRect().width,height:this._layoutRect.height??this._region.getLayoutRect().height}),this._rootMark=null,this._seriesMark=null,this._viewDataMap=new Map,this._viewDataFilter=null,this._data=null,this.layoutZIndex=pk.SeriesGroup,this._invalidType=\`break\`,this._region=t.region,this._dataSet=t.dataSet,(n=this._spec)!=null&&n.name&&(this.name=this._spec.name)}created(){super.created(),this._buildMarkAttributeContext(),this.initData(),this.initGroups(),this.initStatisticalData(),this.event.emit(Q.afterInitData,{model:this}),this.initRootMark(),this.initMark();let e=zA(this);this._initExtensionMark({hasAnimation:e}),this.initMarkStyle(),this.initMarkState(),e&&this.initAnimation(),this._option.disableTriggerEvent||this.initInteraction(),this.afterInitMark(),this.initEvent(),this.event.emit(Q.afterInitEvent,{model:this})}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(e,t)=>this._option.globalScale.getScale(e)?.scale(t),seriesColor:e=>(f(e)&&(e=this.getSeriesKeys()[0]),this._option.globalScale.getScale(\`color\`)?.scale(e)),getRegion:()=>this._region}}setAttrFromSpec(){super.setAttrFromSpec(),this.setSeriesField(this._spec.seriesField),p(this._spec.invalidType)&&(this._invalidType=this._spec.invalidType)}getInvalidCheckFields(){return[this.getStackValueField()]}initInvalidDataTransform(){var e,t;this._invalidType===\`zero\`&&(e=this._rawData)!=null&&e.dataSet&&(VO(this._rawData.dataSet,\`invalidTravel\`,fA),(t=this._rawData)==null||t.transform({type:\`invalidTravel\`,options:{config:()=>({invalidType:this._invalidType,checkField:this.getInvalidCheckFields()})}},!1))}initData(){var e;let t=this._spec.data??this._option.getSeriesData(this._spec.dataId,this._spec.dataIndex);if(t&&(this._rawData=qO(t,this._dataSet,this._option.sourceDataList)),(e=this._rawData?.target)==null||e.addListener(\`change\`,this.rawDataUpdate.bind(this)),this._addDataIndexAndKey(),this._rawData){this.getStack()&&(this._viewDataFilter=KO(this._rawData,this._dataSet,{name:\`\${this.type}_\${this.id}_viewDataFilter\`}));let e=KO(this.getStack()?this._viewDataFilter:this._rawData,this._dataSet,{name:\`\${this.type}_\${this.id}_viewData\`});this._data=new pA(this._option,e),this.getStack()&&this._viewDataFilter.target.removeListener(\`change\`,e.reRunAllTransform)}this.initInvalidDataTransform()}initGroups(){let e=this.getGroupFields();e&&e.length&&(this._groups={fields:e})}initStatisticalData(){this._data&&this._statisticViewData()}getRawDataStatisticsByField(e,t){if(this._rawStatisticsCache||={},!this._rawStatisticsCache[e]||t&&(f(this._rawStatisticsCache[e].min)||f(this._rawStatisticsCache[e].max))||!t&&f(this._rawStatisticsCache[e].values)){if(this._viewDataStatistics&&(!this._viewDataFilter||this._viewDataFilter.transformsArr.length<=1)&&this.getViewData().transformsArr.length<=1&&this._viewDataStatistics.latestData?.[e])this._rawStatisticsCache[e]=this._viewDataStatistics.latestData[e];else if(this._rawData){let n=this._rawData.getFields()?.[e];if(n&&n.lockStatisticsByDomain&&n.domain)this._rawStatisticsCache[e]={},t?(this._rawStatisticsCache[e].min=pe(n.domain),this._rawStatisticsCache[e].max=fe(n.domain)):this._rawStatisticsCache[e].values=n.domain;else{let n=dA(this._rawData.latestData,[{key:e,operations:t?[\`min\`,\`max\`]:[\`values\`]}])[e];this._rawStatisticsCache[e]=N(this._rawStatisticsCache[e]??{},n)}}}return this._rawStatisticsCache[e]}_statisticViewData(){VO(this._dataSet,\`dimensionStatistics\`,uA);let e=\`\${this.type}_\${this.id}_viewDataStatic\`;this._viewDataStatistics=new Sn(this._dataSet,{name:e}),this._viewDataStatistics.parse([this._data.getDataView()],{type:\`dataview\`}),this._viewDataStatistics.transform({type:\`dimensionStatistics\`,options:{fields:()=>{let e=this.getStatisticFields();return this._seriesField&&Qw(e,[{key:this._seriesField,operations:[\`values\`]}]),e},target:\`latest\`}},!1),this._data.getDataView().target.removeListener(\`change\`,this._viewDataStatistics.reRunAllTransform),this.getStack()&&this.createdStackData()}createStatisticalData(e,t,n){VO(this._dataSet,\`dimensionStatistics\`,uA);let r=new Sn(this._dataSet,{name:e});return r.parse([t],{type:\`dataview\`}),r.transform({type:\`dimensionStatistics\`,options:{operations:[\`max\`,\`min\`,\`values\`],fields:()=>{let e=Qw(this.getStatisticFields(),n?.(t.name)??[]);return this._seriesField&&Qw(e,[{key:this._seriesField,operations:[\`values\`]}]),e},target:\`latest\`}},!1),r}createdStackData(){let e=\`\${this.type}_\${this.id}_viewStackData\`;this._viewStackData=new Sn(this._dataSet,{name:e}),this._viewStackData.parse([this._viewDataFilter],{type:\`dataview\`}),this._viewStackData.transform({type:\`stackSplit\`,options:{fields:this.getStackGroupFields()}},!1)}_noAnimationDataKey(e,t){return t}generateDefaultDataKey(e){var t;return f(e)?(e,t,n)=>{if(!1===this._spec.animation){let n=this._noAnimationDataKey(e,t);if(n!==void 0)return n}let{keyMap:r}=n,i=this._getSeriesDataKey(e);return r.get(i)===void 0?(r.set(i,0),i):(r.set(i,r.get(i)+1),\`\${i}_\${r.get(i)}\`)}:v(e)?t=>t[e]:y(e)&&e.every((e=>v(e)))?t=>e.map((e=>t[e])).join(\`-\`):d(e)?(t,n)=>e(t,n):((t=this._option)==null||t.onError(\`invalid dataKey: \${e}\`),(e,t)=>{})}_addDataIndexAndKey(){var e;(e=this._rawData)!=null&&e.dataSet&&(VO(this._rawData.dataSet,\`addVChartProperty\`,Qk),this._rawData.transform({type:\`addVChartProperty\`,options:{beforeCall:mA.bind(this),call:hA}},!1))}updateRawData(e){this._rawData&&this._rawData.updateRawData(e)}rawDataUpdate(e){var t;(t=this._rawDataStatistics)==null||t.reRunAllTransform(),this._rawStatisticsCache=null,this.event.emit(Q.rawDataUpdate,{model:this})}viewDataFilterOver(e){this.event.emit(Q.viewDataFilterOver,{model:this})}viewDataUpdate(e){var t;this.event.emit(Q.viewDataUpdate,{model:this}),(t=this._data)==null||t.updateData(),this._viewDataStatistics&&this._viewDataStatistics.reRunAllTransform()}viewDataStatisticsUpdate(e){this.event.emit(Q.viewDataStatisticsUpdate,{model:this})}getDatumPositionValue(e,t){return!e||f(t)?null:e[t]}getDatumPositionValues(e,t){return!e||f(t)?[]:v(t)?[e[t]]:t.map((t=>e[t]))}setValueFieldToStack(){}setValueFieldToPercent(){}setValueFieldToStackOffsetSilhouette(){}initRootMark(){var e;this._rootMark=this._createMark({type:\`group\`,name:\`seriesGroup_\${this.type}_\${this.id}\`},{parent:(e=this._region).getGroupMark?.call(e),dataView:!1}),this._rootMark.setMarkConfig({zIndex:this._spec.zIndex??this.layoutZIndex})}_getExtensionMarkNamePrefix(){return\`\${this.type}_\${this.id}_extensionMark\`}_initExtensionMark(e){var t;this._spec.extensionMark&&(e.depend=this.getMarksWithoutRoot(),(t=this._spec.extensionMark)==null||t.forEach(((t,n)=>{this._createExtensionMark(t,null,this._getExtensionMarkNamePrefix(),n,e)})))}_createExtensionMark(e,t,n,r,i){var a;let o=this._createMark({type:e.type,name:p(e.name)?\`\${e.name}\`:\`\${n}_\${r}\`},{skipBeforeLayouted:!0,markSpec:e,parent:t,dataView:!1,componentType:e.componentType,depend:i.depend,key:e.dataKey},{setCustomizedShape:e?.customShape});if(o){if(p(e.id)&&o.setUserId(e.id),i.hasAnimation){let t=MA({},NA(e.type,e,this._markAttributeContext));o.setAnimationConfig(t)}if(e.type===\`group\`)n=\`\${n}_\${r}\`,(a=e.children)==null||a.forEach(((e,t)=>{this._createExtensionMark(e,o,n,t,i)}));else if(!(t||f(e.dataId)&&f(e.dataIndex))){let t=this._option.getSeriesData(e.dataId,e.dataIndex);t===this._rawData?o.setDataView(this.getViewData(),this.getViewDataProductId()):(o.setDataView(t),t.target.addListener(\`change\`,(()=>{o.getData().updateData()})))}}}_updateExtensionMarkSpec(){var e;(e=this._spec.extensionMark)==null||e.forEach(((e,t)=>{let n=this._marks.getMarkWithInfo({name:p(e.name)?\`\${e.name}\`:\`\${this._getExtensionMarkNamePrefix()}_\${t}\`});n&&(this.initMarkStyleWithSpec(n,e),n.updateStaticEncode(),n.updateLayoutState())}))}getStackData(){return this._viewStackData?.latestData}_parseSelectorOfInteraction(e,t){if(!t||!t.length)return[];let n=[];return e.markIds?t.filter((t=>{e.markIds.includes(t.getProductId())&&n.push(\`#\${t.getProductId()}\`)})):e.markNames?t.forEach((t=>{e.markNames.includes(t.name)&&n.push(\`#\${t.getProductId()}\`)})):t.forEach((e=>{n.push(\`#\${e.getProductId()}\`)})),n}_parseDefaultInteractionConfig(t){if(!t?.length)return[];let n=(r=this._option.mode)===e.RenderModeEnum[\`desktop-browser\`]||r===e.RenderModeEnum[\`desktop-miniApp\`]?{hover:{enable:!0,trigger:\`pointermove\`,triggerOff:\`view:pointerleave\`},select:{enable:!0,trigger:\`pointertap\`}}:Pm(r)||Fm(r)?{hover:{enable:!0,trigger:[\`pointerdown\`,\`pointermove\`],triggerOff:\`view:pointerleave\`},select:{enable:!0,trigger:\`tap\`}}:null;var r;let i=Object.assign({},n?.hover),a=Object.assign({},n?.select),o=this._spec.hover;u(o)?i.enable=o:m(o)&&(i.enable=!0,i=q(i,o));let s=this._spec.select;u(s)?a.enable=s:m(s)&&(a.enable=!0,a=q(a,s));let c=[];if(i.enable){let e=this._parseSelectorOfInteraction(i,t);e.length&&c.push(this._defaultHoverConfig(e,i))}if(a.enable){let e=this._parseSelectorOfInteraction(a,t);e.length&&c.push(this._defaultSelectConfig(e,a))}return c}_defaultHoverConfig(e,t){return{seriesId:this.id,regionId:this._region.id,selector:e,type:\`element-highlight\`,trigger:t.trigger,triggerOff:t.triggerOff,blurState:QO.STATE_HOVER_REVERSE,highlightState:QO.STATE_HOVER}}_defaultSelectConfig(e,t){let n=t.mode===\`multiple\`,r=p(t.triggerOff)?t.triggerOff:n?[\`empty\`]:[\`empty\`,t.trigger];return{type:\`element-select\`,seriesId:this.id,regionId:this._region.id,selector:e,trigger:t.trigger,triggerOff:r,reverseState:QO.STATE_SELECTED_REVERSE,state:QO.STATE_SELECTED,isMultiple:n}}_parseInteractionConfig(e){let t=this.getCompiler();if(!t)return;let{interactions:n}=this._spec,r=this._parseDefaultInteractionConfig(e);r&&r.length&&r.forEach((e=>{t.addInteraction(e)})),n&&n.length&&n.forEach((e=>{let n=this._parseSelectorOfInteraction(e,this.getMarks());n.length&&t.addInteraction(Object.assign(Object.assign({},e),{selector:n,seriesId:this.id,regionId:this._region.id}))}))}initInteraction(){let e=this.getMarksWithoutRoot();this._parseInteractionConfig(e)}initAnimation(){}initMarkState(){this.initSeriesStyleState()}initSeriesStyleState(){let e=this._spec.seriesStyle;if(!e||!e.length)return;let t=this._seriesField??Nw;this.getMarksWithoutRoot().forEach((n=>{let r={},i={},a={};e.forEach((e=>{let t=e[n.name]?.style;t&&(r[e.name]=!0,a[e.name]=a[e.name]||{},Object.keys(t).forEach((n=>{i[n]=!0,a[e.name][n]=t[n]})))})),n.state.addStateInfo({stateValue:Pw,level:-1,filter:e=>Array.isArray(e)?e.length!==0&&!0===r[e[0][t]]:!0===r[e[t]]});let o={};Object.keys(i).forEach((e=>{o[e]=r=>{let i;if(Array.isArray(r)){if(r.length===0)return;i=a[r[0][t]]?.[e]}return i=a[r[t]]?.[e],p(i)?i:n.getAttribute(e,r)}})),this.setMarkStyle(n,o,Pw,$.User_SeriesStyle)}))}afterInitMark(){this.event.emit(Q.afterInitMark,{model:this}),this.setSeriesField(this._spec.seriesField),this.getMarks().forEach((e=>{var t;(t=e.stateStyle?.normal)!=null&&t.lineWidth&&e.setAttribute(\`stroke\`,this.getColorAttribute(),\`normal\`,$.Base_Series)}))}getMarksWithoutRoot(){return this.getMarks().filter((e=>!e.name?.includes(\`seriesGroup\`)))}getMarksInType(e){return this._marks.getMarksInType(e)}getMarkInName(e){return this._marks.get(e)}getMarkInId(e){return this.getMarks().find((t=>t.id===e))}initEvent(){var e,t;(e=this._data?.getDataView())==null||e.target.addListener(\`change\`,this.viewDataUpdate.bind(this)),(t=this._viewDataStatistics)==null||t.target.addListener(\`change\`,this.viewDataStatisticsUpdate.bind(this))}_releaseEvent(){super._releaseEvent(),this.getCompiler().removeInteraction(this.id)}initTooltip(){this._tooltipHelper=new cA(this)}_compareExtensionMarksSpec(e,t,n){e.length!==t.length||t.some(((t,n)=>t.type!==e[n].type||t.id!==e[n].id||t.name!==e[n].name))?n.reMake=!0:t.some(((t,n)=>t.visible!==e[n].visible))&&(n.reCompile=!0)}_compareLabelSpec(e,t,n){e.length!==t.length||t.some(((t,n)=>t.labelLayout!==e[n].labelLayout||t.visible!==e[n].visible))?n.reMake=!0:!n.reCompile&&t.some(((t,n)=>!ce(t,e[n])))&&(n.reCompile=!0)}_compareSpec(e,t,n){let r=super._compareSpec(e,t),i=Object.keys(t||{}).sort();if(!ce(i,Object.keys(e||{}).sort()))return r.reMake=!0,r;let a=Object.assign(Object.assign(Object.assign(Object.assign({},xA),SA),n),{extensionMark:!0,label:!0,totalLabel:!0});return this._compareExtensionMarksSpec(P(e.extensionMark),P(t.extensionMark),r),!r.reMake&&this._compareLabelSpec(P(e.label),P(t.label),r),!r.reMake&&this._compareLabelSpec(P(e.totalLabel),P(t.totalLabel),r),r.reMake?r:(!r.reCompile&&this._marks.getMarks().some((n=>(a[n.name]=!0,t[n.name]?.visible!==e[n.name]?.visible)))&&(r.reCompile=!0),!r.reCompile&&i.some((n=>SA[n]&&!ce(e[n],t[n])))&&(r.reCompile=!0),i.some((n=>!a[n]&&!ce(e[n],t[n])))&&(r.reMake=!0),r)}_updateSpecData(){!this._rawData||!this._spec.data||this._spec.data instanceof Sn||JO(this._rawData,this._spec.data,!0)}reInit(e){super.reInit(e);let t=this.getMarksWithoutRoot();t.forEach((e=>{this._spec[e.name]&&this.initMarkStyleWithSpec(e,this._spec[e.name])})),this.initMarkStyle(),t.forEach((e=>{e.updateStaticEncode(),e.updateLayoutState(!0)})),this._updateExtensionMarkSpec(),this._updateSpecData(),this._tooltipHelper&&this._tooltipHelper.updateTooltipSpec(),zA(this)&&this.initAnimation()}onEvaluateEnd(e){this._data.updateData()}onRender(e){}release(){var e;super.release(),this._viewDataMap.clear();let t=(this._rawData?.transformsArr)?.findIndex((e=>e.type===\`addVChartProperty\`));t>=0&&this._rawData.transformsArr.splice(t,1),(e=this._data)==null||e.release(),this._dataSet=this._data=this._rawData=this._rawDataStatistics=this._spec=this._region=this._viewDataStatistics=this._viewStackData=null}setLayoutStartPosition(e){C(e.x)&&(this._layoutStartPoint.x=e.x),C(e.y)&&(this._layoutStartPoint.y=e.y)}setLayoutRect({width:e,height:t},n){C(e)&&(this._layoutRect.width=e),C(t)&&(this._layoutRect.height=t)}getSeriesKeys(){return this._seriesField?this.getRawDataStatisticsByField(this._seriesField)?.values??[]:this.name?[this.name]:this.userId?[\`\${this.userId}\`]:[\`\${this.type}_\${this.id}\`]}getSeriesStyle(e){return t=>this._seriesMark?.getAttribute(t,e)??void 0}_getSeriesInfo(e,t){let n=this.getDefaultShapeType();return t.map((t=>({key:t,originalKey:t,style:this.getSeriesStyle({[e]:t}),shapeType:n})))}getSeriesInfoInField(e){return this._getSeriesInfo(e,this.getRawDataStatisticsByField(e)?.values??[])}getSeriesInfoList(){return this._getSeriesInfo(this._seriesField??Nw,this.getSeriesKeys())}_getDefaultColorScale(){var e;let t=this.getDefaultColorDomain(),n=this._getDataScheme();return(e=new lC().domain(t)).range?.call(e,n)}_getDataScheme(){return tC(this.getColorScheme(),this.type)}getDefaultColorDomain(){return this._seriesField?this.getViewDataStatistics()?.latestData[this._seriesField]?.values:[]}getColorAttribute(){return{scale:this._option.globalScale.getScale(\`color\`)??this._getDefaultColorScale(),field:this._seriesField??Nw}}getDimensionField(){return[]}getMeasureField(){return[]}onMarkPositionUpdate(){this.onMarkTreePositionUpdate(this.getMarksWithoutRoot())}onMarkTreePositionUpdate(e){}_createMark(e,t={},n={}){var r,i;let{key:a,groupKey:o,skipBeforeLayouted:s,themeSpec:c={},markSpec:l,dataView:d,dataProductId:m,parent:h,isSeriesMark:g,depend:_,stateSort:v,noSeparateStyle:y=!1}=t,b=super._createMark(e,{key:a??this._getDataIdKey(),seriesId:this.id,attributeContext:this._markAttributeContext,componentType:t.componentType,noSeparateStyle:y});if(p(b)){let t=this.getSpec()||{};this._marks.addMark(b,{name:e.name}),g&&(this._seriesMark=b),f(h)?(r=this._rootMark)==null||r.addMark(b):!1!==h&&h.addMark(b),f(d)?(b.setDataView(this.getViewData(),this.getViewDataProductId()),b.setSkipBeforeLayouted(!0)):!1!==d&&b.setDataView(d,m),u(s)&&b.setSkipBeforeLayouted(s),p(_)&&b.setDepend(...P(_)),f(o)||b.setGroupKey(o),v&&b.setStateSortCallback(v);let a=Object.assign(Object.assign({},n),{morph:(i=n.morph)!=null&&i,support3d:(x=e.type,[\`arc3d\`,\`rect3d\`,\`pyramid3d\`].includes(x)||(n.support3d??(t.support3d||!!t.zField))),morphKey:t.morph?.morphKey||\`\${this.getSpecIndex()}_\${this.getMarks().length}\`,morphElementKey:t.morph?.morphElementKey??n.morphElementKey});b.setMarkConfig(a),this.initMarkStyleWithSpec(b,q({},c,l||t[b.name]))}var x;return b}_getDataIdKey(){return super._getDataIdKey()??Mw}_getSeriesDataKey(e){let t=\`\`;if(!e)return t;let n=this.getDimensionField();t=n.map((t=>e[t])).join(\`_\`);let r=this.getSeriesField();return r&&!n.includes(r)&&(t+=\`_\${e[r]}\`),t}addViewDataFilter(e){var t;(t=this._viewDataFilter??this.getViewData())==null||t.transform(e,!1)}reFilterViewData(){var e;(e=this._viewDataFilter??this.getViewData())==null||e.reRunAllTransform()}reTransformViewData(){var e;(e=this._data?.getDataView())==null||e.reRunAllTransform()}fillData(){var e;(e=this.getRawData())==null||e.reRunAllTransform()}compile(){this.compileData()}getDefaultShapeType(){return\`circle\`}getFieldAlias(e){return e!==Lw&&e!==zw&&e!==Iw&&e!==Rw||(e=this.getStackValueField()),eT(this.getRawData(),e)??e}_getInvalidConnectType(){return this._invalidType===\`zero\`?\`zero\`:this._invalidType===\`link\`?\`connect\`:\`none\`}_getInvalidDefined(e){let t=this.getInvalidCheckFields();return!t.length||t.every((t=>Rm(e[t])))}_getRelatedComponentSpecInfo(e){let t=this.getSpecIndex();return this._option.getSpecInfo().component[e]?.filter((e=>e.seriesIndexes.includes(t)))??[]}_forEachStackGroup(e,t){(t??=this._viewStackData?.latestData)&&(t.values?.length?e(t):t.nodes&&Object.values(t.nodes).forEach((t=>{this._forEachStackGroup(e,t)})))}isDatumInViewData(e){if(!e)return!1;let t=this.getViewData().latestData;return!!t&&(!!t.includes(e)||t.some((t=>Object.keys(e).every((n=>e[n]===t[n])))))}getSeriesFieldValue(e,t){return e[t??this.getSeriesField()??Nw]}}function HA(e,t,n){let r=e.getScale(0),i=\`isInverse\`in e&&e.isInverse();Pb(r.type)?n.sort(((e,n)=>(e[t]-n[t])*(i?-1:1))):n.sort(((e,n)=>(r.index(e[t])-r.index(n[t]))*(i?-1:1)))}function UA(e){return{dataIndex:t=>{let n=e.direction===\`horizontal\`?e.fieldY[0]:e.fieldX[0],r=t?.[n],i=e.direction===\`horizontal\`?e.scaleY:e.scaleX;return((i?.domain)?.call(i)??[]).indexOf(r)||0},dataCount:()=>{let t=e.direction===\`horizontal\`?e.scaleY:e.scaleX;return((t?.domain)?.call(t)??[]).length??0}}}VA.mark=gA,VA.transformerConstructor=BA;class WA extends VA{constructor(){super(...arguments),this.coordinate=\`cartesian\`,this._bandPosition=.5,this._scaleConfig={bandPosition:this._bandPosition},this._direction=\`vertical\`,this._sortDataByAxis=!1,this._getPositionXEncoder=()=>this._positionXEncoder?.bind(this),this._setPositionXEncoder=e=>{this._positionXEncoder=e.bind(this)},this._getPositionYEncoder=()=>this._positionYEncoder?.bind(this),this._setPositionYEncoder=e=>{this._positionYEncoder=e.bind(this)}}_buildScaleConfig(){this._scaleConfig={bandPosition:this._bandPosition}}get fieldX(){return this._fieldX}setFieldX(e){this._fieldX=P(e)}get fieldY(){return this._fieldY}setFieldY(e){this._fieldY=P(e)}get fieldZ(){return this._fieldZ}setFieldZ(e){this._fieldZ=e&&P(e)}get fieldX2(){return this._fieldX2}setFieldX2(e){this._fieldX2=e}get fieldY2(){return this._fieldY2}setFieldY2(e){this._fieldY2=e}get direction(){return this._direction}get scaleX(){return this._scaleX}setScaleX(e){this._scaleX=e}get scaleY(){return this._scaleY}setScaleY(e){this._scaleY=e}get scaleZ(){return this._scaleZ}setScaleZ(e){this._scaleZ=e}getXAxisHelper(){return this._xAxisHelper}setXAxisHelper(e){this._xAxisHelper=e,this.onXAxisHelperUpdate()}getYAxisHelper(){return this._yAxisHelper}setYAxisHelper(e){this._yAxisHelper=e,this.onYAxisHelperUpdate()}getZAxisHelper(){return this._zAxisHelper}setZAxisHelper(e){this._zAxisHelper=e,this.onYAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}getStatisticFields(){let e=[];return[{axisHelper:this.getXAxisHelper(),fields:this._fieldX2?[...this._fieldX,this._fieldX2]:this._fieldX},{axisHelper:this.getYAxisHelper(),fields:this._fieldY2?[...this._fieldY,this._fieldY2]:this._fieldY},{axisHelper:this.getZAxisHelper(),fields:this._fieldZ}].forEach((t=>{t.axisHelper&&t.axisHelper.getScale&&t.fields&&t.fields.forEach((n=>{let r={key:n,operations:[]},i=t.axisHelper.getScale(0);Pb(i.type)?(r.operations=[\`max\`,\`min\`],i.type===\`log\`&&(r.filter=e=>e>0)):r.operations=[\`values\`],e.push(r)}))})),this.getStack()&&e.push({key:this.getStackValueField(),operations:[\`allValid\`]}),e}getGroupFields(){return this.direction===\`vertical\`?this._fieldX:this._fieldY}getStackGroupFields(){return this.getGroupFields()}getStackValue(){let e=(this.direction===\`horizontal\`?this.getXAxisHelper():this.getYAxisHelper())?.getAxisId();return this._spec.stackValue??\`\${K}_series_\${this.type}_\${e}\`}getStackValueField(){return this.direction===\`horizontal\`?P(this._spec.xField)[0]:P(this._spec.yField)[0]}setValueFieldToStack(){this.direction===\`horizontal\`?(this.setFieldX(Lw),this.setFieldX2(Iw)):(this.setFieldY(Lw),this.setFieldY2(Iw))}setValueFieldToPercent(){this.direction===\`horizontal\`?(this.setFieldX(zw),this.setFieldX2(Rw)):(this.setFieldY(zw),this.setFieldY2(Rw))}setValueFieldToStackOffsetSilhouette(){this.direction===\`horizontal\`?(this.setFieldX(Vw),this.setFieldX2(Bw)):(this.setFieldY(Vw),this.setFieldY2(Bw))}onXAxisHelperUpdate(){this.onMarkPositionUpdate()}onYAxisHelperUpdate(){this.onMarkPositionUpdate()}onZAxisHelperUpdate(){this.onMarkPositionUpdate()}setAttrFromSpec(){super.setAttrFromSpec(),this.setFieldX(this._spec.xField),this.setFieldY(this._spec.yField),this.setFieldZ(this._spec.zField),this._specXField=P(this._spec.xField),this._specYField=P(this._spec.yField),p(this._spec.direction)&&(this._direction=this._spec.direction),this.setFieldX2(this._spec?.x2Field),this.setFieldY2(this._spec?.y2Field),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent(),this.getStackOffsetSilhouette()&&this.setValueFieldToStackOffsetSilhouette(),p(this._spec.sortDataByAxis)&&(this._sortDataByAxis=!0===this._spec.sortDataByAxis)}dataToPosition(e,t){return e?t&&!this.isDatumInViewData(e)?null:{x:this.dataToPositionX(e),y:this.dataToPositionY(e)}:null}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToX=this.valueToPositionX.bind(this),this._markAttributeContext.valueToY=this.valueToPositionY.bind(this),this._markAttributeContext.xBandwidth=(e=0)=>{var t;return(t=this.getXAxisHelper()).getBandwidth?.call(t,e)??0},this._markAttributeContext.yBandwidth=(e=0)=>{var t;return(t=this.getYAxisHelper()).getBandwidth?.call(t,e)??0},this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this)}valueToPosition(e,t){return{x:this.valueToPositionX(e),y:this.valueToPositionY(t)}}_axisPosition(e,t,n){return this._scaleConfig.datum=n,e.isContinuous?e.valueToPosition(t,this._scaleConfig):e.dataToPosition(P(t),this._scaleConfig)}valueToPositionX(e,t){return this._axisPosition(this._xAxisHelper,e,t)}valueToPositionY(e,t){return this._axisPosition(this._yAxisHelper,e,t)}_dataToPosition(e,t,n,r,i,a){let o=i();if(o)return o(e);if(!t)return a((e=>NaN)),NaN;let s=(t.getFields?t.getFields():n).slice(0,r);return s&&s.length!==0?(t.isContinuous?a((e=>(this._scaleConfig.datum=e,t.valueToPosition(this.getDatumPositionValue(e,s[0]),this._scaleConfig)))):a((e=>(this._scaleConfig.datum=e,t.dataToPosition(P(this.getDatumPositionValues(e,s)),this._scaleConfig)))),i()(e)):(a((e=>null)),null)}dataToPositionX(e){return this._dataToPosition(e,this._xAxisHelper,this.fieldX,void 0,this._getPositionXEncoder,this._setPositionXEncoder)}dataToPositionY(e){return this._dataToPosition(e,this._yAxisHelper,this.fieldY,void 0,this._getPositionYEncoder,this._setPositionYEncoder)}dataToPositionZ(e){if(!this._zAxisHelper)return NaN;let{dataToPosition:t}=this._zAxisHelper;return t(this.getDatumPositionValues(e,this._fieldZ),{bandPosition:this._bandPosition})}dataToPositionX1(e){return this._xAxisHelper?this._fieldX2&&this._fieldX2 in e?this.valueToPositionX(this.getDatumPositionValues(e,this._fieldX2)):this.valueToPositionX(0):NaN}dataToPositionY1(e){return this._yAxisHelper?this._fieldY2&&this._fieldY2 in e?this.valueToPositionY(this.getDatumPositionValues(e,this._fieldY2)):this.valueToPositionY(0):NaN}positionToData(e){return e?{x:this.positionToDataX(e.x),y:this.positionToDataY(e.y)}:null}positionToDataX(e){return this._scaleX?this._scaleX.invert(e):null}positionToDataY(e){return this._scaleY?this._scaleY.invert(e):null}getRegionRectLeft(){if(!this._xAxisHelper)return NaN;let{getScale:e}=this._xAxisHelper;return e(0).range()[0]}getRegionRectRight(){if(!this._xAxisHelper)return NaN;let{getScale:e}=this._xAxisHelper;return e(0).range()[1]}afterInitMark(){super.afterInitMark(),this.setFieldX(this._fieldX),this.setFieldY(this._fieldY),this._buildScaleConfig()}getDimensionField(){return this._direction===\`horizontal\`?this._specYField:this._specXField}getDimensionContinuousField(){return this._direction===\`horizontal\`?[this.fieldY[0],this.fieldY2]:[this.fieldX[0],this.fieldX2]}getMeasureField(){return this._direction===\`horizontal\`?this._specXField:this._specYField}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(Q.scaleDomainUpdate,{filter:e=>e.model.id===(this._direction===\`horizontal\`?this._yAxisHelper:this._xAxisHelper)?.getAxisId()},(()=>{this._sortDataInAxisDomain()}))}_sortDataInAxisDomain(){var e,t;(e=this.getViewData()?.latestData)!=null&&e.length&&(HA(this._direction===\`horizontal\`?this._yAxisHelper:this._xAxisHelper,this._direction===\`horizontal\`?this._fieldY[0]:this._fieldX[0],this.getViewData().latestData),(t=this._data)==null||t.updateData(!0))}getInvalidCheckFields(){let e=[];return this._xAxisHelper&&this._xAxisHelper.isContinuous&&this._xAxisHelper.getAxisType()!==a.geoCoordinate&&(this._xAxisHelper.getFields?this._xAxisHelper.getFields():this._specXField).forEach((t=>{e.push(t)})),this._yAxisHelper&&this._yAxisHelper.isContinuous&&this._yAxisHelper.getAxisType()!==a.geoCoordinate&&(this._yAxisHelper.getFields?this._yAxisHelper.getFields():this._specYField).forEach((t=>{e.push(t)})),e}reInit(e){this._positionXEncoder&&=null,this._positionYEncoder&&=null,super.reInit(e)}}let GA=\`monotone\`,KA={point:{name:\`point\`,type:\`symbol\`},line:{name:\`line\`,type:\`line\`}};class qA{addSamplingCompile(){if(this._spec.sampling){let{width:e,height:t}=this._region.getLayoutRect(),n=[],r=this._fieldY,i=this._fieldX;n.push({type:\`sampling\`,size:this._direction===\`horizontal\`?t:e,factor:this._spec.samplingFactor,yfield:this._direction===\`horizontal\`?i[0]:r[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(n)}}addOverlapCompile(){var e;if(this._spec.markOverlap){let t=[];t.push({type:\`markoverlap\`,direction:this._direction===\`horizontal\`&&this.coordinate===\`cartesian\`?2:1,delta:this._spec.pointDis,deltaMul:this._spec.pointDisMul,groupBy:this._seriesField}),(e=this._symbolMark)==null||e.getProduct().transform(t)}}reCompileSampling(){this._spec.sampling&&this.compile()}initLineMark(e,t){return this._lineMark=this._createMark(KA.line,{groupKey:this._seriesField,isSeriesMark:t==null||t,stateSort:this._spec.line?.stateSort},Object.assign(Object.assign({},e),{setCustomizedShape:this._spec.line?.customShape,morphElementKey:this.getDimensionField()[0]})),this._lineMark}initLineMarkStyle(e,t){let n=this._lineMark;if(n){if(this.setMarkStyle(n,{stroke:this.getColorAttribute()},\`normal\`,$.Series),this._invalidType!==\`zero\`&&this.setMarkStyle(n,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},\`normal\`,$.Series),this.event.on(Q.viewDataStatisticsUpdate,{filter:e=>e.model===this},(()=>{this.encodeDefined(n,\`defined\`)})),this.coordinate===\`polar\`)this.setMarkStyle(n,{lineJoin:\`bevel\`,curveType:\`linear\`,closePath:!0},\`normal\`,$.Series);else{let r=t??this.getSpec().line?.style?.curveType,i=r===GA?e===\`horizontal\`?\`monotoneY\`:\`monotoneX\`:r;this.setMarkStyle(n,{curveType:i},\`normal\`,$.Built_In)}this.setMarkStyle(n,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},\`normal\`,$.Series)}return n}_getEventElement(e,t=!1){let n=[];return e.dimensionInfo.some((e=>(e.data.some((e=>e.series===this&&(n=e.datum,!0))),!n.length))),n}_dimensionTrigger(e){let t=this._getEventElement(e);switch(e.action){case\`enter\`:this._symbolActiveMark.getDataView().parse(t),this._symbolActiveMark.getData().updateData(!1);break;case\`leave\`:this._symbolActiveMark.getDataView().parse([]),this._symbolActiveMark.getData().updateData(!1)}}initSymbolMark(e,t){let n=this._spec.point||{};if(!1!==n.visible&&(this._symbolMark=this._createMark(KA.point,{groupKey:this._seriesField,isSeriesMark:!!t,stateSort:n.stateSort},Object.assign(Object.assign({},e),{setCustomizedShape:n.customShape,morph:IA(this._spec,KA.point.name),morphElementKey:this.getDimensionField()[0]}))),!0===this._spec.activePoint){let e=new Sn(this._option.dataSet,{name:\`\${K}_series_\${this.id}_active_point\`});e.parse([]),this._symbolActiveMark=this._createMark({name:\`active_point_\${this.id}\`,type:\`symbol\`},{groupKey:this._seriesField,isSeriesMark:!1,dataView:e,parent:this._region.getInteractionMark(),stateSort:n.stateSort},{setCustomizedShape:n.customShape,morph:!1}),this._symbolActiveMark.setVisible(!1)}return this._symbolMark}initSymbolMarkStyle(){let e=this._symbolMark;if(!e)return this._initSymbolActiveMarkAlone(),e;if(this._initSymbolMark(e),this._symbolActiveMark&&this._symbolMark.stateStyle.dimension_hover){for(let t in this._symbolActiveMark.setVisible(!0),this.event.on(FO.dimensionHover,this._dimensionTrigger.bind(this)),this._symbolMark.stateStyle)for(let n in this._symbolActiveMark.stateStyle[t]={},this._symbolMark.stateStyle[t])n!==\`visible\`&&(this._symbolActiveMark.stateStyle[t][n]={style:null,level:$.Series,referer:e});this._symbolActiveMark.state.changeStateInfo({stateValue:QO.STATE_DIMENSION_HOVER,filter:()=>!0})}return e}_initSymbolMark(e){e&&(this.setMarkStyle(e,{fill:this.getColorAttribute()},\`normal\`,$.Series),this.setMarkStyle(e,{x:e=>this._invalidType===\`zero\`||this._getInvalidDefined(e)?this.dataToPositionX(e):NaN,y:e=>this._invalidType===\`zero\`||this._getInvalidDefined(e)?this.dataToPositionY(e):NaN,z:this._fieldZ?this.dataToPositionZ.bind(this):null},\`normal\`,$.Series))}_initSymbolActiveMarkAlone(){var e;let t=this._symbolActiveMark;t&&(this._initSymbolMark(t),t&&(e=this._spec[KA.point.name]?.state)!=null&&e.dimension_hover&&(t.setVisible(!0),this.event.on(FO.dimensionHover,this._dimensionTrigger.bind(this)),this.initMarkStyleWithSpec(t,q({},this._spec[KA.point.name],{visible:!0})),this._symbolActiveMark.state.changeStateInfo({stateValue:QO.STATE_DIMENSION_HOVER,filter:()=>!0})))}initLabelMarkStyle(e){e&&(e.getTarget()?.type!==\`symbol\`&&e.setRule(\`line-data\`),this.setMarkStyle(e,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._invalidType!==\`zero\`&&this.setMarkStyle(e,{visible:this._getInvalidDefined.bind(this)},\`normal\`,$.Series),this.event.on(Q.viewDataStatisticsUpdate,{filter:e=>e.model===this},(()=>{this.encodeDefined(e,\`visible\`)})))}initLineLabelMarkStyle(e){e&&this.setMarkStyle(e,{fill:this.getColorAttribute(),text:e=>e[this.getSeriesField()]??this.getSeriesKeys()[0],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}encodeDefined(e,t){if(!e)return;let n=this._isFieldAllValid();if(this._invalidType===\`zero\`||n){if(!0===e.stateStyle.normal?.[t]?.style)return;this.setMarkStyle(e,{[t]:!0},\`normal\`,$.Series)}else{if(!0!==e.stateStyle.normal?.[t]?.style)return;this.setMarkStyle(e,{[t]:this._getInvalidDefined.bind(this)},\`normal\`,$.Series)}e.getProduct()&&e.compileEncode()}_isFieldAllValid(){let e=this.getViewDataStatistics(),t=this.getStackValueField();return!!(e&&e.latestData&&t)&&e.latestData[t]&&e.latestData[t].allValid}}let JA=Object.assign(Object.assign({},gA),KA);class YA extends Uk{setStyle(e,t=\`normal\`,n=0,r=this.stateStyle){if(f(e))return;r[t]===void 0&&(r[t]={});let i=this._getIgnoreAttributes(),a=[\`strokeWidth\`,\`lineWidth\`,\`lineDash\`,\`strokeDash\`,\`lineJoin\`,\`stroke\`,\`strokeOpacity\`,\`opacity\`,\`fill\`,\`fillOpacity\`,\`texture\`,\`texturePadding\`,\`textureSize\`,\`textureColor\`],o=this.isUserLevel(n),s=!1;Object.keys(e).forEach((c=>{let l=e[c];if(f(l)||i.includes(c))return;o&&a.includes(c)&&(Fb(l?.type)||l!=null&&l.scale||d(l))&&(s=!0);let u=this._filterAttribute(c,l,t,n,o,r);this.setAttribute(c,u,t,n,r)})),s&&this.setMarkConfig({enableSegments:!0})}}class XA extends YA{constructor(){super(...arguments),this.type=XA.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:1})}_getIgnoreAttributes(){return this.model?.type===XS.radar&&this.model?.coordinate===\`polar\`?[]:[\`fill\`,\`fillOpacity\`]}}XA.type=\`line\`;let ZA=()=>{J.registerMark(XA.type,XA),gy(),oy(),xS(),gS(),Z.registerGraphic(Y.line,iu),AA()};class QA extends Uk{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{size:1,symbolType:\`circle\`,fill:void 0,lineWidth:0})}}class $A extends QA{constructor(){super(...arguments),this.type=$A.type}}$A.type=\`symbol\`;let ej=()=>{J.registerMark($A.type,$A),gy(),vy(),gS(),Z.registerGraphic(Y.symbol,tu)};class tj extends BA{_transformLabelSpec(e){!1!==e.point?.visible&&!1!==e.point?.style?.visible?this._addMarkLabelSpec(e,\`point\`):this._addMarkLabelSpec(e,\`line\`),this._addMarkLabelSpec(e,\`line\`,\`lineLabel\`,\`initLineLabelMarkStyle\`,void 0,!0)}}function nj(e){return e.length>=2&&C(e[0])&&C(de(e))&&de(e)>=e[0]}function rj(e,t){let n=de(t)-t[0],r=de(t)*t[0]<0,i=t[0]<=0?0-t[0]:0,a=de(t)>0?de(t)-0:0;n===0?t[0]<0?(i=1,a=0):t[0]>0&&(i=0,a=1):(i/=n,a/=n);let o=e.getDomainSpec(),s={total:n,negative:i,positive:a,includeZero:r,domain:t,extendable_min:!C(o.min),extendable_max:!C(o.max)};if(e._break?.scope){let n=t.findIndex((e=>e>=0)),r,i;n===0?(r=e._break.scope[n],i=[t[0],t[1]],s.positive=1,s.negative=0):de(t)<=0?(s.positive=0,s.negative=1,i=[t[t.length-2],t[t.length-1]]):(r=e._break.scope[n-1],i=[t[n-1],t[n]],s.negative=r[0]+(0-i[0])/(i[1]-i[0])*(r[1]-r[0]),s.positive=1-s.negative),s.break=!0,s.extendable_max=!1,s.extendable_min=!1,s.domain=i}return s}function ij(e,t){let{positive:n,negative:r,extendable_min:i,extendable_max:a,domain:o}=e,{positive:s,negative:c,extendable_min:l,extendable_max:u,domain:d}=t;if(s>0){if(!l)return!1;let e=r/n;a&&(e=r/Math.max(n,s),o[1]=-o[0]/e),d[0]=-d[1]*e}else if(c>0){if(!u)return!1;let e=n/r;i&&(e=n/Math.max(r,r),o[0]=-o[1]/e),d[1]=-d[0]*e}return!0}function aj(e,t){let{extendable_min:n,extendable_max:r,domain:i}=e,{positive:a,negative:o,domain:s}=t;return(a!==0||o!==0)&&!(a>0&&!r)&&!(o>0&&!n)&&(i[0]=s[0],i[1]=s[1],!0)}function oj(e,t){let{positive:n,negative:r,extendable_max:i,domain:a}=e,{positive:o,negative:s,extendable_min:c,domain:l}=t;if(i&&c){let e=Math.max(r,s)/Math.max(n,o);a[1]=-a[0]/e,l[0]=-l[1]*e}else if(c){let e=r/n;l[0]=-l[1]*e}else{if(!i)return!1;{let e=s/o;a[1]=-a[0]/e}}return!0}function sj(e,t){let{extendable_min:n,domain:r}=e,{extendable_max:i,domain:a}=t;return!(!n||!i)&&(r[0]=-r[1],a[1]=-a[0],!0)}let cj=(e,t)=>{if(!e)return e;let n=(t?.targetAxis)?.call(t);if(!n)return e;let r=(t?.currentAxis)?.call(t);if(!r)return e;let i=r.getTickData()?.getDataView();if(!i||!i.transformsArr.find((e=>e.type.includes(\`ticks\`))))return e;let a=r.getScale();if(!a)return e;let o=n.getTickData()?.getDataView()?.latestData;if(!o?.length)return e;let s=n.getScale();if(!s)return e;let c=s.domain(),l=de(c)-c[0];if(l===0)return e;let u=a.domain(),d=de(u)-u[0];if(l===0)return e;let f=o.map((e=>function(e,t,n,r,i){let a=Qe(e,t),o=Math.max(Ze(n),Ze(a));return i*(Math.round(a*10**o)/Math.round(n*10**o))+r}(e.value,c[0],l,u[0],d)));return kb(f)};class lj{constructor(e){this.id=Lm(),this.name=\`\${e}_\${this.id}\`}onAdd(e){this.service=e}release(){this.service=null}}class uj extends lj{constructor(){super(uj.type),this.type=\`AxisSyncPlugin\`}_checkEnableSync(e){if(!Pb(e.getScale().type))return!1;let t=e.getSpec().sync;return!!t?.axisId&&t}_getTargetAxis(e,t){let n=e.getOption().getChart().getComponentByUserId(t.axisId);return n?.type.startsWith(\`cartesianAxis\`)?n:null}onInit(e,t){let n=this._checkEnableSync(t);if(!n||!n.zeroAlign)return;let r=this._getTargetAxis(t,n);r&&t.event.on(Q.scaleDomainUpdate,{filter:({model:e})=>e.id===t.id||e.id===r.id},(()=>{((e,t)=>{var n,r;let i=e.getScale(),a=t.getScale();if(!i||!a)return;let o=(n=e).getDomainAfterSpec?.call(n)??[0,1],s=(r=t).getDomainAfterSpec?.call(r)??[0,1];if(!(o&&s&&nj(o)&&nj(s)))return;let c=rj(e,o),l=rj(t,s);if(!0===c.break&&!0===l.break)return;let{positive:u,negative:d,extendable_min:f,extendable_max:p,includeZero:m}=c,{positive:h,negative:g,extendable_min:_,extendable_max:v,includeZero:y}=l;if(u===0&&d===0){if(!aj(c,l))return}else if(h===0&&g===0){if(!aj(l,c))return}else if(m||y)if(m&&!y){if(!ij(c,l))return}else if(y&&!m){if(!ij(l,c))return}else{if(d===g)return;if(d>g){if(!oj(c,l))return}else if(!oj(l,c))return}else{if(d===0&&h===0){if(!sj(c,l))return}else if(g===0&&u===0&&!sj(l,c))return;if(d===0&&g===0)if(o[0]===0&&s[0]>0){if(!_)return;s[0]=0}else{if(!(s[0]===0&&o[0]>0)||!f)return;o[0]=0}if(u===0&&h===0)if(o[1]===0&&s[1]>0){if(!v)return;s[1]=0}else{if(!(s[1]===0&&o[1]>0)||!p)return;o[1]=0}}i.domain(o),a.domain(s)})(r,t)}))}onDidCompile(e,t){let n=this._checkEnableSync(t);if(!n)return;let r=this._getTargetAxis(t,n);r&&n.tickAlign&&(VO(t.getOption().dataSet,\`tickAlign\`,cj),t.addTransformToTickData({type:\`tickAlign\`,options:{targetAxis:()=>r,currentAxis:()=>t},level:2**53-1},!1))}}uj.pluginType=\`component\`,uj.type=\`AxisSyncPlugin\`;let dj={left:{textAlign:\`center\`,textBaseline:\`bottom\`},right:{textAlign:\`center\`,textBaseline:\`bottom\`},radius:{},angle:{}};function fj(e,t){return{min:e.min??e.range?.min??t?.min,max:e.max??e.range?.max??t?.max}}function pj(e){let t=e?.orient;return t===\`top\`||t===\`bottom\`||t===\`left\`||t===\`right\`||t===\`z\`}let mj=(e,t,n)=>{let r=(t===\`band\`?$k(\`axisBand\`,n):[\`linear\`,\`log\`,\`symlog\`].includes(t)?$k(\`axisLinear\`,n):{})??{},i=xO(e)?$k(\`axisX\`,n):SO(e)?$k(\`axisY\`,n):$k(\`axisZ\`,n);return q({},$k(\`axis\`,n),r,i)},hj=(e,t,n)=>{let r=(t===\`band\`?$k(\`axisBand\`,n):t===\`linear\`?$k(\`axisLinear\`,n):{})??{},i=$k(e===\`angle\`?\`axisAngle\`:\`axisRadius\`,n);return q({},$k(\`axis\`,n),r,i)},gj=e=>e===\`band\`||e===\`ordinal\`||e===\`point\`;function _j(e,t){return{id:e,label:e,value:t,rawValue:e}}function vj(e,t,n){return n||!e||e.getAxisId()===t.getAxisId()}class yj extends Jk{constructor(e){super(),this.component=e}releaseAll(){super.releaseAll(),this.component=null}}function bj(e,t,n,r){switch(e){case a.cartesianBandAxis:return mj(wO(n,[\`z\`]),\`band\`,t);case a.cartesianLinearAxis:return mj(wO(n,[\`z\`]),\`linear\`,t);case a.cartesianLogAxis:return mj(wO(n,[\`z\`]),\`log\`,t);case a.cartesianSymlogAxis:return mj(wO(n,[\`z\`]),\`symlog\`,t);case a.cartesianAxis:case a.cartesianTimeAxis:return mj(wO(n),void 0,t);case a.polarBandAxis:return hj(n.orient,\`band\`,t);case a.polarLinearAxis:return hj(n.orient,\`linear\`,t);case a.polarAxis:return hj(n.orient,void 0,t);case a.cartesianCrosshair:return((e,t)=>{let n=P(t.axes??[]),{bandField:r,linearField:i,xField:o,yField:s}=$k(a.crosshair,e)??{},c=n.find((e=>xO(e.orient))),l;l=p(c)?q({},gj(c.type)?r:i,o):o;let u=n.find((e=>SO(e.orient))),d;return d=p(u)?q({},Ib(u.type)?r:i,s):s,{xField:l,yField:d}})(t,r);case a.polarCrosshair:return((e,t)=>{let n=P(t.axes??[]),{bandField:r,linearField:i,categoryField:o,valueField:s}=$k(a.crosshair,e)??{},c=n.find((e=>e.orient===\`angle\`)),l;l=p(c)?q({},gj(c.type)?r:i,o):o;let u=n.find((e=>e.orient===\`radius\`)),d;return d=p(u)?q({},Ib(u.type)?r:i,s):s,{categoryField:l,valueField:d}})(t,r);case a.colorLegend:case a.sizeLegend:case a.discreteLegend:case a.dataZoom:case a.scrollBar:return xj(n,$k(e,t));default:return $k(e,t)}}let xj=(e,t)=>{let n=t[function(e){return e===\`top\`||e===\`bottom\`?\`horizontal\`:\`vertical\`}(e.orient??t.orient)],r=q({},t,n);return delete r.horizontal,delete r.vertical,r};class Sj extends xk{getTheme(e,t){return bj(this.type,this._option.getTheme(),e,t)}_mergeThemeToSpec(e,t){let{spec:n,theme:r}=super._mergeThemeToSpec(e,t);return this._adjustPadding(n),{spec:n,theme:r}}_adjustPadding(e){let{padding:t,noOuterPadding:n=!0,orient:r}=e;n&&t&&r&&(e.padding=Object.assign(Object.assign({},vC(t)),{[r]:0}))}}class Cj extends wk{static createComponent(e,n){let{spec:r}=e,i=t(e,[\`spec\`]);return new this(r,Object.assign(Object.assign({},n),i))}getRegions(){return this._regions}created(){super.created(),this.initLayout(),this.pluginService=new yj(this)}constructor(e,t){super(e,t),this.name=\`component\`,this.modelType=\`component\`,this.transformerConstructor=Sj,this._delegateEvent=(e,t,n,r=null,i=null)=>{t instanceof ao||this.event.emit(n,{model:this,node:e,event:t,item:r,datum:i,source:fO.chart,chart:(this._option?.globalInstance)?.getChart()},\`model\`)},this._option.animation&&(this.animate=new bk({getCompiler:t.getCompiler}))}initLayout(){super.initLayout(),this._regions=this._regions??this._option.getRegionsInIndex(),this._layout&&(this._layout.layoutBindRegionID=this._regions.map((e=>e?.id)))}changeRegions(e){throw Error(\`Method not implemented.\`)}_getNeedClearVRenderComponents(){throw Error(\`Method not implemented.\`)}onRender(e){throw Error(\`Method not implemented.\`)}getVRenderComponents(){return this._getNeedClearVRenderComponents()}callPlugin(e){this.pluginService&&this.pluginService.getAll().forEach((t=>e(t)))}getContainer(){return this._container||=this._option?.globalInstance.getStage().find((e=>e.name===\`root\`),!0),this._container}_compareSpec(e,t){let n=super._compareSpec(e,t);return n.reMake||=[\`seriesId\`,\`seriesIndex\`,\`regionId\`,\`regionIndex\`].some((n=>!ce(t?.[n],e[n]))),t?.visible!==e.visible&&(n.reCompile=!0),n}release(){var e;super.release(),this.clear(),(e=this.pluginService)==null||e.releaseAll(),this.pluginService=null}clear(){var e;let t=this._getNeedClearVRenderComponents();t&&t.length&&t.forEach((e=>{var t;e&&=((t=this.getContainer())==null||t.removeChild(e),null)})),this._container=null,(e=this.pluginService)==null||e.clearAll()}compile(){this.compileMarks(),this.reAppendComponents()}compileMarks(e){this.getMarks().forEach((t=>{t.compile({group:e,context:{model:this}})}))}reAppendComponents(){let e=this._getNeedClearVRenderComponents();e&&e.length&&e.forEach((e=>{var t;e&&!e.stage&&((t=this.getContainer())==null||t.appendChild(e))}))}getBoundsInRect(e,t){return{x1:0,x2:0,y1:0,y2:0}}getDatum(e){}}Cj.transformerConstructor=Sj;class wj extends Uk{constructor(e,t){super(e,t),this.type=\`component\`,this._componentType=t.componentType,this._mode=t.mode}_initProduct(e){let t=this.getVGrammarView(),n=this.getProductId();this._product=t.mark(Y.component,e??t.rootMark,{componentType:this._componentType,mode:this._mode}).id(n),this._compiledProductId=n}}wj.type=\`component\`;let Tj=()=>{J.registerMark(wj.type,wj)},Ej=e=>e;class Dj extends Cj{getOrient(){return this._orient}getScale(){return this._scale}getScales(){return this._scales}getTickData(e=0){return this._tickData[e]}get visible(){return this._visible}getInverse(){return this._inverse}getCoordinateType(){return this._coordinateType}constructor(e,t){var n;super(e,t),this.specKey=\`axes\`,this._scales=[],this._tickData=[],this._visible=!0,this._tick=void 0,this._visible=(n=e.visible)==null||n,this._coordinateType=\`none\`}_getNeedClearVRenderComponents(){return[]}getVRenderComponents(){return[(this._axisMark?.getProduct())?.getGroupGraphicItem(),(this._gridMark?.getProduct())?.getGroupGraphicItem()].filter(p)}created(){if(super.created(),this.setSeriesAndRegionsFromSpec(),this.initEvent(),this.initScales(),this.updateSeriesScale(),this._shouldComputeTickData()&&this._initData(),this._visible){let e=this._createMark({type:\`component\`,name:\`axis-\${this.getOrient()}\`},{componentType:this.getOrient()===\`angle\`?\`circleAxis\`:\`axis\`,mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});if(this._axisMark=e,e.setMarkConfig({zIndex:this.layoutZIndex}),p(this._spec.id)&&e.setUserId(this._spec.id),e.setMarkConfig({interactive:this._spec.interactive??this.getDefaultInteractive()}),this._marks.addMark(e),this._spec.grid?.visible){let e=this._createMark({type:\`component\`,name:\`axis-\${this.getOrient()}-grid\`},{componentType:this.getOrient()===\`angle\`?hT.circleAxisGrid:hT.lineAxisGrid,mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});e.setMarkConfig({zIndex:this._spec.grid?.style?.zIndex??this._spec.grid?.zIndex??pk.Axis_Grid,interactive:!1}),this._marks.addMark(e),this._gridMark=e}if(!1!==this._option.animation&&!1!==j(this._option.getChart().getSpec(),\`animation\`)&&!0===this._spec.animation){let e=MA(J.getAnimationInKey(\`axis\`)?.(),{appear:this._spec.animationAppear??j(this._option.getChart().getSpec(),\`animationAppear.axis\`)??j(this._option.getChart().getSpec(),\`animationAppear\`),disappear:this._spec.animationDisappear??j(this._option.getChart().getSpec(),\`animationDisappear.axis\`)??j(this._option.getChart().getSpec(),\`animationDisappear\`),enter:this._spec.animationEnter??j(this._option.getChart().getSpec(),\`animationEnter.axis\`)??j(this._option.getChart().getSpec(),\`animationEnter\`),exit:this._spec.animationExit??j(this._option.getChart().getSpec(),\`animationExit.axis\`)??j(this._option.getChart().getSpec(),\`animationExit\`),update:this._spec.animationUpdate??j(this._option.getChart().getSpec(),\`animationUpdate.axis\`)??j(this._option.getChart().getSpec(),\`animationUpdate\`)});e.enter&&(e.update[0].customParameters={enter:e.enter[0]}),this._marks.forEach((t=>t.setAnimationConfig(e)))}}}_shouldComputeTickData(){return this.getVisible()||this._spec.forceInitTick}_initData(){let e=this._initTickDataSet(this._tickTransformOption());e.target.addListener(\`change\`,this._forceLayout.bind(this)),this._tickData=[new Bk(this._option,e)]}collectData(e,t){let n=[];return qS(this._regions,(r=>{let i=this.collectSeriesField(e,r);if(i=y(i)?Pb(this._scale.type)?i:[i[0]]:[i],e||(this._dataFieldText=r.getFieldAlias(i[0])),i){let e=r.getViewData();if(t)i.forEach((e=>{n.push(r.getRawDataStatisticsByField(e,!1))}));else if(e&&e.latestData&&e.latestData.length){let t=r.getViewDataStatistics?.call(r),o=this.type===a.cartesianLinearAxis&&this._spec.breaks&&this._spec.breaks.length;i.forEach((r=>{var i;(i=t?.latestData)!=null&&i[r]&&(o?n.push(Object.assign(Object.assign({},t.latestData[r]),{values:e.latestData.map((e=>e[r]))})):n.push(t.latestData[r]))}))}}}),{userId:this._seriesUserId,specIndex:this._seriesIndex}),n}isSeriesDataEnable(){let e=!0;return qS(this._regions,(t=>{y(t.getViewDataStatistics()?.latestData)&&(e=!1)}),{userId:this._seriesUserId,specIndex:this._seriesIndex}),e}setSeriesAndRegionsFromSpec(){let{seriesId:e,seriesIndex:t,regionId:n,regionIndex:r}=this._spec;p(e)&&(this._seriesUserId=P(e)),p(n)&&(this._regionUserId=P(n)),p(t)&&(this._seriesIndex=P(t)),p(r)&&(this._regionIndex=P(r)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionIndex),this.layout.layoutBindRegionID=this._regions.map((e=>e.id))}getBindSeriesFilter(){return{userId:this._seriesUserId,specIndex:this._seriesIndex}}initEvent(){this.event.on(Q.scaleUpdate,{filter:({model:e})=>e?.id===this.id},this.effect.scaleUpdate.bind(this));let e=function(e,t){let n=[];for(let r of e)for(let e of r.getSeries(t))n.push(e);return n}(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}).map((e=>e.getViewDataStatistics())).filter((e=>!!e));e.length>1?this._option.dataSet.multipleDataViewAddListener(e,\`change\`,(()=>{this.updateScaleDomain()})):e.length===1&&e[0].target.addListener(\`change\`,(()=>{this.updateScaleDomain()})),qS(this._regions,(e=>{e.event.on(Q.rawDataUpdate,{filter:({model:t})=>t?.id===e.id},(()=>{this._clearRawDomain()}))}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}updateScaleDomain(){}_clearRawDomain(){}onLayoutEnd(e){this.updateScaleRange(),this.event.emit(Q.scaleUpdate,{model:this,value:\`range\`}),super.onLayoutEnd(e)}computeData(e){e!==\`force\`||this._tickData&&this._tickData.length?!this._tickData||!this._tickData.length||e!==\`force\`&&ce(this._scale.range(),[0,1])||this._tickData.forEach((e=>{e.getDataView().reRunAllTransform(),e.updateData()})):qS(this._regions,(e=>{var t;(t=e.getViewData())==null||t.reRunAllTransform()}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}initScales(){this._scales=[this._scale];let e=[];if(qS(this._regions,(t=>{let n=t.getGroups();n&&e.push(n)}),{userId:this._seriesUserId,specIndex:this._seriesIndex}),e.length!==0){let t=fe(e.map((e=>e.fields.length)));for(let e=1;e<t;e++){let e=this._scale.clone();this._scales.push(e)}}}_compareSpec(e,t){let n=super._compareSpec(e,t);return n.reMake?n:(n.reRender=!0,t?.type!==e?.type||t?.visible!==e?.visible?(n.reMake=!0,n):(n.reMake=[\`grid\`,\`subGrid\`,\`tick\`,\`subTick\`,\`label\`,\`domainLine\`,\`title\`].some((n=>t?.[n]?.visible!==e?.[n]?.visible)),n))}_getAxisAttributes(){let e=this._spec,n={orient:this.getOrient(),select:!0!==this._option.disableTriggerEvent&&e.select,hover:!0!==this._option.disableTriggerEvent&&e.hover};var r;if(e.domainLine&&e.domainLine.visible?n.line=((r=sT(r=e.domainLine)).startSymbol=sT(r.startSymbol),r.endSymbol=sT(r.endSymbol),r):n.line={visible:!1},e.label&&e.label.visible?(n.label=ae(e.label,[\`style\`,\`formatMethod\`,\`state\`]),e.label.style&&(n.label.style=d(e.label.style)?(t,n,r,i)=>{let a=e.label.style(t.rawValue,n,t,r,i);return lT(q({},this._theme.label?.style,a))}:lT(e.label.style)),(e.label.formatMethod||e.label.formatter)&&(n.label.formatMethod=this._getLabelFormatMethod()),e.label.state&&(n.label.state=function(e){if(A(e))return null;let t={};return Object.keys(e).forEach((n=>{d(e[n])?t[n]=(t,r,i,a)=>lT(e[n](t.rawValue,r,t,i,a)):A(e[n])||(t[n]=lT(e[n]))})),t}(e.label.state))):n.label={visible:!1},e.tick&&e.tick.visible?(n.tick={visible:e.tick.visible,length:e.tick.tickSize,inside:e.tick.inside,alignWithLabel:e.tick.alignWithLabel,dataFilter:e.tick.dataFilter},e.tick.style&&(n.tick.style=d(e.tick.style)?(t,n,r,i)=>{let a=e.tick.style(t,n,r,i);return lT(q({},this._theme.tick?.style,a))}:lT(e.tick.style)),e.tick.state&&(n.tick.state=cT(e.tick.state))):n.tick={visible:!1},e.subTick&&e.subTick.visible?(n.subTick={visible:e.subTick.visible,length:e.subTick.tickSize,inside:e.subTick.inside,count:e.subTick.tickCount},e.subTick.style&&(n.subTick.style=d(e.subTick.style)?(t,n,r,i)=>{let a=e.subTick.style(t,n,r,i);return lT(q({},this._theme.subTick?.style,a))}:lT(e.subTick.style)),e.subTick.state&&(n.subTick.state=cT(e.subTick.state))):n.subTick={visible:!1},e.title&&e.title.visible){let r=e.title,{autoRotate:i,angle:a,style:o={},background:s,state:c,shape:l}=r,u=t(r,[\`autoRotate\`,\`angle\`,\`style\`,\`background\`,\`state\`,\`shape\`]),d,p=a;e.orient!==\`left\`&&e.orient!==\`right\`||i&&f(p)&&(p=e.orient===\`left\`?-90:90,d=dj[e.orient]),n.title=Object.assign(Object.assign({},u),{autoRotate:!1,angle:p?tt(p):null,textStyle:q({},d,lT(o)),pickable:!1!==o.pickable,childrenPickable:!1!==o.pickable,state:{}}),l&&l.visible?(n.title.shape=Object.assign(Object.assign({},l),{style:lT(l.style)}),l.state&&(n.title.state.shape=cT(l.state))):n.title.shape={visible:!1},s&&s.visible?(n.title.background=Object.assign(Object.assign({},s),{style:lT(s.style)}),s.state&&(n.title.state.background=cT(s.state))):n.title.background={visible:!1},c&&(n.title.state.text=cT(c))}else n.title={visible:!1};return e.background&&e.background.visible?(n.panel={visible:!0},e.background.style&&(n.panel.style=lT(e.background.style)),e.background.state&&(n.panel.state=cT(e.background.state))):n.panel={visible:!1},n}_getGridAttributes(){let e=this._spec;return{alternateColor:e.grid.alternateColor,alignWithLabel:e.grid.alignWithLabel,style:d(e.grid.style)?()=>(t,n)=>{let r=e.grid.style(t.datum?.rawValue,n,t.datum);return lT(q({},this._theme.grid?.style,r))}:lT(e.grid.style),subGrid:!1===e.subGrid.visible?{visible:!1}:{type:\`line\`,visible:e.subGrid.visible,alternateColor:e.subGrid.alternateColor,style:lT(e.subGrid.style)}}}_getLabelFormatMethod(){let{formatMethod:e,formatter:t}=this._spec.label,{formatFunc:n}=eA(e,t);return n?(e,r,i)=>n(r.rawValue,r,t):null}_initTickDataSet(e,t=0){HO(this._option.dataSet,\`scale\`,Ej);let n=this.registerTicksTransform();return new Sn(this._option.dataSet,{name:\`\${this.type}_\${this.id}_ticks_\${t}\`}).parse(this._scales[t],{type:\`scale\`}).transform({type:n,options:e},!1)}_tickTransformOption(){let e=this._tick||{},t=this._spec.label||{},{tickCount:n,forceTickCount:r,tickStep:i,tickMode:a}=e,{style:o,formatMethod:s,minGap:c}=t;return{sampling:!1!==this._spec.sampling,tickCount:n,forceTickCount:r,tickStep:i,tickMode:a,axisOrientType:this._orient,coordinateType:this._coordinateType,labelStyle:o,labelFormatter:s,labelGap:c}}addTransformToTickData(e,t){this._tickData.forEach((n=>{var r;(r=n?.getDataView())==null||r.transform(e,t)}))}dataToPosition(e){return this._scale.scale(e)}getDatum(e){return e&&e.name===tb.label?e.data:this._axisMark?(this._axisMark.getProduct()?.getGroupGraphicItem())?.attribute.items:void 0}}Dj.specKey=\`axes\`;let Oj=()=>{Tj(),J.registerAnimation(\`axis\`,(()=>({appear:{custom:Jo},update:{custom:Ob},exit:{custom:Yo}})))},kj=[uj];class Aj extends Dj{getOrient(){return this._orient}getDefaultInteractive(){return!0}set autoIndentOnce(e){this._autoIndentOnce=e}getScales(){return this._scales}constructor(e,n){super(e,n),this.type=a.cartesianAxis,this.name=a.cartesianAxis,this._defaultBandPosition=.5,this._defaultBandInnerPadding=.1,this._defaultBandOuterPadding=.3,this.layoutType=\`region-relative\`,this.layoutZIndex=pk.Axis,this.layoutLevel=mk.Axis,this._orient=\`left\`,this._autoIndentOnce=!1,this._hasAutoIndent=!1,this._scales=[],this._tick=void 0,this._layoutCache={width:0,height:0,_lastComputeOutBounds:{x1:0,x2:0,y1:0,y2:0}},this._innerOffset={top:0,bottom:0,left:0,right:0},this.effect={scaleUpdate:e=>{this.computeData(e?.value),qS(this._regions,(e=>{let t=this.getOrient();xO(t)?vj(e.getXAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&e.setXAxisHelper(this.axisHelper()):SO(t)?vj(e.getYAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&e.setYAxisHelper(this.axisHelper()):CO(t)&&vj(e.getZAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&e.setZAxisHelper(this.axisHelper())}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=e=>{let{x:t,y:n}=e;return C(t)&&(t+=Number(this._orient===\`left\`)*this.getLayoutRect().width),C(n)&&(n+=Number(this._orient===\`top\`)*this.getLayoutRect().height),{x:t,y:n}},this._transformLayoutRect=e=>{if(!this._visible)return e;let t=this._latestBounds.clone().translate(-this.getLayoutStartPoint().x,-this.getLayoutStartPoint().y);switch(this._layout.layoutOrient){case\`left\`:this._layout.layoutRectLevelMap.width===0&&(e.width=t.x1<0?-t.x1:0);break;case\`right\`:this._layout.layoutRectLevelMap.width===0&&(e.width=t.x2>0?t.x2:0);break;case\`top\`:this._layout.layoutRectLevelMap.height===0&&(e.height=t.y1<0?-t.y1:0);break;case\`bottom\`:this._layout.layoutRectLevelMap.height===0&&(e.height=t.y2>0?t.y2:0)}return e.width=Math.ceil(e.width),e.height=Math.ceil(e.height),this._layout.setRectInSpec(this._layoutCacheProcessing(e))},this._updateAxisLayout=()=>{let e=this.getLayoutStartPoint(),n=this._getUpdateAttribute(!1),{grid:r}=n,i=t(n,[\`grid\`]),a=this._axisMark.getProduct(),o=q({x:e.x,y:e.y},this._axisStyle,i);a.encode(o),this._gridMark&&this._gridMark.getProduct().encode(q({x:e.x,y:e.y},this._getGridAttributes(),r))},this._fixAxisOnZero=()=>{let{onZero:e,visible:t}=this._spec.domainLine;if(this.visible&&e&&!1!==t){let{onZeroAxisId:e,onZeroAxisIndex:t}=this._spec.domainLine,n=this._option.getComponentsByKey(\`axes\`),r=xO(this.getOrient()),i=e=>(r?!xO(e.getOrient()):xO(e.getOrient()))&&Pb(e.getScale().type)&&(e.getTickData()?e.getTickData().getLatestData()?.find((e=>e.value===0)):e.getScale().domain()[0]<=0&&de(e.getScale().domain())>=0),a=n.filter((e=>i(e)));if(a.length){let o;if(p(e))o=a.find((t=>t.id===e));else if(p(t)){let e=n[t];i(e)&&(o=e)}else o=a[0];if(o){let e=this._axisMark.getProduct(),t=o.valueToPosition(0);r?e.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dy:this._orient===\`bottom\`?-((o.getInverse()?o.getScale().range()[1]:o.getScale().range()[0])-t):t})}):e.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dx:this._orient===\`left\`?t:-((o.getInverse()?o.getScale().range()[0]:o.getScale().range()[1])-t)})})}}}},this._orient=wO(e,[\`z\`]),CO(this._orient)&&(this.layoutType=\`absolute\`),this._dataSet=n.dataSet,this._coordinateType=\`cartesian\`}static getSpecInfo(e){let t=e[this.specKey];if(!t)return null;let n=e.direction===\`horizontal\`;if(!y(t)){if(!pj(t))return null;let{axisType:e,componentName:r}=TO(t,n);return t.type=e,[{spec:t,specPath:[this.specKey],specInfoPath:[\`component\`,this.specKey,0],type:r}]}let r=t.filter((e=>e.orient===\`z\`))[0],i=!0;if(r){let e=t.filter((e=>e.orient===\`bottom\`))[0],n=t.filter((e=>SO(e.orient)))[0];i=t.length===3&&e&&n}let a=t.map(((e,t)=>({spec:e,index:t})));i||(a=a.filter((({spec:e})=>e.orient!==\`z\`)));let o=[];return a.forEach((({spec:e,index:t})=>{if(!pj(e))return;let{axisType:r,componentName:i}=TO(e,n);e.type=r,o.push({spec:e,specPath:[this.specKey,t],specInfoPath:[\`component\`,this.specKey,t],type:i})})),o}static createComponent(e,n){let{spec:r}=e,i=t(e,[\`spec\`]),a=J.getComponentInKey(i.type);return a?new a(r,Object.assign(Object.assign({},n),i)):(n.onError(\`Component \${i.type} not found\`),null)}initLayout(){super.initLayout(),this._layout.autoIndent=!1!==this._spec.autoIndent,this._layout.layoutOrient=this._orient}setLayout3dBox(e){this.layout3dBox=e}getNewScaleRange(){let{width:e,height:t}=this.getLayoutRect(),{left:n,right:r,top:i,bottom:a}=this._innerOffset,o=[];return xO(this.getOrient())?C(e)&&(o=this._inverse?[e-r,n]:[n,e-r]):CO(this.getOrient())?C(e)&&(o=this._inverse?[e-r,n]:[n,e-r],this._scale.range(o)):C(t)&&(o=this._inverse?[i,t-a]:[t-a,i]),o}updateScaleRange(){let e=!1,t=this.getNewScaleRange(),n=this._scale.range();return t.length===n.length&&t.every(((e,t)=>e===n[t]))?e=!1:(e=!0,this._scale.range(t)),e}init(e){var t;super.init(e),(t=this.pluginService)==null||t.load(kj.map((e=>new e))),this.callPlugin((e=>{this.pluginService&&e.onInit&&e.onInit(this.pluginService,this)}))}setAttrFromSpec(){if(super.setAttrFromSpec(),this.visible){xO(this.getOrient())?_(this._spec.maxHeight)&&(this._spec.maxHeight=\`30%\`):_(this._spec.maxWidth)&&(this._spec.maxWidth=\`30%\`);let e=this._getAxisAttributes();e.label.formatMethod=this._getLabelFormatMethod(),e.verticalFactor=this.getOrient()===\`top\`||this.getOrient()===\`right\`?-1:1,this._axisStyle=e}this._tick=this._spec.tick;let e=this._option.getChart()?.getSpec();this._inverse=function(e,t){let n=e.inverse;return t&&!xO(e.orient)&&(n=!p(e.inverse)||!e.inverse),n}(this._spec,e?.direction===\`horizontal\`)}onLayoutStart(e,t,n){if(super.onLayoutStart(e,t,n),!CO(this.getOrient())&&this._spec.innerOffset){let e=this._spec;SO(this.getOrient())?[\`top\`,\`bottom\`].forEach((n=>{this._innerOffset[n]=gC(e.innerOffset[n],t.height,t)})):[\`left\`,\`right\`].forEach((n=>{this._innerOffset[n]=gC(e.innerOffset[n],t.width,t)}))}}getSeriesStatisticsField(e){let t;return t=xO(this.getOrient())?e.fieldX:CO(this.getOrient())?e.fieldZ:e.fieldY,Pb(this._scale.type)?t:[t[0]]}_tickTransformOption(){return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimals:this._tick?.noDecimals,labelLastVisible:this._spec.label?.lastVisible,labelFirstVisible:this._spec.label?.firstVisible,labelFlush:this._spec.label?.flush})}axisHelper(){return{isContinuous:Pb(this._scale.type),dataToPosition:this.dataToPosition.bind(this),getScale:(e=0)=>this._scales[e],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>!0===this._inverse,getSpec:()=>this._spec}}afterCompile(){let e=this._axisMark?.getProduct();e&&e.addEventListener(X.AFTER_ELEMENT_ENCODE,(()=>{if(!1===this._isLayout&&(xO(this.getOrient())?this.callPlugin((e=>{this.pluginService&&e.onDidLayoutHorizontal&&e.onDidLayoutHorizontal(this.pluginService,this)})):this.callPlugin((e=>{this.pluginService&&e.onDidLayoutVertical&&e.onDidLayoutVertical(this.pluginService,this)})),this._unitText)){let{x:e,y:t}=this.getLayoutStartPoint(),n=xO(this._orient)?{x:fe(this._scale.range())+e,y:t}:{x:e,y:pe(this._scale.range())+t};this._unitText.setAttributes(n)}})),this.callPlugin((e=>{this.pluginService&&e.onDidCompile&&e.onDidCompile(this.pluginService,this)}))}onRender(e){}changeRegions(e){}update(e){}resize(e){}collectScale(){let e=[];return qS(this._regions,(t=>{e.push(this.getOrient()===\`left\`||this.getOrient()===\`right\`?t.scaleY:t.scaleX)}),{userId:this._seriesUserId,specIndex:this._seriesIndex}),e}collectSeriesField(e,t){let n;return n=e>0?t.getGroups()?.fields?.[e]:xO(this.getOrient())?t.getSpec().x2Field?[...t.fieldX,t.fieldX2]:t.fieldX:CO(this.getOrient())?t.fieldZ:t.getSpec().y2Field?[...t.fieldY,t.fieldY2]:t.fieldY,n}updateSeriesScale(){let e=this.getOrient();qS(this._regions,(t=>{xO(e)?vj(t.getXAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&(t.setScaleX(this._scale),t.setXAxisHelper(this.axisHelper())):SO(e)?vj(t.getYAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&(t.setScaleY(this._scale),t.setYAxisHelper(this.axisHelper())):CO(e)&&vj(t.getZAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&(t.setScaleZ(this._scale),t.setZAxisHelper(this.axisHelper()))}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}getBoundsInRect(e){let t={x1:0,y1:0,x2:0,y2:0};if(!this._visible)return t;this._verticalLimitSize=xO(this.getOrient())?e.height:e.width,this.setLayoutRect(e),!this.updateScaleRange()&&y(this.getTickData()?.getLatestData())||this.computeData(\`range\`);let n={skipLayout:!1},r=xO(this.getOrient());this.pluginService&&(r?this.callPlugin((e=>{e.onWillLayoutHorizontal&&e.onWillLayoutHorizontal(this.pluginService,n,this)})):this.callPlugin((e=>{e.onWillLayoutVertical&&e.onWillLayoutVertical(this.pluginService,n,this)})));let i=this._axisMark.getProduct();{let e=this._getUpdateAttribute(!0),n=i.getGroupGraphicItem(),a=q(Object.assign({},this.getLayoutStartPoint()),this._axisStyle,e,{line:{visible:!1}}),o=n.getBoundsWithoutRender(a);o.empty()&&(o=new xt().set(a.x,a.y,a.x,a.y)),this._latestBounds=o,t=this._appendAxisUnit(o,r)}return t}positionToData(e,t){let n=xO(this.getOrient());t&&(e-=n?this.getLayoutStartPoint().x:this.getLayoutStartPoint().y),this._innerOffset&&(e=n?De(e,this._innerOffset.left,this.getLayoutRect().width-this._innerOffset.right):De(e,this._innerOffset.top,this.getLayoutRect().height-this._innerOffset.bottom));let r=this._scale.range();return(e-r[0])*(e-de(r))>0?null:this._scale.invert(e)}_getTitleLimit(e){let t=this._spec.title;if(t.visible&&f(t.style?.maxLineWidth)){let n=this._axisStyle.title?.angle??t.style?.angle??0;if(e){let e=this.getLayoutRect().width,t=Math.abs(Math.cos(n));return t<1e-6?1/0:e/t}let r=this.getLayoutRect().height,i=Math.abs(Math.sin(n));return i<1e-6?1/0:r/i}return null}_getUpdateAttribute(e){let t=0,n=0;if(!e){let e=this.getRegions(),{x:r,y:i}=e[0].getLayoutStartPoint(),a=r+e[0].getLayoutRect().width,o=i+e[0].getLayoutRect().height;for(let t=1;t<e.length;t++){let n=e[t],{x:s,y:c}=n.getLayoutStartPoint(),{width:l,height:u}=n.getLayoutRect();r=Math.min(r,s),a=Math.max(a,l+s),i=Math.min(i,c),o=Math.max(o,u+c)}t=Math.abs(o-i),n=Math.abs(a-r)}let{width:r,height:i}=this.getLayoutRect(),a=xO(this._orient),o=SO(this._orient),s=CO(this._orient),c=this.layout3dBox?this.layout3dBox.length:0,l={x:0,y:0},u=t,d=r;a?l={x:r,y:0}:o?(l={x:0,y:i},u=n,d=i):s&&(l={x:c,y:0});let f=this.getLabelItems(d),p={start:{x:0,y:0},end:l,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(a)},items:f};if(e||(p.grid={type:\`line\`,start:{x:0,y:0},end:l,items:f[0],verticalFactor:this._axisStyle.verticalFactor,depth:c,length:u}),s){let t=this.directionStr??\`r2l\`,n=this.layout3dBox?this.layout3dBox.width:0,r=[0,0],i=-Math.PI/2,a=0;t===\`l2r\`&&(a=this.layout3dBox.length,r=[0,0,0],i=Math.PI/2),p.z=a,p.alpha=i,p.anchor3d=r,e||(p.grid.depth=n)}else{let e=a?this.layout.minHeight:this.layout.minWidth;(a&&this._layout.layoutRectLevelMap.height===9||o&&this._layout.layoutRectLevelMap.width===9)&&(e=this._verticalLimitSize),p.verticalLimitSize=this._verticalLimitSize,p.verticalMinSize=e,p.label={overflowLimitLength:this._getLabelOverflowLimit(a)}}return p}getLabelItems(e){let t=this.getTickData()?.getLatestData();return t&&t.length?[t.map((t=>{let n=this._getNormalizedValue([t.value],e);return _j(t.value,n)})).filter((e=>{let{value:t,rawValue:n}=e,r=this._scale.domain();return this.getSpec().type===\`log\`?t>=0&&t<=1:Pb(this._scale.type)?n>=r[0]&&n<=de(r):r.includes(n)}))]:[]}initEvent(){super.initEvent(),this.visible&&(this.event.on(Q.layoutEnd,this._updateAxisLayout),this.event.on(Q.layoutEnd,this._fixAxisOnZero),this.event.on(Q.layoutRectUpdate,(()=>{this._clearLayoutCache()})))}_getNormalizedValue(e,t){return t===0?0:this.dataToPosition(e)/t}_layoutCacheProcessing(e){return[\`width\`,\`height\`].forEach((t=>{e[t]<this._layoutCache[t]?e[t]=this._layoutCache[t]:this._layoutCache[t]=e[t]})),this._autoIndentOnce&&this._hasAutoIndent?[\`x1\`,\`x2\`,\`y1\`,\`y2\`].forEach((e=>{this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]})):(this._hasAutoIndent=!0,[\`x1\`,\`x2\`,\`y1\`,\`y2\`].forEach((e=>{this.layout.getLastComputeOutBounds()[e]<this._layoutCache._lastComputeOutBounds[e]?this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]:this._layoutCache._lastComputeOutBounds[e]=this.layout.getLastComputeOutBounds()[e]}))),e}_clearLayoutCache(){this._hasAutoIndent=!1,this._layoutCache.width=0,this._layoutCache.height=0,this._layoutCache._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0}}onDataUpdate(){this._clearLayoutCache()}_appendAxisUnit(e,t){var n;if(this._spec.unit&&this._spec.unit.visible){let{text:r,style:i}=this._spec.unit,a,o,{x:s,y:c}=this.getLayoutStartPoint();t?(a={x:fe(this._scale.range())+s,y:c},o={textAlign:\`left\`,textBaseline:\`middle\`}):(a={x:s,y:pe(this._scale.range())+c},o={textAlign:this._orient===\`left\`?\`left\`:\`right\`,textBaseline:\`bottom\`}),o=Object.assign(Object.assign(Object.assign({},o),i),{x:a.x,y:a.y,text:r}),this._unitText?this._unitText.setAttributes(o):(this._unitText=Ql(o),this._unitText.name=\`axis-unit\`,(n=this.getContainer())==null||n.add(this._unitText));let l=this._unitText.AABBBounds;t?(e.x2+=l.x2>e.x2?l.x2-e.x2:0,e.y2+=l.y2>e.y2?l.y2-e.y2:0):(e.x1+=l.x1<e.x1?l.x1-e.x1:0,e.y1+=l.y1<e.y1?l.y1-e.y1:0)}return e}_getNeedClearVRenderComponents(){return this._unitText?[this._unitText]:[]}_getLabelOverflowLimit(e){if(e&&!1!==this._spec.label?.visible&&!0===this._spec.label?.autoLimit){let e=this._option.getComponentsByKey(\`axes\`),t=this.getRegions(),n=e.filter((e=>{let n=e.getOrient();return(n===\`left\`||n===\`right\`)&&e.getRegions().some((e=>t.includes(e)))})),r=0,i=0,a=this.getLayoutStartPoint().x,o=a+this.getLayoutRect().width;return n.forEach((e=>{let t=e.getLayoutStartPoint().x;if(e.getOrient()===\`left\`&&t===a){let t=e.getLayoutRect().width;r=Math.max(r,t)}else if(t===o){let t=e.getLayoutRect().width;i=Math.max(i,t)}})),{left:r,right:i}}}}Aj.type=a.cartesianAxis,Aj.specKey=\`axes\`;let jj=(e,t,n)=>n.reduce(((e,r,i)=>(e.push([r,n.length===i+1?t:n[i+1]]),e)),[[e,n[0]]]);function Mj(e,t){let n=e[0],r=e[e.length-1],i=t.filter((e=>e>n&&e<r));return i.length===0?[[n,r]]:jj(n,r,i)}let Nj=(e,t)=>e-t,Pj=(e,t)=>{let n=[{count:0,sub:[],max:t[0],min:t[0]}],r=0,i=0;for(;r<t.length;)e[i]<=t[r]?(n[r].count+=1,n[r].sub.push(e[i]),i+=1):(r+=1,n[r]={count:0,sub:[],max:t[r],min:t[r]});n.forEach((e=>{e.count&&(e.min=Math.min.apply(null,e.sub))}));let a=e.slice(i);return n[r]={count:a.length,sub:a,min:t[t.length-1],max:Math.max.apply(null,a)},n};function Fj(e,t,n=\`count\`){let r=Pj(e,t),i=n===\`count\`?e.length:r.reduce(((e,t,n)=>t.count>0?e+t.max-t.min:e),0),a=[],o=0,s=0;return r.forEach(((e,t)=>{if(i===0)a.push([0,t/r.length-1]);else{let c=n===\`count\`?e.count:e.max-e.min,l=a[s-1]?a[s-1][1]:0,u=t===r.length-1?1:Math.min((o+c)/i,1);(l!==u||l!==0&&l!==1)&&(s+=1,a.push([l,u]),o+=c)}})),a}let Ij=Math.sqrt(50),Lj=Math.sqrt(10),Rj=Math.sqrt(2);class zj{constructor(){this._extend={},this.niceLabelFormatter=null}setExtraAttrFromSpec(){p(this._spec.nice)&&(this._nice=this._spec.nice),p(this._spec.zero)&&(this._zero=this._spec.zero),this._expand=this._spec.expand,this._domain=fj(this._spec)}transformScaleDomain(){this.setScaleNice()}setLinearScaleNice(){if(!this._nice)return!1;let e=5,t=this._spec.tick||{};if(C(t.forceTickCount))e=t.forceTickCount;else if(d(t.tickCount)){let n=this._scale.range(),r=Math.abs(de(n)-n[0]);r===1&&this._option&&(r=xO(this._orient)?this._option.getChartViewRect().width:this._option.getChartViewRect().height),e=t.tickCount({axisLength:r,labelStyle:this._spec.label&&this._spec.label.style})}else e=C(t.tickCount)?t.tickCount:5;this._spec.niceType===\`accurateFirst\`&&(e=Math.max(5,e));let{min:n,max:r}=this._domain??{};return f(n)&&f(r)&&f(this._softMaxValue)&&f(this._softMinValue)?this._scale.nice(e):(p(n)||p(this._softMinValue))&&f(r)&&f(this._softMaxValue)?this._scale.niceMax(e):!(!f(n)||!f(this._softMinValue)||!p(r)&&!p(this._softMaxValue))&&this._scale.niceMin(e)}setLogScaleNice(){if(!this._nice)return!1;let{min:e,max:t}=this._domain??{};return f(e)&&f(t)&&f(this._softMaxValue)&&f(this._softMinValue)?this._scale.nice():(p(e)||p(this._softMinValue))&&f(t)&&f(this._softMaxValue)?this._scale.niceMax():!(!f(e)||!f(this._softMinValue)||!p(t)&&!p(this._softMaxValue))&&this._scale.niceMin()}setScaleNice(){return this._spec.type===\`log\`?this.setLogScaleNice():this.setLinearScaleNice()}dataToPosition(e,t){return this.valueToPosition(e[0])}valueToPosition(e){return this._scale.scale(e)}computeLinearDomain(e){let t=[];if(e.length){let n=this._spec.breaks&&this._spec.breaks.length,r,i,a=[];if(e.forEach((e=>{let{min:t,max:o}=e;r=r===void 0?t:Math.min(r,t),i=i===void 0?o:Math.max(i,o),n&&(a=a.concat(e.values))})),n){let e=[],n=[],o=f(this._domain.max)?i:this._domain.max;for(let t=0;t<this._spec.breaks.length;t++){let{range:r}=this._spec.breaks[t];r[0]<=r[1]&&r[1]<=o&&(e.push(r),n.push(this._spec.breaks[t]))}if(e.sort(((e,t)=>e[0]-t[0])),e.length){let{domain:r,scope:i}=function(e,t,n){return e.sort(Nj),t.sort(Nj),{domain:Mj(e,t),scope:Fj(e,t,n)}}(a,Dm(e),this._spec.breaks[0].scopeType);t=Dm(r),this._break={domain:r,scope:i,breakDomains:e,breaks:n}}else t=[r,i]}else t=[r,i]}else t[0]=0,t[1]=0;return this.setSoftDomainMinMax(t),this.expandDomain(t),this.includeZero(t),this.setDomainMinMax(t),t}expandDomain(e){if(!this._expand)return;let t=e[0],n=de(e);t===n&&(n===0?n=1:n>0?t=0:n<0&&(n=0)),p(this._expand.min)&&(e[0]=t-(n-t)*this._expand.min),p(this._expand.max)&&(e[e.length-1]=n+(n-t)*this._expand.max)}niceDomain(e){let{min:t,max:n}=fj(this._spec);if(p(t)||p(n)||this._spec.type!==\`linear\`)return e;if(Math.abs(pe(e)-fe(e))<=1e-12){let t=e[0],n=t>=0?1:-1;if(t=Math.abs(t),t<1)e[0]=0,e[e.length-1]=1;else{let n=t/5,r=Math.floor(Math.log(n)/Math.LN10),i=n/10**r;n=(i>=Ij?10:i>=Lj?5:i>=Rj?2:1)*10**r,e[0]=0,e[e.length-1]=10*n}n<0&&(e.reverse(),e[0]*=-1,e[e.length-1]*=-1)}return e}includeZero(e){this._zero&&(e[0]=Math.min(e[0],0),e[e.length-1]=Math.max(de(e),0))}setExtendDomain(e,t){if(t===void 0)return void delete this._extend[e];this._extend[e]=t;let n=this._scale.domain();this.extendDomain(n),this.includeZero(n),this.setDomainMinMax(n),this.niceDomain(n),this._scale.domain(n,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this.event.emit(Q.scaleUpdate,{model:this,value:\`domain\`})}extendDomain(e){let t,n=e.length-1,r=e[0]-e[n]>0,i=r?n:0,a=r?0:n;for(let n in this._extend)t=this._extend[n],t>e[a]&&(e[a]=t),t<e[i]&&(e[i]=t)}getDomainSpec(){return this._domain}setDomainMinMax(e){if(!this._domain)return;let{min:t,max:n}=this._domain;p(t)&&(e[0]=t),p(n)&&(e[e.length-1]=n)}setSoftDomainMinMax(e){let{softMin:t,softMax:n}=this._spec;if(p(t)){let n=d(t)?t(e):t;f(n)&&(n=e[0]),n<=e[0]&&(e[0]=n,this._softMinValue=n)}if(p(n)){let t=d(n)?n(e):n;f(t)&&(t=de(e)),t>=de(e)&&(e[e.length-1]=t),this._softMaxValue=t}}setZero(e){this._zero!==e&&(this._zero=e,this.updateScaleDomain())}updateScaleDomain(){if(!this.isSeriesDataEnable())return;let e=this.collectData(),t=this.computeLinearDomain(e);this.updateScaleDomainByModel(t)}updateScaleDomainByModel(e){e??=this._scale.domain(),this.extendDomain(e),this.includeZero(e),this.setDomainMinMax(e),this.niceDomain(e),this._scale.domain(e,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this._updateNiceLabelFormatter(e),this._domainAfterSpec=this._scale.domain(),this.event.emit(Q.scaleDomainUpdate,{model:this}),this.event.emit(Q.scaleUpdate,{model:this,value:\`domain\`})}getDomainAfterSpec(){return this._domainAfterSpec}_updateNiceLabelFormatter(e){let t=Math.abs(de(e)-e[0]),n=10**(Math.max(-Math.floor(Math.log10(t)),0)+2);this.niceLabelFormatter=e=>C(+e)?Math.round(+e*n)/n:e}}class Bj extends Aj{constructor(){super(...arguments),this.type=a.cartesianLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new Tx}setAttrFromSpec(){super.setAttrFromSpec(),this.setExtraAttrFromSpec();let e=(this._tickData?.[0])?.getDataView().transformsArr.find((e=>e.type===this.registerTicksTransform()));e&&(e.options=this._tickTransformOption())}initScales(){super.initScales();let e=[0,1];p(this._domain?.min)&&(e[0]=this._domain.min),p(this._domain?.max)&&(e[1]=this._domain.max),this._scale.domain(e)}_tickTransformOption(){return Object.assign(Object.assign({},super._tickTransformOption()),{breakData:this._spec.breaks?.length?()=>this._break:null})}_getUpdateAttribute(e){let t=super._getUpdateAttribute(e);if(!CO(this._orient)&&this._break?.breaks?.length){let{width:e,height:n}=this.getLayoutRect(),r=xO(this._orient),i=r?e:n;t.breaks=this._break.breaks.map((e=>{let{range:t,breakSymbol:n,gap:a=6}=e,o=this.valueToPosition((t[0]+t[1])/2)/i,s;s=hC(a)?Number(a.substring(0,a.length-1))/100:a/i;let c=C(n?.angle)?n.angle:r?60:15;return{range:[o-s/2,o+s/2],breakSymbol:Object.assign(Object.assign({visible:!0},n),{angle:c*Math.PI/180}),rawRange:t}}))}return t}getNewScaleRange(){var e,t;let n=super.getNewScaleRange();return(e=this._spec.breaks)!=null&&e.length&&(t=this._break)!=null&&t.scope&&(n=Dm(this._break.scope).map((e=>n[0]+(de(n)-n[0])*e))),n}computeDomain(e){return this.computeLinearDomain(e)}axisHelper(){let e=super.axisHelper();return e.setExtendDomain=this.setExtendDomain.bind(this),e.valueToPosition=this.valueToPosition.bind(this),e}registerTicksTransform(){let e=\`\${this.type}-ticks\`;return VO(this._option.dataSet,e,Px),e}}Bj.type=a.cartesianLinearAxis,Bj.specKey=\`axes\`,ue(Bj,zj);let Vj=()=>{cD(),fD(),Oj(),J.registerComponent(Bj.type,Bj)};class Hj extends Aj{constructor(){super(...arguments),this.type=a.cartesianBandAxis,this._scale=new rx}computeDomain(e){return this.computeBandDomain(e)}updateScaleRange(){let e=super.updateScaleRange();return this.updateGroupScaleRange(),e}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}axisHelper(){let e=(e=0)=>this._scales[e];return{isContinuous:!1,dataToPosition:this.dataToPosition.bind(this),getScale:e,getBandwidth:(t=0)=>e(t).bandwidth(),getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse,getSpec:()=>this._spec}}registerTicksTransform(){let e=\`\${this.type}-ticks\`;return VO(this._option.dataSet,e,zx),e}transformScaleDomain(){this.updateFixedWholeLength()}updateFixedWholeLength(){if(this._scale){let{bandSize:e,maxBandSize:t,minBandSize:n}=this._getOuterBandSizeFromSpec();if(e&&this._scale.bandwidth(e),t&&this._scale.maxBandwidth(t),n&&this._scale.minBandwidth(n),this._scale.isBandwidthFixed()&&this._spec.autoRegionSize&&(e||t)){let n=Jb(this._scale.domain().length,e??t,this._scale.paddingInner(),this._scale.paddingOuter());[\`bottom\`,\`top\`].includes(this._orient)?this._regions.forEach((e=>e.setMaxWidth(n))):[\`left\`,\`right\`].includes(this._orient)&&this._regions.forEach((e=>e.setMaxHeight(n)))}}}_getOuterBandSizeFromSpec(){let{bandSize:e,maxBandSize:t,minBandSize:n,bandSizeLevel:r=0}=this._spec,{gap:i,extend:a=0}=this._spec.bandSizeExtend??{};r=Math.min(r,this._scales.length-1);for(let o=r;o>0;o--){let s=this._scales[o],c=s.domain(),l=s.paddingInner(),u=s.paddingOuter(),d=e=>{let t=o===r?a:0;return f(i)||o<r?Jb(c.length,e,l,u)+t:(e+(v(i)?e*(Number(i.substring(0,i.length-1))/100):i))*c.length/(this._scales[o-1].paddingInner()+1)+t};p(e)&&(e=d(e)),p(t)&&(t=d(t)),p(n)&&(n=d(n))}return{bandSize:e,maxBandSize:t,minBandSize:n}}}Hj.type=a.cartesianBandAxis,Hj.specKey=\`axes\`,ue(Hj,class{constructor(){this._rawDomainIndex=[]}_initData(){if(this._spec.showAllGroupLayers&&this._scales.length>1)for(let e=0;e<this._scales.length;e++){let t=(this._spec.layers??[])[this._scales.length-1-e]||{};if(!1!==t.visible&&t.tickCount!==0&&t.forceTickCount!==0){let n=this._initTickDataSet(Object.assign(Object.assign({},this._tickTransformOption()),t),e);n.target.addListener(\`change\`,this._forceLayout.bind(this));let r=new Bk(this._option,n);this._tickData.push(r),this._tickDataMap||={},this._tickDataMap[e]=r}}else{let e=this._initTickDataSet(this._tickTransformOption());e.target.addListener(\`change\`,this._forceLayout.bind(this));let t=new Bk(this._option,e);this._tickData=[t],this._tickDataMap={0:t}}}dataToPosition(e,t={}){if(e.length===0||this._scales.length===0)return 0;let{position:n,bandScale:r}=this.getPosition(e);return n+r.bandwidth()*(t.bandPosition??this._spec.bandPosition??this._defaultBandPosition)}valueToPosition(e){return this._scale.scale(e)}updateGroupScaleRange(){let e=this._scale;this._scales.forEach(((t,n)=>{n>0&&(t.range([0,e.bandwidth()]),e=t)}))}getPosition(e){let t=0,n=this._scale;if(this._scales.length===1||e.length===1)t=this.valueToPosition(e[0]);else{let r=Math.min(e.length,this._scales.length);for(let n=0;n<r;n++)t+=this._scales[n].scale(e[n]);n=this._scales[r-1]}return{position:t,bandScale:n}}calcScales(e,t){let{bandPadding:n,paddingInner:r,paddingOuter:i}=this._spec,a=y(n),o=y(r),s=y(i);for(let c=0;c<this._scales.length;c++){let l=a?n[c]:n,u=o?r[c]:r,d=s?i[c]:i;this._scales[c].paddingInner(u??l??e,!0).paddingOuter(d??l??t,!0)}}computeBandDomain(e){if(!e.length)return[];if(e.length===1)return e[0].values;let t=new Set;for(let n=0;n<e.length;n++)for(let r=0;r<e[n].values.length;r++)t.add(e[n].values[r]);return Array.from(t)}updateScaleDomain(){if(!this.isSeriesDataEnable())return;!this._rawDomainIndex?.length&&this._scales.length&&this._updateRawDomain();let e=this._spec.domain;for(let t=0;t<this._scales.length;t++)if(e&&e.length&&t===0)this._scales[t].domain(e);else{let e=this.collectData(t),n=this.computeBandDomain(e);this._scales[t].domain(n.sort(((e,n)=>this._rawDomainIndex[t][e]-this._rawDomainIndex[t][n])))}this.transformScaleDomain(),this.event.emit(Q.scaleDomainUpdate,{model:this}),this.event.emit(Q.scaleUpdate,{model:this,value:\`domain\`})}getLabelItems(e){let t=[],n=[];return this._scales.forEach(((r,i)=>{let a=this._tickDataMap[i],o=a?.getLatestData()?.length,s=o?a.getLatestData().map((e=>e.value)):r.domain();if(s&&s.length)if(n&&n.length){let r=[],i=[];n.forEach((t=>{s.forEach((n=>{let a=P(t).concat(n);if(i.push(a),o){let t=_j(n,this._getNormalizedValue(a,e));r.push(t)}}))})),o&&t.push(r.filter((e=>e.value>=0&&e.value<=1))),n=i}else s.forEach((e=>{n.push(e)})),o&&t.push(a.getLatestData().map((t=>_j(t.value,this._getNormalizedValue([t.value],e)))).filter((e=>e.value>=0&&e.value<=1)))})),t.reverse()}_updateRawDomain(){this._rawDomainIndex=[];let e=this._spec.domain;for(let t=0;t<this._scales.length;t++)if(e&&e.length&&t===0)this._scales[t].domain(e);else{let e=this.collectData(t,!0),n=this.computeBandDomain(e);this._rawDomainIndex[t]={},n.forEach(((e,n)=>this._rawDomainIndex[t][e]=n))}}_clearRawDomain(){this._rawDomainIndex=[]}});let Uj=()=>{cD(),fD(),Oj(),J.registerComponent(Hj.type,Hj)};class Wj extends Bj{constructor(){super(...arguments),this.type=a.cartesianTimeAxis,this._zero=!1,this.effect={scaleUpdate:e=>{this.computeData(e?.value),qS(this._regions,(e=>{xO(this.getOrient())?vj(e.getXAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&e.setXAxisHelper(this.axisHelper()):vj(e.getYAxisHelper(),this.axisHelper(),p(this._seriesUserId)||p(this._seriesIndex))&&e.setYAxisHelper(this.axisHelper())}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}setAttrFromSpec(){super.setAttrFromSpec(),this._tick=q({},this._spec.tick,this._spec.layers?.[0])}_initData(){if(super._initData(),this._spec.layers?.[1]){let e=new Sn(this._option.dataSet,{name:\`\${this.type}_\${this.id}_layer_1_ticks\`}).parse(this._scale,{type:\`scale\`}).transform({type:\`\${this.type}-ticks\`,options:Object.assign(Object.assign({},this._tickTransformOption()),{tickCount:this._spec.layers[1].tickCount,forceTickCount:this._spec.layers[1].forceTickCount,tickStep:this._spec.layers[1].tickStep})},!1);this._layerTickData=new Bk(this._option,e)}}computeData(e){super.computeData(e),this._layerTickData&&(this._layerTickData.getDataView().reRunAllTransform(),this._layerTickData.updateData())}_getLabelFormatMethod(){let e=Ht.getInstance(),t=this._spec.layers?.[1]?.timeFormat||\`%Y%m%d\`,n=(this._spec.layers?.[1]?.timeFormatMode||\`local\`)===\`local\`?e.timeFormat:e.timeUTCFormat,r=this._spec.layers?.[0]?.timeFormat||\`%Y%m%d\`,i=(this._spec.layers?.[0]?.timeFormatMode||\`local\`)===\`local\`?e.timeFormat:e.timeUTCFormat;return(e,a,o,s,c)=>{let l;return l=c===0?i(r,e):n(t,e),this._spec.label?.formatMethod?this._spec.label.formatMethod(l,a):l}}getLabelItems(e){let t=[],n=this.getTickData()?.getLatestData();n&&n.length&&t.push(n.map((t=>_j(t.value,this._getNormalizedValue([t.value],e)))));let r=this._layerTickData?.getLatestData();return r&&r.length&&t.push(r.map((t=>_j(t.value,this._getNormalizedValue([t.value],e))))),t}registerTicksTransform(){let e=\`\${this.type}-ticks\`;return VO(this._option.dataSet,e,Px),e}transformScaleDomain(){}}Wj.type=a.cartesianTimeAxis,Wj.specKey=\`axes\`;class Gj extends Bj{constructor(){super(...arguments),this.type=a.cartesianLogAxis,this._zero=!1,this._scale=new kx}initScales(){super.initScales(),this._scale.base(this._spec.base??10),this._scale.clamp(!0,null,!1)}registerTicksTransform(){let e=\`\${this.type}-ticks\`;return VO(this._option.dataSet,e,Px),e}transformScaleDomain(){}}Gj.type=a.cartesianLogAxis,Gj.specKey=\`axes\`,ue(Gj,zj);class Kj extends Bj{constructor(){super(...arguments),this.type=a.cartesianSymlogAxis,this._zero=!1,this._scale=new Ax}initScales(){super.initScales(),this._scale.constant(this._spec.constant??10)}registerTicksTransform(){let e=\`\${this.type}-ticks\`;return VO(this._option.dataSet,e,Px),e}transformScaleDomain(){}}Kj.type=a.cartesianSymlogAxis,Kj.specKey=\`axes\`,ue(Kj,zj);class qj extends WA{constructor(){super(...arguments),this.type=XS.line,this.transformerConstructor=tj,this._sortDataByAxis=!1}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}initMark(){let e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},t=this._spec.seriesMark??\`line\`;this.initLineMark(e,t===\`line\`),this.initSymbolMark(e,t===\`point\`)}initTooltip(){super.initTooltip();let{group:e,mark:t}=this._tooltipHelper.activeTriggerSet;this._lineMark&&e.add(this._lineMark),this._symbolMark&&(t.add(this._symbolMark),e.add(this._symbolMark))}initMarkStyle(){this.initLineMarkStyle(this._direction),this.initSymbolMarkStyle()}initAnimation(){let e={direction:this.direction},t=this._spec?.animationAppear?.preset;if(this._lineMark.setAnimationConfig(MA(J.getAnimationInKey(\`line\`)?.(e,t),NA(\`line\`,this._spec,this._markAttributeContext))),this._symbolMark){let e=UA(this);this._symbolMark.setAnimationConfig(MA(J.getAnimationInKey(\`scaleInOut\`)?.(),NA(\`point\`,this._spec,this._markAttributeContext),e))}}onLayoutEnd(e){super.onLayoutEnd(e),this.reCompileSampling()}getSeriesStyle(e){let t=this._spec?.seriesMark!==\`point\`;return n=>(t&&n===\`fill\`&&(n=\`stroke\`),this._seriesMark?.getAttribute(n,e)??void 0)}getDefaultShapeType(){return\`circle\`}getActiveMarks(){return[this._lineMark,this._symbolMark]}}qj.type=XS.line,qj.mark=JA,qj.transformerConstructor=tj,ue(qj,qA);class Jj{get dataList(){return this._dataArr}constructor(e){this._dataArr=[],this._dataSet=e}parseData(e){this._dataArr=[];let t=P(e);for(let e=0;e<t.length;e++)this._dataArr.push(qO(t[e],this._dataSet,this._dataArr))}updateData(e,t=!1,n=!0){let r=P(e);return(!t||r.length===this._dataArr.length)&&(this._dataValueForEach(r,((e,t)=>{t.markRunning()})),this._dataValueForEach(r,((e,t)=>{JO(t,e,n)})),!0)}_dataValueForEach(e,t){e.forEach(((e,n)=>{if(e instanceof Sn)return;let r=this.getSeriesData(e.id,n);r&&t(e,r,n)}))}getSeriesData(e,t){if(!this._dataArr.length)return null;if(typeof e==\`string\`){let t=this._dataArr.filter((t=>t.name===e));if(t[0])return t[0];Om(\`no data matches dataId \${e}!\`)}if(typeof t==\`number\`){if(this._dataArr[t])return this._dataArr[t];Om(\`no data matches dataIndex \${t}!\`)}return this._dataArr[0]}}class Yj{constructor(e,t){this._scaleSpecMap=new Map,this._scaleMap=new Map,this._modelScaleSpecMap=new Map,this._markAttributeScaleMap=new Map,this._spec=null,this._chart=null,this.getStatisticalFields=e=>{let t=[];return this._scaleSpecMap.forEach(((n,r)=>{zm(n.domain)&&n.domain.forEach((r=>{r.dataId===e&&r.fields.forEach((e=>{Qw(t,[{key:e,operations:Pb(n.type)?[\`max\`,\`min\`]:[\`values\`]}])}))}))})),this._markAttributeScaleMap.forEach(((n,r)=>{let i=this.getScale(r);n.forEach((n=>{this._getSeriesBySeriesId(n.seriesId).getRawData().name===e&&n.field&&Qw(t,[{key:n.field,operations:Pb(i.type)?[\`max\`,\`min\`]:[\`values\`]}])}))})),t},this._spec=e,this._chart=t,this._setAttrFromSpec()}_createFromSpec(e){if(!e.id)return null;let t=this._scaleMap.get(e.id);return t||=e.type===\`ordinal\`&&e.id===\`color\`?dC(\`colorOrdinal\`):dC(e.type),t?(y(e.range)&&t.range(e.range),y(e.domain)&&(zm(e.domain)||t.domain(e.domain)),e.specified&&t.specified&&t.specified(e.specified),e.clamp&&t.clamp&&t.clamp(e.clamp),t):null}_setAttrFromSpec(){if(!this._spec?.length)return;let e=new Map,t=new Map;this._spec.forEach((n=>{let r=this._createFromSpec(n);r&&(e.set(n.id,r),t.set(n.id,n))})),this._modelScaleSpecMap.forEach((n=>{let r=this._createFromSpec(n);r&&(e.set(n.id,r),t.set(n.id,n))})),this._scaleSpecMap=t,this._scaleMap=e}updateSpec(e){let t={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(ce(e,this._spec))return t;t.change=!0;for(let n=0;n<e.length;n++){let r=e[n],i=this._scaleMap.get(r.id);if(!i)return t.reMake=!0,t;let a=this._spec.find((e=>e.id===r.id));if(!a.id||a.type!==r.type||!ce(a.specified,r.specified))return t.reMake=!0,t;r.range&&!ce(r.range,i.range())&&(i.range(r.range),t.reRender=!0),zm(r.domain)?t.reRender=!0:ce(r.domain,i.domain())||(i.domain(r.domain),t.reRender=!0),this._scaleSpecMap.set(r.id,r)}return this._spec=e,t}registerModelScale(e){let t=this._createFromSpec(e);t&&(this._modelScaleSpecMap.set(e.id,e),this._scaleSpecMap.set(e.id,e),this._scaleMap.set(e.id,t))}removeModelScale(e){this._modelScaleSpecMap.forEach((t=>{e(t)&&(this._modelScaleSpecMap.delete(t.id),this._scaleSpecMap.delete(t.id),this._scaleMap.delete(t.id))}))}getScale(e){return this._scaleMap.get(e)}getScaleSpec(e){return this._scaleSpecMap.get(e)}_getSeriesByRawDataId(e){let t=this._chart.getAllSeries();for(let n=0;n<t.length;n++){let r=t[n];if(r.getRawData().name===e)return r}return null}_getSeriesBySeriesId(e){let t=this._chart.getAllSeries();for(let n=0;n<t.length;n++){let r=t[n];if(r.id===e)return r}return null}updateScaleDomain(e){this._scaleSpecMap.forEach(((t,n)=>{let r=this._scaleMap.get(n);if(!r)return;if(!zm(t.domain))return t.domain&&t.domain.length!==0||r.domain(e),void this._updateMarkScale(n,r,r.domain().slice());let i;i=Pb(t.type)?[null,null]:new Set,t.domain.forEach((e=>{let n=this._getSeriesByRawDataId(e.dataId);if(!n)return;let r=Pb(t.type);e.fields.forEach((e=>{let t=n.getRawDataStatisticsByField(e,r);t&&(r?(f(i[0])?i[0]=t.min:i[0]=Math.min(t.min,i[0]),f(i[1])?i[1]=t.max:i[1]=Math.max(t.max,i[1])):t.values.forEach((e=>{i.add(e)})))}))}));let a=i;Pb(t.type)||(i=Array.from(i)),r.domain(i),this._updateMarkScale(n,r,a)}))}_updateMarkScale(e,t,n){let r=this._markAttributeScaleMap.get(e);r&&r.length!==0&&r.forEach((e=>{if(!e.field||!e.markScale||e.markScale===t)return;if(f(e.changeDomain)||e.changeDomain===\`none\`||f(e.seriesId))return void(Pb(t.type)?e.markScale.domain(n):t.domain(Array.from(n)));let r=this._getSeriesBySeriesId(e.seriesId),i=Pb(t.type),a=r.getRawDataStatisticsByField(e.field,i);if(!A(a))return e.changeDomain===\`expand\`?(i?(n[0]=Math.min(n[0],a.min),n[1]=Math.max(n[1],a.max)):(a.values.forEach((e=>{n.add(e)})),n=Array.from(n)),void e.markScale.domain(n)):void(e.changeDomain!==\`replace\`||(i?e.markScale.domain([a.min,a.max]):e.markScale.domain(a.values)));Pb(t.type)?e.markScale.domain(n):t.domain(Array.from(n))}))}registerMarkAttributeScale(e,t){let n=this._scaleMap.get(e.scale),r=this._markAttributeScaleMap.get(e.scale);r||(r=[],this._markAttributeScaleMap.set(e.scale,r));let i=n;return(f(e.field)||!f(e.changeDomain)&&e.changeDomain!==\`none\`&&!f(t))&&(i=n.clone()),r.push(Object.assign(Object.assign({},e),{seriesId:t,markScale:i})),i}}class Xj extends hk{getSpec(){return this._spec}setSpec(e){this._spec=e}getOption(){return this._option}getLayoutRect(){return this._layoutRect}getViewRect(){return this._viewRect}getLayoutTag(){return this._layoutTag}setLayoutTag(e,t,n=!0){this._layoutTag=e;let r=this.getCompiler();return r!=null&&r.getVGrammarView()&&(r.getVGrammarView().updateLayoutTag(),e&&n&&r.renderNextTick(t)),this._layoutTag}getGlobalScale(){return this._globalScale}getEvent(){return this._event}get chartData(){return this._chartData}constructor(e,t){super(t),this.type=\`chart\`,this.id=Lm(),this._regions=[],this._series=[],this._components=[],this._layoutRect={x:0,y:0,width:500,height:500},this._viewRect={width:500,height:500},this._viewBox={x1:0,y1:0,x2:500,y2:500},this._layoutTag=!0,this._idMap=new Map,this.state={layoutUpdateRank:1},this.padding={top:0,left:0,right:0,bottom:0},this.getAllSeries=()=>this._series??[],this.getRegionsInIndex=e=>e&&e.length!==0?this._regions.filter(((t,n)=>e.includes(n))):[this._regions[0]],this.getAllRegions=()=>this._regions,this.getRegionsInIds=e=>e?this._regions.filter((t=>e.includes(t.id))):[],this.getRegionsInQuerier=e=>e?this._regions.filter(((t,n)=>P(e).some((e=>p(e.regionId)&&e.regionId===t.userId||e.regionIndex===n)))):this._regions,this.getRegionsInUserId=e=>{if(e)return this._regions.find((t=>t.userId===e))},this.getRegionsInUserIdOrIndex=(e,t)=>this.getAllRegions().filter((n=>e?.length?n.userId&&e.includes(n.userId):!t?.length||t.includes(n.getSpecIndex()))),this.getComponents=()=>this._components,this.getSeriesInIndex=e=>e&&e.length!==0?this._series.filter(((t,n)=>e.includes(n))):[this._series[0]],this.getSeriesInIds=e=>e?this._series.filter((t=>e.includes(t.id))):[],this.getSeriesInUserId=e=>{if(e)return this._series.find((t=>t.userId===e))},this.getSeriesInUserIdOrIndex=(e,t)=>this.getAllSeries().filter((n=>e?.length?n.userId&&e.includes(n.userId):!t?.length||t.includes(n.getSpecIndex()))),this.getComponentByIndex=(e,t)=>{let n=this._components.filter((t=>(t.specKey||t.type)===e));if(n&&n.length!==0)return n[t]},this.getComponentsByKey=e=>this._components.filter((t=>(t.specKey||t.type)===e)),this.getComponentByUserId=e=>{let t=this._components.find((t=>t.userId===e));if(t)return t},this.getComponentsByType=e=>this._components.filter((t=>t.type===e)),this._paddingSpec=vC(e.padding??t.getTheme().padding),this._event=new LO(t.eventDispatcher,t.mode),this._dataSet=t.dataSet,this._chartData=new Jj(this._dataSet),this._modelOption=Object.assign(Object.assign({},t),{mode:this._option.mode,map:this._idMap,getChartLayoutRect:()=>this._layoutRect,getChartViewRect:()=>this._viewRect,getChart:()=>this,globalScale:this._globalScale,onError:this._option?.onError,disableTriggerEvent:!0===this._option?.disableTriggerEvent,getSeriesData:this._chartData.getSeriesData.bind(this._chartData)}),this._spec=e}created(e){this._chartData.parseData(this._spec.data),this._createGlobalScale(),this._createBackground(),this._createLayout(),e.forEachRegionInSpec(this._spec,this._createRegion.bind(this)),e.forEachSeriesInSpec(this._spec,this._createSeries.bind(this)),e.forEachComponentInSpec(this._spec,this._createComponent.bind(this),this._option.getSpecInfo())}init(){var e,t;(e=this._beforeInit)==null||e.call(this),this._regions.forEach((e=>e.init({}))),this._series.forEach((e=>e.init({}))),this._components.forEach((e=>e.init({dataSet:this._dataSet}))),this._initEvent(),(t=this._initStack)==null||t.call(this),this.reDataFlow()}reDataFlow(){this._series.forEach((e=>e.getRawData()?.markRunning())),this._series.forEach((e=>e.fillData())),this.updateGlobalScaleDomain()}onResize(e,t,n=!0){this._canvasRect={width:e,height:t},this._updateLayoutRect(this._option.viewBox),this.setLayoutTag(!0,null,n)}updateViewBox(e,t){this._option.viewBox=e,this._updateLayoutRect(e),this.setLayoutTag(!0,null,t)}_createBackground(){let e=this._spec.background;if(!e||typeof e!=\`object\`||p(e.gradient))return;let t=ae(e,[\`x\`,\`y\`,\`width\`,\`height\`,\`x1\`,\`y1\`,\`image\`]);t.background=e.image,this._backgroundMark=J.createMark(\`group\`,\`chart-background\`,{model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._globalScale}),this._backgroundMark.created(),this._backgroundMark.setStyle(Object.assign(Object.assign({},t),{x:()=>this._viewBox.x1,y:()=>this._viewBox.y1,width:()=>this._viewBox.x2-this._viewBox.x1,height:()=>this._viewBox.y2-this._viewBox.y1})),this._backgroundMark.setMarkConfig({zIndex:pk.SeriesGroup-2})}_createRegion(e,n){if(!e)return;let{spec:r}=n,i=t(n,[\`spec\`]),a=new e(r,Object.assign(Object.assign({},this._modelOption),i));a&&(a.created(),this._regions.push(a))}_createSeries(e,n){if(!e)return;let{spec:r}=n,i=t(n,[\`spec\`]),a;if(p(r.regionId)?a=this.getRegionsInUserId(r.regionId):p(r.regionIndex)&&(a=this.getRegionsInIndex([r.regionIndex])[0]),!a&&!(a=this._regions[0]))return;let o=new e(r,Object.assign(Object.assign(Object.assign({},this._modelOption),i),{type:r.type,region:a,globalScale:this._globalScale,sourceDataList:this._chartData.dataList}));o&&(o.created(),this._series.push(o),a.addSeries(o))}getSeriesById(e){return this._series.find((t=>t.id===e))}_createComponent(e,t){let n=e.createComponent(t,Object.assign(Object.assign({},this._modelOption),{type:e.type,getAllRegions:this.getAllRegions,getRegionsInIndex:this.getRegionsInIndex,getRegionsInIds:this.getRegionsInIds,getRegionsInUserIdOrIndex:this.getRegionsInUserIdOrIndex,getAllSeries:this.getAllSeries,getSeriesInIndex:this.getSeriesInIndex,getSeriesInIds:this.getSeriesInIds,getSeriesInUserIdOrIndex:this.getSeriesInUserIdOrIndex,getAllComponents:this.getComponents,getComponentByIndex:this.getComponentByIndex,getComponentByUserId:this.getComponentByUserId,getComponentsByKey:this.getComponentsByKey,getComponentsByType:this.getComponentsByType}));n&&(n.created(),this._components.push(n))}getAllComponents(){return this._components}getAllModels(){return[].concat(this.getAllSeries(),this.getAllComponents(),this.getAllRegions())}getModelInFilter(e){if(v(e))return this.getAllModels().find((t=>t.userId===e));if(d(e))return this.getAllModels().find((t=>e(t)));let t=0;return this.getAllModels().find((n=>{if((n.specKey??n.type)===e.type){if(t===e.index)return!0;t++}return!1}))}_createLayout(){this._updateLayoutRect(this._option.viewBox),this._initLayoutFunc()}setLayout(e){this._option.layout=e,this._initLayoutFunc()}_initLayoutFunc(){if(this._layoutFunc=this._option.layout,!this._layoutFunc){let e=!1;(this._spec.zField||this._spec.series&&this._spec.series.some((e=>e.zField)))&&(e=!0);let t=J.getLayoutInKey(this._spec.layout?.type??(e?\`layout3d\`:\`base\`));if(t){let e=new t(this._spec.layout,{onError:this._option?.onError});this._layoutFunc=e.layoutItems.bind(e)}}}layout(e){var t,n,r,i;if((n=(t=this._option.performanceHook)?.beforeLayoutWithSceneGraph)==null||n.call(t),this.getLayoutTag()){this._event.emit(Q.layoutStart,{chart:this,vchart:this._option.globalInstance}),this.onLayoutStart(e);let t=this.getLayoutElements();this._layoutFunc(this,t,this._layoutRect,this._viewBox),this._event.emit(Q.afterLayout,{elements:t,chart:this}),this.setLayoutTag(!1),this.onLayoutEnd(e),this._event.emit(Q.layoutEnd,{chart:this,vchart:this._option.globalInstance})}(i=(r=this._option.performanceHook)?.afterLayoutWithSceneGraph)==null||i.call(r)}onLayoutStart(e){this.getAllModels().forEach((t=>t.onLayoutStart(this._layoutRect,this._viewRect,e)))}onLayoutEnd(e){this.getAllModels().forEach((t=>{t.modelType!==\`series\`&&t.onLayoutEnd(e)}))}onEvaluateEnd(e){[...this._components,...this._regions,...this._series].forEach((t=>t.onEvaluateEnd(e)))}getLayoutElements(){return this.getAllModels().map((e=>e.layout)).filter((e=>!!e))}getModelById(e){let t=this._idMap.get(e);if(t&&t instanceof Sk)return t}getModelByUserId(e){return this.getSeriesInUserId(e)||this.getRegionsInUserId(e)||this.getComponentByUserId(e)||void 0}getAllMarks(){return Array.from(this._idMap.values()).filter((e=>e&&e instanceof Uk))}getMarkById(e){let t=this._idMap.get(e);if(t&&t instanceof Uk)return t}getMarkByUserName(e){return this.getAllMarks().filter((t=>t.name&&t.name===e))}updateData(e,t,n=!0,r){let i=this._dataSet.getDataView(e);i&&(i.markRunning(),i.parseNewData(t,r)),n&&this.updateGlobalScaleDomain(),this.getAllModels().forEach((e=>e.onDataUpdate()))}updateFullData(e,t=!0){P(e).forEach((e=>{let t=this._dataSet.getDataView(e.id);t&&t.markRunning()})),P(e).forEach((e=>{let t=this._dataSet.getDataView(e.id);t&&JO(t,e,!0)})),t&&this.updateGlobalScaleDomain(),this.getAllModels().forEach((e=>e.onDataUpdate()))}onRender(e){}setCanvasRect(e,t){this._canvasRect={width:e,height:t}}getCanvasRect(){return this._canvasRect||=ik(this._spec,this._option,{width:500,height:500}),this._canvasRect}getSeriesData(e,t){return this._chartData.getSeriesData(e,t)}_transformSpecScale(){var e;let t=this._spec.scales?[...this._spec.scales]:[],n=t.find((e=>e.id===\`color\`)),r=this.getColorScheme();if(!n&&(n={type:\`ordinal\`,id:\`color\`,domain:null,range:null},t.push(n),this._spec.color)){let e=this._spec.color;if(y(e))n.range=e;else{let t=e;Object.prototype.hasOwnProperty.call(t,\`type\`)&&(n.type=t.type),Object.prototype.hasOwnProperty.call(t,\`domain\`)&&(n.domain=t.domain),Object.prototype.hasOwnProperty.call(t,\`range\`)&&(n.range=t.range),Object.prototype.hasOwnProperty.call(t,\`specified\`)&&(n.specified=t.specified),Object.prototype.hasOwnProperty.call(t,\`clamp\`)&&(n.clamp=t.clamp)}}return(e=n.range)!=null&&e.length||(n.range=tC(r),n.rangeTheme=!0),t}_createGlobalScale(){this._globalScale=new Yj(this._transformSpecScale(),this),this._modelOption.globalScale=this._globalScale}updateGlobalScaleDomain(){let e=new Set;this._series.forEach((t=>{let n=t.getSeriesKeys();n&&n.forEach((t=>e.add(t)))}));let t=Array.from(e);this._globalScale.updateScaleDomain(t)}updateGlobalScale(e){ak(e,this._globalScale.updateSpec(this._transformSpecScale()))}updateGlobalScaleTheme(){let e=this._globalScale.getScaleSpec(\`color\`),t=this.getColorScheme();e.rangeTheme&&(e.range=tC(t),this._globalScale.getScale(\`color\`).range(e.range))}_getSpecKeys(e){let t={width:!0,height:!0};return Object.keys(e).filter((e=>!t[e])).sort()}updateSpec(e){let t={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(this.setLayoutTag(!0,null,!1),e.type!==this.type)return t.reMake=!0,t;let n=this._getSpecKeys(this._spec);if(!ce(n,this._getSpecKeys(e)))return t.reMake=!0,t;for(let r=0;r<n.length;r++){let i=n[r];if(y(this._spec[i])&&this._spec[i].length!==P(e[i]).length)return t.reMake=!0,t}let r=this._spec;return this._spec=e,this.updateChartConfig(t,r),t.reMake?t:(this.updateGlobalScale(t),t.reMake?t:(this.updateRegionSpec(t),t.reMake?t:(this.updateComponentSpec(t),t.reMake?t:(this.updateSeriesSpec(t),t.reMake||(this.reInit(),this.updateDataSpec(),this.updateGlobalScaleDomain()),t))))}updateChartConfig(e,t){this._paddingSpec=vC(this._spec.padding??this._option?.getTheme().padding),this._updateLayoutRect(this._viewBox)}updateDataSpec(){this._spec.data&&this._chartData.updateData(this._spec.data,!1,!0)}updateRegionSpec(e){var t;(t=this._spec)!=null&&t.region&&(this._spec.region.length===this._regions.length?this._regions.forEach((t=>{ak(e,t.updateSpec(this._spec.region[t.getSpecIndex()]))})):e.reMake=!0)}updateComponentSpec(e){let t={},n={[a.title]:!0,[a.brush]:!0,[a.mapLabel]:!0,[a.indicator]:!0};for(let r in this._components.forEach((r=>{if(r.type===a.label||r.type===a.totalLabel)return;n[r.type]&&(n[r.type]=!1);let i=r.specKey||r.type,o=this._spec[i]??{};y(o)?(t[i]=t[i]||{specCount:o.length,componentCount:0},t[i].componentCount++,ak(e,r.updateSpec(o[r.getSpecIndex()]??{},o))):ak(e,r.updateSpec(o))})),t)if(Object.prototype.hasOwnProperty.call(t,r)){let n=t[r];n.componentCount!==n.specCount&&(e.reMake=!0)}let r=e=>e&&!1!==e.visible;Object.keys(n).forEach((t=>{if(n[t]){let n=this._spec[t];(y(n)?n.some(r):r(n))&&(e.reMake=!0)}}))}updateSeriesSpec(e){this._spec.series.length===this._series.length?this._series.forEach((t=>{let n=this._spec.series[t.getSpecIndex()];ak(e,t.updateSpec(n))})):e.reMake=!0}getCanvas(){return this.getCompiler()?.getCanvas()??null}_updateLayoutRect(e){let t=this.getCanvasRect();if(e){this._viewBox=e;let{x1:n=0,y1:r=0,x2:i,y2:a}=e;t={width:i-n,height:a-r}}else this._viewBox={x1:0,y1:0,x2:t.width,y2:t.height};this._viewRect=t,this.padding=_C(this._paddingSpec,t,t),this._layoutRect.width=t.width-this.padding.left-this.padding.right,this._layoutRect.height=t.height-this.padding.top-this.padding.bottom,this._layoutRect.x=this.padding.left,this._layoutRect.y=this.padding.top,this._event.emit(Q.layoutRectUpdate,{chart:this})}setCurrentTheme(){this.updateChartConfig({change:!0,reMake:!1},this._spec),this.setLayoutTag(!0,null,!1),this.updateGlobalScaleTheme(),this.reInit()}reInit(){[...this._regions,...this._series,...this._components].forEach((e=>{let t=e.getSpecInfo();t&&t.spec&&e.reInit(t.spec)}))}clear(){this.getAllModels().forEach((e=>e.clear?.call(e)))}compile(){this.compileBackground(),this.compileLayout(),this.compileRegions(),this.compileSeries(),this.compileComponents()}afterCompile(){this.getAllRegions().forEach((e=>{var t;(t=e.afterCompile)==null||t.call(e)})),this.getAllSeries().forEach((e=>{var t;(t=e.afterCompile)==null||t.call(e)})),this.getAllComponents().forEach((e=>{var t;(t=e.afterCompile)==null||t.call(e)}))}compileLayout(){let{width:e,height:t}=this.getCanvasRect();this.getCompiler().setSize(e,t)}compileBackground(){var e;this._backgroundMark&&(this._backgroundMark.compile({context:{model:this}}),(e=this._backgroundMark.getProduct())==null||e.layout((()=>{})))}compileRegions(){var e,t,n,r;(t=(e=this._option.performanceHook)?.beforeRegionCompile)==null||t.call(e),this.getAllRegions().forEach((e=>{e.compile()})),(r=(n=this._option.performanceHook)?.afterRegionCompile)==null||r.call(n)}compileSeries(){var e,t,n,r;(t=(e=this._option.performanceHook)?.beforeSeriesCompile)==null||t.call(e),this.getAllSeries().forEach((e=>{e.compile()})),(r=(n=this._option.performanceHook)?.afterSeriesCompile)==null||r.call(n)}compileComponents(){var e,t,n,r;(t=(e=this._option.performanceHook)?.beforeComponentCompile)==null||t.call(e),this.getAllComponents().forEach((e=>{e.compile()})),(r=(n=this._option.performanceHook)?.afterComponentCompile)==null||r.call(n)}release(){[...this._components,...this._regions,...this._series].forEach((e=>{e.beforeRelease()})),super.release(),this.clear(),[...this._components,...this._regions,...this._series].forEach((e=>{e.release()})),this._components=this._regions=this._series=[],this._spec={},this._dataSet=this._globalScale=this._layoutFunc=null,this._layoutTag=!1,this._idMap.clear()}onLayout(e){let t=e.rootMark;this.layout({group:t,srView:e})}updateState(e,t){let n=this.getAllSeries();for(let r in e){if(A(e[r]))continue;let i=e[r],a={stateValue:r};a=d(i.filter)?Object.assign({filter:i.filter},a):Object.assign(Object.assign({},i.filter),a),i.level&&(a.level=i.level),n.forEach((e=>{e.getMarks().forEach((n=>{n.stateStyle[r]&&(t&&!t(e,n,r)||(n.state.changeStateInfo(a),n.updateMarkState(r)))}))}))}}setSelected(e,t,n){this._setStateInDatum(QO.STATE_SELECTED,!0,e,t,n)}setHovered(e,t,n){this._setStateInDatum(QO.STATE_HOVER,!0,e,t,n)}clearState(e){this.getAllRegions().forEach((t=>{t.interaction.clearEventElement(e,!0),t.interaction.resetInteraction(e,null)}))}clearAllStates(){this.getAllRegions().forEach((e=>{e.interaction.clearAllEventElement(),e.interaction.resetAllInteraction()}))}clearSelected(){this.clearState(QO.STATE_SELECTED)}clearHovered(){this.clearState(QO.STATE_HOVER)}_initEvent(){[Q.dataZoomChange,Q.scrollBarChange].forEach((e=>{this._event.on(e,(({value:e})=>{this._disableMarkAnimation([\`exit\`,\`update\`]);let t=()=>{this._enableMarkAnimation([\`exit\`,\`update\`]),this._event.off(X.AFTER_MARK_RENDER_END,t)};this._event.on(X.AFTER_MARK_RENDER_END,t)}))}))}_enableMarkAnimation(e){this.getAllMarks().forEach((t=>{let n=t.getProduct();n&&n.animate&&n.animate.enableAnimationState(e)}))}_disableMarkAnimation(e){this.getAllMarks().forEach((t=>{let n=t.getProduct();n&&n.animate&&n.animate.disableAnimationState(e)}))}_setStateInDatum(e,t,n,r,i){let a=(n=n?P(n):null)?Object.keys(n[0]):null;this.getRegionsInQuerier(i).forEach((i=>{n?(i.getSeries().forEach((t=>{t.getMarks().forEach((o=>{if(o.getProduct()&&(!r||d(r)&&r(t,o))){let t=o.getProduct().isCollectionMark(),r=o.getProduct().elements,s=[];if(t)s=r.filter((e=>{let t=e.getDatum();n.every(((e,n)=>a.every((r=>e[r]==t[n][r]))))}));else if(n.length>1){let e=n.slice();s=r.filter((t=>{if(e.length===0)return!1;let n=t.getDatum(),r=e.findIndex((e=>a.every((t=>e[t]==n[t]))));return r>=0&&(e.splice(r,1),!0)}))}else{let e=r.find((e=>a.every((t=>n[0][t]==e.getDatum()[t]))));e&&(s=[e])}s.forEach((t=>{i.interaction.startInteraction(e,t)}))}}))})),t&&i.interaction.reverseEventElement(e)):i.interaction.clearEventElement(e,!0)}))}setDimensionIndex(e,t){var n,r;let i=null;Array.from(this._event.getComposedEventMap().values()).forEach((n=>{let{eventType:r,event:a}=n;if(r===FO.dimensionHover||r===FO.dimensionClick){let n=a.dispatch(e,t);n!=null&&n.length&&(i=n)}}));let o=f(e)||!i||i.every((e=>Ib(e.axis.getScale().type)&&f(e.index)));if(!1!==t.tooltip){let e=this.getComponentsByType(a.tooltip)[0];if(e?.getVisible())if(o)(r=(n=e).hideTooltip)==null||r.call(n);else{let n={};i.forEach((e=>{let{axis:t,value:r,data:i}=e,a=t.getOrient()===\`left\`||t.getOrient()===\`right\`;i.forEach((e=>{let t=a?e.series.fieldY[0]:e.series.fieldX[0];n[t]=e.datum?.[0]?.[t]??r}))})),e.showTooltip(n,t.showTooltipOption)}}if(!1!==t.crosshair){let e=this.getComponentsByType(a.cartesianCrosshair)[0];e&&e.clearAxisValue&&e.setAxisValue&&(o?e.hideCrosshair():e.showCrosshair(i))}}getColorScheme(){var e;return(e=this._option).getTheme?.call(e).colorScheme}}let Zj=(e,t)=>{let{regionId:n,regionIndex:r}=e.spec;if(p(n)){let e=P(n);return t.region?.filter((({spec:t})=>e.includes(t.id)))}if(p(r))return P(r).map((e=>t.region?.[e])).filter(p)};class Qj{constructor(e){this._option=e,this.type=e.type,this.seriesType=e.seriesType}initChartSpec(e){return this.transformSpec(e),this.transformModelSpec(e)}transformSpec(e){e.region&&e.region.length!==0||(e.region=[{}]),e.tooltip===void 0&&(e.tooltip={}),p(e.stackInverse)&&e.region.forEach((t=>{!p(t.stackInverse)&&(t.stackInverse=e.stackInverse)})),p(e.stackSort)&&e.region.forEach((t=>{!p(t.stackSort)&&(t.stackSort=e.stackSort)}))}generateTransform(e,t){return(n,r,i)=>{let{spec:a,specPath:o,specInfoPath:s,type:c}=r,l=new n.transformerConstructor(Object.assign(Object.assign({},this._option),{type:c})),u=l.transformSpec(a,e,i),d=Object.assign(Object.assign({},r),u);t?d.theme=l.getTheme(a,e):uw(e,o,u.spec),uw(i,s??o,d)}}transformModelSpec(e){return this.createSpecInfo(e,this.generateTransform(e,!1))}createSpecInfo(e,t){var n;t||=this.generateTransform(e,!0);let r={};return this.forEachRegionInSpec(e,t,r),this.forEachSeriesInSpec(e,t,r),(n=r.series)==null||n.forEach(((e,t)=>{let n=(Zj(e,r)??r.region??[])[0];n&&(n.seriesIndexes||=[],n.seriesIndexes.push(t),e.regionIndexes=n.regionIndexes.slice())})),this.forEachComponentInSpec(e,t,r),Object.values(r.component??{}).forEach((e=>e.forEach(((e,t)=>{if(e&&(e.regionIndexes||=(Zj(e,r)??r.region??[]).map((e=>e.regionIndexes[0])),!e.seriesIndexes)){let t=((e,t)=>{let{seriesId:n,seriesIndex:r}=e.spec;if(p(n)){let e=P(n);return t.series?.filter((({spec:t})=>e.includes(t.id)))}if(p(r))return P(r).map((e=>t.series?.[e])).filter(p)})(e,r);if(t)e.seriesIndexes=t.map((({seriesIndexes:e})=>e[0]));else{let t=new Set;(e.regionIndexes??[]).forEach((e=>{var n;(n=r.region?.[e]?.seriesIndexes)==null||n.forEach((e=>t.add(e)))})),e.seriesIndexes=Array.from(t)}}})))),r}_isValidSeries(e){return!0}_getDefaultSeriesSpec(e,t,n){var r;let i={dataKey:e.dataKey,hover:e.hover,select:e.select,label:e.label,seriesStyle:e.seriesStyle,animation:e.animation??this._option.animation,animationThreshold:e.animationThreshold??(r=this._option).getTheme?.call(r).animationThreshold,animationAppear:e.animationAppear,animationDisappear:e.animationDisappear,animationEnter:e.animationEnter,animationUpdate:e.animationUpdate,animationExit:e.animationExit,animationNormal:e.animationNormal,animationState:e.animationState,extensionMark:e.extensionMark,large:e.large,largeThreshold:e.largeThreshold,progressiveStep:e.progressiveStep,progressiveThreshold:e.progressiveThreshold,background:e.seriesBackground,invalidType:e.invalidType,seriesField:e.seriesField,morph:e.morph,interactions:e.interactions},a=this.seriesType;return a&&(i.type=a,i[a]=e[a]),t&&t.length&&t.forEach((t=>{i[t]=e[t]})),n&&n.length&&n.forEach((t=>{i[t]=e[t]})),i}forEachRegionInSpec(e,t,n){return(e.region??[]).map(((e,r)=>t(J.getRegionInType(\`region\`),{spec:e,specPath:[\`region\`,r],type:\`region\`,regionIndexes:[r]},n)))}forEachSeriesInSpec(e,t,n){return(e.series??[]).map(((e,r)=>t(J.getSeriesInType(e.type),{spec:e,specPath:[\`series\`,r],type:e.type,seriesIndexes:[r]},n)))}forEachComponentInSpec(e,t,n){var r,i;let o=[],s=J.getComponents(),c,l,u,d,f=[];for(let t=0;t<s.length;t++){let{cmp:n,alwaysCheck:r}=s[t];n.type.startsWith(a.cartesianAxis)?c=n:n.type.startsWith(a.polarAxis)?l=n:n.type===a.geoCoordinate?u=n:(r||e[n.specKey??n.type])&&(n.type===a.tooltip?d=n:f.push(n))}let p=!1;if(c){let r=c.getSpecInfo(e,n);r?.length>0&&(p=!0,r.forEach((e=>{let r=J.getComponentInKey(e.type);o.push(t(r,e,n))})))}if(l&&!p){let r=l.getSpecInfo(e,n);r?.length>0&&(p=!0,r.forEach((e=>{let r=J.getComponentInKey(e.type);o.push(t(r,e,n))})))}return u&&!p&&((r=u.getSpecInfo(e,n))==null||r.forEach((e=>{o.push(t(u,e,n))}))),f.forEach((r=>{var i;(i=r.getSpecInfo?r.getSpecInfo(e,n):tA(e,r.specKey,r.type))==null||i.forEach((e=>{o.push(t(r,e,n))}))})),d&&((i=tA(e,d.specKey,d.type))==null||i.forEach((e=>{o.push(t(d,e,n))}))),o}transformSeriesSpec(e){let t=this._getDefaultSeriesSpec(e);e.series&&e.series.length!==0?e.series.forEach((e=>{this._isValidSeries(e.type)&&Object.keys(t).forEach((n=>{n in e||(e[n]=t[n])}))})):e.series=[t]}_findBandAxisBySeries(e,t,n){let r=e?.direction===\`horizontal\`?[\`left\`,\`right\`]:[\`top\`,\`bottom\`];return n.find((n=>{if(!r.includes(n.orient))return!1;if(p(n.seriesId)){if(P(n.seriesId).includes(e?.id))return!0}else if(p(n.seriesIndex)){if(P(n.seriesIndex).includes(t))return!0}else if(n.type===\`band\`)return!0;return!0}))}_applyAxisBandSize(e,t,n){let{barMaxWidth:r,barMinWidth:i,barWidth:a,barGapInGroup:o}=n,s=!1;S(i)?(e.minBandSize=i,s=!0):S(a)?(e.minBandSize=a,s=!0):S(r)&&(e.minBandSize=r,s=!0),s&&(e.bandSizeLevel=Number.MAX_VALUE,e.bandSizeExtend={extend:t,gap:y(o)?o[o.length-1]:o})}}class $j extends Qj{needAxes(){return!0}_isValidSeries(e){return!this.seriesType||e===this.seriesType}_getDefaultSeriesSpec(e,t){return super._getDefaultSeriesSpec(e,[\`xField\`,\`yField\`,\`zField\`,\`direction\`,\`stack\`,\`percent\`,\`stackOffsetSilhouette\`,\`totalLabel\`,\`sortDataByAxis\`],t)}transformSpec(e){super.transformSpec(e),super.transformSeriesSpec(e),this._transformAxisSpec(e)}_setDefaultXAxisSpec(e){return{orient:\`bottom\`}}_setDefaultYAxisSpec(e){return{orient:\`left\`}}_setDefaultZAxisSpec(e){return{orient:\`z\`}}_transformAxisSpec(e){if(this.needAxes()){e.axes||=[];let t={x:!1,y:!1,z:!1};e.axes.forEach((n=>{let{orient:r}=n,i=null;r!==\`top\`&&r!==\`bottom\`||(t.x=!0,i=this._setDefaultXAxisSpec(e)),r!==\`left\`&&r!==\`right\`||(t.y=!0,i=this._setDefaultYAxisSpec(e)),r===\`z\`&&(t.z=!0,i=this._setDefaultZAxisSpec(e)),i&&Object.keys(i).forEach((e=>{f(n[e])&&(n[e]=i[e])})),j(n,\`trimPadding\`)&&q(n,ok(this.type,e))})),t.x||e.axes.push(this._setDefaultXAxisSpec(e)),t.y||e.axes.push(this._setDefaultYAxisSpec(e)),e.zField&&!t.z&&e.axes.push(this._setDefaultZAxisSpec(e))}}}class eM extends $j{_getDefaultSeriesSpec(e){let t=super._getDefaultSeriesSpec(e,[\`point\`,\`line\`,\`activePoint\`,\`sampling\`,\`samplingFactor\`,\`pointDis\`,\`pointDisMul\`,\`markOverlap\`,\`lineLabel\`]);return t.seriesMark=e.seriesMark??\`line\`,t}transformSpec(e){super.transformSpec(e),rk(e)}}let tM=(e,t)=>{let n={nodes:{}},{fields:r}=t;if(!r?.length)return n;let i=r.length-1,a,o,s=n;return e.forEach((e=>{e.latestData&&e.latestData.forEach((e=>{s=n;for(let t=0;t<r.length;t++){let n=r[t],c=e[n];if(f(c))break;s.groupField=n,s.nodes[c]||(t===i?s.nodes[c]={values:[]}:(a={nodes:{}},s.nodes[c]=a)),t===i?(o=s.nodes[c],o.values.push(e)):s=s.nodes[c]}}))})),n};class nM{constructor(e,t){this.stackRegion=({model:e})=>{var t;let n=e.getSeries();if(!n.some((e=>e.getStack())))return;let r=n.some((e=>!!e.getSpec()?.totalLabel?.alwayCalculateTotal||e.getSpec()?.totalLabel?.visible)),i=r||n.some((e=>e.getPercent())),a=n.some((e=>e.getStackOffsetSilhouette())),o=tT(e,!0);for(let t in o)for(let n in o[t].nodes)aT(o[t].nodes[n],e.getStackInverse(),i,r);if(a)for(let e in o)for(let t in o[e].nodes)iT(o[e].nodes[t]);r&&e.getSeries().forEach((e=>{let t=e.getStackData(),n=e.getStackValue(),r=e.getStackValueField();t&&r&&rT(o[n],r)})),(t=this._options)!=null&&t.afterStackRegion&&this._options.afterStackRegion(e,o)},this._chart=e,this._options=t}init(){this._chart.getAllRegions().forEach((e=>{e.event.on(Q.regionSeriesDataFilterOver,{filter:({model:t})=>t?.id===e.id},this.stackRegion)}))}stackAll(){this._chart.getAllRegions().forEach((e=>{this.stackRegion({model:e})}))}}class rM{_beforeInit(){this._dataSet&&VO(this._dataSet,\`stackSplit\`,tM)}_initStack(){this._stack=new nM(this),this._stack.init()}}class iM extends Xj{constructor(){super(...arguments),this.transformerConstructor=eM,this.type=\`line\`,this.seriesType=XS.line}}iM.type=\`line\`,iM.seriesType=XS.line,iM.transformerConstructor=eM,ue(iM,rM);function aM(e,t=!0){return(n,r,i)=>{let a=e.direction===\`vertical\`?e.yField:e.xField,o=n?.[a];return e.direction===\`vertical\`?{overall:t&&e.growFrom(),orient:o>0?\`negative\`:\`positive\`}:{overall:!!t&&e.growFrom(),orient:o>0?\`positive\`:\`negative\`}}}let oM=(e,t=!0)=>({type:e.direction===\`horizontal\`?\`growWidthIn\`:\`growHeightIn\`,options:aM(e,t)}),sM=(e,t=!0)=>({type:e.direction===\`horizontal\`?\`growWidthOut\`:\`growHeightOut\`,options:aM(e,t)}),cM={type:\`fadeIn\`},lM={type:\`growCenterIn\`};function uM(e,t){if(!1===t)return{};switch(t){case\`fadeIn\`:return cM;case\`scaleIn\`:return lM;default:return oM(e)}}class dM extends Uk{constructor(){super(...arguments),this.type=dM.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,lineWidth:0})}}dM.type=\`rect\`;let fM=()=>{J.registerMark(dM.type,dM),iD(),nD.useRegisters([XD,ZD,QD,$D,JD,YD])},pM=Object.assign(Object.assign({},gA),{bar:{name:\`bar\`,type:\`rect\`},barBackground:{name:\`barBackground\`,type:\`rect\`}});function mM(e,t,n){var r;if(e.values.length>0){let i;if(e.sortDatums.length){let a=e.sortDatums;t&&(a=e.sortDatums.slice().reverse());for(let e=0;e<a.length;e++)i=hM(a[e].datum,i,a[e].series,n,(r=a[e].series[n.axisHelper]).getScale?.call(r,0),e===0)}else{let r=e.series;t&&(r=r.slice().reverse()),r.forEach((({s:e,values:r},a)=>{var o;let s=(o=e[n.axisHelper]).getScale?.call(o,0);for(let o=0;o<r.length;o++){let c=r[t?r.length-1-o:o];i=hM(c,i,e,n,s,o===0&&a===0)}}))}}for(let r in e.nodes)mM(e.nodes[r],t,n)}function hM(e,t,n,r,i,a){let o=n.getSpec().barMinHeight,s=n[r.axisHelper].isInverse(),c=fC(n[r.startMethod](e),i),l=fC(n[r.endMethod](e),i);a&&(t=c);let u=Math.abs(c-l);u<o&&(u=o);let d=1;return l<c?d=-1:l===c&&(d=r.isVertical?s?1:-1:s?-1:1),l=t+d*u,e[r.start]=t,e[r.end]=l,l}Object.assign(Object.assign({},gA),{bar3d:{name:\`bar3d\`,type:\`rect3d\`}});class gM extends BA{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(e){this._addMarkLabelSpec(e,\`bar\`)}}class _M extends WA{constructor(){super(...arguments),this.type=XS.bar,this._barMarkName=\`bar\`,this._barMarkType=\`rect\`,this.transformerConstructor=gM,this._bandPosition=0,this._getBarXStart=(e,t,n)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),e[_A]):this._spec.barMinHeight?this._calculateRectPosition(e,!1,n):fC(this._dataToPosX(e),t,n),this._getBarXEnd=(e,t,n)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),e[vA]):fC(this._dataToPosX1(e),t,n),this._getBarYStart=(e,t)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),e[yA]):this._spec.barMinHeight?this._calculateRectPosition(e,!0):fC(this._dataToPosY(e),t),this._getBarYEnd=(e,t)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),e[bA]):fC(this._dataToPosY1(e),t),this._getBarBackgroundXStart=e=>{let t=e.range();return Math.min(t[0],t[t.length-1])},this._getBarBackgroundXEnd=e=>{let t=e.range();return Math.max(t[0],t[t.length-1])},this._getBarBackgroundYStart=e=>{let t=e.range();return Math.min(t[0],t[t.length-1])},this._getBarBackgroundYEnd=e=>{let t=e.range();return Math.max(t[0],t[t.length-1])},this._getBarBackgroundPositionXEncoder=()=>this._barBackgroundPositionXEncoder?.bind(this),this._setBarBackgroundPositionXEncoder=e=>{this._barBackgroundPositionXEncoder=e.bind(this)},this._getBarBackgroundPositionYEncoder=()=>this._barBackgroundPositionYEncoder?.bind(this),this._setBarBackgroundPositionYEncoder=e=>{this._barBackgroundPositionYEncoder=e.bind(this)}}initMark(){this._initBarBackgroundMark(),this._barMark=this._createMark(Object.assign(Object.assign({},_M.mark.bar),{name:this._barMarkName,type:this._barMarkType}),{groupKey:this._seriesField,isSeriesMark:!0,stateSort:this._spec.bar?.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morphElementKey:this.getDimensionField()[0],morph:IA(this._spec,this._barMarkName),setCustomizedShape:this._spec.bar?.customShape})}_initBarBackgroundMark(){this._spec.barBackground&&this._spec.barBackground.visible&&(this._barBackgroundMark=this._createMark(_M.mark.barBackground,{dataView:this._barBackgroundViewData.getDataView(),dataProductId:this._barBackgroundViewData.getProductId(),stateSort:this._spec.barBackground.stateSort},{setCustomizedShape:this._spec.barBackground.customShape,progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold}))}initMarkStyle(){this._barMark&&this.setMarkStyle(this._barMark,{fill:this.getColorAttribute()},\`normal\`,$.Series)}initLabelMarkStyle(e){e&&this.setMarkStyle(e,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}initTooltip(){super.initTooltip();let{mark:e,group:t}=this._tooltipHelper.activeTriggerSet;this._barMark&&(e.add(this._barMark),t.add(this._barMark))}_statisticViewData(){var e;super._statisticViewData();let t=this._spec.barBackground??{};if(!t.visible)return;let n=this._getRelatedComponentSpecInfo(\`axes\`).some((e=>e.type===a.cartesianBandAxis)),r;if(VO(this._option.dataSet,\`addVChartProperty\`,Qk),n)VO(this._option.dataSet,\`dimensionItems\`,([e],{scaleDepth:t})=>{let n=[{}],r=this.getDimensionField(),i=f(t)?r.length:Math.min(r.length,t);for(let t=0;t<i;t++){let i=r[t],a=e.latestData[i]?.values;if(!a?.length)continue;let o=[],s=this._spec.dataKey??Mw;for(let e=0;e<a.length;e++)for(let t=0;t<n.length;t++)o.push(Object.assign(Object.assign({},n[t]),{[i]:a[e],[s]:a[e]}));n=o}return n}),r=new Sn(this._option.dataSet).parse([this._viewDataStatistics],{type:\`dataview\`}).transform({type:\`dimensionItems\`,options:{scaleDepth:f(t.fieldLevel)?void 0:t.fieldLevel+1}},!1).transform({type:\`addVChartProperty\`,options:{beforeCall:mA.bind(this),call:hA}},!1),(e=this._viewDataStatistics)==null||e.target.addListener(\`change\`,r.reRunAllTransform);else{VO(this._option.dataSet,\`dimensionItems\`,([t])=>{let n=[],[r,i]=this.getDimensionContinuousField(),a={};return e.latestData.forEach((e=>{let t=\`\${e[r]}-\${e[i]}\`;a[t]||(a[t]={[r]:e[r],[i]:e[i]},n.push(a[t]))})),n});let e=this.getViewData();r=new Sn(this._option.dataSet).parse([e],{type:\`dataview\`}).transform({type:\`dimensionItems\`},!1).transform({type:\`addVChartProperty\`,options:{beforeCall:mA.bind(this),call:hA}},!1),e?.target.addListener(\`change\`,r.reRunAllTransform)}this._barBackgroundViewData=new pA(this._option,r)}init(e){super.init(e),this.direction===\`vertical\`?this._xAxisHelper?.getScale(0).type===\`band\`?this.initBandRectMarkStyle():this.initLinearRectMarkStyle():this._yAxisHelper?.getScale(0).type===\`band\`?this.initBandRectMarkStyle():this.initLinearRectMarkStyle()}_shouldDoPreCalculate(){let e=this.getRegion();return this.getStack()&&e.getSeries().filter((e=>e.type===this.type&&e.getSpec().barMinHeight)).length}_calculateStackRectPosition(e){let t=this.getRegion();if(t._bar_series_position_calculated)return;let n,r,i,a,o;t._bar_series_position_calculated=!0,e?(n=bA,r=yA,i=\`_dataToPosY1\`,a=\`_dataToPosY\`,o=\`_yAxisHelper\`):(n=vA,r=_A,i=\`_dataToPosX1\`,a=\`_dataToPosX\`,o=\`_xAxisHelper\`);let s=tT(t,!1,(e=>e.type===this.type));for(let c in s)for(let l in s[c].nodes)mM(s[c].nodes[l],t.getStackInverse(),{isVertical:e,start:n,end:r,startMethod:i,endMethod:a,axisHelper:o})}_calculateRectPosition(e,t,n){var r;let i,a,o;t?(i=\`_dataToPosY1\`,a=\`_dataToPosY\`,o=\`_yAxisHelper\`):(i=\`_dataToPosX1\`,a=\`_dataToPosX\`,o=\`_xAxisHelper\`);let s=(r=this[o]).getScale?.call(r,0),c=this[o].isInverse(),l=this._spec.barMinHeight,u=fC(this[i](e),s,n),d=fC(this[a](e),s,n),f=Math.abs(u-d);f<l&&(f=l);let p=1;return d<u?p=-1:d===u&&(p=t?c?1:-1:c?-1:1),u+p*f}_dataToPosX(e){return this.dataToPositionX(e)}_dataToPosX1(e){return this.dataToPositionX1(e)}_dataToPosY(e){return this.dataToPositionY(e)}_dataToPosY1(e){return this.dataToPositionY1(e)}initBandRectMarkStyle(){var e,t;let n=((e=this._xAxisHelper)?.getScale)?.call(e,0),r=((t=this._yAxisHelper)?.getScale)?.call(t,0);this.direction===\`horizontal\`?this.setMarkStyle(this._barMark,{x:e=>this._getBarXStart(e,n),x1:e=>this._getBarXEnd(e,n),y:e=>this._getPosition(this.direction,e),height:()=>this._getBarWidth(this._yAxisHelper),width:()=>{},y1:()=>{}},\`normal\`,$.Series):this.setMarkStyle(this._barMark,{y:e=>this._getBarYStart(e,r),y1:e=>this._getBarYEnd(e,r),x:e=>this._getPosition(this.direction,e),width:()=>this._getBarWidth(this._xAxisHelper),x1:()=>{},height:()=>{}},\`normal\`,$.Series),this._initStackBarMarkStyle(),this._initBandBarBackgroundMarkStyle()}_initStackBarMarkStyle(){var e,t;if(!this._spec.stackCornerRadius)return;let n=((e=this._xAxisHelper)?.getScale)?.call(e,0),r=((t=this._yAxisHelper)?.getScale)?.call(t,0);this._barMark.setMarkConfig({clip:!0,clipPath:()=>{let e=[];return this._forEachStackGroup((t=>{let i=1/0,a=-1/0,o=!1,s=1/0,c=-1/0;t.values.forEach((e=>{let t=e[Iw],n=e[Lw],r=e[Rw],l=e[zw];i=Math.min(i,t,n),a=Math.max(a,t,n),p(r)&&p(l)&&(o=!0,s=Math.min(s,r,l),c=Math.max(c,r,l))}));let l=Object.assign(Object.assign(Object.assign({},t.values[0]),{[Iw]:i,[Lw]:a}),o?{[Rw]:s,[zw]:c}:void 0),u=this.direction===\`horizontal\`?{x:this._getBarXStart(l,n),x1:this._getBarXEnd(l,n),y:this._getPosition(this.direction,l),height:this._getBarWidth(this._yAxisHelper)}:{y:this._getBarYStart(l,r),y1:this._getBarYEnd(l,r),x:this._getPosition(this.direction,l),width:this._getBarWidth(this._xAxisHelper)};e.push(su(Object.assign(Object.assign({},u),{cornerRadius:d(this._spec.stackCornerRadius)?this._spec.stackCornerRadius(u,l,this._markAttributeContext):this._spec.stackCornerRadius,fill:!0})))})),e}})}initLinearRectMarkStyle(){var e,t;let n=((e=this._xAxisHelper)?.getScale)?.call(e,0),r=((t=this._yAxisHelper)?.getScale)?.call(t,0);if(this.direction===\`horizontal\`){let e=p(this._fieldY2)?{y:e=>fC(this._dataToPosY(e),r,!0),y1:e=>fC(this._dataToPosY1(e),r,!0)}:{y:e=>fC(this._dataToPosY(e)-this._getBarWidth(this._yAxisHelper)/2,r,!0),height:e=>this._getBarWidth(this._yAxisHelper)};this.setMarkStyle(this._barMark,Object.assign({x:e=>this._getBarXStart(e,n,!0),x1:e=>this._getBarXEnd(e,n,!0)},e),\`normal\`,$.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign({x:()=>this._getBarBackgroundXStart(n),x1:()=>this._getBarBackgroundXEnd(n)},e),\`normal\`,$.Series)}else{let e=p(this._fieldX2)?{x:e=>fC(this._dataToPosX(e),n,!0),x1:e=>fC(this._dataToPosX1(e),n,!0)}:{x:e=>fC(this._dataToPosX(e)-this._getBarWidth(this._xAxisHelper)/2,n,!0),width:e=>this._getBarWidth(this._xAxisHelper)};this.setMarkStyle(this._barMark,Object.assign(Object.assign({},e),{y:e=>this._getBarYStart(e,r),y1:e=>this._getBarYEnd(e,r)}),\`normal\`,$.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign(Object.assign({},e),{y:()=>this._getBarBackgroundYStart(r),y1:()=>this._getBarBackgroundYEnd(r)}),\`normal\`,$.Series)}}_initBandBarBackgroundMarkStyle(){var e,t;if(!this._barBackgroundMark)return;let n=((e=this._xAxisHelper)?.getScale)?.call(e,0),r=((t=this._yAxisHelper)?.getScale)?.call(t,0),i=this._spec.barBackground??{},a=f(i.fieldLevel)?void 0:i.fieldLevel+1;this.direction===\`horizontal\`?this.setMarkStyle(this._barBackgroundMark,{x:()=>this._getBarBackgroundXStart(n),x1:()=>this._getBarBackgroundXEnd(n),y:e=>this._getPosition(this.direction,e,a,\`barBackground\`),height:()=>this._getBarWidth(this._yAxisHelper,a),width:()=>{},y1:()=>{}},\`normal\`,$.Series):this.setMarkStyle(this._barBackgroundMark,{x:e=>this._getPosition(this.direction,e,a,\`barBackground\`),y:()=>this._getBarBackgroundYStart(r),y1:()=>this._getBarBackgroundYEnd(r),width:()=>this._getBarWidth(this._xAxisHelper,a),x1:()=>{},height:()=>{}},\`normal\`,$.Series)}initAnimation(){let e={yField:this._fieldY[0],xField:this._fieldX[0],direction:this.direction,growFrom:()=>{let e=this.direction===\`horizontal\`?this._xAxisHelper?.getScale(0):this._yAxisHelper.getScale(0);if(e){let t=e.domain(),n=pe(t),r=fe(t);return r<0?e.scale(r):n>0?e.scale(n):e.scale(0)}}},t=this._spec.animationAppear?.preset,n=UA(this);this._barMark.setAnimationConfig(MA(J.getAnimationInKey(\`bar\`)?.(e,t),NA(this._barMarkName,this._spec,this._markAttributeContext),n))}_getBarWidth(e,t){let n=this._groups?this._groups.fields.length:1,r=f(t)?n:Math.min(n,t),i=e.getBandwidth?.call(e,r-1)??6,a=p(this._spec.barWidth)&&r===n,o=p(this._spec.barMinWidth),s=p(this._spec.barMaxWidth),c=i;return a&&(c=bC(this._spec.barWidth,i)),o&&(c=Math.max(c,bC(this._spec.barMinWidth,i))),s&&(c=Math.min(c,bC(this._spec.barMaxWidth,i))),c}_getPosition(e,t,n,r){let i,a,o;e===\`horizontal\`?(i=this.getYAxisHelper(),a=\`height\`,o=r===\`barBackground\`?this.dataToBarBackgroundPositionY.bind(this):this.dataToPositionY.bind(this)):(i=this.getXAxisHelper(),a=\`width\`,o=r===\`barBackground\`?this.dataToBarBackgroundPositionX.bind(this):this.dataToPositionX.bind(this));let s=i.getScale(0),c=this._groups?this._groups.fields.length:1,l=f(n)?c:Math.min(c,n),u=i.getBandwidth?.call(i,l-1)??6,d=l===c?this._barMark.getAttribute(a,t):u;if(l>1&&p(this._spec.barGapInGroup)){let e=this._groups.fields,n=P(this._spec.barGapInGroup),r=0,a=0;for(let o=e.length-1;o>=1;o--){let s=e[o],c=i.getScale(o)?.domain()??[],l=c.length,f=bC(n[o-1]??de(n),u),p=c.indexOf(t[s]);o===e.length-1?(r+=l*d+(l-1)*f,a+=p*(d+f)):(a+=p*(r+f),r+=r+(l-1)*f)}return s.scale(t[e[0]])+i.getBandwidth(0)/2-r/2+a}let m=Pb(s.type||\`band\`);return o(t,l)+.5*(u-d)+(m?-u/2:0)}dataToBarBackgroundPositionX(e,t){return this._dataToPosition(e,this._xAxisHelper,this.fieldX,t,this._getBarBackgroundPositionXEncoder,this._setBarBackgroundPositionXEncoder)}dataToBarBackgroundPositionY(e,t){return this._dataToPosition(e,this._yAxisHelper,this.fieldY,t,this._getBarBackgroundPositionYEncoder,this._setBarBackgroundPositionYEncoder)}onLayoutEnd(e){super.onLayoutEnd(e),this.getRegion()._bar_series_position_calculated=!1,this._spec.sampling&&this.compile()}compile(){if(super.compile(),this._spec.sampling){let{width:e,height:t}=this._region.getLayoutRect(),n=[],r=this._fieldY,i=this._fieldX;n.push({type:\`sampling\`,size:this._direction===\`horizontal\`?t:e,factor:this._spec.samplingFactor,yfield:this._direction===\`horizontal\`?i[0]:r[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(n)}}getDefaultShapeType(){return\`square\`}getActiveMarks(){return[this._barMark]}compileData(){var e;super.compileData(),(e=this._barBackgroundViewData)==null||e.compile()}fillData(){var e;super.fillData(),(e=this._barBackgroundViewData?.getDataView())==null||e.reRunAllTransform()}viewDataUpdate(e){var t,n;super.viewDataUpdate(e),(t=this._barBackgroundViewData?.getDataView())==null||t.reRunAllTransform(),(n=this._barBackgroundViewData)==null||n.updateData()}release(){var e;super.release(),(e=this._barBackgroundViewData)==null||e.release(),this._barBackgroundViewData=null}}_M.type=XS.bar,_M.mark=pM,_M.transformerConstructor=gM;let vM=()=>{CD(),fM(),J.registerAnimation(\`bar\`,((e,t)=>({appear:uM(e,t),enter:oM(e,!1),exit:sM(e,!1),disappear:sM(e)}))),Uj(),Vj(),J.registerSeries(_M.type,_M)};class yM extends $j{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,[\`barWidth\`,\`barMaxWidth\`,\`barMinWidth\`,\`barGapInGroup\`,\`barMinHeight\`,\`sampling\`,\`samplingFactor\`,\`barBackground\`,\`stackCornerRadius\`])}transformSpec(e){super.transformSpec(e),rk(e)}_transformAxisSpec(e){var t;if(super._transformAxisSpec(e),!e.axes)return;let n=e.series.some((e=>e.direction===\`horizontal\`)),r=e.axes.find((e=>e.type===\`band\`))??e.axes.find((e=>(n?[\`left\`,\`right\`]:[\`top\`,\`bottom\`]).includes(e.orient)));if(r&&!r.bandSize&&!r.maxBandSize&&!r.minBandSize&&e.autoBandSize){let n=m(e.autoBandSize)&&(t=e.autoBandSize.extend)!=null?t:0,{barMaxWidth:i,barMinWidth:a,barWidth:o,barGapInGroup:s}=e.series.find((e=>e.type===\`bar\`));this._applyAxisBandSize(r,n,{barMaxWidth:i,barMinWidth:a,barWidth:o,barGapInGroup:s})}}}class bM extends Xj{constructor(){super(...arguments),this.transformerConstructor=yM,this.type=\`bar\`,this.seriesType=XS.bar}}bM.type=\`bar\`,bM.seriesType=XS.bar,bM.transformerConstructor=yM,ue(bM,rM);class xM extends YA{constructor(){super(...arguments),this.type=xM.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}_getIgnoreAttributes(){return[]}}xM.type=\`area\`;let SM=()=>{J.registerMark(xM.type,xM),gy(),ny(),Z.registerGraphic(Y.area,Tu),xS(),gS(),AA()};class CM extends cA{constructor(){super(...arguments),this._getSeriesStyle=(e,t,n)=>{for(let n of P(t)){let t=this.series.getSeriesStyle(e)?.(n);if(!1!==t||n!==\`fill\`&&n!==\`stroke\`||(t=n===\`fill\`?this.series.getSeriesStyle(e)?.(\`stroke\`)?.[0]:this.series.getSeriesStyle(e)?.(\`fill\`)),p(t))return t}return n}}}let wM=Object.assign(Object.assign(Object.assign({},gA),KA),{area:{name:\`area\`,type:\`area\`}}),TM=()=>{J.registerAnimation(\`area\`,OA),kA(),DA()};class EM extends tj{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(e){let t=!1!==e.point?.visible&&!1!==e.point?.style?.visible;this._addMarkLabelSpec(e,(e=>{let n=e.position===\`inside-middle\`;return!t||n?\`area\`:\`point\`})),this._addMarkLabelSpec(e,\`area\`,\`areaLabel\`,\`initLineLabelMarkStyle\`,void 0,!0)}_transformSpecAfterMergingTheme(e,t,n){var r;super._transformSpecAfterMergingTheme(e,t,n);let{area:i={},line:a={},seriesMark:o}=e,s=!1!==i.visible&&!1!==i.style?.visible,c=!1!==a.visible&&!1!==a.style?.visible;i.support3d=!(!i.support3d&&!a.support3d),i.zIndex=p(i.zIndex)||p(a.zIndex)?Math.max(i.zIndex??0,a.zIndex??0):void 0,i.style&&delete i.style.stroke,i.state&&Object.keys(i.state).forEach((e=>{\`style\`in i.state[e]?delete i.state[e].style.stroke:delete i.state[e].stroke}));let l=i,u=a;(o===\`line\`||c&&!s)&&(l=a,u=i),i.style=q({},u.style,l.style),i.state=q({},u.state,l.state),!1===i.interactive&&(i.style.fillPickable=!1),!1===a.interactive&&(a.style.strokePickable=!1),i.interactive=!(!i.interactive&&(r=a.interactive)!=null&&!r),e.area=i,e.line=a}}class DM extends WA{constructor(){super(...arguments),this.type=XS.area,this.transformerConstructor=EM,this._sortDataByAxis=!1}initMark(){let e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},t=this._spec.area||{},n=this._spec.seriesMark??\`area\`,r=this._isAreaVisible()||this._isLineVisible();this._areaMark=this._createMark(DM.mark.area,{groupKey:this._seriesField,isSeriesMark:r&&n!==\`point\`,stateSort:t.stateSort},Object.assign(Object.assign({},e),{morphElementKey:this.getDimensionField()[0],setCustomizedShape:t.customShape})),this.initSymbolMark(e,n===\`point\`)}initMarkStyle(){this.initAreaMarkStyle(),this.initSymbolMarkStyle()}initAreaMarkStyle(){let e=this.getSpec().area?.style?.curveType??this.getSpec().line?.style?.curveType,t=e===GA?this._direction===\`horizontal\`?\`monotoneY\`:\`monotoneX\`:e,n=this._areaMark;if(n){let e=this._isAreaVisible(),r=this._isLineVisible();e||r?n.setVisible(!0):n.setVisible(!1),this._direction===\`horizontal\`?this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:e=>{var t;return fC(this.dataToPositionX1(e),((t=this._xAxisHelper)?.getScale)?.call(t,0))},y:this.dataToPositionY.bind(this),y1:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,orient:this._direction},\`normal\`,$.Series):this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:this.dataToPositionX.bind(this),y1:e=>{var t;return fC(this.dataToPositionY1(e),((t=this._yAxisHelper)?.getScale)?.call(t,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},\`normal\`,$.Series),this.setMarkStyle(n,{fill:!!e&&this.getColorAttribute(),stroke:!!r&&this.getColorAttribute()},\`normal\`,$.Series),this._invalidType!==\`zero\`&&this.setMarkStyle(n,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},\`normal\`,$.Series),this.getStack()&&this.setMarkStyle(n,{zIndex:e=>-e[Lw]},\`normal\`,$.Series),this.setMarkStyle(n,{curveType:t},\`normal\`,$.Built_In),Object.keys(n.stateStyle).forEach((e=>{n.stateStyle[e].stroke&&n.setPostProcess(\`stroke\`,(e=>[e,!1,!1,!1]),e)}))}}initAnimation(){let e={direction:this.direction},t=this._spec.animationAppear?.preset;if(this._lineMark&&this._lineMark.setAnimationConfig(MA(J.getAnimationInKey(\`line\`)?.(e,t),NA(\`line\`,this._spec,this._markAttributeContext))),this._areaMark&&this._areaMark.setAnimationConfig(MA(J.getAnimationInKey(\`area\`)?.(e,t),NA(\`area\`,this._spec,this._markAttributeContext))),this._symbolMark){let e=UA(this);this._symbolMark.setAnimationConfig(MA(J.getAnimationInKey(\`scaleInOut\`)?.(),NA(\`point\`,this._spec,this._markAttributeContext),e))}}_isAreaVisible(){let e=this._spec.area||{};return!1!==e.visible&&!1!==e.style?.visible}_isLineVisible(){let e=this._spec.line||{};return!1!==e.visible&&!1!==e.style?.visible}initTooltip(){this._tooltipHelper=new CM(this);let{group:e,mark:t}=this._tooltipHelper.activeTriggerSet;this._areaMark&&e.add(this._areaMark),this._lineMark&&e.add(this._lineMark),this._symbolMark&&(t.add(this._symbolMark),e.add(this._symbolMark))}viewDataStatisticsUpdate(e){super.viewDataStatisticsUpdate(e),this.encodeDefined(this._areaMark,\`defined\`)}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}getDefaultShapeType(){return\`square\`}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}onLayoutEnd(e){super.onLayoutEnd(e),this.reCompileSampling()}getSeriesStyle(e){return t=>{let n=this._spec.seriesMark??\`area\`,r=this._seriesMark?.getAttribute(t,e)??void 0;return t!==\`fill\`||r&&n!==\`line\`||(t=\`stroke\`,r=this._seriesMark?.getAttribute(t,e)??void 0),t===\`stroke\`&&y(r)?r[0]:r}}}DM.type=XS.area,DM.mark=wM,DM.transformerConstructor=EM,ue(DM,qA);class OM extends $j{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,[\`point\`,\`line\`,\`area\`,\`seriesMark\`,\`activePoint\`,\`sampling\`,\`samplingFactor\`,\`pointDis\`,\`pointDisMul\`,\`markOverlap\`,\`areaLabel\`])}transformSpec(e){super.transformSpec(e),rk(e)}}class kM extends Xj{constructor(){super(...arguments),this.transformerConstructor=OM,this.type=\`area\`,this.seriesType=XS.area}}kM.type=\`area\`,kM.seriesType=XS.area,kM.transformerConstructor=OM,ue(kM,rM);class AM extends VA{constructor(){super(...arguments),this.coordinate=\`polar\`,this._outerRadius=.6,this._innerRadius=0,this._angleField=[],this._radiusField=[],this._sortDataByAxis=!1}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}getAngleField(){return this._angleField}setAngleField(e){return this._angleField=p(e)?P(e):[],this._angleField}getRadiusField(){return this._radiusField}setRadiusField(e){return this._radiusField=p(e)?P(e):[],this._radiusField}get innerRadiusField(){return this._innerRadiusField}setInnerRadiusField(e){return this._innerRadiusField=P(e),this._innerRadiusField}get radiusScale(){return this._radiusScale}setRadiusScale(e){return this._radiusScale=e,e}get angleScale(){return this._angleScale}setAngleScale(e){return this._angleScale=e,e}get angleAxisHelper(){return this._angleAxisHelper}set angleAxisHelper(e){this._angleAxisHelper=e,this.onAngleAxisHelperUpdate()}get radiusAxisHelper(){return this._radiusAxisHelper}set radiusAxisHelper(e){this._radiusAxisHelper=e,this.onRadiusAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getCenter=()=>this.angleAxisHelper.center(),this._markAttributeContext.getLayoutRadius=()=>this._computeLayoutRadius()}valueToPosition(e,t){if(f(e)||f(t)||!this.angleAxisHelper||!this.radiusAxisHelper)return{x:NaN,y:NaN};let n=this.radiusAxisHelper.dataToPosition(P(t));if(n<0){if(this._invalidType===\`break\`||this._invalidType===\`link\`)return{x:NaN,y:NaN};if(this._invalidType===\`zero\`)return this.angleAxisHelper.center()}let r=this.angleAxisHelper.dataToPosition(P(e));return this.angleAxisHelper.coordToPoint({angle:r,radius:n})}dataToPosition(e,t){return e&&this.angleAxisHelper&&this.radiusAxisHelper?t&&!this.isDatumInViewData(e)?null:this.valueToPosition(this.getDatumPositionValues(e,this._angleField),this.getDatumPositionValues(e,this._radiusField)):null}dataToPositionX(e){return this.dataToPosition(e)?.x}dataToPositionY(e){return this.dataToPosition(e)?.y}dataToPositionZ(e){return 0}positionToData(e){}radiusToData(e){}angleToData(e){}getStatisticFields(){var e,t;let n=[];return(e=this.radiusAxisHelper)!=null&&e.getScale&&this._radiusField.forEach((e=>{let t={key:e,operations:[]};Pb(this.radiusAxisHelper.getScale(0).type)?t.operations=[\`max\`,\`min\`]:t.operations=[\`values\`],n.push(t)})),(t=this.angleAxisHelper)!=null&&t.getScale&&this._angleField.forEach((e=>{let t={key:e,operations:[]};Pb(this.angleAxisHelper.getScale(0).type)?t.operations=[\`max\`,\`min\`]:t.operations=[\`values\`],n.push(t)})),n}setAttrFromSpec(){super.setAttrFromSpec(),p(this._spec.outerRadius)&&(this._outerRadius=this._spec.outerRadius),p(this._spec.radius)&&(this._outerRadius=this._spec.radius),p(this._spec.innerRadius)&&(this._innerRadius=this._spec.innerRadius),p(this._spec.sortDataByAxis)&&(this._sortDataByAxis=!0===this._spec.sortDataByAxis)}onRadiusAxisHelperUpdate(){this.onMarkPositionUpdate()}onAngleAxisHelperUpdate(){this.onMarkPositionUpdate()}afterInitMark(){super.afterInitMark()}_computeLayoutRadius(){let e=this._angleAxisHelper||this._radiusAxisHelper;if(e)return e.layoutRadius();let{width:t,height:n}=this._region.getLayoutRect();return Math.min(t/2,n/2)}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(Q.scaleDomainUpdate,{filter:e=>e.model.id===this._angleAxisHelper?.getAxisId()},(()=>{this._sortDataInAxisDomain()}))}_sortDataInAxisDomain(){var e;(e=this.getViewData()?.latestData)!=null&&e.length&&HA(this.angleAxisHelper,this._angleField[0],this.getViewData().latestData)}getInvalidCheckFields(){let e=[];return this.angleAxisHelper.isContinuous&&this._angleField.forEach((t=>{e.push(t)})),this.radiusAxisHelper.isContinuous&&this._radiusField.forEach((t=>{e.push(t)})),e}}function jM(e){return Rm(e)?Number.parseFloat(e):0}let MM=(e,t)=>{let{asStartAngle:n,asEndAngle:r,asMiddleAngle:i,asRadian:a,asRatio:o,asQuadrant:s,asK:c,showAllZero:l,supportNegative:u,showEmptyCircle:d}=t,f=t.angleField(),p=t.startAngle(),m=t.endAngle(),h=t.minAngle(),g=e.map((e=>Object.assign({},e)));if(!g||g.length===0||!l&&d&&NM(g,f,u))return g;let _=(e,t,o)=>{e[n]=t,e[r]=t+o,e[i]=t+o/2,e[a]=o,e[s]=ot(t+o/2)},v=0,y=-1/0,b=!0;for(let e=0;e<g.length;e++){let t=u?Math.abs(jM(g[e][f])):jM(g[e][f]);v+=t,y=Math.max(t,y),b&&t!==0&&(b=!1),g[e][AC]=t}let x=g.map((e=>Number(e[f]))),S=m-p,C=p,w=S,T=0,E=function(e,t=2){let n=e.reduce(((e,t)=>e+(isNaN(t)?0:t)),0);if(n===0)return 0;let r=10**t,i=e.map((e=>(isNaN(e)?0:e)/n*r*100)),a=100*r,o=i.map((e=>Math.floor(e))),s=o.reduce(((e,t)=>e+t),0),c=i.map(((e,t)=>e-o[t]));for(;s<a;){let e=-1/0,t=null;for(let n=0;n<c.length;n++)c[n]>e&&(e=c[n],t=n);++o[t],c[t]=0,++s}return o.map((e=>e/r))}(x);if(g.forEach(((e,t)=>{let n=e[AC],r=v?n/v:0,i=r*S;i<h?(i=h,w-=h):T+=n;let a=C,s=C+i;e[o]=r,e[c]=y?n/y:0,e._percent_=E[t],_(e,a,i),C=s})),w<S)if(w<=.001){let e=S/g.length;g.forEach(((t,n)=>{_(t,p+n*e,e)}))}else{let e=w/T;C=p,g.forEach((t=>{let n=t[a]===h?h:t[AC]*e;_(t,C,n),C+=n}))}if(v!==0&&(g[g.length-1][r]=m),b&&l){let e=S/g.length;g.forEach(((t,n)=>{_(t,p+n*e,e)}))}return g},NM=(e,t,n)=>!!f(e)||e.length===0||!!e.every((e=>jM(e[t])===0))||!n&&e.reduce(((e,n)=>e+jM(n[t])),0)===0;function PM(e,t,n){return(r,i,a)=>t?e.growField===\`radius\`?{overall:0}:{overall:e.growFrom(r,i,n)}:{overall:!1}}let FM=e=>({type:e.growField===\`radius\`?\`growRadiusIn\`:\`growAngleIn\`,options:PM(e,!0,XO.appear)}),IM={type:\`fadeIn\`},LM=e=>({type:e.growField===\`radius\`?\`growRadiusIn\`:\`growAngleIn\`,easing:\`linear\`,options:PM(e,!0,XO.enter)}),RM=e=>({type:e.growField===\`radius\`?\`growRadiusOut\`:\`growAngleOut\`,easing:\`linear\`,options:PM(e,!0,XO.exit)}),zM=e=>({type:e.growField===\`radius\`?\`growRadiusOut\`:\`growAngleOut\`,options:PM(e,!0,XO.exit)});function BM(e,t){if(!1===t)return{};switch(t){case\`fadeIn\`:return IM;case\`growRadius\`:return FM(Object.assign(Object.assign({},e),{growField:\`radius\`}));default:return FM(Object.assign(Object.assign({},e),{growField:\`angle\`}))}}class VM extends Uk{constructor(e,t){super(e,t),this.type=HM.type,this._unCompileChannel={centerOffset:!0,radiusOffset:!0},this.computeOuterRadius=(e,t,n=\`normal\`,r,i)=>i+(this.getAttribute(\`radiusOffset\`,t,n,r)??0),this.computeCenter=(e,t,n=\`normal\`,r,i)=>rt({x:0,y:0},this.getAttribute(\`centerOffset\`,t,n,r),t[FC])[e]+i,this._computeExChannel.x=this.computeCenter,this._computeExChannel.y=this.computeCenter,this._computeExChannel.outerRadius=this.computeOuterRadius,this._extensionChannel.centerOffset=[\`x\`,\`y\`],this._extensionChannel.radiusOffset=[\`outerRadius\`]}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{startAngle:0,endAngle:0,outerRadius:0,innerRadius:0,cornerRadius:0,lineWidth:0,innerPadding:0,outerPadding:0})}}class HM extends VM{constructor(){super(...arguments),this.type=HM.type}}HM.type=\`arc\`;let UM=()=>{rD(),nD.useRegisters([cO,lO,oO,sO]),J.registerMark(HM.type,HM)},WM=Object.assign(Object.assign({},gA),{pie:{name:\`pie\`,type:\`arc\`},labelLine:{name:\`labelLine\`,type:\`path\`}});Object.assign(Object.assign({},gA),{pie3d:{name:\`pie3d\`,type:\`arc3d\`},labelLine:{name:\`labelLine\`,type:\`path\`}});class GM extends BA{_transformLabelSpec(e){this._addMarkLabelSpec(e,\`pie\`)}_mergeThemeToSpec(e,t){let n=this._theme,r=e;if(this._shouldMergeThemeToSpec()){let n=this._getDefaultSpecFromChart(t);r=q({},this._theme,n,e);let i=(e,t)=>q({},e===\`inside\`||e===\`inside-center\`?this._theme.innerLabel:this._theme.outerLabel,t);y(r.label)?r.label=r.label.map((e=>i(e.position,e))):r.label=i(r.label.position,r.label)}return{spec:r,theme:n}}_getDefaultSpecFromChart(e){let t=super._getDefaultSpecFromChart(e)??{},{centerX:n,centerY:r}=e;return p(n)&&(t.centerX=n),p(r)&&(t.centerY=r),Object.keys(t).length>0?t:void 0}}let KM=\`\${K}_LABEL_VISIBLE\`;class qM extends AM{constructor(){super(...arguments),this.transformerConstructor=GM,this._pieMarkName=\`pie\`,this._pieMarkType=\`arc\`,this.getCenter=()=>{let e=this._region.getLayoutRect();return{x:gC(this._spec?.centerX,e.width,e,e.width/2),y:gC(this._spec?.centerY,e.height,e,e.height/2)}},this._startAngle=RC,this._endAngle=zC,this._pieMark=null,this._labelMark=null,this._labelLineMark=null,this._emptyArcMark=null,this.dataToCentralPosition=e=>{let t=e[FC];if(f(t))return null;let n=this.computeDatumRadius(e),r=this.computeDatumInnerRadius(e);return rt(this.computeCenter(e),(n+r)/2,t)}}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.getCenter().x,y:()=>this.getCenter().y}),this._markAttributeContext.startAngleScale=e=>this.startAngleScale(e),this._markAttributeContext.endAngleScale=e=>this.endAngleScale(e)}setAttrFromSpec(){var e,t,n;super.setAttrFromSpec(),this._centerOffset=this._spec.centerOffset??0,this._cornerRadius=this._spec.cornerRadius??0;let r=function(e,t){let n=0,r=2*Math.PI,i=p(e),a=p(t);for(i||a?a?i?(n=e,r=t):(n=t-2*Math.PI,r=t):(n=e,r=e+2*Math.PI):(n=0,r=2*Math.PI);r<=n;)r+=2*Math.PI;for(;n>2*Math.PI;)n-=2*Math.PI,r-=2*Math.PI;for(;r<0;)n+=2*Math.PI,r+=2*Math.PI;return{startAngle:n,endAngle:r}}(p(this._spec.startAngle)?tt(this._spec.startAngle):this._startAngle,p(this._spec.endAngle)?tt(this._spec.endAngle):this._endAngle);this._startAngle=r.startAngle,this._endAngle=r.endAngle,this._padAngle=p(this._spec.padAngle)?tt(this._spec.padAngle):0,this.setAngleField(this._spec.valueField||this._spec.angleField),this._spec.categoryField&&this.setSeriesField(this._spec.categoryField),this._radiusField=[],this._specAngleField=this._angleField.slice(),this._specRadiusField=[],this._showEmptyCircle=(e=this._spec.emptyPlaceholder?.showEmptyCircle)!=null&&e,this._showAllZero=(t=this._spec.showAllZero)!=null&&t,this._supportNegative=(n=this._spec.supportNegative)!=null&&n}initData(){super.initData();let e=this.getViewData();if(!e)return;VO(this._dataSet,\`pie\`,MM),e.transform({type:\`pie\`,options:{angleField:()=>this._angleField[0],startAngle:()=>this._startAngle,endAngle:()=>this._endAngle,minAngle:()=>p(this._spec.minAngle)?tt(this._spec.minAngle):0,asStartAngle:MC,asEndAngle:NC,asRatio:jC,asMiddleAngle:FC,asRadian:LC,asQuadrant:IC,asK:PC,showAllZero:this._showAllZero,supportNegative:this._supportNegative,showEmptyCircle:this._showEmptyCircle}},!1);let t=new Sn(this._dataSet,{name:\`\${K}_series_\${this.id}_viewDataLabel\`});t.parse([this.getViewData()],{type:\`dataview\`}),this._viewDataLabel=new pA(this._option,t)}compileData(){var e;super.compileData(),(e=this._viewDataLabel)==null||e.compile()}initMark(){this._pieMark=this._createMark(Object.assign(Object.assign({},qM.mark.pie),{name:this._pieMarkName,type:this._pieMarkType}),{key:Mw,groupKey:this._seriesField,skipBeforeLayouted:!0,isSeriesMark:!0,stateSort:this._spec.pie?.stateSort},{setCustomizedShape:this._spec.pie?.customShape,morph:IA(this._spec,this._pieMarkName),morphElementKey:this._seriesField}),this._showEmptyCircle&&(this._emptyArcMark=this._createMark({name:\`emptyCircle\`,type:\`arc\`},{dataView:!1}))}startAngleScale(e){return JS(MC)(e)}endAngleScale(e){return JS(NC)(e)}_computeLayoutRadius(){return((e,t,n,r)=>{let i=e();if(S(i))return i;if(d(i))return i(t(),n());let a=t();if(i===\`auto\`&&a.width>0&&a.height>0){let{startAngle:e=0,endAngle:t=2*Math.PI}=r();return at(a,n(),e,t)}return Math.min(a.width/2,a.height/2)})((()=>this._spec.layoutRadius),this.getLayoutRect,this.getCenter,(()=>({startAngle:this._startAngle,endAngle:this._endAngle})))}initMarkStyle(){let e={x:()=>this.getCenter().x,y:()=>this.getCenter().y,fill:this.getColorAttribute(),outerRadius:pC(this._outerRadius)?this._outerRadius:()=>this._computeLayoutRadius()*this._outerRadius,innerRadius:pC(this._innerRadius)?this._innerRadius:()=>this._computeLayoutRadius()*this._innerRadius,cornerRadius:()=>this._computeLayoutRadius()*this._cornerRadius,startAngle:e=>this.startAngleScale(e),endAngle:e=>this.endAngleScale(e),padAngle:this._padAngle,centerOffset:this._centerOffset},t=this._pieMark;t&&this.setMarkStyle(t,e,\`normal\`,$.Series);let n=this._emptyArcMark;n&&this.setMarkStyle(n,Object.assign(Object.assign({},e),{visible:()=>{let e=this.getAngleField()[0];return NM(this.getViewData().latestData,e,this._supportNegative)}}),\`normal\`,$.Series)}initInteraction(){this._parseInteractionConfig(this._pieMark?[this._pieMark]:[])}initTooltip(){super.initTooltip(),this._pieMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pieMark)}initMarkStyleWithSpec(e,t,n){if(super.initMarkStyleWithSpec(e,t,n),e.name===this._pieMarkName){let t=this.getSpec()[e.name];if(t)for(let n in t.state||{})this.setMarkStyle(e,this.generateRadiusStyle(t.state[n]),n,$.User_Mark)}e.name===\`emptyCircle\`&&this.setMarkStyle(e,this.generateRadiusStyle(t.style),\`normal\`,$.User_Mark)}initLabelMarkStyle(e){e&&this.setMarkStyle(e,{visible:JS(KM).bind(this),text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:this.dataToPositionZ.bind(this)})}afterInitMark(){super.afterInitMark()}initEvent(){var e;super.initEvent(),(e=this._viewDataLabel.getDataView())==null||e.target.addListener(\`change\`,this.viewDataLabelUpdate.bind(this))}initGroups(){}onLayoutEnd(e){this._viewDataLabel.getDataView().reRunAllTransform(),this.onMarkPositionUpdate(),super.onLayoutEnd(e)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return this._specAngleField}viewDataLabelUpdate(){this.event.emit(Q.viewDataLabelUpdate,{model:this}),this._viewDataLabel.updateData()}generateRadiusStyle(e){if(!e)return;let t={};return e.outerRadius&&(t.outerRadius=()=>this._computeLayoutRadius()*e.outerRadius),e.innerRadius&&(t.innerRadius=()=>this._computeLayoutRadius()*e.innerRadius),e.cornerRadius&&(t.cornerRadius=()=>this._computeLayoutRadius()*e.cornerRadius),t}computeCenter(e){return{x:this._pieMark.getAttribute(\`x\`,e,\`normal\`),y:this._pieMark.getAttribute(\`y\`,e,\`normal\`)}}getRadius(e=\`normal\`){return(e===\`normal\`?this.getSpec()[this._pieMark?.name||\`pie\`]?.style?.outerRadius:this.getSpec()[this._pieMark?.name||\`pie\`]?.state?.[e]?.outerRadius)??this._outerRadius}getInnerRadius(e=\`normal\`){return(e===\`normal\`?this.getSpec()[this._pieMark?.name||\`pie\`]?.style?.innerRadius:this.getSpec()[this._pieMark?.name||\`pie\`]?.state?.[e]?.innerRadius)??this._innerRadius}computeRadius(e,t){return this._computeLayoutRadius()*e*(f(t)?1:t)+this._centerOffset}computeDatumRadius(e,t){return this._computeLayoutRadius()*this.getRadius(t)+this._centerOffset}_compareSpec(e,t,n){n??={data:!0};let r=[\`centerX\`,\`centerY\`,\`centerOffset\`,\`radius\`,\`innerRadius\`,\`cornerRadius\`,\`startAngle\`,\`endAngle\`,\`padAngle\`];r.forEach((e=>{n[e]=!0}));let i=super._compareSpec(e,t,n);return e??={},r.some((n=>e[n]!==t[n]))&&(i.reRender=!0,i.change=!0),i}computeDatumInnerRadius(e,t){return this._computeLayoutRadius()*this.getInnerRadius(t)+this._centerOffset}dataToPosition(e,t){let n=e[FC];if(f(n)||t&&!this.isDatumInViewData(e))return null;let r=this.computeDatumRadius(e);return rt(this.computeCenter(e),r,n)}initAnimation(){let e={growFrom:(e,t,n)=>{if(n===XO.appear)return this._startAngle;if(n===XO.disappear)return this._endAngle;let r=[XO.disappear,XO.exit],i=t.mark.elements,a=e?.[jw];if(i.find((e=>e.data[0]?.[jw]<a))===void 0)return this._startAngle;if(i.find((e=>e.data[0]?.[jw]>a))===void 0)return this._endAngle;let o=[...i].reverse().find((e=>e.data[0]?.[jw]<a));return r.includes(n)?o?.getNextGraphicAttributes()?.endAngle:o?.getGraphicAttribute(\`endAngle\`,!0)}},t=this._spec.animationAppear?.preset;if(this._pieMark){let n=MA(J.getAnimationInKey(\`pie\`)?.(e,t),NA(\`pie\`,this._spec,this._markAttributeContext));n.normal&&n.normal.type&&(n.normal=function(e,t){var n;let r=t.options?.distance??10,i=C(t.duration)?t.duration/2:1e3,a=t.options.easing??\`cubicOut\`;return{oneByOne:t.oneByOne,loop:(n=t.loop)!=null&&n,timeSlices:[{duration:i,effects:{easing:a,channel:{x:{from:t=>e.getAttribute(\`x\`,t),to:t=>e.getAttribute(\`x\`,t)+rt({x:0,y:0},r,t[FC]).x},y:{from:t=>e.getAttribute(\`y\`,t),to:t=>e.getAttribute(\`y\`,t)+rt({x:0,y:0},r,t[FC]).y}}}},{duration:i,effects:{easing:a,channel:{x:{to:t=>e.getAttribute(\`x\`,t),from:t=>e.getAttribute(\`x\`,t)+rt({x:0,y:0},r,t[FC]).x},y:{to:t=>e.getAttribute(\`y\`,t),from:t=>e.getAttribute(\`y\`,t)+rt({x:0,y:0},r,t[FC]).y}}}}]}}(this._pieMark,n.normal)),this._pieMark.setAnimationConfig(n)}if(this._emptyArcMark){let n=MA(J.getAnimationInKey(\`emptyCircle\`)?.(e,t??\`fadeIn\`));this._emptyArcMark.setAnimationConfig(n)}}getDefaultShapeType(){return\`circle\`}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return\`\`}_noAnimationDataKey(e,t){return t}getActiveMarks(){return[this._pieMark]}}qM.transformerConstructor=GM,qM.mark=WM;class JM extends qM{constructor(){super(...arguments),this.type=XS.pie}}JM.type=XS.pie;let YM=()=>{UM(),J.registerAnimation(\`pie\`,((e,t)=>({appear:BM(e,t),enter:LM(e),exit:RM(e),disappear:zM(e)}))),J.registerAnimation(\`emptyCircle\`,((e,t)=>({appear:BM(e,t)}))),J.registerSeries(JM.type,JM)};class XM extends Qj{_isValidSeries(e){return!this.seriesType||e===this.seriesType}getIndicatorSpec(e){let t=P(e.indicator),n=e.innerRadius??e.series?.[0]?.innerRadius;return p(n)&&t.forEach((e=>{f(e.limitRatio)&&(e.limitRatio=n)})),t}_getDefaultSeriesSpec(e,t){return super._getDefaultSeriesSpec(e,[\`radius\`,\`outerRadius\`,\`innerRadius\`,\`startAngle\`,\`endAngle\`,\`sortDataByAxis\`],t)}transformSpec(e){super.transformSpec(e),y(e.dataZoom)&&e.dataZoom.length>0&&e.dataZoom.forEach((e=>{e.filterMode===\`axis\`&&(e.filterMode=\`filter\`)})),this.transformSeriesSpec(e),p(e.indicator)&&(e.indicator=this.getIndicatorSpec(e))}}class ZM extends XM{needAxes(){return!1}_getDefaultSeriesSpec(e){let t=super._getDefaultSeriesSpec(e,[\`center\`,\`centerOffset\`,\`cornerRadius\`,\`padAngle\`,\`minAngle\`,\`emptyPlaceholder\`,\`showAllZero\`,\`supportNegative\`,\`layoutRadius\`]);return t.categoryField=e.categoryField||e.seriesField,t.valueField=e.valueField||e.angleField,t.emptyCircle=e.emptyPlaceholder?.emptyCircle,t}}class QM extends Xj{constructor(){super(...arguments),this.transformerConstructor=ZM}}QM.transformerConstructor=ZM;class $M extends QM{constructor(){super(...arguments),this.transformerConstructor=ZM,this.type=\`pie\`,this.seriesType=XS.pie}}$M.type=\`pie\`,$M.seriesType=XS.pie,$M.transformerConstructor=ZM;class eN extends Qj{_getDefaultSeriesSpec(e){let t=super._getDefaultSeriesSpec(e);return delete t.data,t}_transformAxisSpec(e){e.axes&&e.autoBandSize&&e.series.forEach(((t,n)=>{var r;if(t.type===\`bar\`){let i=this._findBandAxisBySeries(t,n,e.axes);if(i&&!i.bandSize&&!i.maxBandSize&&!i.minBandSize){let e=m(t.autoBandSize)&&(r=t.autoBandSize.extend)!=null?r:0,{barMaxWidth:n,barMinWidth:a,barWidth:o,barGapInGroup:s}=t;this._applyAxisBandSize(i,e,{barMaxWidth:n,barMinWidth:a,barWidth:o,barGapInGroup:s})}}}))}transformSpec(e){if(super.transformSpec(e),e.series&&e.series.length){let t=this._getDefaultSeriesSpec(e);e.series.forEach((e=>{this._isValidSeries(e.type)&&Object.keys(t).forEach((n=>{n in e||(e[n]=t[n])}))}))}e.axes&&e.axes.length&&e.axes.forEach((t=>{j(t,\`trimPadding\`)&&q(t,ok(this.type,e))})),this._transformAxisSpec(e)}}class tN extends Xj{constructor(){super(...arguments),this.transformerConstructor=eN,this.type=\`common\`}}tN.type=\`common\`,tN.transformerConstructor=eN,ue(tN,rM);let nN={rect:cN,symbol:oN,arc:uN,point:function(e){let{labelSpec:t}=e,n;return n=!1!==t.overlap&&{avoidBaseMark:!1},{position:\`center\`,overlap:n}},"line-data":function(e){let t=oN(e);return u(t.overlap)||(t.overlap.avoidBaseMark=!1),t},stackLabel:function(e,t,n){let r=e.series,i=e.labelSpec||{},a=r.getTotalData();return{customLayoutFunc:a=>a.map((a=>{let o=i.position||\`withChange\`,s=i.offset||0,c=t?t(a.data):a.data,l=iN(e,c,i.formatMethod);return l.x=function(e,t,n,r){return t.direction===\`horizontal\`?n===\`middle\`?.5*(t.totalPositionX(e,\`end\`)+t.totalPositionY(e,\`start\`)):n===\`max\`?t.totalPositionX(e,e.end>=e.start?\`end\`:\`start\`)+r:n===\`min\`?t.totalPositionX(e,e.end>=e.start?\`start\`:\`end\`)-r:t.totalPositionX(e,\`end\`)+(e.end>=e.start?r:-r):t.totalPositionX(e,\`index\`,.5)}(c,r,o,s),l.y=function(e,t,n,r){return t.direction===\`horizontal\`?t.totalPositionY(e,\`index\`,.5):n===\`middle\`?.5*(t.totalPositionY(e,\`end\`)+t.totalPositionY(e,\`start\`)):n===\`max\`?t.totalPositionY(e,e.end>=e.start?\`end\`:\`start\`)-r:n===\`min\`?t.totalPositionY(e,e.end>=e.start?\`start\`:\`end\`)+r:t.totalPositionY(e,\`end\`)+(e.end>=e.start?-r:r)}(c,r,o,s),r.direction===\`horizontal\`?l.textAlign=o===\`middle\`?\`center\`:o===\`withChange\`&&c.end-c.start>=0||o===\`max\`?\`left\`:\`right\`:l.textBaseline=o===\`middle\`?o:o===\`withChange\`&&c.end-c.start>=0||o===\`max\`?\`bottom\`:\`top\`,n?.(a,c,l),Ql(Object.assign(Object.assign({},l),{id:a.id}))})),dataFilter:e=>{let t=[];return a.forEach((n=>{let i=e.find((e=>n.index===e.data?.[r.getDimensionField()[0]]));i&&(i.data=n,t.push(i))})),t},overlap:{strategy:[]}}},line:dN,area:dN,rect3d:cN,arc3d:uN,treemap:function(e){return{customLayoutFunc:(e,t)=>t,overlap:!1}},venn:function(e){return{customLayoutFunc:(e,t)=>t,smartInvert:!0}}};function rN(e,t){let{labelSpec:n}=t;n.overlap&&!m(n.overlap)&&(n.overlap={});let r=nN[e]??nN.point;return t.series.type===XS.sankey?function(e){let{series:t,labelSpec:n={}}=e,r=aN(n.position)??\`outside\`,i=t.direction,a,o=r;return v(r)&&(i===\`vertical\`?o=r===\`inside-start\`?e=>\`inside-left\`:r===\`inside-middle\`?e=>\`center\`:r===\`inside-end\`?e=>\`inside-right\`:e=>\`bottom\`:r===\`inside-start\`?o=e=>\`inside-left\`:r===\`inside-middle\`?o=e=>\`center\`:r===\`inside-end\`?o=e=>\`inside-right\`:r===\`outside\`&&(o=e=>\`right\`)),a=!1!==n.overlap&&(!v(r)||!r.includes(\`inside\`))&&{strategy:n.overlap?.strategy??fN(t)},{position:o,overlap:a,smartInvert:!1,offset:0,syncState:!0}}(t):r(t)}function iN(e,t,n,r){let{labelMark:i,series:a}=e,o={text:t[a.getMeasureField()[0]],data:t,textType:e.labelSpec.textType??\`text\`},s=Object.keys(i.stateStyle.normal);for(let e of s)o[e]=i.getAttribute(e,t);if(a.type!==XS.sankey){let{formatFunc:e,args:i}=eA(n,r,o.text,t);e&&(o._originText=o.text,o.text=e(...i,{series:a}))}return o}function aN(e){return d(e)?t=>e(t.data):e}function oN(e){let{series:t,labelSpec:n}=e,r=t.direction===\`horizontal\`?\`right\`:\`top\`,i=aN(n.position)??r,a;return a=!1!==n.overlap&&{strategy:n.overlap?.strategy??sN(),avoidBaseMark:i!==\`center\`},{position:i,overlap:a}}function sN(){return[{type:\`position\`,position:[\`top\`,\`bottom\`,\`right\`,\`left\`,\`top-right\`,\`top-left\`,\`bottom-left\`,\`bottom-right\`]}]}function cN(e){let{series:t,labelSpec:n={}}=e,r=aN(n.position)??\`outside\`,i=t.direction??\`vertical\`,a=t.direction===\`horizontal\`?t.getXAxisHelper()?.isInverse():t.getYAxisHelper()?.isInverse(),o,s=r;s=e=>{let{data:r}=e,o=(typeof n.position==\`function\`?n.position(r):n.position)??\`outside\`;if(o===\`outside\`){let e=t.getMeasureField()[0],n={vertical:[\`top\`,\`bottom\`],horizontal:[\`right\`,\`left\`]},o=r?.[e]>=0&&a||r?.[e]<0&&!a?1:0;return n[i][o]}return o},o=!1!==n.overlap&&{strategy:n.overlap?.strategy??lN(t)};let c=!1;return v(r)&&r.includes(\`inside\`)&&(c=!0),{position:s,overlap:o,smartInvert:c}}function lN(e){return[{type:\`position\`,position:t=>{let{data:n}=t,r=e.getMeasureField()[0];return(e.direction===\`horizontal\`?e.getXAxisHelper()?.isInverse():e.getYAxisHelper()?.isInverse())?n?.[r]>=0?e.direction===\`horizontal\`?[\`left\`,\`inside-left\`]:[\`bottom\`,\`inside-bottom\`]:e.direction===\`horizontal\`?[\`right\`,\`inside-right\`]:[\`top\`,\`inside-top\`]:n?.[r]>=0?e.direction===\`horizontal\`?[\`right\`,\`inside-right\`]:[\`top\`,\`inside-top\`]:e.direction===\`horizontal\`?[\`left\`,\`inside-left\`]:[\`bottom\`,\`inside-bottom\`]}}]}function uN(e){let{labelSpec:t}=e,n=aN(t.position)??\`outside\`,r=n,i;return i=t.smartInvert?t.smartInvert:v(n)&&n.includes(\`inside\`),{position:r,smartInvert:i}}function dN(e){let{labelSpec:t,series:n}=e,r=n.getViewDataStatistics?.call(n).latestData?.[n.getSeriesField()]?.values,i=r?r.map(((e,t)=>({[n.getSeriesField()]:e,index:t}))):[{index:0,[Nw]:n.getSeriesKeys()[0]}];return{position:t.position??\`end\`,data:i}}function fN(e){return[{type:\`position\`,position:t=>e.direction===\`horizontal\`?[\`right\`,\`left\`]:[\`bottom\`,\`top\`]}]}class pN extends Cj{constructor(e,t){super(e,t),this.type=a.label,this.name=a.label,this.layoutType=\`none\`,this.layoutZIndex=pk.Label,this._regions=t.getRegionsInIndex(t.regionIndexes)}_interactiveConfig(e){let{interactive:t}=e,n={hover:!1,select:!1,state:e.state};if(!0!==t)return n;let{hover:r,select:i}=this._option.getChart().getSpec();return!1===r&&!1===r.enable||(n.hover=!0),!1===i&&!1===i.enable||(n.select=!0),n}_compareSpec(e,t){let n=super._compareSpec(e,t);return n.reRender=!0,ce(t,e)||(n.reMake=!0),n}onRender(e){}changeRegions(e){}_getNeedClearVRenderComponents(){return[]}}pN.type=a.label;class mN extends Uk{getTextType(){return this._textType}constructor(e,t){super(e,t),this.type=mN.type,this._textType=\`text\`}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{angle:0,textAlign:\`center\`,lineWidth:0,textConfig:[]})}initStyleWithSpec(e,t){super.initStyleWithSpec(e,t),e.textType&&(this._textType=e.textType)}compileEncode(){super.compileEncode(),this._textType===\`rich\`&&this._product.encodeState(\`group\`,{textType:this._textType})}}mN.type=\`text\`;class hN extends mN{constructor(){super(...arguments),this.skipEncode=!1}getRule(){return this._rule}setRule(e){this._rule=e}getTarget(){return this._target}setTarget(e){this._target=e,this._rule||this.setRule(e.type)}getComponent(){return this._component}setComponent(e){this._component=e}}hN.type=\`text\`,hN.constructorType=\`label\`;let gN=()=>{J.registerMark(hN.constructorType,hN),gy(),by(),my(),Z.registerGraphic(Y.text,Ql)};class _N extends Sj{_initTheme(e,t){return{spec:e,theme:this._theme}}}class vN extends pN{constructor(e,t){super(e,t),this.type=a.label,this.name=a.label,this.specKey=\`label\`,this.transformerConstructor=_N,this.layoutZIndex=pk.Label,this._layoutRule=e.labelLayout||\`series\`}static getSpecInfo(e,t){let n=[];return(t?.region||[]).forEach(((r,i)=>{(r.seriesIndexes||[]).some((e=>{let{markLabelSpec:n={}}=t.series[e];return Object.values(n).some((e=>Array.isArray(e)&&(e=>e.some((e=>e.visible)))(e)))}))&&n.push({spec:e,type:a.label,specInfoPath:[\`component\`,this.specKey,i],regionIndexes:[i]})})),n}init(e){super.init(e),this.initEvent(),this._initTextMark(),this._initLabelComponent(),this._initTextMarkStyle()}reInit(e){super.reInit(e),this._labelInfoMap&&this._labelInfoMap.clear(),this._initTextMark(),this._initTextMarkStyle()}initEvent(){this.event.on(Q.dataZoomChange,(()=>{this._labelComponentMap.forEach(((e,t)=>{let n=t.getProduct().getGroupGraphicItem();n&&n.disableAnimation()})),this.event.on(X.AFTER_MARK_RENDER_END,e)}));let e=()=>{this._labelComponentMap.forEach(((e,t)=>{let n=t.getProduct().getGroupGraphicItem();n&&n.enableAnimation()})),this.event.off(X.AFTER_MARK_RENDER_END,e)}}_initTextMark(){this._labelInfoMap||=new Map,this._labelComponentMap||=new Map,qS(this._regions,(e=>{let{markLabelSpec:t={}}=e.getSpecInfo(),n=Object.keys(t),r=e.getRegion();this._labelInfoMap.get(r)||this._labelInfoMap.set(r,[]);for(let i=0;i<n.length;i++){let a=n[i],o=e.getMarkInName(a);o&&t[a].forEach(((t,n)=>{var i;if(t.visible){let s=this._labelInfoMap.get(r),c=this._createMark({type:\`label\`,name:\`\${a}-label-\${n}\`},{noSeparateStyle:!0,attributeContext:e.getMarkAttributeContext()});t.showRelatedMarkTooltip&&((i=e.tooltipHelper?.activeTriggerSet.mark)==null||i.add(c)),c.setTarget(o),s.push({labelMark:c,baseMark:o,series:e,labelSpec:t})}}))}}))}_initLabelComponent(){this._labelInfoMap.forEach(((e,t)=>{if(this._layoutRule===\`region\`){let n=this._createMark({type:\`component\`,name:\`\${t.getGroupMark().name}-label-component\`},{componentType:\`label\`,noSeparateStyle:!0},{support3d:this._spec.support3d});n&&(n.setSkipBeforeLayouted(!0),e[0]&&p(e[0].labelSpec.zIndex)&&n.setMarkConfig({zIndex:e[0].labelSpec.zIndex}),this._marks.addMark(n),this._labelComponentMap.set(n,(()=>this._labelInfoMap.get(t))))}else e.forEach(((e,n)=>{let r=this._createMark({type:\`component\`,name:\`\${e.labelMark.name}-component\`},{componentType:\`label\`,noSeparateStyle:!0},{support3d:e.baseMark.getMarkConfig().support3d});r&&(p(e.labelSpec.zIndex)&&r.setMarkConfig({zIndex:e.labelSpec.zIndex}),r.setSkipBeforeLayouted(!0),this._marks.addMark(r),this._labelComponentMap.set(r,(()=>this._labelInfoMap.get(t)[n])))}))}))}_initTextMarkStyle(){this._labelComponentMap.forEach(((e,t)=>{P(e()).forEach((({labelMark:e})=>{e.setComponent(t)}))})),this._labelInfoMap.forEach((e=>{e.forEach((e=>{var t;let{labelMark:n,labelSpec:r,series:i}=e;this.initMarkStyleWithSpec(n,r,void 0),d(r?.getStyleHandler)&&r.getStyleHandler(i)?.call(i,n,r),(t=n.stateStyle?.normal)!=null&&t.lineWidth&&n.setAttribute(\`stroke\`,i.getColorAttribute(),\`normal\`,$.Base_Series)}))}))}updateLayoutAttribute(){super.updateLayoutAttribute(),this._labelComponentMap.forEach(((e,t)=>{let n=e();y(n)?this._updateMultiLabelAttribute(n,t):this._updateSingleLabelAttribute(n,t)}))}_updateMultiLabelAttribute(e,t){this._updateLabelComponentAttribute(t.getProduct(),e.map((({baseMark:e})=>e.getProduct())),e)}_updateSingleLabelAttribute(e,t){let{baseMark:n}=e;this._updateLabelComponentAttribute(t.getProduct(),n.getProduct(),[e])}_updateLabelComponentAttribute(e,t,n){let r=this._option.getComponentsByType(\`totalLabel\`);e.target(t).configure({interactive:!1}).depend(r.map((e=>e.getMarks()[0].getProduct()))).labelStyle(((e,t)=>{let i=n[t.labelIndex];if(i){let{labelSpec:e,labelMark:t,series:n}=i,a=t.getRule(),o=this._interactiveConfig(e),s=this._spec?.centerOffset??0,c=q({textStyle:Object.assign({pickable:!0===e.interactive},e.style),overlap:{avoidMarks:r.map((e=>e.getMarks()[0].getProductId()))}},rN(a,i),Object.assign(Object.assign(Object.assign({},ae(e,[\`position\`,\`style\`,\`state\`,\`type\`,\`stackDataFilterType\`,\`getStyleHandler\`])),o),{centerOffset:s}),e.stackDataFilterType?{dataFilter:e.stackDataFilterType===\`min\`?e=>e.filter((e=>e.data[Gw])):e=>e.filter((e=>e.data[Ww]))}:{});return n&&n.parseLabelStyle&&(c=n.parseLabelStyle(c,e,t)),a!==\`line\`&&a!==\`area\`||(c.type=a),c}})).encode(((e,t,r)=>{if(n[r.labelIndex]){let{labelSpec:t,labelMark:i}=n[r.labelIndex];return i.skipEncode?{data:e}:iN(n[r.labelIndex],e,t.formatMethod,t.formatter)}})).size((()=>Object.assign({padding:n[0].labelSpec.overlap?.padding},n[0].series.getRegion().getLayoutRect())))}compileMarks(){this.getMarks().forEach((e=>{let t=this._labelComponentMap.get(e)(),n;n=y(t)?t[0].series.getRegion().getGroupMark().getProduct():t.series.getRegion().getGroupMark().getProduct(),e.compile({group:n,context:{model:this,labelInfo:t}})}))}getVRenderComponents(){let e=[];return this._labelComponentMap.forEach(((t,n)=>{let r=n.getProduct().getGroupGraphicItem();r&&e.push(r)})),e}getLabelInfoByTextGraphic(e){let t,n=e?.parent,r=n?.parent;if(r){let e=r.getChildren().indexOf(n);this._labelComponentMap.forEach(((n,i)=>{i.getProduct().getGroupGraphicItem()===r&&(t=P(n())[e])}))}return t}}vN.type=a.label,vN.specKey=\`label\`,vN.transformerConstructor=_N;var yN;(function(e){e[e.ALL=3]=\`ALL\`,e[e.HORIZONTAL=2]=\`HORIZONTAL\`,e[e.VERTICAL=1]=\`VERTICAL\`})(yN||={});let bN={x:[\`top\`,\`bottom\`],y:[\`left\`,\`right\`],category:[\`angle\`],value:[\`radius\`]};class xN extends Cj{get enableRemain(){return this.triggerOff===\`none\`}constructor(e,t){super(e,t),this.specKey=\`crosshair\`,this.layoutType=\`none\`,this.gridZIndex=pk.CrossHair_Grid,this.labelZIndex=pk.CrossHair,this.trigger=\`hover\`,this._handleIn=e=>{if(!this._option)return;let{x:t,y:n}=this.calculateTriggerPoint(e);this.showDefault=!1,this._layoutCrosshair(t,n),this._hasActive=this._getNeedClearVRenderComponents().some((e=>e&&!1!==e.attribute.visible))},this._handleClickInEvent=e=>{if(!this._hasActive||!this._spec.lockAfterClick||this._clickLock)return this._clickLock?(this._clickLock=!1,void this._handleOutEvent()):void(this._onlyLockClick||(this._handleIn(e),S(this.triggerOff)&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout((()=>{this._handleOutEvent()}),this.triggerOff))));this._clickLock=!0},this._handleHoverInEvent=Me((e=>{this._clickLock||this._handleIn(e)}),10),this._handleOutEvent=()=>{this.enableRemain||this._clickLock||!this._hasActive||(this.clearOutEvent(),this.hide())},this._handleTooltipShow=e=>{let t=e.tooltipData;if(e.isEmptyTooltip||!t||!t.length||m(this._spec.followTooltip)&&!1===this._spec.followTooltip[e.activeType])return void this._handleTooltipHideOrRelease();let{x:n,y:r}=this.calculateTriggerPoint(e);this.showDefault=!1,this._layoutCrosshair(n,r,t,e.activeType),this._hasActive=this._getNeedClearVRenderComponents().some((e=>e&&!1!==e.attribute.visible))},this._handleTooltipHideOrRelease=()=>{this.clearOutEvent(),this.hide()},this.enable=!0,this.showDefault=!0}_setAllAxisValues(e,t,n){let r=!1;if(e.forEach((e=>{Ib(e.axis.getScale().type)&&(r?this.enable=!1:r=!0)})),!this.enable)return!1;let{currentValue:i}=this._stateByField[n];return e.forEach(((e,n)=>{let r=e.axis;i.set(n,{datum:this._getDatumAtPoint(r,t),axis:r})})),!0}clearAxisValue(){Object.keys(this._stateByField).forEach((e=>{this._stateByField[e].currentValue.clear()}))}hideCrosshair(){this.clearAxisValue(),this.hide()}showCrosshair(e){e&&e.length&&(this.showDefault=!1,this.clearAxisValue(),e.forEach((e=>{let{axis:t,value:n}=e;this.setAxisValue(n,t)})),this.layoutByValue(!1))}_getLimitBounds(){if(!this._limitBounds){let{width:e,height:t}=this._option.globalInstance.getChart()?.getViewRect()??{width:0,height:0};this._limitBounds={x1:0,y1:0,x2:e,y2:t}}return this._limitBounds}_showDefaultCrosshairBySpec(){Object.keys(this._stateByField).forEach((e=>{let t=this._spec[e];if(t&&t.visible&&t.defaultSelect){let{axisIndex:n,datum:r}=t.defaultSelect,i=this._option.getComponentsByKey(\`axes\`).find((e=>e.getSpecIndex()===n));i&&(this._stateByField[e].currentValue.clear(),this._stateByField[e].currentValue.set(n,{axis:i,datum:r}))}}))}_updateVisibleCrosshair(){let e=!1;Object.keys(this._stateByField).forEach((t=>{let n=this._spec[t];n&&n.visible&&this._stateByField[t].currentValue.size?e=!0:this._hideByField(t)})),e&&this.layoutByValue(!1)}_showDefaultCrosshair(){this.showDefault?(this._showDefaultCrosshairBySpec(),this.layoutByValue(!1)):this._updateVisibleCrosshair()}setAttrFromSpec(){super.setAttrFromSpec(),this._parseCrosshairSpec()}created(){super.created(),this._initEvent()}_compareSpec(e,t){let n=super._compareSpec(e,t);return n.reMake||ce(t,e)||(n.reRender=!0,n.reMake=!0),n}_initEvent(){if(!this._option.disableTriggerEvent)if(this._spec.followTooltip)this._registerTooltipEvent();else{let e=this._getTriggerEvent();e&&e.forEach((e=>{this._registerEvent(e.in,!1,e.click),e.out&&this._registerEvent(e.out,!0)}))}}_registerEvent(e,t,n){let r=t?this._handleOutEvent:n?this._handleClickInEvent:this._handleHoverInEvent,i=t?{level:pO.chart}:{source:fO.chart};y(e)?e.forEach((e=>{this.event.on(e,i,r)})):this.event.on(e,i,r)}_eventOff(e,t,n){let r=t?this._handleOutEvent:n?this._handleClickInEvent:this._handleHoverInEvent;y(e)?e.forEach((e=>{this.event.off(e,r)})):this.event.off(e,r)}updateLayoutAttribute(){this._limitBounds=null,this._showDefaultCrosshair()}calculateTriggerPoint(e){let{event:t}=e,n=this._option.getCompiler().getStage().getLayer(void 0),r={x:t.viewX,y:t.viewY};return n.globalTransMatrix.transformPoint({x:t.viewX,y:t.viewY},r),{x:r.x-this.getLayoutStartPoint().x,y:r.y-this.getLayoutStartPoint().y}}_getTriggerEvent(){let{mode:t=e.RenderModeEnum[\`desktop-browser\`]}=this._option,n=function(t){return t===e.RenderModeEnum[\`desktop-browser\`]||t===e.RenderModeEnum[\`desktop-miniApp\`]?{click:\`pointertap\`,hover:\`pointermove\`,hoverOut:\`pointerleave\`,clickOut:\`pointerleave\`}:Pm(t)||Fm(t)?{click:\`tap\`,hover:[\`pointerdown\`,\`pointermove\`],hoverOut:\`pointerleave\`,clickOut:\`pointerleave\`}:null}(t);if(n){let e=P(this.trigger||\`hover\`),t=e=>e===\`click\`?this.triggerOff===\`none\`?null:n.clickOut:n.hoverOut;this._spec.lockAfterClick&&!e.includes(\`click\`)?(e.push(\`click\`),this._onlyLockClick=!0):this._onlyLockClick=!1;let r=[];return e.forEach((e=>{r.push({click:e===\`click\`,in:n[e],out:t(e)})})),r}return null}_registerTooltipEvent(){this.event.on(Q.tooltipHide,{source:fO.chart},this._handleTooltipHideOrRelease),this.event.on(Q.tooltipShow,{source:fO.chart},this._handleTooltipShow),this.event.on(Q.tooltipRelease,{source:fO.chart},this._handleTooltipHideOrRelease)}_getAxisInfoByField(e){var t;let n=(t=this._option).getComponentsByKey?.call(t,\`axes\`);if(!n?.length)return null;let r=j(this._spec,\`\${e}Field.bindingAxesIndex\`);if(r||(r=[],n.forEach(((t,n)=>{bN[e].includes(t.getOrient())&&r.push(n)}))),!r.length)return null;let i=new Map,a=1/0,o=1/0,s=-1/0,c=-1/0,{x:l,y:u}=this.getLayoutStartPoint();return r.forEach((e=>{a=1/0,o=1/0,s=-1/0,c=-1/0;let t=n.find((t=>t.getSpecIndex()===e));t&&(t.getRegions().forEach((e=>{let{x:t,y:n}=e.getLayoutStartPoint();a=Math.min(a,t-l),o=Math.min(o,n-u),s=Math.max(s,t+e.getLayoutRect().width-l),c=Math.max(c,n+e.getLayoutRect().height-u)})),i.set(e,{x1:a,y1:o,x2:s,y2:c,axis:t}))})),i}changeRegions(e){}onLayoutEnd(e){let t=this._regions[0];this.setLayoutRect(t.getLayoutRect()),this.setLayoutStartPosition(t.getLayoutStartPoint()),super.onLayoutEnd(e)}onRender(e){}_releaseEvent(){this.clearOutEvent();let e=this._getTriggerEvent();e&&e.forEach((e=>{this._eventOff(e.in,!1,e.click),e.out&&this._eventOff(e.out,!0)}))}_parseFieldInfo(){Object.keys(this._stateByField).forEach((e=>{let t=this._spec[e],{crosshairComp:n}=this._stateByField[e];if(t&&t.visible){if(this._stateByField[e].attributes=this._parseField(t,e),n){let{style:t,type:r}=this._stateByField[e].attributes,i=r===\`rect\`?\`rectStyle\`:\`lineStyle\`;n.setAttributes({[i]:t})}}else n&&n.parent&&n.parent.removeChild(n)}))}_parseCrosshairSpec(){this._parseFieldInfo();let{trigger:e,triggerOff:t,labelZIndex:n,gridZIndex:r}=this._spec;e&&(this.trigger=e),(t===\`none\`||S(t)&&t>0)&&(this.triggerOff=t),n!==void 0&&(this.labelZIndex=n),r!==void 0&&(this.gridZIndex=r)}_parseField(e,n){var r;let i={},{line:a={},label:o={},visible:s}=e;if(i.visible=s,i.type=a.type||\`line\`,!1===a.visible)i.style={visible:!1};else{let n=a.style||{},{stroke:o,fill:s,lineWidth:c}=n,l=n,{strokeOpacity:u,fillOpacity:d,opacity:f}=l,p=t(l,[\`strokeOpacity\`,\`fillOpacity\`,\`opacity\`]),m=i.type===\`line\`,h=m?u:d;if(S(f)&&(h=(h??1)*f),i.style=Object.assign({opacity:h,pickable:!1,visible:!0},p),m)i.style.stroke=o||s,i.style.lineWidth=j(a,\`width\`,c||2);else{i.style.fill=s||o,(r=e?.line?.style)!=null&&r.stroke&&(i.style.stroke=e.line.style.stroke);let t=j(a,\`width\`);if(typeof t==\`string\`){let e=parseInt(t.substring(0,t.length-1),10)/100;i.style.sizePercent=e}else typeof t!=\`number\`&&typeof t!=\`function\`||(i.style.size=t)}}if(o.visible){let e=o.labelBackground||{},n=o.style||{},r=e.style||{},{fill:a=\`rgba(47, 59, 82, 0.9)\`,stroke:s,outerBorder:c}=r,l=t(r,[\`fill\`,\`stroke\`,\`outerBorder\`]);i.label={visible:!0,formatMethod:o.formatMethod,formatter:o.formatter,minWidth:e.minWidth,maxWidth:e.maxWidth,padding:e.padding,textStyle:Object.assign(Object.assign({fontSize:14,pickable:!1},n),{fill:n.fill||\`#fff\`,stroke:j(n,\`stroke\`)}),panel:(u(e.visible)?e.visible:e)?Object.assign({visible:!0,pickable:!1,fill:a,stroke:s,outerBorder:Object.assign({stroke:a,distance:0,lineWidth:3},c)},l):{visible:!1},zIndex:this.labelZIndex,childrenPickable:!1,pickable:!1}}else i.label={visible:!1};return i}_filterAxisByPoint(e,t,n){return e&&e.forEach((r=>{let i=r.axis;var a,o,s;if(o=t,s=n,((a=r).x1>o||a.x2<o||a.y1>s||a.y2<s)&&e.delete(i.getSpecIndex()),i.type.startsWith(\`polarAxis\`)){let r=i.getCenter(),a=i.getInnerRadius(),o=i.getOuterRadius(),s=et.distancePP({x:t,y:n},r);(s>o||s<a)&&e.delete(i.getSpecIndex())}})),e}_updateCrosshairLabel(e,t,n){let r=this.getContainer();e?e.setAttributes(t):(e=new Jy(t),r?.add(e),n(e)),function(e,t){let{x1:n,y1:r,x2:i,y2:a}=t,{x1:o,y1:s,x2:c,y2:l}=e.AABBBounds,{dx:u=0,dy:d=0}=e.attribute,f=0,p=0;o<n&&(f=n-o),s<r&&(p=r-s),c>i&&(f=i-c),l>a&&(p=a-l),f&&e.setAttribute(\`dx\`,f+u),p&&e.setAttribute(\`dy\`,p+d)}(e,this._getLimitBounds())}clearOutEvent(){this._timer&&=(clearTimeout(this._timer),null),this._clickLock&&=null,this._hasActive&&=null}_hideByField(e){let{crosshairComp:t,labelsComp:n}=this._stateByField[e];t&&t.hideAll(),n&&Object.keys(n).forEach((e=>{n[e]&&n[e].hideAll()}))}hide(){Object.keys(this._stateByField).forEach((e=>{this._hideByField(e)}))}_getNeedClearVRenderComponents(){return Object.keys(this._stateByField).reduce(((e,t)=>{let{crosshairComp:n,labelsComp:r}=this._stateByField[t];return n&&e.push(n),r&&Object.keys(r).forEach((t=>{r[t]&&e.push(r[t])})),e}),[])}}xN.specKey=\`crosshair\`;let SN=(e,t,n,r=!1)=>(n||={x:0,y:0},Object.keys(e).forEach((i=>{let{currentValue:a,cacheInfo:o,labelsComp:s,attributes:c,coordKey:l}=e[i],u=null,d=0;if(a.size){let e=Array.from(a.values())[0];d=e.axis.getScale().scale(e.datum)+e.axis.getLayoutStartPoint()[l]-n[l],u=e.axis}let f=!!a.size&&Number.isFinite(d)&&!Number.isNaN(d),m=r&&!f&&p(o),h=m?o:{coordRange:[0,0],sizeRange:[0,0],coord:d,labelsTextStyle:{},labels:s?Object.keys(s).reduce(((e,t)=>(e[t]={visible:!1,text:\`\`,dx:0,dy:0},e)),{}):null,visible:f,axis:u},g;h&&(h._isCache=m);let _=0;if(c&&a.forEach((({axis:e,datum:n=\`\`})=>{let r=null,a=e.getScale();if(Ib(a.type))g=a.bandwidth(),g===0&&a.step&&(_=a.step());else if(Pb(a.type)){let a=i===\`xField\`?t.fieldX[0]:t.fieldY[0],o=i===\`xField\`?t.fieldX2:t.fieldY2,s=function(e,t,n,r){for(let i=0,a=e.length;i<a;i++){let a=e[i];if(a){let e=a[n],i=a[r||n];if(e<=t&&i>=t)return a}}return null}(t.getViewData().latestData,+n,a,o);if(s){let e=i===\`xField\`?t.dataToPositionX(s):t.dataToPositionY(s);o?(g=Math.abs(e-(i===\`xField\`?t.dataToPositionX1(s):t.dataToPositionY1(s))),n=\`\${s[a]} ~ \${s[o]}\`):g=1,d=e}r=e.niceLabelFormatter}if(h&&c.label?.visible&&!m){let t=function(e){let t=0;return j(e,\`tick.visible\`)&&(t+=j(e,\`tick.tickSize\`)),j(e,\`label.visible\`)&&(t+=j(e,\`label.space\`)),t}(e.getSpec()),i=e.getOrient();h.labels[i]&&(h.labels[i].visible=!0,h.labels[i].text=n,i===\`left\`?(h.labels[i].dx=-t,h.labelsTextStyle[i]={textAlign:\`right\`,textBaseline:\`middle\`}):i===\`right\`?(h.labels[i].dx=t,h.labelsTextStyle[i]={textAlign:\`left\`,textBaseline:\`middle\`}):i===\`top\`?(h.labels[i].y=0,h.labels[i].dy=-t,h.labelsTextStyle[i]={textAlign:\`center\`,textBaseline:\`bottom\`}):i===\`bottom\`&&(h.labels[i].dy=t,h.labelsTextStyle[i]={textAlign:\`center\`,textBaseline:\`top\`}),h.labels[i].defaultFormatter=r)}})),h&&!m){let e={x1:1/0,y1:1/0,x2:-1/0,y2:-1/0};wN(e,a),i===\`xField\`?(h.coordRange=[e.x1,e.x2],h.sizeRange=[e.y1,e.y2],h.coord=d+n.x,h.labels&&(h.labels.top.y=e.y1,h.labels.bottom.y=e.y2)):(h.coordRange=[e.y1,e.y2],h.sizeRange=[e.x1,e.x2],h.coord=d+n.y,h.labels&&(h.labels.left.x=e.x1,h.labels.right.x=e.x2)),(h.coord<h.coordRange[0]||h.coord>h.coordRange[1])&&(h.visible=!1),c&&c.label&&Object.keys(h.labels).forEach((e=>{h.labels[e].visible&&CN(h.labels[e],e,c.label)}))}e[i].bandSize=g??0,e[i].offsetSize=_,e[i].cacheInfo=h})),e),CN=(e,t,n)=>{let{formatMethod:r,formatter:i}=n,{formatFunc:a,args:o}=eA(r,i,e.text,{label:e.text,position:t});a?e.text=a(...o):e.defaultFormatter&&(e.text=e.defaultFormatter(e.text))},wN=(e,t)=>{t.forEach((({axis:t})=>{t.getRegions().forEach((t=>{let{x:n,y:r}=t.getLayoutStartPoint(),{width:i,height:a}=t.getLayoutRect();e.x1=Math.min(e.x1,n),e.y1=Math.min(e.y1,r),e.x2=Math.max(e.x2,n+i),e.y2=Math.max(e.y2,r+a)}))}))},TN=e=>{let{cacheInfo:t,attributes:n,bandSize:r,offsetSize:i,coordKey:a,anotherAxisKey:o}=e,{coord:s,sizeRange:c}=t,l=n.type,u;if(l===\`line\`){let e=s+r/2;u={visible:!0,start:{[a]:e,[o]:c[0]},end:{[a]:e,[o]:c[1]}}}else if(l===\`rect\`){let e=EN(n,r,t.axis),{coordRange:l}=t;u={visible:!0,start:{[a]:Math.max(s-e/2-i/2,l[0]),[o]:c[0]},end:{[a]:Math.min(s+r+e/2+i/2,l[1]),[o]:c[1]}}}return u},EN=(e,t,n)=>{let r=0;if(e.style?.sizePercent)r=(e.style.sizePercent-1)*t;else if(typeof e.style?.size==\`number\`)r=e.style.size-t;else if(typeof e.style?.size==\`function\`){let i=n.getLayoutRect();r=e.style.size(i,n)-t}return r};class DN extends xN{static getSpecInfo(e){return tA(e,this.specKey,this.type,(e=>e.xField&&!1!==e.xField.visible||e.yField&&!1!==e.yField.visible))}constructor(e,t){super(e,t),this.type=a.cartesianCrosshair,this.name=a.cartesianCrosshair,this._stateByField={xField:{coordKey:\`x\`,anotherAxisKey:\`y\`,currentValue:new Map,labelsComp:{top:null,bottom:null}},yField:{coordKey:\`y\`,anotherAxisKey:\`x\`,currentValue:new Map,labelsComp:{left:null,right:null}}}}_findAllAxisContains(e,t){let n=this._getAxisInfoByField(\`x\`),r=this._getAxisInfoByField(\`y\`);return{xAxisMap:this._filterAxisByPoint(n,e,t),yAxisMap:this._filterAxisByPoint(r,e,t)}}_getDatumAtPoint(e,t){let n=xO(e.getOrient())?\`x\`:\`y\`,r=t[n]-(e.getLayoutStartPoint()[n]-this.getLayoutStartPoint()[n]);return e.getScale().invert(r)}setAxisValue(e,t){xO(t.getOrient())?this._stateByField.xField.currentValue.set(t.getSpecIndex(),{datum:e,axis:t}):this._stateByField.yField.currentValue.set(t.getSpecIndex(),{datum:e,axis:t})}_layoutCrosshair(e,t,n,r){let i=e,a=t;if(n&&n.length){if(r===\`dimension\`){let e=n[0],t=e.data.findIndex((e=>e.datum.length>0)),r;if(t>-1){let n=e.data[t];r=n.series.dataToPosition(n.datum[0])}(p(e.dimType)?e.dimType===\`y\`:SO((e?.axis)?.getOrient()))?a=r?.y:i=r?.x}else if(r===\`mark\`){let e=n[0],t=e.series.dataToPosition(e.datum[0]);i=t?.x,a=t?.y}}this.clearAxisValue();let{xAxisMap:o,yAxisMap:s}=this._findAllAxisContains(i,a);if(o&&o.size===0||s&&s.size===0){if(this.enableRemain)return;this.hide()}else o&&o.size&&this._setAllAxisValues(o,{x:i,y:a},\`xField\`),s&&s.size&&this._setAllAxisValues(s,{x:i,y:a},\`yField\`),this.layoutByValue()}layoutByValue(e){if(!this.enable)return;let t=((e,t)=>{for(let n=0;n<e.length;n++){let r=e[n].getSeries();for(let e=0;e<r.length;e++){let n=r[e];if(t&&n&&n.coordinate===t||!t&&n)return n}}return null})(this._regions,\`cartesian\`);t&&(SN(this._stateByField,t,this.getLayoutStartPoint(),e??this.enableRemain),Object.keys(this._stateByField).forEach((e=>{this._layoutByField(e)})))}_layoutByField(e){let{cacheInfo:t,attributes:n,labelsComp:r,bandSize:i,coordKey:a}=this._stateByField[e];if(!n||!t||t._isCache&&this.enableRemain)return;let{coord:o,labels:s,visible:c,labelsTextStyle:l}=t;if(c){let t=TN(this._stateByField[e]);this._updateCrosshairByField(e,t),Object.keys(s).forEach((t=>{if(s[t].visible){let c=Object.assign(Object.assign(Object.assign({[a]:o+i/2},s[t]),n.label),{textStyle:Object.assign(Object.assign({},n.label?.textStyle),l[t]),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(r[t],c,(n=>{n.name=\`crosshair-\${e.replace(\`Field\`,\`\`)}-\${t}-label\`,r[t]=n}))}else r[t]&&r[t].hideAll()}))}else this._hideByField(e)}_updateCrosshairByField(e,t){let n=this.getContainer(),{attributes:r}=this._stateByField[e],{crosshairComp:i}=this._stateByField[e];if(i)i.setAttributes(t);else{let a=r.style;r.type===\`line\`?i=new Qy(Object.assign(Object.assign({},t),{lineStyle:a,zIndex:this.gridZIndex+1,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1})):r.type===\`rect\`&&(i=new $y(Object.assign(Object.assign({},t),{rectStyle:a,zIndex:this.gridZIndex,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1}))),n?.add(i),this._stateByField[e].crosshairComp=i}}}DN.specKey=\`crosshair\`,DN.type=a.cartesianCrosshair;let ON=(e,t)=>p(t)?e.map((e=>t[e])):void 0,kN=(e,t)=>n=>e.every(((e,r)=>n[e]===t?.[r])),AN=e=>!f(e)&&(y(e)?e.length>0&&e.every(p):Object.keys(e).length>0);function jN(e,t,n){let r=Object.assign({regionIndex:0},t),i=n.getOption(),a=i.getRegionsInUserIdOrIndex(p(r.regionId)?[r.regionId]:void 0,p(r.regionIndex)?[r.regionIndex]:void 0)[0];if(!a)return\`none\`;let o=MN(e,a),s=r.activeType??(o.length>1?\`dimension\`:\`mark\`),c=a.getLayoutStartPoint(),l=a.getLayoutRect(),u=i.globalInstance.getContainer(),d=Object.assign({x:0,y:0},u?function(e){let{x:t,y:n}=e.getBoundingClientRect();return{x:t,y:n}}(u):{}),m=e=>{let{dimensionFields:t,dimensionData:n,measureFields:r,measureData:i,groupField:a,groupData:o}=e.data;return e.series.getViewData()?.latestData.find((e=>kN(t,n)(e)&&kN(r,i)(e)&&(f(a)||kN([a],[o])(e))))},h=e=>{let t=(e=>({x:Math.min(Math.max(e.x,0),l.width),y:Math.min(Math.max(e.y,0),l.height)}))(e),n=r.x??c.x+t.x,i=r.y??c.y+t.y;return{canvasX:n,canvasY:i,clientX:d.x+n,clientY:d.y+i}};if(s===\`dimension\`){let t=o[0];if(!t)return\`none\`;let r=new Map;o.forEach((e=>{var t;r.has(e.series)||r.set(e.series,[]),(t=r.get(e.series))==null||t.push(e)}));let a=[{value:e[t.data.dimensionFields[0]],data:[...r.keys()].map((e=>({series:e,datum:r.get(e)?.map((e=>m(e)))??[]})))}];p(t.dimType)&&(a[0].position=t.pos[t.dimType],a[0].dimType=t.dimType);let c={changePositionOnly:!1,action:\`enter\`,tooltip:null,dimensionInfo:a,chart:i.globalInstance.getChart()??void 0,datum:void 0,model:void 0,source:fO.chart,event:h({x:o.reduce(((e,t)=>e+t.pos.x),0)/o.length,y:o.reduce(((e,t)=>e+t.pos.y),0)/o.length}),item:void 0,itemMap:new Map};n.processor.dimension.showTooltip(a,c,!1);let l=i.globalInstance;return Zk.globalConfig.uniqueTooltip&&Zk.hideTooltip(l.id),s}if(s===\`mark\`){let t=o[0];if(!t)return\`none\`;let r=Object.assign(Object.assign({},m(t)),e),a=[{datum:[r],series:t.series}],c={changePositionOnly:!1,tooltip:null,dimensionInfo:[{value:r[t.data.dimensionFields[0]],data:a}],chart:i.globalInstance.getChart()??void 0,datum:r,model:t.series,source:fO.chart,event:h(t.pos),item:void 0,itemMap:new Map};n.processor.mark.showTooltip({datum:r,mark:null,series:t.series},c,!1);let l=i.globalInstance;return Zk.globalConfig.uniqueTooltip&&Zk.hideTooltip(l.id),s}return\`none\`}let MN=(e,t)=>{let n=t.getSeries(),r=[];return n.forEach((t=>{var n;let i=t.getDimensionField(),a=t.getMeasureField(),o=t.getSeriesField(),s=p(o)?e[o]:void 0,c=p(o)&&(n=(t.getViewDataStatistics?.call(t))?.latestData[o]?.values)!=null?n:[],l=ON(i,e),u=ON(a,e),d=AN(u),m=!d&&p(o)&&f(s)&&c.length>0,h=()=>{let e=t.getViewData()?.latestData.find(kN(i,l));if(!d&&(u=ON(a,e),!AN(u)))return;let n=t.type===XS.pie?t.dataToCentralPosition(e):t.dataToPosition(e);f(n)||isNaN(n.x)||isNaN(n.y)||r.push({pos:n,data:{dimensionFields:i,dimensionData:l,measureFields:a,measureData:u,hasMeasureData:d,groupField:o,groupData:s},series:t})};if(t.coordinate===\`cartesian\`){let e=t,n=Ib(t.getYAxisHelper()?.getScale(0)?.type)?\`y\`:\`x\`,p=i.map(((e,t)=>[e,t])).filter((([,e])=>f(l?.[e]))),h=[l??[]];p.length>0&&p.forEach((([e,n])=>{let r=(t.getViewDataStatistics?.call(t))?.latestData[e]?.values??[],i=[];h.forEach((e=>{r.forEach((t=>{let r=e?.slice()??[];r[n]=t,i.push(r)}))})),h=i})),h.forEach((l=>{if(m){let s=e.getViewData()?.latestData.filter(kN(i,l));c.forEach((c=>{let p=s.find((e=>e[o]===c));if(u=ON(a,p),!AN(u))return;let m=e.dataToPosition(p);f(m)||isNaN(m.x)||isNaN(m.y)||r.push({pos:m,data:{dimensionFields:i,dimensionData:l,measureFields:a,measureData:u,hasMeasureData:d,groupField:o,groupData:c},series:t,dimType:n})}))}else{let c=e.getViewData()?.latestData.find(kN(i,l));if(!d&&(u=ON(a,c),!AN(u)))return;let p=e.dataToPosition(c);if(f(p)||isNaN(p.x)||isNaN(p.y))return;r.push({pos:p,data:{dimensionFields:i,dimensionData:l,measureFields:a,measureData:u,hasMeasureData:d,groupField:o,groupData:s},dimType:n,series:t})}}))}else if(t.coordinate===\`polar\`)if(t.type===XS.pie)h();else{let e=t;if(m){let n=(e.getViewData()?.latestData.filter(kN(i,l))).find((e=>e[o]===s));c.forEach((s=>{if(u=ON(a,n),!AN(u))return;let c=e.dataToPosition(n);f(c)||isNaN(c.x)||isNaN(c.y)||r.push({pos:c,data:{dimensionFields:i,dimensionData:l,measureFields:a,measureData:u,hasMeasureData:d,groupField:o,groupData:s},series:t})}))}else h()}else t.coordinate===\`geo\`&&h()})),r},NN=[\`updateTitle\`,\`updateContent\`,\`updatePosition\`,\`maxLineCount\`,\`othersLine\`],PN=(e,t,n,r,i)=>{let a={activeType:e};switch(e){case\`mark\`:case\`group\`:if(n){let o=n.getSpec()?.tooltip;return a.visible=!0,o!=null&&o.handler&&(a.handler=o.handler),a.handler?.showTooltip?a:(o!=null&&o[e]&&NN.forEach((t=>{p(o[e][t])&&(a[t]=o[e][t])})),Object.assign(Object.assign({},a),n.tooltipHelper.getTooltipData(e,t,r,r[0].datum,i)))}break;case\`dimension\`:if(r?.length){if(FN(r).every((e=>!iA(\`dimension\`,e.tooltipHelper?.spec)))?a.visible=!1:a.visible=!0,a.handler=t.handler,a.handler?.showTooltip)return a;let n=[];return r.forEach((a=>a.data.forEach((a=>{let{series:o}=a,s=o.tooltipHelper.getTooltipData(e,t,r,a.datum,i);s&&n.push(s)})))),function(e){if(!e||!e.length)return null;let t=[];return e.forEach((({content:e})=>{e&&e.forEach((e=>{t.push(e)}))})),t.length?Object.assign(Object.assign({},e[0]),{content:t}):e[0]}(n)}}return null},FN=e=>{let t=[];return e.forEach((e=>{e.data.forEach((e=>{p(e.series)&&t.push(e.series)}))})),t},IN={dom:\`\${K}_TOOLTIP_HANDLER_DOM\`,canvas:\`\${K}_TOOLTIP_HANDLER_CANVAS\`},LN={key:\`其他\`,value:\`...\`},RN=[\`group\`,\`mark\`,\`dimension\`];class zN{constructor(e){this._showTooltipByHandler=(e,t)=>{var n;if(f(e))return 1;t.changePositionOnly||this.clearCache(),this._updateViewSpec(e,t);let r=this._cacheActiveSpec;if(f(r)||!1===r.visible)return 1;t.tooltipSpec=this.component.getSpec(),t.activeTooltipSpec=r;let{title:i,content:a}=r,o=f(i?.key)&&f(i?.value)&&!a?.length;if(this.component.event.emit(Q.tooltipShow,Object.assign(Object.assign({},t),{isEmptyTooltip:o,tooltipData:e,activeType:this.activeType,tooltip:this.component})),o)return 1;let s;return r.handler?.showTooltip?s=r.handler.showTooltip.bind(r.handler):(n=this.component.tooltipHandler)!=null&&n.showTooltip&&(s=this.component.tooltipHandler.showTooltip.bind(this.component.tooltipHandler)),s?s(this.activeType,e,t)??0:1},this.component=e}_preprocessDimensionInfo(e){let t=[];if(e?.forEach((e=>{let n=Object.assign(Object.assign({},e),{data:e.data.filter((({series:e})=>!1!==e.getSpec()?.tooltip?.visible))});n.data.length>0&&t.push(n)})),t.length>0)return t}_updateViewSpec(e,t){let{changePositionOnly:n,model:r}=t;if(!n||!this._cacheActiveSpec){let n=this.component.getSpec();if(this._cacheActiveSpec=PN(this.activeType,this.component.getSpec(),r,e,t),this._cacheActiveSpec){f(this._cacheActiveSpec.handler)&&p(n.handler)&&(this._cacheActiveSpec.handler=n.handler);let r=n[this.activeType]??{},i=this._cacheActiveSpec.updateTitle??r.updateTitle,a=this._cacheActiveSpec.updateContent??r.updateContent,o=this._cacheActiveSpec.maxLineCount??r.maxLineCount??20;if(i&&(this._cacheActiveSpec.title=i(this._cacheActiveSpec.title,e,t)??this._cacheActiveSpec.title),a)this._cacheActiveSpec.content=a(this._cacheActiveSpec.content,e,t)??this._cacheActiveSpec.content;else if(o>=1&&this._cacheActiveSpec.content?.length>o){let e=this._cacheActiveSpec.othersLine??r.othersLine,t=e?Object.assign(Object.assign({},LN),e):LN;this._cacheActiveSpec.content=[...this._cacheActiveSpec.content.slice(0,o-1),Object.assign(Object.assign({},this._cacheActiveSpec.content[o-1]),t)]}}}}shouldHandleTooltip(e,t){return!f(t)&&iA(this.activeType,e.model?.tooltipHelper?.spec)}clearCache(){this._cacheActiveSpec=void 0}}class BN extends zN{constructor(){super(...arguments),this.activeType=\`dimension\`}showTooltip(e,t,n){let r=Object.assign(Object.assign({},t),{dimensionInfo:this._preprocessDimensionInfo(e),changePositionOnly:n,tooltip:this.component});return this._showTooltipByHandler(e,r)}_getDimensionInfo(e){let t,n=this.component.getChart(),r=n.getCompiler().getStage().getLayer(void 0),i={x:e.event.viewX,y:e.event.viewY};if(r.globalTransMatrix.transformPoint({x:e.event.viewX,y:e.event.viewY},i),t=[...jO(n,i,!0)??[],...bO(n,i)??[]],t.length===0)t=void 0;else if(t.length>1){let e=t.filter((e=>{let t=e.axis;if(t.getSpec().hasDimensionTooltip)return!0;if(!Ib(t.getScale().type))return!1;let n;for(let e of t?.getRegions()??[]){for(let t of e.getSeries())if(t.coordinate===\`cartesian\`){n=t;break}if(p(n))break}return p(n)&&n.getDimensionField()[0]===n.fieldY[0]?t.getOrient()===\`left\`||t.getOrient()===\`right\`:t.getOrient()===\`bottom\`||t.getOrient()===\`top\`}));if(t=e.length?e:t.slice(0,1),t.length>1){let e=new Set;t.forEach((t=>{t.data=t.data.filter((({key:t})=>!e.has(t)&&(e.add(t),!0)))}))}}return t}getMouseEventData(e){return{tooltipInfo:this._getDimensionInfo(e),ignore:!1}}}class VN extends zN{constructor(){super(...arguments),this.activeType=\`mark\`}showTooltip(e,t,n){let{datum:r,series:i}=e,a=this.component.getSpec(),o=[{datum:[r],series:i}],s=i.tooltipHelper,c=(i.getSpec()?.tooltip)?.mark?.checkOverlap,l=!1;if(!0===c||!0===a.mark?.checkOverlap&&!1!==c){let e=s?.activeTriggerSet.mark;if(e){l=!0;let n=this.component.getChart().getCompiler().getStage().getLayer(void 0),r={x:t.event.viewX,y:t.event.viewY};n.globalTransMatrix.transformPoint({x:t.event.viewX,y:t.event.viewY},r),e.forEach((e=>{e.getProductElements().forEach((e=>{let n=e.getGraphicItem();e!==t.item&&n&&n.containsPoint(r.x,r.y,_r.GLOBAL,n.stage.getPickerService())&&o[0].datum.push(e.getDatum())}))}))}}let u=Object.assign(Object.assign({},t),{model:i,changePositionOnly:n,tooltip:this.component});if(n&&l){let e=this._cacheActiveSpec&&this._cacheActiveSpec.data;e&&e[0].series===o[0].series&&e[0].datum.length===o[0].datum.length&&!e[0].datum.some(((e,t)=>e!==o[0].datum[t]))||(u.changePositionOnly=!1)}return this._showTooltipByHandler(o,u)}getMouseEventData(e){let t,n,r=e.model?.modelType;if(r===\`series\`){let r=e.model,i=r.tooltipHelper,a=i?.activeTriggerSet.mark,o=i?.ignoreTriggerSet.mark;a?.has(e.mark)?t={mark:e.mark,datum:e.datum,series:r}:o!=null&&o.has(e.mark)&&(n=!0)}else if(r===\`component\`){let r=e.model,i=e.node;if(r.name===\`label\`&&i){let{baseMark:e,series:a,labelMark:o}=r.getLabelInfoByTextGraphic(i)??{},s=a.tooltipHelper,c=s?.activeTriggerSet.mark,l=s?.ignoreTriggerSet.mark;c?.has(o)?t={mark:e,datum:i.attribute.data,series:a}:l!=null&&l.has(o)&&(n=!0)}}return{tooltipInfo:t,ignore:n}}}class HN extends zN{constructor(){super(...arguments),this.activeType=\`group\`}showTooltip(e,t,n){let{datum:r,series:i}=e,a=[{datum:P(r),series:i}],o=Object.assign(Object.assign({},t),{groupDatum:this._getGroupDatum(t),changePositionOnly:n,tooltip:this.component});return this._showTooltipByHandler(a,o)}getMouseEventData(e){let t;if(e.model?.modelType===\`series\`){let n=e.model;if((n.tooltipHelper?.activeTriggerSet.group)?.has(e.mark)){let r=this.component.getSpec()[this.activeType];(r?.triggerMark?P(r.triggerMark):[]).includes(e.mark?.name)&&(t={mark:e.mark,datum:e.datum,series:n})}}return{tooltipInfo:t,ignore:!1}}_getGroupDatum(e){let{model:t,mark:n,datum:r}=e,i=t;if([\`line\`,\`area\`].includes(n.type))return P(r);let a=i.getViewData().latestData,o=i.getSeriesField();if(!o)return a;let s=P(r)[0][o];return a.filter((e=>e[o]===s))}}let UN=e=>p(e)&&!y(e),WN=e=>p(e)&&y(e);class GN extends Sj{_shouldMergeThemeToSpec(){return!1}_initTheme(e,t){let{spec:n,theme:r}=super._initTheme(e,t);return n.style=q({},this._theme,n.style),n.offset=q({},r.offset,e.offset),n.transitionDuration=e.transitionDuration??r.transitionDuration,{spec:n,theme:r}}_transformSpecAfterMergingTheme(e,t,n){var r,i;super._transformSpecAfterMergingTheme(e,t,n),e.visible=(r=e.visible)==null||r,e.activeType=(e=>{if(!1===e?.visible)return[];let t={mark:!1!==e?.mark?.visible,dimension:!1!==e?.dimension?.visible,group:!1!==e?.group?.visible};return p(e?.activeType)&&Object.keys(t).forEach((n=>{t[n]=(e?.activeType)?.includes(n)})),Object.keys(t).filter((e=>t[e]))})(e),e.renderMode=e.renderMode??(Fm(this._option.mode)||!Nm(this._option.mode)?\`canvas\`:\`html\`),e.trigger=e.trigger??\`hover\`,e.className=e.className??\`vchart-tooltip-element\`,e.enterable=(i=e.enterable)!=null&&i,e.transitionDuration=e.transitionDuration??150,e.confine=e.confine??e.renderMode===\`canvas\`,p(e.parentElement)?v(e.parentElement)&&(e.parentElement=jp.getElementById(e.parentElement)):Nm(this._option.mode)&&(e.parentElement=Mm?.body)}}class KN extends Cj{constructor(){super(...arguments),this.layoutZIndex=1,this.type=a.tooltip,this.name=a.tooltip,this.transformerConstructor=GN,this.specKey=\`tooltip\`,this.layoutType=\`none\`,this._isReleased=!1,this._alwaysShow=!1,this._eventList=[],this._isTooltipShown=!1,this._clickLock=!1,this._mountEvent=(e,t,n)=>{this.event.on(e,t,n),this._eventList.push({eventType:e,handler:n})},this._handleClickToLock=e=>{this._clickLock?(this._handleChartMouseOut(e),this._clickLock=!1):this._clickLock=!0},this._getMouseOutHandler=e=>t=>{var n;if(this._isReleased||this._alwaysShow||this._clickLock||!this._isTooltipShown&&!((n=this.tooltipHandler)?.isTooltipShown)?.call(n))return;let r=Nm(this._option?.mode),{clientX:i,clientY:a}=t.event;r&&e&&this._isPointerInChart({x:i,y:a})||(this._enterable?this._outTimer=setTimeout((()=>{this._handleChartMouseOut(t)}),this._spec?.showDelay??50):this._handleChartMouseOut(t))},this._handleChartMouseOut=e=>{this._alwaysShow||this._isReleased||this._isEnterTooltip||this._spec.triggerOff!==\`none\`&&(this._hideTooltipByHandler(Object.assign(Object.assign({},e),{tooltip:this})),this._handleMouseMove&&this._handleMouseMove.cancel&&this._handleMouseMove.cancel(),this._cacheEnterableRect=null,this._cacheInfo=void 0,this._cacheParams=void 0,this._cacheActiveType=void 0)},this._getMouseMoveHandler=e=>t=>{var n;this._isReleased||this._isEnterTooltip||(this._outTimer&&=(clearTimeout(this._outTimer),null),this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),this._alwaysShow||(this._clickLock?e&&(this._handleChartMouseOut(t),this._clickLock=!1):!e&&this._enterable&&((n=this.tooltipHandler)?.isTooltipShown)?.call(n)?(this._showTimer&&clearTimeout(this._showTimer),this._showTimer=setTimeout((()=>{this._handleChartMouseMove(t,e)}),this._spec?.showDelay??50)):this._handleChartMouseMove(t,e)))},this._handleChartMouseMove=(e,t)=>{if(this._isReleased)return;let n=this._getMouseEventData(e),{tooltipInfo:{dimension:r},ignore:{mark:i}}=n,a={mark:!1,dimension:!1,group:!1};for(let r=0,i=RN.length;r<i;r++){let i=RN[r];if(this.processor[i]&&this._showTooltipByMouseEvent(i,n,e,t)){a[i]=!0;break}}Object.values(a).every((e=>!e))&&!function(e){return f(e.mark)&&f(e.model)&&f(e.datum)}(e)&&(i&&UN(this._cacheInfo)?a.mark=this._showTooltipByMouseEvent(\`mark\`,n,e,t,!0):p(r)&&(a.dimension=this._showTooltipByMouseEvent(\`dimension\`,n,e,t))),a.mark||a.group||a.dimension&&!f(r)?this._initEventOfTooltipContent():this._handleChartMouseOut(e)},this._showTooltipByMouseEvent=(e,t,n,r,i)=>{let a=this.processor[e];if(!a.shouldHandleTooltip(n,t.tooltipInfo[e]))return!1;let o;if(this._hideTimer&&clearTimeout(this._hideTimer),i)o=!a.showTooltip(this._cacheInfo,n,!0);else{let r=t.tooltipInfo[e],i=this._isSameAsCache(r,n,e);o=!a.showTooltip(r,n,i),o&&(this._cacheInfo=r,this._cacheParams=n,this._cacheActiveType=e)}o&&(this._isTooltipShown=!0,r&&this._spec.lockAfterClick&&!this._clickLock?this._clickLock=!0:Number.isFinite(this._spec.hideTimer)&&(this._hideTimer=setTimeout((()=>{this._handleChartMouseOut()}),this._spec.hideTimer)));let s=this._option?.globalInstance;return o&&Zk.globalConfig.uniqueTooltip&&s&&Zk.hideTooltip(s.id),o},this._getMouseEventData=e=>{let t={tooltipInfo:{},ignore:{}};return Object.keys(this.processor).forEach((n=>{let{tooltipInfo:r,ignore:i}=this.processor[n].getMouseEventData(e);t.tooltipInfo[n]=r,t.ignore[n]=i})),t},this._hideTooltipByHandler=e=>{var t;if(!this._isTooltipShown&&!((t=this.tooltipHandler)?.isTooltipShown)?.call(t))return 0;this.event.emit(Q.tooltipHide,Object.assign(Object.assign({},e),{source:fO.chart,tooltip:this})),Object.values(this.processor).forEach((e=>{e.clearCache()}));let n=this._spec.handler??this.tooltipHandler;if(n.hideTooltip){let t=n.hideTooltip.call(n,e);return t||(this._isTooltipShown=!1),t}return 1},this.hideTooltip=()=>{if(this._isReleased)return!1;let e={changePositionOnly:!1,tooltip:this,item:void 0,datum:void 0,source:fO.chart};return this._alwaysShow=!1,!this._hideTooltipByHandler(e)}}isTooltipShown(){return this._isTooltipShown}changeRegions(e){}_getNeedClearVRenderComponents(){return[]}_registerEvent(){}_releaseEvent(){}onLayout(e){}onLayoutEnd(e){}onRender(e){}created(){super.created(),this._regions=this._option.getAllRegions(),this._initEvent()}release(){var e,t;super.release(),this._isReleased=!0,this._hideTimer&&clearTimeout(this._hideTimer),this._eventList.forEach((({eventType:e,handler:t})=>{this.event.off(e,t)})),this._eventList=[],(t=(e=this.tooltipHandler)?.release)==null||t.call(e),this._isTooltipShown=!1}beforeRelease(){this.event.emit(Q.tooltipHide,{tooltip:this,chart:this.getChart()}),this.event.emit(Q.tooltipRelease,{tooltip:this,chart:this.getChart()})}_initHandler(){var e;let t=this._spec.renderMode??\`html\`,n=this._option.globalInstance.getTooltipHandlerByUser();if(n)this.tooltipHandler=n,this._enterable=!1;else{let n=t===\`canvas\`?IN.canvas:IN.dom,r=J.getComponentPluginInType(n);r||km(\`Can not find tooltip handler: \`+n);let i=new r;i.name=\`\${this._spec.className}-\${this._option.globalInstance.id??0}-\${this.getSpecIndex()}\`,(e=this.pluginService)==null||e.load([i]),this.tooltipHandler=i,this._spec.enterable&&t===\`html\`&&this.tooltipHandler?(this._enterable=!0,this._needInitEventOfTooltip=!0):this._enterable=!1}}_initEventOfTooltipContent(){var e;if(!this._needInitEventOfTooltip)return;let t=(e=this.tooltipHandler).getTooltipContainer?.call(e)?.firstChild;t&&(t.addEventListener(\`pointerenter\`,(()=>{if(!this._enterable)return;this._isEnterTooltip=!0;let e=t.getBoundingClientRect?.call(t);e&&(this._cacheEnterableRect={x:e.x,y:e.y,width:e.width,height:e.height}),this._outTimer&&=(clearTimeout(this._outTimer),null),this._showTimer&&=(clearTimeout(this._showTimer),null)})),t.addEventListener(\`pointerleave\`,(()=>{if(this._enterable&&(this._isEnterTooltip=!1,this._cacheEnterableRect)){let e=t.getBoundingClientRect?.call(t);e&&Object.keys(this._cacheEnterableRect).every((t=>this._cacheEnterableRect[t]===e[t]))&&(this._cacheEnterableRect=null,this._outTimer=setTimeout(this.hideTooltip,this._spec?.showDelay??50))}})),this._needInitEventOfTooltip=!1)}_initProcessor(){let e=this._spec.activeType;this.processor={},e.includes(\`dimension\`)&&(this.processor.dimension=new BN(this)),e.includes(\`group\`)&&(this.processor.group=new HN(this)),e.includes(\`mark\`)&&(this.processor.mark=new VN(this))}_initEvent(){if(this._option.disableTriggerEvent)return;let e=P(this._spec.trigger??\`hover\`),t=P(this._spec.triggerOff),n=this._option.mode;e.forEach((e=>{e===\`hover\`?(this._handleMouseMove=this._throttle(this._getMouseMoveHandler(!1)),this._mountEvent(\`pointermove\`,{source:\`chart\`},this._handleMouseMove),(Pm(n)||Fm(n))&&(this._mountEvent(\`pointerdown\`,{source:\`chart\`},this._getMouseMoveHandler(!1)),this._mountEvent(\`pointerup\`,{source:\`window\`},this._getMouseOutHandler(!0))),this._mountEvent(\`pointerleave\`,{source:\`chart\`},this._getMouseOutHandler(!1))):e===\`click\`?(this._mountEvent(\`pointertap\`,{source:\`chart\`},this._getMouseMoveHandler(!0)),this._mountEvent(\`pointerup\`,{source:\`window\`},this._getMouseOutHandler(!0))):m(e)&&this._mountEvent(e.eventType,{source:e.source??\`chart\`,consume:e.consume},this._getMouseMoveHandler(!0))})),t.filter((e=>m(e))).forEach((e=>{var t;this._mountEvent(e.eventType,{source:e.source??\`chart\`,consume:e.consume},this._getMouseOutHandler((t=e.checkOutside)!=null&&t))})),!e.includes(\`click\`)&&this._spec.lockAfterClick&&this._mountEvent(\`pointertap\`,{source:\`chart\`},this._handleClickToLock)}_throttle(e){let t;return t=S(this._spec.throttleInterval)?this._spec.throttleInterval:this._spec.renderMode===\`html\`&&this._spec.transitionDuration?50:10,Me(e,t)}reInit(e){var t,n;if(super.reInit(e),this.tooltipHandler){let e=this._spec.renderMode??\`html\`,r=this._spec.enterable&&e===\`html\`;r&&!this._enterable&&(this._needInitEventOfTooltip=!0),this._enterable=r,(n=(t=this.tooltipHandler).reInit)==null||n.call(t)}else this._initHandler()}showTooltip(e,t){if(this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),!this.tooltipHandler?.showTooltip)return!1;let n=jN(e,t,this);return n!==\`none\`&&(this._alwaysShow=!!t?.alwaysShow),n}_isSameAsCache(e,t,n){if(n!==this._cacheActiveType)return!1;if(e===this._cacheInfo)return!0;if(f(this._cacheInfo)||f(e))return!1;if(WN(e)){if(UN(this._cacheInfo))return!1;let t=this._cacheInfo;return t.length===e.length&&e.every(((e,n)=>hO(e,t[n])))}if(WN(this._cacheInfo))return!1;let r=this._cacheInfo;if(!(e?.datum===r.datum&&e?.mark===r.mark&&e?.series===r.series))return!1;let i=this._cacheParams;return!f(i)&&!f(t)&&i.mark===t.mark&&i.model===t.model&&i.datum===t.datum}_isPointerInChart(e){let t=this._option?.globalInstance;if(!t||!t.getChart())return!1;let{x:n,y:r}=e,{x:i,y:a,width:o,height:s}=t.getCanvas().getBoundingClientRect();return n>=i&&n<=i+o&&r>=a&&r<=a+s}getVisible(){return!1!==this._spec.visible}}KN.type=a.tooltip,KN.transformerConstructor=GN,KN.specKey=\`tooltip\`;function qN(e,n){let{title:r={},item:i={},pager:a={},background:o={},type:s,id:c,visible:l,orient:u,position:d,data:f,filter:m,regionId:h,regionIndex:g,seriesIndex:_,seriesId:v,padding:y}=e,b=t(e,[\`title\`,\`item\`,\`pager\`,\`background\`,\`type\`,\`id\`,\`visible\`,\`orient\`,\`position\`,\`data\`,\`filter\`,\`regionId\`,\`regionIndex\`,\`seriesIndex\`,\`seriesId\`,\`padding\`]);return r.visible?b.title=function(e){var t,n;let r=Object.assign({},e);return A(e.style)||(r.textStyle=lT(e.style)),A(e.textStyle)||q(r.textStyle,lT(e.textStyle)),(t=e.shape)!=null&&t.style&&lT(r.shape.style),(n=e.background)!=null&&n.style&&lT(r.background.style),r}(r):b.title={visible:!1},A(i.focusIconStyle)||lT(i.focusIconStyle),i.shape&&=sT(i.shape),i.label&&=sT(i.label),i.value&&=sT(i.value),i.background&&=sT(i.background),hC(i.maxWidth)&&(i.maxWidth=Number(i.maxWidth.substring(0,i.maxWidth.length-1))*n.width/100),hC(i.width)&&(i.width=Number(i.width.substring(0,i.width.length-1))*n.width/100),hC(i.height)&&(i.height=Number(i.height.substring(0,i.height.length-1))*n.width/100),b.item=i,a.type===\`scrollbar\`?(A(a.railStyle)||lT(a.railStyle),A(a.sliderStyle)||lT(a.sliderStyle)):(A(a.textStyle)||lT(a.textStyle),a.handler&&sT(a.handler)),b.pager=a,o.visible&&!A(o.style)&&(q(b,o.style),p(o.padding)&&(b.padding=o.padding)),b}let JN=(e,t)=>{let n=[],r={},{series:i,seriesField:a}=t;return i().forEach((e=>{let t=a(e),i;i=t===e.getSeriesField()?e.getSeriesInfoList():e.getSeriesInfoInField(t),i.forEach((e=>{r[e.key]||(r[e.key]=!0,n.push(e))}))})),n},YN=(e,t)=>{var n;let{series:r,selected:i,field:a,data:o,customFilter:s}=t,c=i(),l=o();if(c.length===0&&l.length)return[];if(c.length===l.length)return e;let u={};c.forEach((e=>{u[e]=!0}));let d=a()??Nw;return s?s(e,c,d):(y(e)&&e[0]?.nodes?(e[0].nodes=e[0].nodes.filter((e=>!0===u[e.key])),(n=e[0])!=null&&n.links&&(e[0].links=e[0].links.filter((e=>!0===u[e.source]&&!0===u[e.target])))):p(d)&&(e=e.filter((e=>!0===u[r.getSeriesFieldValue(e,d)]))),e)};class XN extends Cj{constructor(){super(...arguments),this.layoutType=\`normal\`,this.layoutZIndex=pk.Legend,this.layoutLevel=mk.Legend,this.specKey=\`legends\`,this._orient=\`left\`,this._visible=!0,this._position=\`middle\`,this._preSelectedData=[],this._selectedData=[],this.effect={onSelectedDataChange:()=>{qS(this._regions,(e=>{var t;(t=e.getViewData())==null||t.markRunning()}),{userId:this._seriesUserId,specIndex:this._seriesIndex}),qS(this._regions,(e=>{e.reFilterViewData()}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}get orient(){return this._orient}get visible(){return this._visible}get position(){return this._position}getLegendData(){return this._legendData.getLatestData()}getSelectedData(){return this._selectedData}setAttrFromSpec(){super.setAttrFromSpec(),this._orient=mC(this._spec.orient)?this._spec.orient:\`left\`,this._position=this._spec.position??\`middle\`,this._visible=!1!==this._spec.visible;let{regionId:e,regionIndex:t,seriesId:n,seriesIndex:r}=this._spec;p(n)&&(this._seriesUserId=P(n)),p(e)&&(this._regionUserId=P(e)),p(r)&&(this._seriesIndex=P(r)),p(t)&&(this._regionUserIndex=P(t)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionUserIndex)}created(){super.created(),this.initData()}onRender(e){}_compareSpec(e,t){let n=super._compareSpec(e,t);return n.reRender=!0,e?.orient===t?.orient?(ce(t,e)||(n.reCompile=!0),n):(n.reMake=!0,n)}changeRegions(e){}_bindLegendDataChange(){this._preSelectedData=this._selectedData.slice(),this._initSelectedData()}initData(){let e=this._initLegendData();e.target.addListener(\`change\`,this._bindLegendDataChange.bind(this)),this._legendData=new Bk(this._option,e),this._initSelectedData(),qS(this._regions,(e=>{e.event.on(Q.rawDataUpdate,{filter:({model:t})=>t?.id===e.id},(()=>{this._legendData.getDataView().reRunAllTransform()}))}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}setSelectedData(e){var t,n,r;let i=this._selectedData;f(e)||JSON.stringify(i)===JSON.stringify(e)||(qS(this._regions,(t=>{t.legendSelectedFilter&&(e=t.legendSelectedFilter(this,e))}),{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._selectedData=[...e],(n=(t=this.effect).onSelectedDataChange)==null||n.call(t),this.event.emit(Q.legendSelectedDataChange,{model:this}),(r=this._legendComponent)==null||r.setSelected(this._selectedData))}afterSetLayoutStartPoint(e){if(super.afterSetLayoutStartPoint(e),this._legendComponent){let{x:t,y:n}=e;C(t*n)&&this._legendComponent.setAttributes({x:t,y:n})}}getBoundsInRect(e,t){if(!this._visible)return this._legendComponent&&this._legendComponent.parent&&(this._legendComponent.parent.removeChild(this._legendComponent),this._legendComponent=null),{x1:0,y1:0,x2:0,y2:0};let n={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0},r=this._getLegendAttributes(e);if(r.disableTriggerEvent=this._option.disableTriggerEvent,this._legendComponent)ce(r,this._cacheAttrs)||this._legendComponent.setAttributes(q({},r,{defaultSelected:this._selectedData}));else{let e=new(this._getLegendConstructor())(q({},r,{defaultSelected:this._selectedData}));e.name=\`legend\`,this._legendComponent=e,this.getContainer().add(e),this._option.disableTriggerEvent||this._initEvent(),e.on(\`*\`,((e,t)=>this._delegateEvent(this._legendComponent,e,t)))}this._cacheAttrs=r;let i=isFinite(this._legendComponent.AABBBounds.width())?this._legendComponent.AABBBounds.width():0,a=isFinite(this._legendComponent.AABBBounds.height())?this._legendComponent.AABBBounds.height():0;if(this.layoutType!==\`normal-inline\`){let e=this.layoutOrient===\`bottom\`||this.layoutOrient===\`top\`?\`horizontal\`:\`vertical\`,n=this._position,{width:r,height:o}=t,s=0,c=0;e===\`horizontal\`?n===\`middle\`?s=(r-i)/2:n===\`end\`&&(s=r-i):n===\`middle\`?c=(o-a)/2:n===\`end\`&&(c=o-a),this._legendComponent.setAttributes({dx:s,dy:c})}return n.x2=n.x1+i,n.y2=n.y1+a,n}onDataUpdate(){var e,t,n;if(JSON.stringify(this._preSelectedData)!==JSON.stringify(this._selectedData)){if(this._legendComponent){let e=this._getLegendAttributes(this.getLayoutRect());ce(e,this._cacheAttrs)||this._legendComponent.setAttributes(q({},e,{defaultSelected:this._selectedData}))}(t=(e=this.effect).onSelectedDataChange)==null||t.call(e),(n=this.getChart())==null||n.setLayoutTag(!0,null,!1),this.event.emit(Q.legendSelectedDataChange,{model:this})}}_getNeedClearVRenderComponents(){return[this._legendComponent]}clear(){super.clear(),this._cacheAttrs=null,this._preSelectedData=null}}XN.specKey=\`legends\`;class ZN extends XN{constructor(){super(...arguments),this.type=a.discreteLegend,this.name=a.discreteLegend}static getSpecInfo(e){return tA(e,this.specKey,this.type,(e=>!e.type||e.type===\`discrete\`))}init(e){super.init(e),qS(this._regions,(e=>{e.addViewDataFilter({type:\`discreteLegendFilter\`,options:{series:e,selected:()=>this._selectedData,field:()=>this._getSeriesLegendField(e),data:()=>this.getLegendDefaultData(),customFilter:this._spec.customFilter},level:YO.legendFilter})}),{userId:this._seriesUserId,specIndex:this._seriesIndex})}_initLegendData(){VO(this._option.dataSet,\`discreteLegendFilter\`,YN),VO(this._option.dataSet,\`discreteLegendDataMake\`,JN);let e=new Sn(this._option.dataSet,{name:\`\${this.type}_\${this.id}_data\`});return e.transform({type:\`discreteLegendDataMake\`,options:{series:()=>{let e=[];return qS(this._regions,(t=>{e.push(t)}),{specIndex:this._spec.seriesIndex,userId:this._spec.seriesId}),e},seriesField:e=>this._getSeriesLegendField(e)}}),e}_getSeriesLegendField(e){var t;let n=e.getSeriesField(),r=this._spec.scaleName??this._spec.scale;if(f(r)||!e.getRawData())return n;let i=this._option.globalScale.getScaleSpec(r);if(!i)return n;if(this._spec.field)return this._spec.field;if(!zm(i.domain))return n;let a=i.domain.find((t=>t.dataId===e.getRawData().name));return a&&(t=a.fields?.[0])!=null?t:n}_initSelectedData(){let e=this.getLegendDefaultData();if(this._unselectedData){let t=[],n=[];e.forEach((e=>{this._unselectedData.includes(e)?n.push(e):t.push(e)})),this._selectedData=t,this._unselectedData=n}else this._spec.defaultSelected?this._selectedData=[...this._spec.defaultSelected]:this._selectedData=e}getLegendDefaultData(e){return d(this._spec.data)?this._getLegendItems().map((e=>e.label)):this._legendData.getLatestData().map(e?e=>e.originalKey:e=>e.key)}_addDefaultTitleText(e){if(e.title?.visible&&f(e.title.text)&&f(e.title.style?.text)){let t=(this._regions?.[0])?.getSeries()[0];if(!t)return;e.title.text=eT(t.getRawData(),t.getSeriesField())}}_getLegendAttributes(e){let t=this.layoutOrient===\`bottom\`||this.layoutOrient===\`top\`?\`horizontal\`:\`vertical\`,n=Object.assign(Object.assign({layout:t,items:this._getLegendItems(),zIndex:this.layoutZIndex},qN(this._spec,e)),{maxWidth:e.width,maxHeight:e.height});return this._addDefaultTitleText(n),this._addLegendItemFormatMethods(n),n}_getLegendConstructor(){return zS}setSelectedData(e){e&&(this._unselectedData=this.getLegendDefaultData().filter((t=>!e.includes(t)))),super.setSelectedData(e)}_initEvent(){if(this._legendComponent){let e=!1!==this._spec.filter;this._legendComponent.addEventListener(PS.legendItemClick,(t=>{let n=j(t,\`detail.currentSelected\`);e&&this.setSelectedData(n),this.event.emit(Q.legendItemClick,{model:this,value:n,event:t})})),this._legendComponent.addEventListener(PS.legendItemHover,(e=>{let t=j(e,\`detail\`);this.event.emit(Q.legendItemHover,{model:this,value:t,event:e})})),this._legendComponent.addEventListener(PS.legendItemUnHover,(e=>{let t=j(e,\`detail\`);this.event.emit(Q.legendItemUnHover,{model:this,value:t,event:e})}))}}_getLegendItems(){let e=(this._legendData.getLatestData()||[]).map((e=>{let t=e.style(\`fillOpacity\`),n=e.style(\`strokeOpacity\`),r=e.style(\`opacity\`),i=e.style(\`texture\`);return{label:e.key,shape:{symbolType:e.style(\`symbolType\`)??e.shapeType??\`circle\`,fillOpacity:C(t)?t:1,strokeOpacity:C(n)?n:1,opacity:C(r)?r:1,texturePadding:i?1:null,textureSize:i?4:null,texture:i,fill:e.style(\`fill\`),stroke:e.style(\`stroke\`),textureColor:e.style(\`textureColor\`),innerBorder:e.style(\`innerBorder\`),outerBorder:e.style(\`outerBorder\`),lineDash:e.style(\`lineDash\`),lineDashOffset:e.style(\`lineDashOffset\`),lineWidth:e.style(\`lineWidth\`)}}}));return d(this._spec.data)?this._spec.data(e,this._option.globalScale.getScale(\`color\`),this._option.globalScale):e}_addLegendItemFormatMethods(e){let{formatMethod:t,formatter:n}=this._spec.item?.label??{},{formatMethod:r,formatter:i}=this._spec.item?.value??{},{formatFunc:a}=eA(t,n);n&&!t&&a&&(e.item.label.formatMethod=(e,t)=>a(e,t,n));let{formatFunc:o}=eA(r,i);i&&!r&&o&&(e.item.value.formatMethod=(e,t)=>o(i,e,t,n))}}ZN.specKey=\`legends\`,ZN.type=a.discreteLegend;let QN=\`vchart-tooltip\`,$N=\`\${QN}-container\`,eP=\`\${QN}-title\`,tP=\`\${QN}-content-box\`,nP={offsetX:10,offsetY:10},rP=\`99999999999999\`;function iP(e){return String(e).replace(/&/g,\`&amp;\`).replace(/</g,\`&lt;\`).replace(/>/g,\`&gt;\`).replace(/\\(/g,\`&#40;\`).replace(/  /g,\` &nbsp;\`)}let aP=(e,t)=>e?(t||=e.getBoundingClientRect(),e.offsetWidth>0?t.width/e.offsetWidth:e.offsetHeight>0?t.height/e.offsetHeight:1):1,oP=e=>v(e)&&e?.trim()!==\`\`||S(e)?iP(e):\`\`,sP=(e,t)=>{let n;if(p(e)){if(S(e))n=e;else if(d(e)){let r=e(t);S(r)&&(n=r)}}return n},cP={left:[-2,0],right:[2,0],top:[0,-2],lt:[-2,-2],tl:[-2,-2],rt:[2,-2],tr:[2,-2],bottom:[0,2],bl:[-2,2],lb:[-2,2],br:[2,2],rb:[2,2],inside:[0,0],center:[0,0],centerBottom:[0,1],centerTop:[0,-1],centerLeft:[-1,0],centerRight:[1,0]},lP=(e,t,n=2)=>cP[e]?.[t===\`x\`?0:1]??n;class uP extends lj{constructor(){super(...arguments),this._visible=!0,this._isReleased=!1,this.showTooltip=(e,t,n)=>{let{changePositionOnly:r}=n;return r?this.changeTooltipPosition(n,t):this.changeTooltip(!0,n,t)},this.changeTooltip=(e,t,n)=>this._isReleased?1:e?this.changeTooltipPosition(t,n):(this._updateTooltip(!1,t),0),this.changeTooltipPosition=(e,t)=>{var n;if(this._isReleased)return 1;let r=e.event,{tooltipSpec:i,activeTooltipSpec:a,changePositionOnly:o}=e;if(!a)return 1;let s=a.activeType;if(a.handler)return(n=a.handler).showTooltip?.call(n,s,t,e)??0;let c=a;a.position=this._getActualTooltipPosition(a,e,this._getTooltipBoxSize(a,o));let l=a.updatePosition??i[s]?.updatePosition;l&&(a.position=l(a.position,t,e));let u=!1!==c?.visible;return t&&r.type!==\`pointerout\`&&a.visible&&(a.title||a.content)||(u=!1),this._updateTooltip(u,Object.assign(Object.assign({},e),{changePositionOnly:o})),0},this._getActualTooltipPosition=(e,t,n)=>{let{tooltipSpec:r}=t,i={x:1/0,y:1/0};if(!r)return i;let a=t.event,{activeType:o,data:s}=e,c=o===\`dimension\`?s[0]?.data?.[0]:s?.[0],{offsetX:l,offsetY:u}=this._option,f=r[o],h=rA(f?.position,s,t),g=rA(f?.positionMode,s,t)??(o===\`mark\`?\`mark\`:\`pointer\`),{width:_=0,height:v=0}=n??{},y=r.renderMode===\`canvas\`,b=(t?.chart)?.getCanvasRect(),x=b?.width??500,w=b?.height??500,T=!1,E={width:0,height:0},D,O={x:0,y:0},k={x:0,y:0},A=1,j=1,ee=Nm(this._env);if(ee&&!r.confine?(E.width=window.innerWidth,E.height=window.innerHeight):(E.width=x,E.height=w),ee&&!y){let e=this._getParentElement(r);k=(e?.getBoundingClientRect)?.call(e)??i;let t=this._compiler.getCanvas()??this._chartContainer;D=t?.getBoundingClientRect(),O={x:D.x-k.x,y:D.y-k.y},A=aP(t,D),j=aP(e,k)}let te=j/A,M={},ne={x:h,y:h},re={x:[\`left\`,\`right\`],y:[\`top\`,\`bottom\`]},ie=({orient:e,mode:n,offset:r},i)=>{let a,o,s=t.model?.getLayoutStartPoint(),d=r??(i===\`x\`?l:u);if(n===\`mark\`){T=!0;let e=t.item?.getBounds();e&&s&&(a=(i===\`x\`?e.x1:e.y1)+s[i],o=(i===\`x\`?e.x2:e.y2)+s[i])}else if(n===\`crosshair\`&&c?.series?.coordinate===\`cartesian\`&&c.datum&&c.datum.length){T=!0;let e=((e,t)=>{let n=new Map,r=new Map,{series:i,datum:a}=e,o=i.direction===\`horizontal\`,s=(o?i.getYAxisHelper():i.getXAxisHelper()).getAxisId(),c=i.getChart().getComponentsByKey(\`axes\`).find((e=>e.id===s));if(!c)return;(o?r:n).set(c.getSpecIndex(),{datum:i.getDatumPositionValues(a[0],i.getDimensionField())?.[0],axis:c});let l={xField:{coordKey:\`x\`,anotherAxisKey:\`y\`,currentValue:n,attributes:{visible:!!n.size,type:\`rect\`}},yField:{coordKey:\`y\`,anotherAxisKey:\`x\`,currentValue:r,attributes:{visible:!!r.size,type:\`rect\`}}};return SN(l,i,t),l.xField.cacheInfo?TN(l.xField):l.yField.cacheInfo?TN(l.yField):void 0})(c,s);e&&(a=e.start[i],o=e.end[i])}else ne[i]=e;if(T){let t=re[i][0],n=i===\`x\`?_:v;switch(lP(e,i)){case-2:M[t]=a-n*te-d;break;case 0:M[t]=(a+o)/2-n*te/2;break;case-1:M[t]=(a+o)/2-n*te-d;break;case 1:M[t]=(a+o)/2+d;break;case 2:M[t]=o+d}}},N=[\`x\`,\`y\`];if(m(h))if(m(ae=h)&&(p(ae.left)||p(ae.right)||p(ae.top)||p(ae.bottom))){let{left:e,right:t,top:n,bottom:r}=h;M.left=sP(e,a),M.top=sP(n,a),M.right=sP(t,a),M.bottom=sP(r,a)}else (e=>m(e)&&(p(e.x)||p(e.y)))(h)&&N.forEach((e=>{let t=h[e];S(t)||d(t)?M[re[e][0]]=sP(t,a):ie(t,e)}));else p(h)&&(ie({orient:h,mode:g},\`x\`),ie({orient:h,mode:g},\`y\`));var ae;let oe={x:null,y:null};return N.forEach((e=>{let t=e===\`x\`?_:v,n=e===\`x\`?x:w,i=e===\`x\`?l:u,o=lP(ne[e],e);if(C(M[re[e][0]]))oe[e]=M[re[e][0]];else if(C(M[re[e][1]]))oe[e]=n-t*te-M[re[e][1]];else{let n=e===\`x\`?a.canvasX:a.canvasY;oe[e]=o>0?n+i:o===0?n-t*te/2:n-t*te-i}oe[e]*=A,ee&&(oe[e]+=O[e]),oe[e]/=j;let s=e===\`x\`?E.width:E.height,c=r.confine?-(k[e]-(D?.[e]??0)/A)/j:-k[e]/j,d=s/j+c-t;o!==2&&oe[e]<c?T?oe[e]=c:(oe[e]+=o===0?i+t/2:2*i+t,oe[e]>d&&(oe[e]=d)):o!==-2&&oe[e]>d&&(T?oe[e]=d:(oe[e]-=o===0?i+t/2:2*i+t,oe[e]<c&&(oe[e]=c)))})),oe}}get env(){return this._env}onAdd(e){super.onAdd(e);let t=e.component;this._component=t,this._chartOption=t.getOption(),this._env=this._chartOption.mode,this._chartContainer=this._chartOption.globalInstance.getContainer(),this._compiler=t.getCompiler(),this._initFromSpec()}hideTooltip(e){return this.changeTooltip(!1,e)}release(){var e,t;let n=this._component.getSpec()??{};n.handler?(t=(e=n.handler).release)==null||t.call(e):(this._removeTooltip(),this._isReleased=!0)}_getDefaultOption(){let{offset:e}=this._component.getSpec();return e?{offsetX:e.x??nP.offsetX,offsetY:e.y??nP.offsetY}:nP}_getParentElement(e){return e.parentElement}getTooltipContainer(){return this._container}_initFromSpec(){this._option=this._getDefaultOption()}reInit(){this._initFromSpec()}}uP.specKey=\`tooltip\`;let dP=(e,t)=>p(e)?y(e)?e.map((e=>\`\${e}px\`)).join(\` \`):\`\${e}px\`:t??\`initial\`,fP=(e={},t={})=>{p(e.fontFamily)&&(t.fontFamily=e.fontFamily);let n=e.fill??e.fontColor;return p(n)&&(t.color=n),p(e.fontWeight)&&(t.fontWeight=e.fontWeight),p(e.textAlign)&&(t.textAlign=e.textAlign),p(e.fontSize)&&(t.fontSize=dP(e.fontSize)),p(e.maxWidth)&&(t.maxWidth=dP(e.maxWidth)),e.multiLine||p(e.maxWidth)&&!1!==e.multiLine?(t.whiteSpace=\`initial\`,t.wordBreak=e.wordBreak??\`break-word\`):(t.wordBreak=\`normal\`,t.whiteSpace=\`nowrap\`),t},pP=(e={})=>{let{lineHeight:t}=e;return e.fontSize?gC(t,e.fontSize):0},mP=e=>{let{backgroundColor:t,border:n,shadow:r,padding:i}=e,a={borderWidth:\`\${n?.width??0}px\`},o=null;n!=null&&n.color&&(a.borderColor=n.color),t&&(a.backgroundColor=t),a.boxShadow=r?\`\${r.x}px \${r.y}px \${r.blur}px \${r.spread}px \${r.color}\`:\`initial\`;let{radius:s}=n??{};return p(s)&&(a.borderRadius=C(s)?\`\${s}px\`:\`\${s}\`),i&&(o=Bt(i),a.padding=dP(o)),{panelStyle:a,panelPadding:o}};function hP(e,t){e&&e.style&&t&&Object.keys(t).forEach((n=>{e.style[n]=t[n]}))}class gP extends uP{getVisibility(){return!!this._rootDom&&this._rootDom.style.visibility===\`visible\`}setVisibility(e){e!==this.getVisibility()&&this._rootDom&&(this._rootDom.style.visibility=e?\`visible\`:\`hidden\`)}constructor(){super(gP.type),this.type=IN.dom,this._tooltipContainer=Mm?.body}onAdd(e){super.onAdd(e),this._initStyle(),this.initEl()}initEl(){let e=this._component.getSpec().parentElement;if(Mm&&e&&e.children&&e.children.length){for(let t=0;t<e.children.length;t++)if(e.children[t].classList.contains($N)){this._container=e.children[t];break}this._container||(this._container=Mm.createElement(\`div\`),this._container.style.position=\`relative\`,this._container.style.zIndex=rP,this._container.classList.add($N),e.appendChild(this._container))}}initRootDom(){let e=this._component.getSpec(),t=document.createElement(\`div\`),n=this._chartOption?.getTheme()??{};hP(t,Object.assign({left:\`0\`,top:\`0\`,pointerEvents:\`none\`,padding:\`12px\`,position:\`absolute\`,zIndex:rP,fontFamily:n?.fontFamily??sw.fontFamily,fontSize:\`11px\`,borderRadius:\`3px\`,borderStyle:\`solid\`,lineHeight:\`initial\`,background:\`#fff\`,boxShadow:\`2px 2px 4px rgba(0, 0, 0, 0.1)\`,maxWidth:\`100wh\`,maxHeight:\`100vh\`,visibility:\`hidden\`},this._domStyle.panel)),t.classList.add(e.className),t.setAttribute(\`vchart-tooltip-id\`,\`\${this.id}\`),this._container.appendChild(t),this._rootDom=t}_getTooltipBoxSize(e,t){this._rootDom||this.initRootDom(),t||this._updateDomStringByCol(e),this._updateDomStyle(\`height\`);let n=this._rootDom?.getBoundingClientRect();return{width:n?.width,height:n?.height}}_removeTooltip(){this._rootDom&&this._rootDom.parentNode&&(this._rootDom.parentNode.removeChild(this._rootDom),this._rootDom=null),this._container=null}_updateTooltip(e,t){if(e&&this._rootDom){let{tooltipSpec:n,activeTooltipSpec:r}=t;t.changePositionOnly||(this._tooltipActual=r);let i=this.getVisibility(),a=this._rootDom;if(a){let{x:e=0,y:o=0}=r.position??{};if(n.updateElement){this._updatePosition(this._cacheCustomTooltipPosition??{x:e,y:o}),n.updateElement(a,r,t);let i=this._getActualTooltipPosition(r,t,{width:a.offsetWidth,height:a.offsetHeight});this._updatePosition(i),this._cacheCustomTooltipPosition=i}else this._rootDom.style.transitionDuration=i?this._domStyle.panel.transitionDuration??\`initial\`:\`0ms\`,this._updatePosition({x:e,y:o})}this.setVisibility(e)}else this.setVisibility(e),this._cacheCustomTooltipPosition=void 0}_initStyle(){this._domStyle=((e={})=>{let{style:t={},enterable:n,transitionDuration:r}=e,{panel:i={},titleLabel:a,shape:o,keyLabel:s,valueLabel:c,spaceRow:l,align:u}=t,{panelStyle:d,panelPadding:f}=mP(i),p={marginTop:\`0px\`,marginBottom:\`0px\`};d.pointerEvents=n?\`auto\`:\`none\`,r&&(d.transitionDuration=r?\`\${r}ms\`:\`initial\`,d.transitionProperty=r?\`transform\`:\`initial\`,d.transitionTimingFunction=r?\`ease-out\`:\`initial\`),C(l)&&(p.marginBottom=\`\${l}px\`);let m={width:dP(o?.size??8)},h=fP(a),g=fP(s),_=fP(c),v=u===\`right\`?\`marginLeft\`:\`marginRight\`;u===\`right\`?(d.direction=\`rtl\`,h.textAlign=\`right\`,g.textAlign=\`right\`,_.textAlign=\`left\`):(h.textAlign=\`left\`,g.textAlign=\`left\`,_.textAlign=\`right\`),m[v]=dP(o.spacing??8),g[v]=dP(s.spacing??26),_[v]=dP(c.spacing??0);let y=Math.max(pP(c),pP(s));return p.lineHeight=y>0?\`\${y}px\`:\`20px\`,{panelPadding:f,row:p,panel:d,title:h,shape:m,key:g,value:_}})(this._component.getSpec())}_updateDomStringByCol(e){let{title:t={},content:n}=e,r=n&&n.length,i=this._domStyle.row,a=[...this._rootDom.children],o=a.find((e=>e.className.includes(eP)));if(!o&&!1!==t.visible){o=document.createElement(\`h2\`);let e=document.createElement(\`span\`);o.appendChild(e),o.classList.add(eP),this._rootDom.appendChild(o)}o&&!1!==t.visible?(hP(o,Object.assign(Object.assign(Object.assign({},this._domStyle.title),r?i:{marginBottom:\`0px\`}),{marginTop:\`0px\`})),o.firstChild.innerHTML=\`\${t.value??\`\`}\`):o&&!1===t.visible&&o.parentNode.removeChild(o);let s=a.find((e=>e.className.includes(tP))),c=[\`shape\`,\`key\`,\`value\`];if(!s&&r&&(s=document.createElement(\`div\`),c.forEach((e=>{let t=document.createElement(\`div\`);t.classList.add(\`\${QN}-column\`),t.classList.add(\`\${QN}-\${e}-column\`),t.setAttribute(\`data-col\`,e),s.appendChild(t)})),s.classList.add(tP),this._rootDom.appendChild(s)),s&&r){let e=[...s.children];hP(s,{whiteSpace:\`nowrap\`}),e.forEach(((e,t)=>{let r=e.getAttribute(\`data-col\`);if(r&&c.includes(r)){let t=r===\`shape\`&&n.every((e=>!e.hasShape||!e.shapeType));hP(e,Object.assign(Object.assign({},this._domStyle[r]),{display:t?\`none\`:\`inline-block\`,verticalAlign:\`top\`}));let a=[...e.children];a.slice(n.length).forEach((e=>{e.parentNode.removeChild(e)})),n.forEach(((t,o)=>{let s=a[o];s||(s=document.createElement(\`div\`),s.classList.add(\`\${QN}-\${r}\`),e.appendChild(s));let c=Object.assign({},i);o===n.length-1&&(c.marginBottom=\`0px\`),c.display=!1===t.visible?\`none\`:\`block\`,c.height=\`initial\`,r===\`key\`?(s.innerHTML=oP(t.key),t.keyStyle&&fP(t.keyStyle,c)):r===\`value\`?(s.innerHTML=oP(t.value),t.valueStyle&&fP(t.valueStyle,c)):r===\`shape\`&&(s.innerHTML=function(e,t){if(!e||!e.hasShape||!e.shapeType)return\`\`;let n=\`style="display:inline-block;vertical-align:middle;"\`,{shapeType:r,shapeFill:i,shapeStroke:a,shapeHollow:o=!1}=e,s=e.shapeSize??8,c=e.shapeLineWidth?iP(e.shapeLineWidth)+\`px\`:\`0px\`,l=\`currentColor\`,u=()=>a?iP(a):l,d=s,f=e=>new eu({symbolType:e,size:d,fill:!0}),p=f(r),h=p.getParsedPath(),g,_;if(!h.path&&h.pathStr&&(p=f(h.pathStr)),p.getParsedPath().path){let e=p.getParsedPath().path;_=e.toString(),g=e.bounds}else h.isSvg&&h.svgCache&&(_=h.svgCache.map((e=>e.path.toString())).join(),g=h.svgCache.reduce(((e,t)=>e.union(t.path.bounds)),new xt));let y=\`\${g.x1} \${g.y1} \${g.width()} \${g.height()}\`;if(c!==\`0px\`){let[e,t,n,r]=y.split(\` \`).map((e=>Number(e))),i=Number(c.slice(0,-2));y=\`\${e-i/2} \${t-i/2} \${n+i} \${r+i}\`}if(!i||v(i)||o)return l=o?\`none\`:i?iP(i):\`currentColor\`,\`\\n    <svg \${n} width="\${s}" height="\${s}" viewBox="\${y}">\\n      <path\\n        d="\${_}"\\n        style="fill: \${l}; stroke: \${u()}; stroke-width: \${c}"\\n      >\\n      </path>\\n    </svg>\`;if(m(i)){l=\`gradientColor\`+(t??\`\`);let e=\`\`,r=(i.stops??[]).map((e=>\`<stop offset="\${iP(e.offset.toString())}" stop-color="\${iP(e.color)}"/>\`)).join(\`\`);return i.gradient===\`radial\`?e=\`<radialGradient id="\${l}" cx="50%" cy="50%" r="50%" fx="0%" fy="0%">\\n      \${r}\\n      </radialGradient>\`:i.gradient===\`linear\`&&(e=\`<linearGradient id="\${l}" x1="\${100*(i.x0??0)}%" y1="\${100*(i.y0??0)}%" x2="\${100*(i.x1??0)}%" y2="\${100*(i.y1??0)}%">\\n      \${r}\\n      </linearGradient>\`),\`\\n    <svg \${n} width="\${s}" height="\${s}" viewBox="-0.5 -0.5 1 1">\\n      \${e}\\n      <path\\n        d="\${_}"\\n        style="fill: url(#\${l}); stroke: \${u()}; stroke-width: \${c}"\\n      >\\n      </path>\\n    </svg>\`}return\`\`}(t,\`\${this.id}_\${o}\`)),hP(s,c)}))}}))}else s&&!r&&s.parentNode.removeChild(s)}_updateDomStyle(e=\`width\`){let t=this._rootDom,n=[...t.children].find((e=>e.className.includes(tP)));if(n){let r=this._component.getSpec(),i={};if(p(r?.style?.maxContentHeight)){let e=t.children[0],a=e&&e.className.includes(eP)?e.getBoundingClientRect().height+(r.style.spaceRow??0):0,o=this._chartOption.getChartViewRect(),s=gC(r.style.maxContentHeight,Math.min(o.height,document.body.clientHeight)-a-(this._domStyle.panelPadding?this._domStyle.panelPadding[0]+this._domStyle.panelPadding[1]:0));s>0&&(i.maxHeight=\`\${s}px\`,i.overflowY=\`auto\`,i.width=\`calc(100% + \${this._domStyle.panelPadding?this._domStyle.panelPadding[1]+\`px\`:\`10px\`})\`,hP(n,i))}let a=n.children,o=[];if(a){for(let t=0;t<a.length;t++){let n=a[t].children??[];for(let t=0;t<n.length;t++){let r=n[t].getBoundingClientRect()[e];(o[t]===void 0||o[t]<r)&&(o[t]=r)}}for(let t=0;t<a.length;t++){let n=a[t].children??[];for(let t=0;t<n.length;t++)n[t].style[e]=\`\${o[t]}px\`}}}}_getParentElement(e){return this._container??super._getParentElement(e)}isTooltipShown(){return this.getVisibility()}reInit(){super.reInit(),this._initStyle(),this._rootDom&&hP(this._rootDom,this._domStyle.panel),this.getVisibility()&&(this._updateDomStringByCol(this._tooltipActual),this._updateDomStyle(\`height\`))}_updatePosition({x:e,y:t}){this._rootDom&&(this._rootDom.style.transform=\`translate3d(\${e}px, \${t}px, 0)\`)}}gP.type=IN.dom;let _P={fontFamily:sw.fontFamily,spacing:10,wordBreak:\`break-word\`},vP=(e,t)=>{let n,r;e?.type!==\`rich\`&&e?.type!==\`html\`?(e=(e??\`\`).toString(),t.multiLine?(n=e.split(\`
\`),n=n.map(((e,t)=>t<n.length-1?e+\`
\`:e))):n=[e],r=n.map((e=>Object.assign(Object.assign({},t),{text:e})))):(r=e.text,n=e);let i=(a={wordBreak:t.wordBreak??\`break-word\`,maxWidth:t.maxWidth?t.maxWidth:void 0,width:0,height:0,textConfig:r},Fu||=U.CreateGraphic(\`richtext\`,{}),Fu.setAttributes(a),Fu.AABBBounds);var a;return{width:i.width(),height:i.height(),text:n}};function yP(e={},t,n){return Object.assign(Object.assign({},n??_P),{fill:e.fill??e.fontColor,textAlign:e.textAlign,textBaseline:e.textBaseline,fontFamily:e.fontFamily??t?.fontFamily,fontSize:e.fontSize,fontWeight:e.fontWeight,lineHeight:e.lineHeight,spacing:e.spacing,multiLine:p(e.maxWidth)?!1!==e.multiLine:e.multiLine,maxWidth:e.maxWidth,wordBreak:e.wordBreak,autoWidth:e.autoWidth})}let bP=e=>{let{backgroundColor:t,border:n,shadow:r}=e,i={lineWidth:n?.width??0,shadow:!!r};n!=null&&n.color&&(i.stroke=n.color),t&&(i.fill=t),r&&(i.shadowColor=r.color,i.shadowBlur=r.blur,i.shadowOffsetX=r.x,i.shadowOffsetY=r.y,i.shadowSpread=r.spread);let{radius:a}=n??{};return p(a)&&(i.cornerRadius=[a,a,a,a]),i};class xP extends uP{constructor(){super(xP.type),this.type=IN.canvas,this._attributes=null}onAdd(e){super.onAdd(e),this._tooltipCanvasId=this._chartOption.modeParams?.tooltipCanvasId}_initTooltipComponent(e){let t=this._getLayer(e);this._tooltipComponent=new WS({autoCalculatePosition:!1,autoMeasure:!1}),t.add(this._tooltipComponent)}_getLayer(e){if(this._layer)return this._layer;this._layer=e.createLayer(this._tooltipCanvasId);let t=this._layer.layerHandler.canvas.nativeCanvas;return t&&t.style&&(t.style.touchAction=\`none\`,t.style.pointerEvents=\`none\`),this._layer}_getTooltipBoxSize(e,t){if(!t||f(this._attributes)){let t=this._chartOption?.getTheme()??{};this._attributes=((e,t,n)=>{var r;let{style:i={},enterable:a,transitionDuration:o}=t,{panel:s={},titleLabel:c,shape:l,keyLabel:u,valueLabel:d,spaceRow:f,align:m}=i,h=Bt(s.padding),g=vC(s.padding),_=yP(Object.assign({textAlign:m===\`right\`?\`right\`:\`left\`},c),n),v=yP(Object.assign({textAlign:m===\`right\`?\`right\`:\`left\`},u),n),y=yP(d,n),b={fill:!0,size:l?.size??8,spacing:l?.spacing??6},x={panel:bP(s),padding:h,title:{},content:[],titleStyle:{value:_,spaceRow:f},contentStyle:{shape:b,key:v,value:y,spaceRow:f},hasContentShape:!1,keyWidth:0,valueWidth:0,enterable:a,transitionDuration:o,align:m},{title:S={},content:C=[]}=e,w=g.left+g.right,T=g.top+g.bottom,E=0,D=!!C.length,O=0,k=0,A=0,j=0;if(D){let e=[],t=[],n=[],r=[],i=0;x.content=C.map(((a,o)=>{let s=0,{hasShape:c,key:l,shapeType:u=\`\`,shapeFill:d,shapeStroke:m,shapeLineWidth:h,shapeSize:g,value:_,isKeyAdaptive:x,spaceRow:S,keyStyle:w,valueStyle:T,shapeHollow:E}=a,D={height:0,spaceRow:S??f};if(p(l)){let n=q({},v,yP(w,void 0,{})),{width:r,height:i,text:a}=vP(l,n);D.key=Object.assign(Object.assign({width:r,height:i},n),{text:a}),x?t.push(r):e.push(r),s=Math.max(s,i)}if(p(_)){let e=q({},y,yP(T,void 0,{})),{width:t,height:r,text:i}=vP(_,e);D.value=Object.assign(Object.assign({width:t,height:r},e),{text:i}),n.push(t),s=Math.max(s,r)}if(c){let e={visible:!0,symbolType:u};E?e.stroke=d:e.fill=d,e.stroke=m??d,e.lineWidth=h,D.shape=e;let t=g??b.size;s=Math.max(t,s),r.push(t)}else D.shape={visible:!1};return D.height=s,i+=s,o<C.length-1&&(i+=D.spaceRow),D})),T+=i,O=e.length?fe(e):0,k=t.length?fe(t):0,A=n.length?fe(n):0,j=r.length?fe(r)+b.spacing:0,E=Math.max(j+O+v.spacing+A+y.spacing,j+k,E),x.hasContentShape=!!r.length,x.keyWidth=O,x.valueWidth=A}let ee=0,te=0,M=0,{visible:ne=!0,value:re=\`\`,valueStyle:ie,spaceRow:N}=S;x.title.visible=ne,x.title.spaceRow=N??f;let ae={},oe=()=>ae.autoWidth&&!1!==ae.multiLine;if(ne){ae=q({},_,yP(ie,void 0,{})),oe()&&(ae.multiLine=(r=ae.multiLine)==null||r,ae.maxWidth=ae.maxWidth??(D?Math.ceil(E):void 0));let{text:e,width:t,height:n}=vP(re,ae);x.title.value=Object.assign(Object.assign({width:oe()?Math.min(t,ae.maxWidth??Number.MAX_VALUE):t,height:n},ae),{text:e}),ee=x.title.value.width,te=x.title.value.height,M=te+(D?x.title.spaceRow:0)}return T+=M,x.title.width=ee,x.title.height=te,oe()?w+=E||ee:w+=Math.max(ee,E),D&&x.content.forEach((e=>{var t;let n=e.value;n&&((t=n.autoWidth)==null||t)&&(n.width=w-g.left-g.right-j-O-v.spacing-y.spacing,n.maxWidth||=Math.ceil(n.width),x.valueWidth=Math.max(x.valueWidth,n.width))})),x.panel.width=w,x.panel.height=T,x})(e,this._component.getSpec(),t)}let{panel:n}=this._attributes??{};return{width:n.width+n.lineWidth,height:n.height+n.lineWidth}}_removeTooltip(){this._layer&&this._layer.removeAllChild(),this._attributes=null}_updateTooltip(e,t){this._visible=e;let n=this._compiler.getStage();if(!n)return;if(!e)return void(this._tooltipComponent&&this._tooltipComponent.attribute.visible&&(this._tooltipComponent.hideAll(),this._tooltipComponent.setAttributes({visibleAll:!1})));this._tooltipComponent||this._initTooltipComponent(n);let{activeTooltipSpec:r}=t,i=r.position;t.changePositionOnly?p(i)&&this._tooltipComponent.setAttributes(i):this._tooltipComponent.setAttributes(Object.assign(Object.assign({},this._attributes),i)),this._tooltipComponent.attribute.visible||(this._tooltipComponent.showAll(),this._tooltipComponent.setAttributes({visibleAll:!0}))}isTooltipShown(){return this._tooltipComponent?.attribute.visibleAll}release(){var e;super.release(),(e=this._layer)==null||e.release()}}xP.type=IN.canvas;let SP=/\\{([^}]+)\\}/,CP=/\\{([^}]+)\\}/g,wP=/:/;class TP extends lj{constructor(){super(TP.type),this.type=\`formatterPlugin\`,this._timeModeFormat={utc:Ht.getInstance().timeUTCFormat,local:Ht.getInstance().timeFormat},this._formatter=this._format,this._timeFormatter=this._timeModeFormat.local,this._numericFormatter=Xt.getInstance().format,this._numericSpecifier=Xt.getInstance().formatter,this._numericFormatterCache=new Map,this._isNumericFormatterCache=new Map}onInit(e,t){let{globalInstance:n}=e;if(!n)return;this._spec=t?.[TP.specKey]??{};let{timeMode:r,customFormatter:i,numericFormatter:a,timeFormatter:o}=this._spec;d(i)?this._formatter=i:(this._formatter=this._format.bind(this),d(o)?this._timeFormatter=o:r&&this._timeModeFormat[r]&&(this._timeFormatter=this._timeModeFormat[r]),a&&(this._numericFormatter=a,this._numericSpecifier=null,this._numericFormatterCache=null)),J.registerFormatter(this._formatter)}_format(e,t,n){return y(e)?e.map(((e,r)=>{let i=y(n)?n[r]:n;return i?this._formatSingleLine(e,t,i):e})):y(n)?n.map((n=>this._formatSingleLine(e,t,n))):this._formatSingleLine(e,t,n)}_formatSingleLine(e,t,n){let r;return this._isNumericFormatterCache&&(this._isNumericFormatterCache.get(n)?r=this._isNumericFormatterCache.get(n):(r=SP.test(n),this._isNumericFormatterCache.set(n,r))),r?n.replace(CP,((e,n)=>{if(!wP.test(n)){let r=t[n.trim()];return r===void 0?e:r}let r=n.split(\`:\`),i=t[r.shift()],a=r.join(\`:\`);return this._formatSingleText(i,a)})):this._formatSingleText(e,n)}_formatSingleText(e,t){if(qt.test(t)&&this._numericFormatter){let n;return this._numericFormatterCache&&this._numericSpecifier?(this._numericFormatterCache.get(t)?n=this._numericFormatterCache.get(t):(n=this._numericSpecifier(t),this._numericFormatterCache.set(t,n)),n(Number(e))):this._numericFormatter(t,Number(e))}return t.includes(\`%\`)&&this._timeFormatter?this._timeFormatter(t,e):e}release(){super.release(),this._format=null,this._timeFormatter=null,this._numericFormatter=null,this._numericSpecifier=null,this._numericFormatterCache=null,this._isNumericFormatterCache=null}}TP.pluginType=\`chart\`,TP.specKey=\`formatter\`,TP.type=\`formatterPlugin\`,Zk.useRegisters([()=>{CD(),wD(),ZA(),ej(),kA(),DA(),Uj(),Vj(),J.registerSeries(qj.type,qj),J.registerChart(iM.type,iM)},()=>{CD(),wD(),ZA(),SM(),ej(),TM(),Uj(),Vj(),J.registerSeries(DM.type,DM),J.registerChart(kM.type,kM)},()=>{vM(),J.registerChart(bM.type,bM)},()=>{YM(),J.registerChart($M.type,$M)},()=>{J.registerChart(tN.type,tN)},Vj,Uj,()=>{J.registerComponent(ZN.type,ZN)},()=>{J.registerComponent(KN.type,KN)},()=>{J.registerComponent(DN.type,DN)},()=>{Z.registerGraphicComponent(fT.label,(e=>new ES(e))),Z.registerComponent(fT.label,uD),gN(),Tj(),J.registerComponent(vN.type,vN,!0)},()=>{var e=xP;J.registerComponentPlugin(e.type,e)},()=>{var e=TP;J.registerChartPlugin(e.type,e)},sE,oE]),Zk.useRegisters([()=>{Y_(V)}]),e.DEFAULT_CHART_HEIGHT=500,e.DEFAULT_CHART_WIDTH=500,e.DEFAULT_DATA_INDEX=jw,e.DEFAULT_DATA_KEY=Mw,e.DEFAULT_DATA_SERIES_FIELD=Nw,e.DEFAULT_MEASURE_CANVAS_ID=Aw,e.DEFAULT_SERIES_STYLE_NAME=Pw,e.Factory=J,e.MOSAIC_CAT_END_PERCENT=Yw,e.MOSAIC_CAT_START_PERCENT=Jw,e.MOSAIC_VALUE_END_PERCENT=qw,e.MOSAIC_VALUE_START_PERCENT=Kw,e.PREFIX=K,e.SEGMENT_FIELD_END=Zw,e.SEGMENT_FIELD_START=Xw,e.STACK_FIELD_END=Lw,e.STACK_FIELD_END_OffsetSilhouette=Vw,e.STACK_FIELD_END_PERCENT=zw,e.STACK_FIELD_KEY=Fw,e.STACK_FIELD_START=Iw,e.STACK_FIELD_START_OffsetSilhouette=Bw,e.STACK_FIELD_START_PERCENT=Rw,e.STACK_FIELD_TOTAL=Hw,e.STACK_FIELD_TOTAL_BOTTOM=Gw,e.STACK_FIELD_TOTAL_PERCENT=Uw,e.STACK_FIELD_TOTAL_TOP=Ww,e.ThemeManager=Ew,e.VChart=Zk,e.builtinThemes=hw,e.computeActualDataScheme=nC,e.createArc=Ou,e.createArea=Tu,e.createGroup=$c,e.createLine=iu,e.createRect=su,e.createRichText=yu,e.createSymbol=tu,e.createText=Ql,e.darkTheme=lw,e.dataScheme=xC,e.default=Zk,e.defaultThemeName=gw,e.getActualColor=iC,e.getColorSchemeBySeries=cC,e.getDataScheme=tC,e.getMergedTheme=ww,e.getTheme=xw,e.hasThemeMerged=yw,e.isColorKey=aC,e.isProgressiveDataColorScheme=oC,e.isTokenKey=ow,e.lightTheme=cw,e.queryColorFromColorScheme=rC,e.queryToken=aw,e.registerTheme=bw,e.removeTheme=Sw,e.themeExist=Cw,e.themes=_w,e.token=sw,e.transformColorSchemeToStandardStruct=sC,e.version=\`1.13.8\`,e.vglobal=jp,Object.defineProperty(e,\`__esModule\`,{value:!0})}))})),u=c(l());Component({properties:{styles:{type:String},canvasId:{type:String},spec:{type:Object,observer(e,t){this.chart&&JSON.stringify(e)!==JSON.stringify(t)&&this.chart.updateSpec(e)}},options:{type:Object,value:{}},events:{type:Object,value:[]}},data:{offscreenCanvasWidth:0,offscreenCanvasHeight:0,chart:void 0},lifetimes:{attached(){this._onload()},detached(){this.chart&&this.chart.release()}},pageLifetimes:{show(){}},methods:{init(){wx.createSelectorQuery().in(this).select(\`#\${this.data.canvasId}_draw_canvas\`).fields({node:!0,size:!0}).exec(async e=>{e[0].node;let t=[\`\${this.data.canvasId}_draw_canvas\`,\`\${this.data.canvasId}_tooltip_canvas\`,\`\${this.data.canvasId}_hit_canvas\`],n={width:e[0].width,height:e[0].height};this.setData({offscreenCanvasWidth:n.width,offscreenCanvasHeight:n.height}),this.chart&&this.chart.release(),await u.vglobal.setEnv(\`wx\`,{domref:n,force:!0,canvasIdLists:t,freeCanvasIdx:2,component:this});let r=new u.default({...this.data.spec,width:n.width,height:n.height},{mode:\`wx\`,modeParams:{domref:n,force:!0,canvasIdLists:t,tooltipCanvasId:\`\${this.data.canvasId}_tooltip_canvas\`,freeCanvasIdx:2},dpr:wx.getSystemInfoSync().pixelRatio,renderCanvas:\`\${this.data.canvasId}_draw_canvas\`,...this.data.options});this.chart=r,this.triggerEvent(\`chartinit\`),this.data.events&&this.data.events.forEach(e=>{e&&r.on(e.type,{...e.query,source:\`chart\`},e.handler)}),r.renderAsync().then(e=>{this.triggerEvent(\`chartready\`)})})},_onload(){if(!this.data.spec||!this.data.canvasId){console.warn(\`组件需绑定 spec 变量并且设置唯一 canvas-id\`);return}wx.onWindowResize(e=>{this.init()}),this.init()},bindEvent(e){let{brand:t}=wx.getSystemInfoSync();if(t===\`PC\`&&e.type.startsWith(\`touch\`)||t!==\`PC\`&&e.type.startsWith(\`mouse\`))return;let n=this.chart;n&&(e.target=n.getCanvas(),n.getStage().window.dispatchEvent(e))}}});"
`;

exports[`build import-umd > dist > components/chart/index.json 1`] = `
"{
  "component": true
}"
`;

exports[`build import-umd > dist > components/chart/index.wxml 1`] = `
"<view class="vchart" id="{{ canvasId }}" style="{{ styles }}">
  <canvas
    class="cs-canvas"
    bindtouchstart="bindEvent"
    bindtouchmove="bindEvent"
    bindtouchend="bindEvent"
    bindmousemove="bindEvent"
    bindmouseover="bindEvent"
    bindmouseout="bindEvent"
    bindmousedown="bindEvent"
    bindmouseup="bindEvent"
    id="{{ canvasId }}_draw_canvas"
    canvas-id="{{ canvasId }}_draw_canvas"
    type="2d"
  ></canvas>
  <canvas width="{{ offscreenCanvasWidth }}" height="{{ offscreenCanvasHeight }}" id="{{ canvasId }}_hit_canvas"
    canvas-id="{{ canvasId }}_hit_canvas" class="cs-tooltip-canvas" type="2d"></canvas>
  <canvas width="{{ offscreenCanvasWidth }}" height="{{ offscreenCanvasHeight }}" id="{{ canvasId }}_tooltip_canvas"
    canvas-id="{{ canvasId }}_tooltip_canvas" class="cs-tooltip-canvas" type="2d"></canvas>
</view>
"
`;

exports[`build import-umd > dist > components/chart/index.wxss 1`] = `
".vchart{width:100%;height:100%;position:relative;padding:0!important}.cs-canvas{width:100%;height:100%;margin:0;display:block}.cs-canvas-hidden{opacity:0;visibility:hidden;display:none}.cs-tooltip-canvas{z-index:1;pointer-events:none;width:100%;height:100%;position:absolute;top:0;left:0}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > pages/index/index.js 1`] = `"Page({data:{spec:{},events:[],options:{}},chartType:\`\`,stage:void 0,onLoad(e){this.chartType=e.name||\`\`,this.setData({spec:{type:\`bar\`,data:[{id:\`barData\`,values:[{type:\`Autocracies\`,year:\`1930\`,value:129},{type:\`Autocracies\`,year:\`1940\`,value:133},{type:\`Autocracies\`,year:\`1950\`,value:130},{type:\`Autocracies\`,year:\`1960\`,value:126},{type:\`Autocracies\`,year:\`1970\`,value:117},{type:\`Autocracies\`,year:\`1980\`,value:114},{type:\`Autocracies\`,year:\`1990\`,value:111},{type:\`Autocracies\`,year:\`2000\`,value:89},{type:\`Autocracies\`,year:\`2010\`,value:80},{type:\`Autocracies\`,year:\`2018\`,value:80},{type:\`Democracies\`,year:\`1930\`,value:22},{type:\`Democracies\`,year:\`1940\`,value:13},{type:\`Democracies\`,year:\`1950\`,value:25},{type:\`Democracies\`,year:\`1960\`,value:29},{type:\`Democracies\`,year:\`1970\`,value:38},{type:\`Democracies\`,year:\`1980\`,value:41},{type:\`Democracies\`,year:\`1990\`,value:57},{type:\`Democracies\`,year:\`2000\`,value:87},{type:\`Democracies\`,year:\`2010\`,value:98},{type:\`Democracies\`,year:\`2018\`,value:99}]}],xField:[\`year\`,\`type\`],yField:\`value\`,seriesField:\`type\`,legends:{visible:!0,orient:\`top\`,position:\`start\`},axes:[{orient:\`left\`,label:{formatMethod:e=>\`$\${e}\`}}]}})},onChartInit(e){console.log(\`chart 实例初始化完成\`,e)},onChartReady(e){console.log(\`chart 实例渲染完成\`,e)}});"`;

exports[`build import-umd > dist > pages/index/index.json 1`] = `
"{
  "usingComponents": {
    "Navbar": "/components/Navbar/Navbar",
    "chart": "/components/chart/index"
  },
  "navigationBarTitleText": "初始模板"
}"
`;

exports[`build import-umd > dist > pages/index/index.wxml 1`] = `
"<view>
  <Navbar />
  <chart canvas-id="chart" spec="{{ spec }}" styles="{{ styles }}" events="{{ events }}" bind:chartinit="onChartInit" bind:chartready="onChartReady" />
</view>"
`;

exports[`build import-umd > dist > pages/index/index.wxss 1`] = `
".page{color:red}
/*$vite$:1*/"
`;

exports[`build import-umd > dist > sitemap.json 1`] = `
"{
  "desc": "关于本文件的更多信息，请参考文档 https://developers.weixin.qq.com/miniprogram/dev/framework/sitemap.html",
  "rules": [
    {
      "action": "allow",
      "page": "*"
    }
  ]
}"
`;

exports[`build import-umd > dist > theme.json 1`] = `
"{
  "light": {},
  "dark": {}
}"
`;

exports[`build import-umd > dist 1`] = `
[
  "app.js",
  "app.json",
  "app.wxss",
  "components/Navbar/Navbar.js",
  "components/Navbar/Navbar.json",
  "components/Navbar/Navbar.wxml",
  "components/Navbar/Navbar.wxss",
  "components/chart/index.js",
  "components/chart/index.json",
  "components/chart/index.wxml",
  "components/chart/index.wxss",
  "pages/index/index.js",
  "pages/index/index.json",
  "pages/index/index.wxml",
  "pages/index/index.wxss",
  "sitemap.json",
  "theme.json",
]
`;
