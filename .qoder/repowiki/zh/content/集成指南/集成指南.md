# 集成指南

<cite>
**本文档中引用的文件**  
- [tailwind.config.ts](file://templates/weapp-vite-tailwindcss-template/tailwind.config.ts)
- [postcss.config.js](file://templates/weapp-vite-tailwindcss-template/postcss.config.js)
- [package.json](file://templates/weapp-vite-tailwindcss-tdesign-template/package.json)
- [package.json](file://templates/weapp-vite-tailwindcss-vant-template/package.json)
- [index.ts](file://packages/plugin-wevu/src/index.ts)
- [plugin.ts](file://packages/plugin-wevu/src/plugin.ts)
- [runtime.ts](file://packages/plugin-wevu/src/runtime.ts)
- [tailwindcss.md](file://website/integration/tailwindcss.md)
- [tdesign.md](file://website/integration/tdesign.md)
- [vant.md](file://website/integration/vant.md)
- [vue-mini.md](file://website/integration/vue-mini.md)
- [extract.ts](file://apps/vite-native/scripts/extract.ts)
- [tdesign.json](file://apps/vite-native/scripts/tdesign.json)
- [vant.json](file://apps/vite-native/scripts/vant.json)
</cite>

## 目录
1. [Tailwind CSS 集成](#tailwind-css-集成)
2. [UI 组件库集成](#ui-组件库集成)
   - [TDesign 集成](#tdesign-集成)
   - [Vant 集成](#vant-集成)
   - [自动导入组件](#自动导入组件)
3. [Vue 语法支持插件](#vue-语法支持插件)
4. [其他构建工具集成](#其他构建工具集成)
5. [常见问题与解决方案](#常见问题与解决方案)

## Tailwind CSS 集成

weapp-vite 提供了对 Tailwind CSS 的完整支持，通过预配置模板和优化的构建流程，开发者可以轻松在小程序项目中使用 Tailwind CSS。

### PostCSS 配置

项目使用标准的 PostCSS 配置文件来集成 Tailwind CSS。配置文件中包含了必要的插件和处理流程：

```js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

此配置确保了 Tailwind CSS 能够正确处理样式，并添加必要的浏览器前缀。

### 类名提取配置

Tailwind CSS 的核心功能之一是按需提取类名，避免生成不必要的 CSS。在 weapp-vite 中，通过以下配置实现：

```ts
export default <Config>{
  content: [
    // 添加你需要提取的文件目录
    'src/**/*.{wxml,js,ts}',
  ],
  theme: {
    extend: {},
  },
  plugins: [
    iconsPlugin({
      collections: getIconCollections(['mdi']),
    }),
  ],
  corePlugins: {
    // 小程序不需要 preflight 和 container，因为这主要是给 h5 的
    preflight: false,
    container: false,
  },
}
```

关键配置说明：
- `content`：指定需要扫描的文件路径，确保所有 wxml、js、ts 文件中的类名都能被正确提取
- `corePlugins`：禁用 preflight 和 container 核心插件，因为这些主要是为 H5 端设计的，小程序环境不需要

### 运行时优化

weapp-vite 对 Tailwind CSS 进行了专门的运行时优化，包括：
- 按需加载：只生成项目中实际使用的类名
- 小程序适配：针对小程序的样式系统进行了特殊处理
- 构建性能：优化了构建流程，减少编译时间

**Section sources**
- [tailwind.config.ts](file://templates/weapp-vite-tailwindcss-template/tailwind.config.ts#L1-L23)
- [postcss.config.js](file://templates/weapp-vite-tailwindcss-template/postcss.config.js#L1-L7)
- [tailwindcss.md](file://website/integration/tailwindcss.md#L1-L18)

## UI 组件库集成

weapp-vite 支持多种流行的 UI 组件库，提供了简化的集成流程和优化的使用体验。

### TDesign 集成

TDesign 是腾讯推出的一套企业级设计体系，其小程序版本 tdesign-miniprogram 可以轻松集成到 weapp-vite 项目中。

#### 安装依赖

```sh
pnpm add tdesign-miniprogram
```

如果使用 tdesign-miniprogram 版本 >=1.9.0，还需要安装 tslib 作为依赖：

```sh
pnpm add -D tslib
```

#### 项目配置

1. **构建设置**：在微信开发者工具中，详情设置里勾选"将 JS 编译成 ES5"
2. **app.json 配置**：移除 `"style": "v2"` 配置项
3. **TypeScript 配置**：如果使用 TypeScript，需要在 tsconfig.json 中添加路径映射：

```json
{
  "paths": {
    "tdesign-miniprogram/*": ["./node_modules/tdesign-miniprogram/miniprogram_dist/*"]
  }
}
```

#### 手动使用组件

以按钮组件为例，在 JSON 文件中引入组件：

```json
{
  "usingComponents": {
    "t-button": "tdesign-miniprogram/button/button"
  }
}
```

然后在 WXML 中使用：

```html
<t-button theme="primary">按钮</t-button>
```

**Section sources**
- [package.json](file://templates/weapp-vite-tailwindcss-tdesign-template/package.json#L1-L42)
- [tdesign.md](file://website/integration/tdesign.md#L1-L84)

### Vant 集成

Vant Weapp 是有赞团队开发的小程序 UI 组件库，同样可以轻松集成到 weapp-vite 项目中。

#### 安装依赖

```sh
pnpm i @vant/weapp
```

#### 项目配置

1. **app.json 配置**：移除 `"style": "v2"` 配置项
2. **TypeScript 配置**：如果使用 TypeScript，需要在 tsconfig.json 中添加路径映射：

```json
{
  "paths": {
    "@vant/weapp/*": ["path/to/node_modules/@vant/weapp/dist/*"]
  }
}
```

#### 手动使用组件

以按钮组件为例，在 JSON 文件中引入组件：

```json
{
  "usingComponents": {
    "van-button": "@vant/weapp/button/index"
  }
}
```

然后在 WXML 中使用：

```html
<van-button type="primary">按钮</van-button>
```

**Section sources**
- [package.json](file://templates/weapp-vite-tailwindcss-vant-template/package.json#L1-L42)
- [vant.md](file://website/integration/vant.md#L1-L70)

### 自动导入组件

weapp-vite 提供了自动导入组件的功能，可以避免手动在每个页面的 JSON 文件中注册组件。

#### TDesign 自动导入

```ts
import { TDesignResolver } from 'weapp-vite/auto-import-components/resolvers'

export default <UserConfig>{
  weapp: {
    enhance: {
      autoImportComponents: {
        resolvers: [
          TDesignResolver(),
        ],
      },
    },
  },
}
```

#### Vant 自动导入

```ts
import { VantResolver } from 'weapp-vite/auto-import-components/resolvers'

export default <UserConfig>{
  weapp: {
    enhance: {
      autoImportComponents: {
        resolvers: [
          VantResolver(),
        ],
      },
    },
  },
}
```

系统通过预提取的组件列表（如 tdesign.json 和 vant.json）来实现自动导入功能，这些列表包含了所有可用的组件名称。

**Section sources**
- [tdesign.md](file://website/integration/tdesign.md#L61-L84)
- [vant.md](file://website/integration/vant.md#L47-L70)
- [extract.ts](file://apps/vite-native/scripts/extract.ts#L1-L50)
- [tdesign.json](file://apps/vite-native/scripts/tdesign.json#L1-L79)
- [vant.json](file://apps/vite-native/scripts/vant.json#L1-L72)

## Vue 语法支持插件

weapp-vite 通过 plugin-wevu 插件提供了对 Vue 语法的支持，允许开发者使用 Vue 的单文件组件（SFC）语法开发小程序。

### 插件实现原理

plugin-wevu 插件的核心功能是将 Vue 单文件组件转换为小程序原生的文件结构。插件的主要组成部分包括：

- **编译器**（compiler）：负责解析 Vue SFC 并生成相应的代码
- **Vite 插件**（plugin）：集成到 Vite 构建流程中
- **运行时**（runtime）：提供 Vue 风格的响应式系统和组件生命周期

### 使用方法

#### 安装插件

```sh
pnpm add @weapp-vite/plugin-wevu
```

#### 配置插件

```ts
import { wevuPlugin } from '@weapp-vite/plugin-wevu'

export default {
  plugins: [
    wevuPlugin({
      include: ['src/pages', 'src/components'],
      outputRoot: 'dist'
    })
  ]
}
```

#### 插件选项

- `include`：指定需要处理的文件路径
- `outputRoot`：指定编译后文件的输出根目录

插件会自动监听 Vue 文件的变化，并在开发过程中实时编译。编译过程包括：
1. 解析 Vue SFC 的 script、template、style 和 config 部分
2. 将各部分转换为小程序对应的 js、wxml、wxss 和 json 文件
3. 处理样式作用域和脚本依赖

### 运行时机制

plugin-wevu 的运行时实现了 Vue 风格的响应式系统，包括：

- **数据绑定**：通过 setData 实现数据更新
- **计算属性**：支持 computed 定义
- **方法调用**：支持 methods 定义
- **侦听器**：支持 watch 定义
- **组合式 API**：支持 setup 函数

运行时通过代理模式将 Vue 组件的逻辑映射到小程序的页面和组件生命周期中。

**Section sources**
- [index.ts](file://packages/plugin-wevu/src/index.ts#L1-L5)
- [plugin.ts](file://packages/plugin-wevu/src/plugin.ts#L1-L313)
- [runtime.ts](file://packages/plugin-wevu/src/runtime.ts#L1-L344)

## 其他构建工具集成

weapp-vite 设计时考虑了与其他构建工具和开发环境的兼容性，提供了灵活的集成方案。

### 与现有项目集成

对于已经使用其他构建工具的项目，可以通过以下步骤迁移到 weapp-vite：

1. 安装 weapp-vite 作为开发依赖
2. 配置 vite.config.ts 文件
3. 调整项目结构以适应 weapp-vite 的约定
4. 逐步替换原有的构建脚本

### 开发环境配置

weapp-vite 支持多种开发环境配置，包括：

- **环境变量**：通过 .env 文件管理不同环境的配置
- **多平台构建**：支持同时为不同小程序平台构建
- **调试工具**：集成源码映射和错误提示

### 持续集成

weapp-vite 可以轻松集成到 CI/CD 流程中，支持：

- 自动化构建
- 代码质量检查
- 单元测试
- 部署发布

## 常见问题与解决方案

### Tailwind CSS 类名未生效

**问题原因**：Tailwind CSS 的按需提取功能可能没有正确扫描到所有文件。

**解决方案**：
1. 检查 tailwind.config.ts 中的 content 配置是否包含了所有相关文件路径
2. 确保文件扩展名正确（如 .wxml、.js、.ts）
3. 重启开发服务器以重新扫描文件

### UI 组件样式冲突

**问题原因**：小程序的样式作用域机制可能导致样式冲突。

**解决方案**：
1. 使用组件库推荐的样式隔离方案
2. 在 app.json 中正确配置组件引用
3. 避免在全局样式中覆盖组件库的样式

### 自动导入组件不工作

**问题原因**：自动导入解析器未正确配置或组件列表不完整。

**解决方案**：
1. 检查 vite.config.ts 中的 autoImportComponents 配置
2. 确认使用的解析器（TDesignResolver 或 VantResolver）正确导入
3. 验证组件库版本是否与解析器兼容

### 构建性能问题

**问题原因**：大型项目可能遇到构建性能瓶颈。

**解决方案**：
1. 使用分包功能减少主包大小
2. 优化依赖树，移除不必要的依赖
3. 启用缓存机制
4. 调整构建配置，如减少 source map 的生成

### TypeScript 类型错误

**问题原因**：类型定义文件未正确配置或路径映射缺失。

**解决方案**：
1. 检查 tsconfig.json 中的 paths 配置
2. 确保类型定义文件已正确安装
3. 使用绝对路径或正确的相对路径引用模块