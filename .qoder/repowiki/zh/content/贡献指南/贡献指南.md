# 贡献指南

<cite>
**本文档中引用的文件**  
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [README.md](file://README.md)
- [package.json](file://package.json)
- [eslint.config.js](file://eslint.config.js)
- [commitlint.config.ts](file://commitlint.config.ts)
- [vitest.config.ts](file://vitest.config.ts)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)
- [turbo.json](file://turbo.json)
- [lint-staged.config.js](file://lint-staged.config.js)
- [stylelint.config.js](file://stylelint.config.js)
- [@weapp-core/init/package.json](file://@weapp-core/init/package.json)
- [packages/weapp-vite/package.json](file://packages/weapp-vite/package.json)
- [packages/create-weapp-vite/package.json](file://packages/create-weapp-vite/package.json)
- [@weapp-core/init/test/index.test.ts](file://@weapp-core/init/test/index.test.ts)
- [e2e/index.test.ts](file://e2e/index.test.ts)
</cite>

## 目录
1. [介绍](#介绍)
2. [开发环境搭建](#开发环境搭建)
3. [代码风格与提交规范](#代码风格与提交规范)
4. [测试策略](#测试策略)
5. [Pull Request流程与代码审查](#pull-request流程与代码审查)
6. [贡献示例](#贡献示例)
7. [项目架构与模块关系](#项目架构与模块关系)
8. [为贡献者提供的路径与期望](#为贡献者提供的路径与期望)

## 介绍

weapp-vite 是一个现代化的小程序打包工具，旨在为小程序开发提供现代化的开发体验。本贡献指南旨在为开发者提供清晰的路径和期望，帮助他们为项目做出贡献。通过遵循本指南，贡献者可以确保他们的贡献符合项目的标准和期望。

**Section sources**
- [README.md](file://README.md#L1-L52)

## 开发环境搭建

为了开始为weapp-vite项目贡献代码，首先需要搭建开发环境。以下是详细的步骤：

1. **克隆仓库**：使用 `git clone` 命令克隆weapp-vite仓库到本地。
2. **安装依赖**：项目使用pnpm作为包管理器，确保已安装pnpm，然后运行 `pnpm install` 安装所有依赖。
3. **配置脚本**：项目使用turbo作为任务运行器，可以通过 `turbo run` 命令执行各种任务，如构建、测试和lint。
4. **运行测试**：在进行任何更改之前，确保所有测试通过。可以使用 `pnpm test` 命令运行所有测试。

完成上述步骤后，您就可以开始为项目贡献代码了。

**Section sources**
- [package.json](file://package.json#L18-L43)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml#L1-L17)
- [turbo.json](file://turbo.json#L1-L35)

## 代码风格与提交规范

weapp-vite项目遵循严格的代码风格和提交规范，以确保代码的一致性和可维护性。

### ESLint和Prettier

项目使用ESLint进行代码质量检查，Prettier进行代码格式化。ESLint配置位于 `eslint.config.js` 文件中，Prettier配置集成在lint-staged中。贡献者在提交代码前应确保代码通过ESLint检查，并使用Prettier格式化。

### Commitlint

项目使用commitlint来规范提交信息的格式。提交信息必须遵循约定式提交（Conventional Commits）规范。commitlint配置位于 `commitlint.config.ts` 文件中。贡献者在提交代码时，应确保提交信息符合规范。

**Section sources**
- [eslint.config.js](file://eslint.config.js#L1-L49)
- [commitlint.config.ts](file://commitlint.config.ts#L1-L4)
- [lint-staged.config.js](file://lint-staged.config.js#L1-L12)
- [stylelint.config.js](file://stylelint.config.js#L1-L4)

## 测试策略

weapp-vite项目采用全面的测试策略，包括单元测试、集成测试和端到端测试，以确保代码的稳定性和可靠性。

### 单元测试

单元测试用于测试单个函数或模块的行为。项目使用Vitest作为测试框架，测试文件通常位于 `test` 目录下，文件名以 `.test.ts` 结尾。例如，`@weapp-core/init` 包的单元测试位于 `@weapp-core/init/test` 目录下。

### 集成测试

集成测试用于测试多个模块之间的交互。项目中的集成测试同样使用Vitest框架，确保不同模块协同工作时的正确性。

### 端到端测试

端到端测试用于模拟真实用户场景，测试整个应用的行为。项目使用 `miniprogram-automator` 进行端到端测试，测试文件位于 `e2e` 目录下。例如，`e2e/index.test.ts` 文件中的测试用例会启动小程序并检查页面的WXML输出。

**Section sources**
- [vitest.config.ts](file://vitest.config.ts#L1-L124)
- [@weapp-core/init/test/index.test.ts](file://@weapp-core/init/test/index.test.ts#L1-L60)
- [e2e/index.test.ts](file://e2e/index.test.ts#L1-L41)

## Pull Request流程与代码审查

贡献者在完成代码更改后，应通过Pull Request（PR）提交更改。PR流程包括以下步骤：

1. **创建分支**：从主分支创建一个新的特性分支。
2. **提交更改**：在特性分支上进行更改，并提交更改。
3. **推送分支**：将特性分支推送到远程仓库。
4. **创建PR**：在GitHub上创建PR，描述更改的内容和目的。
5. **代码审查**：项目维护者会对PR进行审查，提出修改建议。
6. **合并PR**：在通过审查后，PR将被合并到主分支。

代码审查标准包括代码质量、功能正确性、测试覆盖率和文档完整性。

**Section sources**
- [README.md](file://README.md#L29-L39)

## 贡献示例

为了帮助贡献者更好地理解如何为项目做出贡献，以下是几个实际的贡献示例：

### 修复bug

1. **识别问题**：在项目的问题列表中找到一个未解决的bug。
2. **复现问题**：在本地环境中复现该bug。
3. **编写测试**：编写一个失败的测试用例来验证bug的存在。
4. **修复代码**：修改代码以修复bug。
5. **运行测试**：确保所有测试通过。
6. **提交PR**：按照PR流程提交更改。

### 添加功能

1. **提出建议**：在项目的问题列表中提出新功能的建议。
2. **讨论设计**：与项目维护者讨论功能的设计和实现。
3. **实现功能**：编写代码实现新功能。
4. **编写测试**：为新功能编写单元测试和集成测试。
5. **更新文档**：更新相关文档以反映新功能。
6. **提交PR**：按照PR流程提交更改。

### 改进文档

1. **识别不足**：在项目文档中找到不清晰或缺失的部分。
2. **编写内容**：编写清晰、准确的文档内容。
3. **格式化文档**：确保文档格式符合项目标准。
4. **提交PR**：按照PR流程提交更改。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L4)

## 项目架构与模块关系

weapp-vite项目采用monorepo架构，包含多个包和应用。主要模块包括：

- **@weapp-core/init**：初始化项目的核心模块。
- **@weapp-core/logger**：日志记录模块。
- **@weapp-core/schematics**：代码生成模块。
- **@weapp-core/shared**：共享工具模块。
- **create-weapp-vite**：创建新项目的CLI工具。
- **weapp-vite**：核心打包工具。
- **weapp-ide-cli**：微信开发者工具的CLI插件。

这些模块通过pnpm workspace进行管理，确保依赖的一致性和版本的同步。

```mermaid
graph TD
A[@weapp-core/init] --> B[create-weapp-vite]
C[@weapp-core/logger] --> D[weapp-vite]
E[@weapp-core/schematics] --> D
F[@weapp-core/shared] --> D
G[weapp-ide-cli] --> D
B --> D
```

**Diagram sources**
- [package.json](file://package.json#L2-L165)
- [@weapp-core/init/package.json](file://@weapp-core/init/package.json#L1-L74)
- [packages/weapp-vite/package.json](file://packages/weapp-vite/package.json#L1-L156)
- [packages/create-weapp-vite/package.json](file://packages/create-weapp-vite/package.json#L1-L58)

**Section sources**
- [README.md](file://README.md#L15-L28)

## 为贡献者提供的路径与期望

weapp-vite项目欢迎所有形式的贡献，包括但不限于创建问题、提交PR、创建第三方中间件、分享想法和构建应用。项目维护者期望贡献者能够：

- 遵循代码风格和提交规范。
- 编写高质量的测试。
- 提供清晰的文档。
- 积极参与社区讨论。

通过遵循这些期望，贡献者可以帮助weapp-vite项目持续发展和改进。

**Section sources**
- [README.md](file://README.md#L31-L38)