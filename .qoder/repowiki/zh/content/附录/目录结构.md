# 目录结构

<cite>
**本文档中引用的文件**  
- [package.json](file://package.json)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)
- [turbo.json](file://turbo.json)
- [monorepo.config.ts](file://monorepo.config.ts)
- [@weapp-core/init/package.json](file://@weapp-core/init/package.json)
- [packages/weapp-vite/package.json](file://packages/weapp-vite/package.json)
- [apps/vite-native/package.json](file://apps/vite-native/package.json)
- [templates/weapp-vite-template/package.json](file://templates/weapp-vite-template/package.json)
- [website/package.json](file://website/package.json)
</cite>

## 目录结构

weapp-vite 项目采用 monorepo 架构，通过 pnpm workspace 和 turbo 工具进行高效管理。整个项目结构清晰，职责分明，支持多包协同开发和独立发布。项目主要由以下几个核心目录组成：`@weapp-core`、`packages`、`apps`、`templates` 和 `website`，每个目录都有明确的设计意图和功能定位。

```mermaid
graph TD
A[weapp-vite 项目根目录] --> B[@weapp-core]
A --> C[packages]
A --> D[apps]
A --> E[templates]
A --> F[website]
A --> G[assets]
A --> H[docs]
A --> I[e2e]
A --> J[scripts]
A --> K[.gitignore]
A --> L[package.json]
A --> M[pnpm-workspace.yaml]
A --> N[turbo.json]
A --> O[monorepo.config.ts]
B --> B1[init]
B --> B2[logger]
B --> B3[schematics]
B --> B4[shared]
C --> C1[create-weapp-vite]
C --> C2[mcp]
C --> C3[plugin-wevu]
C --> C4[rolldown-require]
C --> C5[vite-plugin-performance]
C --> C6[volar]
C --> C7[weapp-ide-cli]
C --> C8[weapp-vite]
C --> C9[web]
C --> C10[wevu]
D --> D1[ast]
D --> D2[playground]
D --> D3[plugin-demo]
D --> D4[raw-ts]
D --> D5[rollup-watcher]
D --> D6[subpackage-shared-chunks]
D --> D7[tdesign-miniprogram-starter-retail]
D --> D8[vite-native]
D --> D9[vite-native-skyline]
D --> D10[vite-native-ts]
D --> D11[vite-native-ts-skyline]
D --> D12[weapp-vite-web-demo]
D --> D13[weapp-wechat-zhihu]
D --> D14[wevu-runtime-demo]
D --> D15[wevu-vue-demo]
E --> E1[weapp-vite-tailwindcss-tdesign-template]
E --> E2[weapp-vite-tailwindcss-template]
E --> E3[weapp-vite-tailwindcss-vant-template]
E --> E4[weapp-vite-template]
F --> F1[api]
F --> F2[blog]
F --> F3[community]
F --> F4[config]
F --> F5[deep]
F --> F6[demos/aa]
F --> F7[guide]
F --> F8[integration]
F --> F9[migration]
F --> F10[packages/rolldown-require]
F --> F11[public]
F --> F12[snippets]
F --> F13[troubleshoot]
F --> F14[typedoc-api]
```

**Diagram sources**
- [package.json](file://package.json)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)

**Section sources**
- [package.json](file://package.json)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)
- [turbo.json](file://turbo.json)
- [monorepo.config.ts](file://monorepo.config.ts)

## 核心目录分析

### @weapp-core 目录

`@weapp-core` 目录包含了项目的核心工具和共享库，这些包为整个 monorepo 提供基础支持。该目录下的每个包都是独立的 npm 包，可以单独发布和维护。

- **init**: 提供项目初始化功能，包含创建新项目的脚本和模板。该包负责处理项目创建过程中的各种配置文件生成和依赖安装。
- **logger**: 提供统一的日志记录功能，确保整个项目中的日志输出格式一致。
- **schematics**: 提供代码生成器功能，支持通过 schematics 生成代码模板。
- **shared**: 包含项目中多个包共享的工具函数和常量。

这些核心包通过 `workspace:*` 依赖关系被其他包引用，确保了版本的一致性和开发的便利性。

**Section sources**
- [@weapp-core/init/package.json](file://@weapp-core/init/package.json)

### packages 目录

`packages` 目录包含了项目的主要功能包，这些包构成了 weapp-vite 的核心功能体系。每个包都有明确的职责和功能定位。

- **create-weapp-vite**: 提供命令行工具，用于快速创建新的 weapp-vite 项目。
- **weapp-vite**: 项目的核心打包工具，负责小程序的构建、开发服务器和各种插件集成。
- **weapp-ide-cli**: 为微信开发者工具提供 CLI 支持，增强开发体验。
- **vite-plugin-performance**: 提供性能分析插件，帮助开发者优化小程序性能。
- **rolldown-require**: 自定义的打包工具，用于处理特定的模块依赖关系。
- **plugin-wevu**: 支持 wevu 框架的插件，实现 Vue 风格的小程序开发。

这些包通过 `package.json` 中的 `exports` 字段提供清晰的模块导出接口，支持 tree-shaking 和按需加载。

**Section sources**
- [packages/weapp-vite/package.json](file://packages/weapp-vite/package.json)

### apps 目录

`apps` 目录包含了多个示例应用和测试项目，这些应用主要用于验证 weapp-vite 的功能和作为开发参考。

- **vite-native**: 原生小程序示例，展示了基本的 weapp-vite 集成。
- **vite-native-ts**: TypeScript 小程序示例，展示了 TypeScript 支持。
- **vite-native-skyline**: Skyline 渲染引擎示例，展示了新渲染引擎的支持。
- **weapp-vite-web-demo**: Web 端集成示例，展示了跨平台开发能力。
- **wevu-vue-demo**: Vue 风格小程序示例，展示了 wevu 框架的使用。
- **plugin-demo**: 插件开发示例，展示了如何开发和集成自定义插件。

这些示例应用通过 `devDependencies` 引用 `weapp-vite`，确保了开发环境的一致性。

**Section sources**
- [apps/vite-native/package.json](file://apps/vite-native/package.json)

### templates 目录

`templates` 目录包含了项目模板，这些模板用于快速创建不同配置的小程序项目。

- **weapp-vite-template**: 基础模板，包含最基本的 weapp-vite 配置。
- **weapp-vite-tailwindcss-template**: 集成 Tailwind CSS 的模板。
- **weapp-vite-tailwindcss-tdesign-template**: 集成 Tailwind CSS 和 TDesign 组件库的模板。
- **weapp-vite-tailwindcss-vant-template**: 集成 Tailwind CSS 和 Vant Weapp 组件库的模板。

这些模板包含了完整的项目配置，包括 `tsconfig.json`、`vite.config.ts` 和 `project.config.json`，确保新项目开箱即用。

**Section sources**
- [templates/weapp-vite-template/package.json](file://templates/weapp-vite-template/package.json)

### website 目录

`website` 目录包含了项目的文档网站，使用 VitePress 构建，提供详细的使用文档和 API 参考。

- **guide**: 使用指南，包含各种功能的详细说明。
- **config**: 配置参考，详细说明各种配置选项。
- **api**: API 文档，自动生成的 TypeScript API 参考。
- **integration**: 集成指南，说明如何与其他工具和框架集成。
- **migration**: 迁移指南，帮助用户从旧版本升级。

文档网站通过 `typedoc` 自动生成 API 文档，并集成 `mermaid` 支持图表展示。

**Section sources**
- [website/package.json](file://website/package.json)

## 包管理策略

weapp-vite 项目采用 monorepo 架构，通过 pnpm workspace 实现高效的包管理。`pnpm-workspace.yaml` 文件定义了工作区包含的包：

```yaml
packages:
  - apps/*
  - templates/*
  - packages/*
  - '@weapp-core/*'
  - website
  - '!**/test/**'
```

这种配置允许所有指定目录下的包共享依赖，避免重复安装。`shamefullyHoist: true` 配置将依赖提升到根节点，提高安装效率。

项目使用 turbo 作为构建工具，`turbo.json` 文件定义了任务依赖关系：

```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "lint": {
      "dependsOn": ["^lint"],
      "outputs": []
    }
  }
}
```

这种配置确保了构建任务的正确执行顺序，同时支持缓存优化。

## 配置文件体系

项目采用分层的配置文件体系，确保配置的灵活性和可维护性。

### 根目录配置

- **package.json**: 定义项目元数据和脚本命令，包含 `turbo` 相关的构建脚本。
- **tsconfig.json**: 根 TypeScript 配置，被其他配置文件继承。
- **vite.config.ts**: 根 Vite 配置（如果存在）。

### 包级配置

每个包都有自己的配置文件：

- **package.json**: 定义包的元数据、依赖和构建脚本。
- **tsconfig.json**: 包特定的 TypeScript 配置。
- **tsup.config.ts**: 使用 tsup 进行构建的配置。
- **vitest.config.ts**: 测试配置。

### 应用配置

示例应用包含完整的项目配置：

- **project.config.json**: 微信小程序项目配置。
- **vite.config.ts**: Vite 构建配置。
- **tsconfig.json**: TypeScript 配置。

## 目录结构优势

weapp-vite 的目录结构设计具有以下优势：

1. **可维护性**: monorepo 架构使得相关代码集中管理，便于统一维护和版本控制。
2. **扩展性**: 模块化设计使得新功能可以轻松添加，不影响现有代码。
3. **开发效率**: 共享工具和配置减少了重复工作，提高开发效率。
4. **一致性**: 统一的代码风格和配置确保了项目的一致性。
5. **文档完善**: 内置的文档网站提供了完整的使用指南和 API 参考。

## 新贡献者导航指南

对于新贡献者，建议按照以下路径了解项目：

1. 从 `README.md` 开始，了解项目整体情况。
2. 查看 `packages/weapp-vite` 目录，了解核心功能实现。
3. 运行 `apps/vite-native` 示例，体验实际效果。
4. 查阅 `website` 文档，深入了解使用方法。
5. 参考 `templates` 中的模板，了解项目初始化过程。

通过这种结构化的学习路径，新贡献者可以快速上手并开始贡献代码。

**Section sources**
- [package.json](file://package.json)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)
- [turbo.json](file://turbo.json)
- [monorepo.config.ts](file://monorepo.config.ts)
- [@weapp-core/init/package.json](file://@weapp-core/init/package.json)
- [packages/weapp-vite/package.json](file://packages/weapp-vite/package.json)
- [apps/vite-native/package.json](file://apps/vite-native/package.json)
- [templates/weapp-vite-template/package.json](file://templates/weapp-vite-template/package.json)
- [website/package.json](file://website/package.json)