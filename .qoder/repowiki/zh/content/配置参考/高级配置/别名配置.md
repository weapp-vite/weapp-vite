# 别名配置

<cite>
**本文档引用的文件**
- [alias.ts](file://packages/weapp-vite/src/runtime/config/internal/alias.ts)
- [config.ts](file://packages/weapp-vite/src/types/config.ts)
- [json.ts](file://packages/weapp-vite/src/utils/json.ts)
- [vite.config.ts](file://apps/vite-native/vite.config.ts)
- [alias.md](file://website/guide/alias.md)
- [json.md](file://website/config/json.md)
</cite>

## 目录
1. [简介](#简介)
2. [JS/TS 别名配置](#jsts-别名配置)
3. [JSON/JSONC 别名配置](#jsonjsonc-别名配置)
4. [别名配置语法详解](#别名配置语法详解)
5. [实际配置示例](#实际配置示例)
6. [与 TypeScript 路径映射的协同工作](#与-typescript-路径映射的协同工作)
7. [常见问题与调试技巧](#常见问题与调试技巧)

## 简介

`weapp-vite` 提供了强大的别名配置功能，支持在 JS/TS 和 JSON/JSONC 文件中使用别名来简化模块导入路径。通过别名配置，开发者可以避免深层级的 `../../` 路径引用，提高代码的可读性和可维护性。本文档将深入讲解别名配置的实现原理和使用方法。

**Section sources**
- [alias.md](file://website/guide/alias.md#L1-L151)

## JS/TS 别名配置

`weapp-vite` 在项目内部默认启用了 `vite-tsconfig-paths` 插件，因此只需要在 `tsconfig.json` 或 `jsconfig.json` 中配置 `baseUrl` 和 `paths`，即可在项目中直接使用别名。

### 配置方法

在 `tsconfig.json` 中添加以下配置：

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": [
        "src/*"
      ],
      "@components/*": [
        "src/components/*"
      ],
      "@utils/*": [
        "src/utils/*"
      ]
    }
  }
}
```

配置完成后，就可以在代码中使用别名：

```ts
import utils from '@/utils/helper'
import Button from '@components/Button'
```

**Section sources**
- [alias.md](file://website/guide/alias.md#L13-L42)

## JSON/JSONC 别名配置

`weapp-vite` 对所有 JSON 配置文件进行了增强，支持在 JSON/JSONC 文件中使用别名映射，帮助更好地组织大型项目。

### 启用 JSON 别名

在 `vite.config.ts` 中配置 `weapp.jsonAlias.entries`：

```ts
import type { UserConfig } from 'weapp-vite/config'
import path from 'node:path'

export default <UserConfig>{
  weapp: {
    jsonAlias: {
      entries: [
        {
          find: '@',
          replacement: path.resolve(__dirname, 'src/components'),
        },
        {
          find: '@assets',
          replacement: path.resolve(__dirname, 'src/assets'),
        },
      ],
    },
  },
}
```

### 配置语法

`weapp.jsonAlias.entries` 的配置语法与 Vite 的 `resolve.alias` 完全一致，支持字符串和正则表达式匹配。

**Section sources**
- [alias.md](file://website/guide/alias.md#L43-L146)
- [json.md](file://website/config/json.md#L7-L52)

## 别名配置语法详解

### 基本语法结构

别名配置的核心是 `find` 和 `replacement` 两个属性：

- `find`: 要匹配的别名前缀
- `replacement`: 替换为的实际路径

### 通配符使用

支持使用通配符进行批量匹配：

```ts
{
  entries: [
    {
      find: '@/*',
      replacement: path.resolve(__dirname, 'src/*'),
    },
  ],
}
```

### 正则表达式匹配

支持使用正则表达式进行更复杂的匹配：

```ts
{
  entries: [
    {
      find: /^@icons\//,
      replacement: path.resolve(__dirname, 'src/assets/icons/'),
    },
  ],
}
```

### 优先级规则

别名配置遵循以下优先级规则：

1. 数组中靠前的配置优先级更高
2. 字符串匹配优先于正则表达式匹配
3. 精确匹配优先于通配符匹配

**Section sources**
- [config.ts](file://packages/weapp-vite/src/types/config.ts#L16-L49)
- [alias.ts](file://packages/weapp-vite/src/runtime/config/internal/alias.ts#L1-L60)

## 实际配置示例

### 单个别名配置

```ts
{
  weapp: {
    jsonAlias: {
      entries: [
        {
          find: '@',
          replacement: path.resolve(__dirname, 'components'),
        },
      ],
    },
  },
}
```

### 批量别名配置

```ts
{
  weapp: {
    jsonAlias: {
      entries: [
        {
          find: '@components',
          replacement: path.resolve(__dirname, 'src/components'),
        },
        {
          find: '@pages',
          replacement: path.resolve(__dirname, 'src/pages'),
        },
        {
          find: '@assets',
          replacement: path.resolve(__dirname, 'src/assets'),
        },
      ],
    },
  },
}
```

### 嵌套别名配置

```ts
{
  weapp: {
    jsonAlias: {
      entries: [
        {
          find: '@ui/*',
          replacement: path.resolve(__dirname, 'src/components/ui/*'),
        },
        {
          find: '@layout/*',
          replacement: path.resolve(__dirname, 'src/components/layout/*'),
        },
      ],
    },
  },
}
```

**Section sources**
- [vite.config.ts](file://apps/vite-native/vite.config.ts#L59-L67)

## 与 TypeScript 路径映射的协同工作

`weapp-vite` 的别名配置与 TypeScript 路径映射可以协同工作，确保在不同文件类型中使用一致的路径前缀。

### 配置一致性

为了确保一致性，建议在 `tsconfig.json` 和 `vite.config.ts` 中使用相同的别名前缀：

```json
// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"]
    }
  }
}
```

```ts
// vite.config.ts
{
  weapp: {
    jsonAlias: {
      entries: [
        {
          find: '@',
          replacement: path.resolve(__dirname, 'src'),
        },
        {
          find: '@components',
          replacement: path.resolve(__dirname, 'src/components'),
        },
      ],
    },
  },
}
```

### 避免配置冲突

为了避免配置冲突，需要注意以下几点：

1. 确保 `tsconfig.json` 中的 `baseUrl` 与 `vite.config.ts` 中的路径解析一致
2. 避免在不同配置文件中使用相同的别名前缀但指向不同的路径
3. 在 monorepo 项目中，可以通过 `weapp.tsconfigPaths.projects` 指定多个 `tsconfig` 文件

**Section sources**
- [alias.md](file://website/guide/alias.md#L3-L151)
- [config.ts](file://packages/weapp-vite/src/types/config.ts#L382-L383)

## 常见问题与调试技巧

### 别名未生效

**问题原因**：`tsconfig` 修改后需要重新启动开发服务器。

**解决方案**：重启 `pnpm dev` 进程，确保 Rolldown 能读取新的 `paths` 配置。

### JSON 中提示路径不存在

**问题原因**：开发者工具的校验不理解别名是正常现象。

**解决方案**：编译产物仍会替换为真实路径。若想在 IDE 内消除警告，可借助自定义类型定义或在 `usingComponents` 上方写注释标记。

### 调试技巧

1. 使用 `console.log` 输出解析后的路径
2. 检查构建产物中的实际路径
3. 使用 `vite-plugin-inspect` 插件查看别名解析过程
4. 在 `vite.config.ts` 中启用 `debug` 选项查看详细的解析日志

**Section sources**
- [alias.md](file://website/guide/alias.md#L146-L151)
- [json.ts](file://packages/weapp-vite/src/utils/json.ts#L61-L75)